{"version":3,"sources":["../../../js/activity/builtin/findPath.js"],"names":["define","defineComponent","F","withDataRequest","FindPath","after","$node","empty","trigger","defaultAttrs","pathsSelector","addVerticesSelector","on","onPathClick","onAddVertices","loadDefaultContent","document","onFocusPaths","onDefocusPaths","onWorkspaceLoaded","updateButton","$button","workspaceId","self","onDifferentWorkspace","attr","process","noResults","resultsCount","disabled","prop","Boolean","i18n","event","data","select","count","$","addClass","text","number","pretty","openlumifyData","currentWorkspaceId","append","processId","id","$target","target","dataRequest","done","paths","results","vertices","_","chain","flatten","uniq","value","labels","sourceId","outVertexId","targetId","inVertexId","hide","$addButton","length"],"mappings":"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","file":"findPath.js","sourcesContent":["/*eslint no-labels:0*/\ndefine([\n    'flight/lib/component',\n    'util/formatters',\n    'util/withDataRequest'\n], function(\n    defineComponent,\n    F,\n    withDataRequest) {\n    'use strict';\n\n    return defineComponent(FindPath, withDataRequest);\n\n    function FindPath() {\n\n        this.after('teardown', function() {\n            this.$node.empty();\n            this.trigger('defocusPaths');\n        });\n\n        this.defaultAttrs({\n            pathsSelector: '.found-paths',\n            addVerticesSelector: '.add-vertices'\n        });\n\n        this.after('initialize', function() {\n\n            this.on('click', {\n                pathsSelector: this.onPathClick,\n                addVerticesSelector: this.onAddVertices\n            });\n\n            this.loadDefaultContent();\n\n            this.on(document, 'focusPaths', this.onFocusPaths);\n            this.on(document, 'defocusPaths', this.onDefocusPaths);\n            this.on(document, 'workspaceLoaded', this.onWorkspaceLoaded);\n        });\n\n        this.updateButton = function($button, workspaceId) {\n            var self = this,\n                onDifferentWorkspace = workspaceId !== this.attr.process.workspaceId,\n                noResults = (self.attr.process.resultsCount || 0) === 0,\n                disabled = onDifferentWorkspace || noResults;\n\n            $button.prop('disabled', Boolean(disabled));\n\n            $button.attr('title', onDifferentWorkspace ?\n                i18n('popovers.find_path.wrong_workspace') :\n                i18n('popovers.find_path.show_path'));\n        };\n\n        this.onWorkspaceLoaded = function(event, data) {\n            this.updateButton(this.select('pathsSelector'), data.workspaceId);\n        };\n\n        this.loadDefaultContent = function() {\n            var count = this.attr.process.resultsCount || 0,\n                $button = $('<button>').addClass('found-paths btn btn-mini')\n                    .text(\n                        i18n('popovers.find_path.paths.' + (\n                             count === 0 ? 'none' : count === 1 ? 'one' : 'some'\n                        ), F.number.pretty(count))\n                    );\n\n            this.updateButton($button, openlumifyData.currentWorkspaceId);\n\n            this.$node.empty().append($button);\n        };\n\n        this.onFocusPaths = function(event, data) {\n            if (data.processId !== this.attr.process.id) {\n                this.loadDefaultContent();\n            }\n        };\n\n        this.onDefocusPaths = function(event, data) {\n            this.loadDefaultContent();\n        };\n\n        this.onAddVertices = function(event) {\n            this.trigger('focusPathsAddVertexIds');\n            this.loadDefaultContent();\n        };\n\n        this.onPathClick = function(event) {\n            var self = this,\n                $target = $(event.target).addClass('loading').prop('disabled', true);\n\n            this.dataRequest('longRunningProcess', 'get', this.attr.process.id)\n                .done(function(process) {\n                    var paths = process.results && process.results.paths || [],\n                        vertices = _.chain(paths).flatten().uniq().value();\n\n                    self.trigger('focusPaths', {\n                        paths,\n                        labels: process.labels,\n                        sourceId: self.attr.process.outVertexId,\n                        targetId: self.attr.process.inVertexId,\n                        processId: self.attr.process.id\n                    });\n\n                    $target.hide();\n\n                    var $addButton = $('<button>').addClass('btn btn-mini btn-primary add-vertices');\n\n                    if (vertices.length === 0) {\n                        $addButton.prop('disabled', true);\n                    }\n\n                    $addButton.text(i18n('popovers.find_path.add'));\n                    self.$node.append($addButton);\n                })\n        };\n    }\n});\n"]}