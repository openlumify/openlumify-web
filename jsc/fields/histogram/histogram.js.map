{"version":3,"sources":["../../../js/fields/histogram/histogram.js"],"names":["define","defineComponent","template","d3","withDataRequest","Color","productSelectors","HEIGHT","ALL_DATES","BRUSH_PADDING","BRUSH_TEXT_PADDING","BRUSH_BACKGROUND_HEIGHT","MAX_ZOOM_IN","MAX_ZOOM_OUT","DAY","Histogram","inDomain","d","xScale","domain","margin","top","right","bottom","left","defaultAttrs","noDataMessageSelector","noDataMessageDetailsText","i18n","includeYAxis","before","subscription","after","$node","html","attr","triggerChange","_","debounce","bind","onGraphPaddingUpdated","on","document","onWorkspaceLoaded","onObjectsSelected","onVerticesUpdated","onEdgesUpdated","onPropertyConfigChanged","onFitHistogram","watchForProductChanges","property","title","dataType","currentSelected","vertexIds","edgeIds","redraw","throttle","renderChart","openlumifyData","storePromise","then","store","observe","getProduct","newProduct","updateBarSelection","zoom","scale","translate","event","svg","data","filteredPropertyIris","properties","selectedVertices","vertices","selectedEdges","edges","selectedEdgeIds","pluck","sort","selectedVertexIds","options","fromHistogram","clearBrush","self","padding","width","scrollParent","height","find","range","focus","style","rebin","skipAnimation","debouncedBin","shouldSkipAnimation","binCount","binValues","yScale","max","layer","values","y0","y","select","call","yAxis","selectAll","createBars","brush","x","xAxis","orient","currentExtent","selectedObjectIds","getObjectIdsForExtent","isEqual","extend","extent","isDate","isDateTime","displayType","allDates","ontology","ticks","isArray","map","isFunction","getTime","count","length","histogram","layout","value","bins","histogramsByConcept","chain","groupBy","mapObject","conceptValues","buckets","filter","v","contains","propertyIri","each","bucket","time","day","floor","Date","pairs","kv","conceptIri","ontologyConcept","concepts","byId","relationships","byTitle","normalColor","color","setLightness","setSaturation","toString","dimColor","stack","conceptData","flatten","partition","i","object","trigger","results","Promise","all","dataRequest","vals","forEach","getTimezoneOffset","ontologyProperties","foundOntologyProperties","valuesExtent","calculateValuesExtent","createXScale","linear","axis","tickSize","brushedTextFormat","tickFormat","format","tickValues","onZoomedUpdate","updateBrushInfo","updateFocusInfo","onZoomed","scaleChange","previousScale","translateChange","previousTranslate","createZoomBehavior","svgOuter","node","enter","append","mousemove","toElement","$","closest","preventDragOverGraph","class","stopPropagation","axisOverlay","svgBackground","gBrush","barGroup","insert","bars","gBrushRects","not","toArray","gBrushText","gBrushTextStartBackground","gBrushTextEndBackground","gBrushTextStart","Math","gBrushTextEnd","multi","getMilliseconds","getSeconds","getMinutes","getHours","getDay","getDate","getMonth","replace","min","delta","rawValues","offset","days","parseInt","round","maxZoomIn","maxZoomOut","behavior","scaleExtent","objectsForExtent","text","clear","mouse","x0","invert","firstNonEmpty","dx","barLayers","reverse","order","groupData","animationDuration","hasData","css","classed","any","o","vertexId","edgeId","transition","duration","exitingBars","exit","remove","timer","flush","xy","xInv","compact","selected","anySelected","currentColor"],"mappings":"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","file":"histogram.js","sourcesContent":["define([\n    'flight/lib/component',\n    './histogramTpl.hbs',\n    'd3',\n    'util/withDataRequest',\n    'colorjs',\n    'data/web-worker/store/product/selectors'\n], function(\n    defineComponent,\n    template,\n    d3,\n    withDataRequest,\n    Color,\n    productSelectors) {\n    'use strict';\n\n    var HEIGHT = 100,\n        ALL_DATES = 'ALL_DATES',\n        BRUSH_PADDING = 0,\n        BRUSH_TEXT_PADDING = 2,\n        BRUSH_BACKGROUND_HEIGHT = 13,\n        MAX_ZOOM_IN = 1000,\n        MAX_ZOOM_OUT = 100,\n        DAY = 24 * 60 * 60 * 1000;\n\n    return defineComponent(Histogram, withDataRequest);\n\n    function inDomain(d, xScale) {\n        var domain = xScale.domain();\n        return d > domain[0] && d < domain[1];\n    }\n\n    function Histogram() {\n\n        var margin = {top: 6, right: 16, bottom: 40, left: 16};\n\n        this.defaultAttrs({\n            noDataMessageSelector: '.no-data-message',\n            noDataMessageDetailsText: i18n('histogram.no_data_details'),\n            includeYAxis: false\n        });\n\n        this.before('teardown', function() {\n            if (this.subscription) {\n                this.subscription();\n            }\n        })\n\n        this.after('initialize', function() {\n            this.$node.html(template({\n                noDataMessageDetailsText: this.attr.noDataMessageDetailsText\n            }));\n\n            this.triggerChange = _.debounce(this.triggerChange.bind(this), 500);\n            this.onGraphPaddingUpdated = _.debounce(this.onGraphPaddingUpdated.bind(this), 500);\n            this.on(document, 'graphPaddingUpdated', this.onGraphPaddingUpdated);\n            this.on(document, 'workspaceLoaded', this.onWorkspaceLoaded);\n            this.on(document, 'objectsSelected', this.onObjectsSelected);\n            this.on(document, 'verticesUpdated', this.onVerticesUpdated);\n            this.on(document, 'edgesUpdated', this.onEdgesUpdated);\n            this.on('propertyConfigChanged', this.onPropertyConfigChanged);\n            this.on('fitHistogram', this.onFitHistogram);\n\n            this.watchForProductChanges();\n\n            if (!this.attr.property) {\n                this.attr.property = {\n                    title: ALL_DATES,\n                    dataType: 'date'\n                }\n            }\n\n            this.currentSelected = { vertexIds: [], edgeIds: [] };\n            this.redraw = _.throttle(this.redraw.bind(this), 16);\n\n            this.renderChart();\n        });\n\n        this.watchForProductChanges = function() {\n            openlumifyData.storePromise.then(store => {\n                this.subscription = store.observe(productSelectors.getProduct, (newProduct) => {\n                    if (newProduct) {\n                        this.renderChart().then(() => this.updateBarSelection(this.currentSelected));\n                    }\n                });\n            });\n        }\n\n        this.onFitHistogram = function() {\n            this.zoom.scale(1).translate([0, 0]).event(this.svg);\n        };\n\n        this.onPropertyConfigChanged = function(event, data) {\n            this.filteredPropertyIris = data.properties;\n            this.redraw(true);\n        };\n\n        this.onObjectsSelected = function(event, data) {\n            var selectedVertices = (data && data.vertices) || [],\n                selectedEdges = (data && data.edges) || [],\n                selectedEdgeIds = _.pluck(selectedEdges, 'id').sort(),\n                selectedVertexIds = _.pluck(selectedVertices, 'id').sort();\n\n            if (!data.options.fromHistogram) {\n                this.clearBrush();\n            }\n\n            this.currentSelected = { vertexIds: selectedVertexIds, edgeIds: selectedEdgeIds };\n            this.updateBarSelection(this.currentSelected);\n        };\n\n        this.onEdgesUpdated = function() {\n            var self = this;\n\n            this.renderChart().then(function() {\n                self.updateBarSelection(self.currentSelected);\n            });\n        };\n\n        this.onVerticesUpdated = function() {\n            var self = this;\n\n            this.renderChart().then(function() {\n                self.updateBarSelection(self.currentSelected);\n            });\n        };\n\n        this.onWorkspaceLoaded = function() {\n            this.renderChart();\n        };\n\n        this.onGraphPaddingUpdated = function(event, data) {\n            if (this.xScale) {\n                var padding = data.padding,\n                    width = this.width = this.$node.scrollParent().width() - margin.left - margin.right,\n                    height = width / (16 / 9);\n\n                this.$node.find('svg').attr('width', width + margin.left + margin.right);\n\n                this.xScale.range([0, width]);\n                this.focus.style('display', 'none');\n                this.redraw();\n            }\n        };\n\n        this.redraw = function(rebin, skipAnimation) {\n            var self = this;\n\n            if (rebin) {\n                if (!this.debouncedBin) {\n                    this.debouncedBin = _.debounce(function(shouldSkipAnimation) {\n                        self.binCount = null;\n                        self.data = self.binValues();\n                        self.yScale.domain([0, d3.max(self.data, function(layer) {\n                            return d3.max(layer.values, function(d) {\n                                return d.y0 + d.y;\n                            });\n                        }) || 0]);\n\n                        if (self.attr.includeYAxis) {\n                            self.svg.select('.y.axis').call(self.yAxis)\n                                                      .selectAll('.tick text')\n                        }\n\n                        self.redraw(false, shouldSkipAnimation);\n                    }, 250);\n                }\n                this.debouncedBin(skipAnimation);\n            }\n\n            this.createBars(this.data, skipAnimation);\n            this.svg.select('.brush').call(this.brush.x(this.xScale));\n            this.svg.select('.x.axis').call(this.xAxis.orient('bottom'));\n\n            if (this.currentExtent) {\n                var selectedObjectIds = this.getObjectIdsForExtent(this.currentExtent);\n                if (!_.isEqual(selectedObjectIds, this.currentSelected)) {\n                    this.currentSelected = selectedObjectIds;\n                    this.triggerChange(_.extend({ extent: this.currentExtent }, this.currentSelected));\n                }\n            }\n        };\n\n        this.binValues = function() {\n            var isDate = this.attr.property.dataType === 'date',\n                isDateTime = this.attr.property.displayType !== 'dateOnly',\n                allDates = this.attr.property.title === ALL_DATES,\n                xScale = this.xScale,\n                ontology = this.ontology;\n\n            if (!this.binCount) {\n                this.binCount = allDates ? xScale.ticks(100) : isDate ? xScale.ticks(25) : 25;\n                if (_.isArray(this.binCount)) {\n                    this.binCount = _.map(this.binCount, function(d) {\n                        return _.isFunction(d.getTime) ? d.getTime() : d;\n                    });\n                }\n            }\n\n            var self = this,\n                count = this.values.length === 0 ? 0 : this.binCount,\n                histogram = d3.layout.histogram()\n                    .value(_.property('value'))\n                    .bins(count),\n                histogramsByConcept = _.chain(this.values)\n                    .groupBy('conceptIri')\n                    .mapObject(function(conceptValues) {\n                        var buckets = histogram(_.filter(conceptValues, function(v) {\n                            if (self.filteredPropertyIris) {\n                                if (!_.contains(self.filteredPropertyIris, v.propertyIri)) {\n                                    return false;\n                                }\n                            }\n                            return inDomain(v.value, xScale);\n                        }));\n                        _.each(buckets, function(bucket) {\n                            bucket.x = isDate && !isDateTime ? d3.time.day.floor(bucket.x) : new Date(bucket.x)\n                        });\n                        return buckets;\n                    })\n                    .pairs()\n                    .map(function(kv) {\n                        var conceptIri = kv[0],\n                            ontologyConcept = ontology.concepts.byId[conceptIri] || ontology.relationships.byTitle[conceptIri];\n\n                        var normalColor = '#c4c4c4';\n                        if (ontologyConcept && ontologyConcept.color) {\n                            normalColor = new Color(ontologyConcept.color).setLightness(.6).setSaturation(.5).toString();\n                        }\n                        var dimColor = new Color(normalColor).setSaturation(.1).setLightness(.3).toString();\n\n                        return { conceptIri: conceptIri, values: kv[1], normalColor: normalColor, dimColor: dimColor };\n                    })\n                    .value(),\n                stack = d3.layout.stack().values(_.property('values'));\n\n            return _.each(stack(histogramsByConcept), function(conceptData) {\n                conceptData.values = _.filter(conceptData.values, _.property('length'));\n            });\n        }\n\n        this.getObjectIdsForExtent = function(extent) {\n            return _.chain(this.data || [])\n                    .map(function(d) {\n                        return _.filter(d.values, function(v) {\n                           return extent &&\n                               extent.length === 2 &&\n                               v.x >= extent[0] &&\n                               v.x <= extent[1];\n                        });\n                    })\n                    .flatten()\n                    .partition(function(d) {\n                        return 'vertexId' in d;\n                    })\n                    .map(function(d, i) {\n                        return i === 0 ?\n                            ['vertexIds', _.pluck(d, 'vertexId').sort()] :\n                            ['edgeIds', _.pluck(d, 'edgeId').sort()];\n                    })\n                    .object()\n                    .value();\n        };\n\n        this.triggerChange = function(data) {\n            this.trigger('updateHistogramExtent', data);\n        };\n\n        this.renderChart = function(results) {\n            var self = this;\n\n            if (!results) {\n                return Promise.all([\n                    this.dataRequest('workspace', 'histogramValues', this.attr.property),\n                    this.dataRequest('ontology', 'ontology')\n                ]).then(function(results) {\n                    return self.renderChart(results);\n                });\n            }\n\n            var vals = results[0],\n                isDate = this.attr.property.dataType === 'date',\n                isDateTime = isDate && this.attr.property.displayType !== 'dateOnly';\n\n            if (isDate && !isDateTime) {\n                vals.values.forEach(function(v) {\n                    v.value = v.value + (new Date(v.value).getTimezoneOffset() * 60000);\n                })\n            }\n\n            this.trigger('ontologyPropertiesRenderered', {\n                ontologyProperties: vals.foundOntologyProperties\n            });\n\n            var foundOntologyProperties = this.foundOntologyProperties = vals.foundOntologyProperties,\n\n                ontology = this.ontology = results[1],\n\n                values = this.values = vals.values,\n\n                width = this.width = this.$node.scrollParent().width() - margin.left - margin.right,\n                height = this.height = HEIGHT - margin.top - margin.bottom,\n\n                valuesExtent = calculateValuesExtent(),\n\n                xScale = this.xScale = createXScale(),\n\n                data = this.data = this.binValues(),\n\n                yScale = this.yScale = d3.scale.linear()\n                    .domain([0, data.length ? d3.max(data, function(layer) {\n                        return d3.max(layer.values, function(d) {\n                            return d.y0 + d.y;\n                        });\n                    }) : 0])\n                    .range([height, 0]),\n\n                xAxis = this.xAxis = d3.svg.axis()\n                    .scale(xScale)\n                    .ticks(isDate ? 3 : 4)\n                    .tickSize(5, 0)\n                    .orient('bottom'),\n\n                brushedTextFormat = xAxis.tickFormat(),\n\n                format = (function() {\n                    var format = isDate && '%Y-%m-%d';\n                    if (isDateTime) {\n                        format += ' %I %p';\n                    }\n                    format = format && d3.time.format(format);\n                    if (format) {\n                        brushedTextFormat = format;\n                    }\n                    return format;\n                })(),\n\n                yAxis = this.yAxis = d3.svg.axis()\n                    .scale(yScale)\n                    .ticks(0)\n                    .tickSize(5, 0)\n                    .tickValues(function() {\n                        return yScale.domain()[1] !== 0 ? [0, yScale.domain()[1]] : [];\n                    })\n                    .orient('right'),\n\n                onZoomedUpdate = _.throttle(function() {\n                    updateBrushInfo();\n                    updateFocusInfo();\n                }, 1000 / 30),\n\n                onZoomed = function() {\n                    var scale = d3.event.scale,\n                        scaleChange = scale !== self.previousScale,\n                        translate = d3.event.translate[0],\n                        translateChange = translate !== self.previousTranslate;\n\n                    if (self.currentExtent) {\n                        self.brush.extent(self.currentExtent);\n                    }\n\n                    self.redraw(scaleChange || translateChange, true);\n                    self.previousScale = scale;\n                    self.previousTranslate = translate;\n                    onZoomedUpdate();\n                },\n\n                zoom = this.zoom = createZoomBehavior(),\n\n                brush = (this.brush || (this.brush = d3.svg.brush()\n                    .on('brush', _.throttle(function() {\n                        updateBrushInfo();\n                        updateFocusInfo();\n                    }, 1000 / 30))))\n                    .x(self.xScale),\n\n                focus = null,\n\n                svgOuter = this.svg = d3.select(this.node)\n                    .selectAll('svg')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('svg')\n                            .on('mousemove', mousemove)\n                            .on('mouseover', function() {\n                                focus.style('display', null);\n                            })\n                            .on('mouseout', function() {\n                                if (!d3.event.toElement || $(d3.event.toElement).closest('svg').length === 0) {\n                                    focus.style('display', 'none');\n                                }\n                            });\n                    })\n                    .attr('width', width + margin.left + margin.right)\n                    .attr('height', height + margin.top + margin.bottom)\n                    .call(zoom),\n\n                preventDragOverGraph = svgOuter\n                    .selectAll('rect.preventDrag')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('rect').attr({\n                            class: 'preventDrag',\n                            x: 0,\n                            y: 0,\n                            width: '100%'\n                        })\n                    })\n                    .attr('height', height + margin.top)\n                    .on('mousedown', function() {\n                        d3.event.stopPropagation();\n                    }),\n\n                axisOverlay = svgOuter\n                    .selectAll('rect.axis-overlay')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('rect').attr({\n                            class: 'axis-overlay',\n                            x: 0,\n                            width: '100%'\n                        })\n                    })\n                    .attr({\n                        y: height + margin.top,\n                        height: margin.bottom\n                    }),\n\n                svg = svgOuter\n                    .selectAll('g.root')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('g').attr('class', 'root');\n                    })\n                    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')'),\n\n                svgBackground = svg\n                    .selectAll('g.background')\n                    .data([1])\n                    .call(function() {\n                        this.enter()\n                            .append('g').attr('class', 'background')\n                            .call(function() {\n                                this.append('g').attr('class', 'focus').style('display', 'none')\n                                    .call(function() {\n                                        this.append('text').attr('text-anchor', 'middle');\n                                        this.append('rect')\n                                            .attr('class', 'scrub')\n                                            .attr('width', 1)\n                                            .attr('height', margin.bottom * 0.6);\n                                    })\n                                this.append('g').attr({\n                                    class: 'x axis'\n                                })\n                            })\n\n                        this.select('g.axis')\n                            .attr('transform', 'translate(0,' + height + ')')\n                            .call(xAxis);\n\n                        focus = self.focus = this.select('.focus')\n                            .call(function() {\n                                this.select('text').attr('y', height + margin.bottom - 5)\n                                this.select('rect').attr('y', height)\n                            })\n                    }),\n\n                gBrush = svg\n                    .selectAll('g.brush')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('g').attr('class', 'brush')\n                            .on('mousedown', function() {\n                                d3.event.stopPropagation();\n                            })\n\n                    })\n                    .call(brush),\n\n                barGroup = this.barGroup = gBrush\n                    .selectAll('g.barGroup')\n                    .data([1])\n                    .call(function() {\n                        this.enter().insert('g', '.extent').attr('class', 'barGroup')\n                    }),\n\n                bars = this.createBars(data),\n\n                gBrushRects = d3.selectAll(this.$node.find('g.brush rect').not('.barGroup rect').toArray())\n                    .attr('height', height + BRUSH_PADDING * 2),\n\n                gBrushText = gBrush\n                    .selectAll('g.brushText')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('g').style('display', 'none').attr('class', 'brushText')\n                    }),\n\n                gBrushTextStartBackground = gBrushText\n                    .selectAll('rect.textstartbg')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('rect').attr({\n                            class: 'textstartbg',\n                            x: 0.5,\n                            y: 0.5\n                        })\n                    })\n                    .attr('height', BRUSH_BACKGROUND_HEIGHT),\n\n                gBrushTextEndBackground = gBrushText\n                    .selectAll('rect.textendbg')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('rect').attr({\n                            class: 'textendbg',\n                            x: 0.5\n                        })\n                    })\n                    .attr({\n                        y: height - BRUSH_BACKGROUND_HEIGHT,\n                        height: BRUSH_BACKGROUND_HEIGHT\n                    }),\n\n                gBrushTextStart = gBrushText\n                    .selectAll('text.textstart')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('text').attr({\n                            class: 'textstart',\n                            x: BRUSH_TEXT_PADDING,\n                            y: Math.max(0, BRUSH_BACKGROUND_HEIGHT - BRUSH_PADDING - BRUSH_TEXT_PADDING)\n                        })\n                    }),\n\n                gBrushTextEnd = gBrushText\n                    .selectAll('text.textend')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('text').attr({\n                            class: 'textend',\n                            'text-anchor': 'end'\n                        })\n                    })\n                    .attr('y', height + BRUSH_PADDING - BRUSH_TEXT_PADDING);\n\n            if (isDate) {\n                xAxis.tickFormat(d3.time.format.multi([\n                    ['.%L', function(d) {\n                        return d.getMilliseconds();\n                    }],\n                    [':%S', function(d) {\n                        return d.getSeconds();\n                    }],\n                    ['%I:%M', function(d) {\n                        return d.getMinutes();\n                    }],\n                    ['%I %p', function(d) {\n                        return d.getHours();\n                    }],\n                    ['%a %d', function(d) {\n                        return d.getDay() && d.getDate() !== 1;\n                    }],\n                    ['%b %d', function(d) {\n                        return d.getDate() !== 1;\n                    }],\n                    ['%b', function(d) {\n                        return d.getMonth();\n                    }],\n                    ['%Y', function() {\n                        return true;\n                    }]\n                ]));\n            } else {\n                xAxis.tickFormat(function(d) {\n                    return d3.format('s')(d)\n                        .replace(/(\\.\\d{2})\\d+/, '$1');\n                });\n            }\n\n            if (this.attr.includeYAxis) {\n                svg.selectAll('g.y')\n                    .data([1])\n                    .call(function() {\n                        this.enter().append('g')\n                            .attr('class', 'y axis')\n                            .selectAll('.tick text')\n                    })\n                    .call(yAxis)\n            }\n\n            function calculateValuesExtent() {\n                var min, max, delta, rawValues = _.pluck(values, 'value');\n\n                if (isDate) {\n                    if (values.length === 0) {\n                        return [\n                            d3.time.day.offset(new Date(), -1),\n                            d3.time.day.offset(new Date(), 2)\n                        ];\n                    } else if (values.length === 1) {\n                        return [\n                            d3.time.day.offset(rawValues[0], -1),\n                            d3.time.day.offset(rawValues[0], 2)\n                        ];\n                    } else {\n                        min = d3.min(rawValues);\n                        max = d3.max(rawValues);\n                        delta = max - min;\n\n                        var days = Math.max(1,\n                            parseInt(Math.round(delta / 1000 / 60 / 60 / 24 * 0.1), 10)\n                        );\n\n                        return [\n                            d3.time.day.offset(min, days * -1),\n                            d3.time.day.offset(max, days)\n                        ];\n                    }\n                } else if (values.length === 0) {\n                    return [0, 100];\n                } else if (values.length === 1) {\n                    return [rawValues[0] - 1, rawValues[0] + 1];\n                }\n\n                min = d3.min(rawValues);\n                max = d3.max(rawValues);\n                delta = max - min;\n\n                return [\n                    min - delta * 0.1,\n                    max + delta * 0.1\n                ];\n            }\n\n            function createZoomBehavior() {\n                var delta = valuesExtent[1] - valuesExtent[0],\n                    maxZoomIn = delta / (isDateTime ? 36e5 : isDate ? 36e5 * 48 : 10),\n                    maxZoomOut = delta / (isDate ? (50 * 365 * 24 * 36e5) : 1);\n\n                return d3.behavior.zoom()\n                    .x(xScale)\n                    .scaleExtent([1 / 2, maxZoomIn])\n                    .on('zoom', onZoomed);\n            }\n\n            function createXScale() {\n                var scale = (isDateTime || isDate) ? d3.time.scale() : d3.scale.linear();\n                return scale.domain(valuesExtent).range([0, width]);\n            }\n\n            function updateBrushInfo() {\n                var extent = self.brush.extent(),\n                    delta = extent[1] - extent[0],\n                    width = Math.max(0, self.xScale(\n                             isDate ?\n                             new Date(self.xScale.domain()[0].getTime() + delta) :\n                             (self.xScale.domain()[0] + delta)\n                        ) - 1),\n                    data = {\n                        extent: delta < 0.00001 ? null : extent\n                    };\n\n                if (!_.isEqual(data.extent, self.currentExtent) && (data.extent || self.currentExtent)) {\n                    self.updateBarSelection();\n                    var objectsForExtent = self.getObjectIdsForExtent(data.extent);\n                    _.extend(data, objectsForExtent);\n                    if (data.extent && _.isEqual(objectsForExtent, self.currentSelected)) {\n                        self.updateBarSelection(objectsForExtent);\n                    } else {\n                        self.currentSelected = objectsForExtent;\n                        self.triggerChange(data);\n                    }\n                }\n\n                self.currentExtent = data.extent;\n\n                gBrushTextStartBackground.attr('width', width);\n                gBrushTextEndBackground.attr('width', width);\n                gBrushTextStart.text(brushedTextFormat(extent[0]));\n\n                gBrushText\n                    .style('display', delta < 0.01 ? 'none' : '')\n                    .attr('transform', 'translate(' + self.xScale(extent[0]) + ', 0)');\n\n                gBrushTextEnd\n                    .text(brushedTextFormat(extent[1]))\n                    .attr(\n                        'transform',\n                        'translate(' + (width - BRUSH_TEXT_PADDING) + ', 0)'\n                    );\n            }\n            this.clearBrush = function() {\n                this.currentSelected = {};\n                gBrush.call(self.brush.clear());\n                delete self.currentExtent;\n                updateBrushInfo();\n            }\n\n            var mouse = null;\n            function mousemove() {\n                mouse = d3.mouse(this)[0];\n                updateFocusInfo();\n            }\n\n            function updateFocusInfo() {\n                if (mouse !== null) {\n                    var x0 = self.xScale.invert(mouse - margin.left);\n                    focus.attr('transform', 'translate(' + self.xScale(x0) + ', 0)');\n                    if (isDate) {\n                        focus.select('text').text(format(x0));\n                    } else {\n                        focus.select('text').text(xAxis.tickFormat()(x0));\n                    }\n                }\n            }\n\n            this.redraw(true);\n        }\n\n        this.createBars = function(data, skipAnimation) {\n            var self = this,\n                height = this.height,\n                xScale = this.xScale,\n                yScale = this.yScale,\n                firstNonEmpty = _.find(data, function(d) {\n                    return d.values.length;\n                }),\n                dx = firstNonEmpty ? firstNonEmpty.values[0].dx : 0,\n                barLayers = this.barGroup.selectAll('.barlayer').data(data.reverse(), function(d) {\n                    return d.conceptIri;\n                }).order(),\n                bars = barLayers.selectAll('.bar').data(function(groupData) {\n                    return groupData.values;\n                }, function(d) {\n                    return d[0].conceptIri + d.x.getTime();\n                }).order(),\n                isDate = this.attr.property.dataType === 'date',\n                animationDuration = skipAnimation ? 0 : 250,\n                hasData = this.data && this.data.length;\n\n            this.select('noDataMessageSelector').css('display', hasData ? 'none' : 'block');\n            this.svg.style('display', hasData ? 'block' : 'none');\n\n            barLayers.enter().append('g').attr('class', 'barlayer').style('fill', function(d) {\n                return d.normalColor;\n            });\n\n            bars.enter()\n                .append('g').attr('class', 'bar')\n                .classed('selected', function(d) {\n                    return !self.currentExtent && d.length && _.any(d, function(o) {\n                        return o.vertexId && _.contains(self.currentSelected.vertexIds || [], o.vertexId) ||\n                            o.edgeId && _.contains(self.currentSelected.edgeIds || [], o.edgeId);\n                    });\n                })\n                .attr('transform', function(d) {\n                    return 'translate(' + xScale(d.x) + ',' + yScale(0) + ')';\n                })\n                .append('rect')\n                .attr('height', 0);\n\n            bars.transition('height-animation').duration(animationDuration)\n                .attr('transform', function(d) {\n                    return 'translate(' + xScale(d.x) + ',' + yScale(d.y + d.y0) + ')';\n                });\n            bars.select('rect')\n                    .attr('width',\n                        Math.max(1,\n                            (isDate ?\n                             xScale(xScale.domain()[0].getTime() + dx) :\n                             xScale(xScale.domain()[0] + dx)\n                            ) - 1\n                        )\n                    )\n                    .transition('height-animation').duration(animationDuration)\n                    .attr('height', function(d) {\n                        return height - yScale(d.y);\n                    })\n\n            var exitingBars = bars.exit().transition('height-animation').duration(animationDuration);\n            exitingBars.attr('transform', function(d) {\n                return 'translate(' + xScale(d.x) + ',' + yScale(0) + ')';\n            });\n            exitingBars.select('rect').attr('height', 0);\n            exitingBars.remove();\n\n            barLayers.exit().remove();\n\n            if (skipAnimation) d3.timer.flush();\n\n            bars.on('mousedown', function(d) {\n                var xy = d3.mouse(self.svg.select('.brush').node()),\n                    xInv = xScale.invert(xy[0]);\n                self.clearBrush();\n                self.brush.extent([xInv, xInv]);\n                self.currentSelected.vertexIds = _.compact(_.pluck(d, 'vertexId')).sort();\n                self.currentSelected.edgeIds = _.compact(_.pluck(d, 'edgeId')).sort();\n                self.updateBarSelection(self.currentSelected);\n                self.triggerChange(_.extend({ extent: self.currentExtent }, self.currentSelected));\n            });\n\n            return bars;\n        }\n\n        this.updateBarSelection = function(selected) {\n            var barLayers = this.svg.selectAll('.barlayer'),\n                bars = barLayers.selectAll('.bar'),\n                selectedVertexIds = selected && selected.vertexIds || [],\n                selectedEdgeIds = selected && selected.edgeIds || [],\n                anySelected = selectedVertexIds.length || selectedEdgeIds.length;\n\n            bars.classed('selected', anySelected && function(d) {\n                return d.length && _.any(d, function(o) {\n                    return o.vertexId && _.contains(selectedVertexIds, o.vertexId) ||\n                        o.edgeId && _.contains(selectedEdgeIds, o.edgeId);\n                });\n            });\n            barLayers.each(function(d) {\n                var currentColor = anySelected ? d.dimColor : d.normalColor;\n                d3.select(this).transition('fill-animation').style('fill', currentColor);\n            });\n        }\n    }\n});\n"]}