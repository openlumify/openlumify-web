{"version":3,"sources":["../../js/fields/dateRelative.js"],"names":["define","defineComponent","F","withPropertyField","template","UNITS_TIME","second","minute","hour","day","week","month","year","UNITS","_","omit","DateRelative","makeNumber","v","parseInt","defaultAttrs","amountSelector","unitSelector","pastPresentSelector","after","self","displayTime","attr","property","displayType","$node","html","units","getUnits","defer","select","focus","calculateRelativeDate","value","now","Date","unit","setSeconds","getSeconds","amount","setMinutes","getMinutes","setHours","getHours","setDate","getDate","setMonth","getMonth","setFullYear","getFullYear","getTime","getValue","$","trim","val","past","isNaN","date","_date","dateStringServer","timeStringServer","setValue","inFuture","defaultUnit","Math","abs","isValid","isNumber","chain","map","key","display","i18n","selected","sortBy"],"mappings":"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","file":"dateRelative.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/formatters',\n    './withPropertyField',\n    './dateRelativeTpl.hbs'\n], function(\n    defineComponent,\n    F,\n    withPropertyField,\n    template) {\n    'use strict';\n\n    // Mapping to java.util.Calendar constants\n    var UNITS_TIME = {\n          second: 13,\n          minute: 12,\n          hour: 10,\n          day: 5,\n          week: 3,\n          month: 2,\n          year: 1\n        },\n        UNITS = _.omit(UNITS_TIME, 'second', 'minute', 'hour');\n\n    return defineComponent(DateRelative, withPropertyField);\n\n    function makeNumber(v) {\n        return parseInt(v, 10);\n    }\n\n    function DateRelative() {\n\n        this.defaultAttrs({\n            amountSelector: '.amount',\n            unitSelector: '.unit',\n            pastPresentSelector: '.past-or-present'\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.displayTime = this.attr.property.displayType !== 'dateOnly';\n            this.$node.html(template({\n                units: this.getUnits()\n            }));\n\n            _.defer(function() {\n                self.select('amountSelector').focus();\n            })\n        });\n\n        this.calculateRelativeDate = function(value) {\n            var now = new Date();\n\n            switch (value.unit) {\n                case UNITS.second:\n                    now.setSeconds(now.getSeconds() + value.amount);\n                    break;\n                case UNITS.minute:\n                    now.setMinutes(now.getMinutes() + value.amount);\n                    break;\n                case UNITS.hour:\n                    now.setHours(now.getHours() + value.amount);\n                    break;\n                case UNITS.day:\n                    now.setDate(now.getDate() + value.amount);\n                    break;\n                case UNITS.week:\n                    now.setDate(now.getDate() + value.amount * 7);\n                    break;\n                case UNITS.month:\n                    now.setMonth(now.getMonth() + value.amount);\n                    break;\n                case UNITS.year:\n                    now.setFullYear(now.getFullYear() + value.amount);\n                    break;\n            }\n\n            return now.getTime();\n        };\n\n        this.getValue = function() {\n            var amount = makeNumber($.trim(this.select('amountSelector').val())),\n                past = makeNumber($.trim(this.select('pastPresentSelector').val())),\n                value = {\n                    unit: makeNumber($.trim(this.select('unitSelector').val()))\n                };\n\n            if (!isNaN(amount) && !isNaN(past)) {\n                value.amount = amount * past;\n\n                var date = this.calculateRelativeDate(value);\n                if (this.displayTime) {\n                    value._date = F.date.dateStringServer(date) + ' ' + F.date.timeStringServer(date);\n                } else {\n                    value._date = F.date.dateStringServer(date);\n                }\n            }\n\n            return value;\n        };\n\n        this.setValue = function(value) {\n            var inFuture = value && !isNaN(value.amount) && value.amount >= 0,\n                defaultUnit = this.displayTime ? UNITS_TIME.hour : UNITS.day;\n\n            this.select('amountSelector')\n                .val((!value || isNaN(value.amount)) ? '' : Math.abs(value.amount));\n            this.select('unitSelector')\n                .val((!value || isNaN(value.unit)) ? defaultUnit : value.unit);\n            this.select('pastPresentSelector')\n                .val(inFuture ? '1' : '-1');\n        };\n\n        this.isValid = function(value) {\n            return value &&\n                _.isNumber(value.unit) &&\n                !isNaN(value.unit) &&\n                _.isNumber(value.amount) &&\n                !isNaN(value.amount);\n        };\n\n        this.getUnits = function() {\n            return _.chain(this.displayTime ? UNITS_TIME : UNITS)\n                .map(function(value, key) {\n                    return {\n                        display: i18n('field.date.relative.unit.' + key),\n                        value: value,\n                        selected: false\n                    }\n                })\n                .sortBy('value')\n                .value();\n        };\n\n    }\n});\n"]}