{"version":3,"sources":["../../js/fields/geoLocation.js"],"names":["define","defineComponent","template","P","F","withPropertyField","withDataRequest","GeoLocationField","makeNumber","v","result","isNegative","_","isString","trim","substr","slice","m","match","min","sec","deg","number","parseFloat","isNaN","splitLatLon","latLonStr","parts","split","length","lat","lon","isNumber","latitude","longitude","invalidRange","coord","val","defaultAttrs","descriptionSelector","latSelector","lonSelector","radiusSelector","radiusSearchSelector","before","node","config","asyncRender","after","self","rendered","Promise","fulfill","hasGeocoder","done","enabled","attr","$node","html","setValue","value","setupDescriptionTypeahead","on","select","onFocusDescription","trigger","event","defer","pastedValue","$","target","parsedValue","triggerFieldUpdated","add","animatePop","require","MapSearchPopover","attachTo","currentValue","getValue","debounce","region","description","radius","onlySearchable","toggleClass","type","values","compact","getValues","filterUpdated","map","i","isValid","then","descField","radiusField","latitudeField","longitudeField","name","property","title","radiusInvalid","latitudeInvalid","longitudeInvalid","valid","startsWith","vertex","singlePropValid","dataRequest","savedResults","request","parent","css","end","typeahead","items","minLength","source","q","process","cancel","data","indexBy","results","keys","catch","matcher","item","updater","find","focus"],"mappings":"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","file":"geoLocation.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    './geoLocationTpl.hbs',\n    'util/parsers',\n    'util/vertex/formatters',\n    './withPropertyField',\n    'util/withDataRequest'\n], function(defineComponent, template, P, F, withPropertyField, withDataRequest) {\n    'use strict';\n\n    return defineComponent(GeoLocationField, withPropertyField, withDataRequest);\n\n    // 39° 2' 36.96\" N\n    // 77° 29' 15\" W\n    // 39.0436° N\n    // 77.4875° W\n    // 39.0436\n    // 77.4875\n    function makeNumber(v) {\n        var result;\n        var isNegative = false;\n        if (_.isString(v)) {\n            v = v.trim();\n            if (v.substr(-1) === 'N' || v.substr(-1) === 'E') {\n                v = v.slice(0, -1).trim();\n                isNegative = false;\n            } else if (v.substr(-1) === 'S' || v.substr(-1) === 'W') {\n                v = v.slice(0, -1).trim();\n                isNegative = true;\n            }\n            var m = v.match(/(.+)[°º]((.+)'((.+)\")?)?/);\n            if (m) {\n                if (m[1]) {\n                    var min = 0, sec = 0;\n                    var deg = P.number.parseFloat(m[1].trim());\n                    if (m[3]) {\n                        min = P.number.parseFloat(m[3].trim());\n                        if (m[5]) {\n                            sec = P.number.parseFloat(m[5].trim());\n                        }\n                    }\n                    result = deg + min / 60.0 + sec / (60.0 * 60.0);\n                }\n            }\n        }\n        if (!result || _.isNaN(result)) {\n            result = P.number.parseFloat(v);\n        }\n        if (_.isNaN(result)) {\n            return;\n        }\n        if (isNegative) {\n            result = -result;\n        }\n        return result;\n    }\n\n    function splitLatLon(latLonStr) {\n        var parts = latLonStr.split(',');\n        if (parts.length === 2) {\n            var lat = makeNumber(parts[0].trim()),\n                lon = makeNumber(parts[1].trim());\n\n            if (_.isNumber(lat) && _.isNumber(lon)) {\n                return {\n                    latitude: lat,\n                    longitude: lon\n                };\n            }\n        }\n    }\n\n    function invalidRange(coord, val) {\n        return isNaN(coord) || coord < (val * -1) || coord > val;\n    }\n\n    function GeoLocationField() {\n\n        this.defaultAttrs({\n            descriptionSelector: '.description',\n            latSelector: '.lat',\n            lonSelector: '.lon',\n            radiusSelector: '.radius',\n            radiusSearchSelector: '.radius-search'\n        });\n\n        this.before('initialize', function(node, config) {\n            config.asyncRender = true;\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.rendered = new Promise(function(fulfill) {\n                self.hasGeocoder().done(function(enabled) {\n                    self.attr.hasGeocoder = enabled;\n                    self.$node.html(template(self.attr));\n                    self.setValue(self.attr.value);\n                    self.setupDescriptionTypeahead();\n                    self.on(self.select('descriptionSelector'), 'focus blur', self.onFocusDescription);\n                    fulfill();\n                    self.trigger('fieldRendered');\n\n                    self.on('paste', {\n                        latSelector: function(event) {\n                            _.defer(function() {\n                                var pastedValue = $(event.target).val();\n                                if (pastedValue.length) {\n                                    var parsedValue = splitLatLon(pastedValue);\n                                    if (parsedValue) {\n                                        self.setValue(parsedValue);\n                                        self.triggerFieldUpdated();\n\n                                        self.select('latSelector')\n                                          .add(self.select('lonSelector'))\n                                          .animatePop();\n                                    }\n                                }\n                            })\n                        }\n                    })\n\n                    self.on('click', {\n                        radiusSearchSelector(event) {\n                            require(['util/popovers/mapSearch/mapSearch'], function(MapSearchPopover) {\n                                MapSearchPopover.attachTo(self.node, {\n                                    currentValue: self.getValue()\n                                });\n                            })\n                        }\n                    })\n                    self.on('mapSearchRegionUpdated', _.debounce((event, {region}) => {\n                        self.setValue(region);\n                        self.triggerFieldUpdated();\n                    }, 500))\n                });\n            })\n        });\n\n        this.setValue = function(value) {\n            if (_.isString(value)) {\n                var parsedValue = splitLatLon(value);\n                if (parsedValue) {\n                    value = parsedValue;\n                }\n            }\n            this.select('descriptionSelector').val(value.description || '');\n            this.select('latSelector').val(value.latitude || '');\n            this.select('lonSelector').val(value.longitude || '');\n            this.select('radiusSelector').val(value.radius || '');\n        };\n\n        this.getValue = function() {\n            var value = {\n                description: $.trim(this.select('descriptionSelector').val()),\n                latitude: makeNumber($.trim(this.select('latSelector').val())),\n                longitude: makeNumber($.trim(this.select('lonSelector').val()))\n            };\n\n            if (this.attr.onlySearchable) {\n                value.radius = makeNumber($.trim(this.select('radiusSelector').val()));\n            }\n            return value;\n        };\n\n        this.onFocusDescription = function(event) {\n            if (!this.attr.hasGeocoder) {\n                return;\n            }\n\n            this.$node.toggleClass('desc-focus', event.type === 'focus');\n        };\n\n        this.triggerFieldUpdated = function() {\n            var values = _.compact(this.getValues());\n            this.filterUpdated(values.map(function(v, i) {\n                if (values.length === 3 && i === 0) {\n                    return v;\n                }\n                return makeNumber(v);\n            }));\n        };\n\n        this.isValid = function(value) {\n            var self = this;\n\n            return this.rendered.then(function() {\n                var descField = self.select('descriptionSelector').length,\n                    radiusField = self.select('radiusSelector'),\n                    latitudeField = self.select('latSelector'),\n                    longitudeField = self.select('lonSelector'),\n                    name = self.attr.property.title,\n                    radiusInvalid = radiusField.length && (isNaN(value.radius) || value.radius <= 0),\n                    latitudeInvalid = invalidRange(value.latitude, 90),\n                    longitudeInvalid = invalidRange(value.longitude, 180),\n                    valid = !radiusInvalid && !latitudeInvalid && !longitudeInvalid;\n\n                radiusField.toggleClass('invalid', radiusInvalid);\n                latitudeField.toggleClass('invalid', latitudeInvalid);\n                longitudeField.toggleClass('invalid', longitudeInvalid);\n\n                return valid && (self.attr.property.title.startsWith('dataType:') || F.vertex.singlePropValid(value, name));\n            })\n        };\n\n        this.hasGeocoder = function() {\n            return this.dataRequest('config', 'properties').then(function(config) {\n                return config['geocoder.enabled'] === 'true';\n            });\n        };\n\n        this.setupDescriptionTypeahead = function() {\n            var self = this;\n\n            if (this.attr.hasGeocoder) {\n                var savedResults, request;\n\n                self.select('descriptionSelector')\n                    .parent().css('position', 'relative').end()\n                    .typeahead({\n                        items: 15,\n                        minLength: 3,\n                        source: function(q, process) {\n                            if (request && request.cancel) {\n                                request.cancel();\n                            }\n\n                            request = self.dataRequest('map', 'geocode', q)\n                                .then(function(data) {\n                                    savedResults = _.indexBy(data.results, 'name');\n                                    process(_.keys(savedResults));\n                                })\n                                .catch(function() {\n                                    process([]);\n                                })\n                        },\n                        matcher: function(item) {\n                            return true;\n                        },\n                        updater: function(item) {\n                            var result = savedResults[item];\n                            if (result) {\n                                self.select('latSelector').val(result.latitude)\n                                    .add(self.select('lonSelector').val(result.longitude))\n                                    .animatePop().done(function() {\n                                        self.$node.find('.radius').focus();\n                                        self.triggerFieldUpdated();\n                                    })\n\n                                return result.name;\n                            }\n                            return item;\n                        }\n                    });\n                }\n        }\n    }\n});\n"]}