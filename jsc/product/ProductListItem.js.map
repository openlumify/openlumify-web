{"version":3,"sources":["../../js/product/ProductListItem.jsx"],"names":["define","createReactClass","PropTypes","PureRenderMixin","DroppableHOC","dnd","MaxTitleLength","ProductListItem","mixins","propTypes","selected","string","editable","bool","isRequired","previewHash","product","shape","id","title","workspaceId","kind","loading","getInitialState","confirmDelete","editing","invalid","componentWillReceiveProps","nextProps","state","setState","componentDidUpdate","prevProps","prevState","refs","titleField","focus","select","render","props","isSelected","previewStyle","backgroundImage","encodeURIComponent","buttons","i18n","onCancel","onSave","onEdit","onConfirmDelete","onDelete","cls","push","inputAttrs","disabled","join","onSelect","onLeaveItem","onTitleKeyUp","onChange","event","target","onSelectProduct","stopPropagation","onDeleteProduct","checkInvalid","value","trim","onUpdateTitle","nowInvalid","length","keyCode","ProductListItemWithDroppable","ProductListItemDroppable","VISALLO_MIMETYPES","ELEMENTS","elements","getElementsFromDataTransfer","e","dataTransfer","onDropElements","preventDefault"],"mappings":"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","file":"ProductListItem.js","sourcesContent":["define([\n    'create-react-class',\n    'prop-types',\n    'react-pure-render-mixin',\n    'components/DroppableHOC',\n    'util/dnd'\n], function(createReactClass, PropTypes, PureRenderMixin, DroppableHOC, dnd) {\n    'use strict';\n\n    const MaxTitleLength = 128;\n    const ProductListItem = createReactClass({\n        mixins: [PureRenderMixin],\n        propTypes: {\n            selected: PropTypes.string,\n            editable: PropTypes.bool.isRequired,\n            previewHash: PropTypes.string,\n            product: PropTypes.shape({\n                id: PropTypes.string.isRequired,\n                title: PropTypes.string.isRequired,\n                workspaceId: PropTypes.string.isRequired,\n                kind: PropTypes.string.isRequired,\n                loading: PropTypes.bool\n            }).isRequired\n        },\n        getInitialState() {\n            return {\n                confirmDelete: true,\n                editing: false,\n                invalid: false,\n                loading: false\n            };\n        },\n        componentWillReceiveProps(nextProps) {\n            const { product } = nextProps;\n            if ('loading' in product && !product.loading && this.state.loading && this.state.editing) {\n                this.setState({ editing: false, loading: false })\n            }\n        },\n        componentDidUpdate(prevProps, prevState) {\n            if (!prevState.editing && this.state.editing && this.refs.titleField) {\n                this.refs.titleField.focus();\n                this.refs.titleField.select();\n            }\n        },\n        render() {\n            const { product, previewHash, selected, editable } = this.props;\n            const { confirmDelete, editing, invalid, loading } = this.state;\n            const { id, kind, title, workspaceId } = product;\n            const isSelected = selected === id;\n            const previewStyle = previewHash ? {\n                backgroundImage: `url(product/preview?productId=${encodeURIComponent(id)}&workspaceId=${encodeURIComponent(workspaceId)}&md5=${previewHash})`\n            } : {};\n            const buttons = loading ?\n                ([\n                    <button key=\"save\" className=\"loading btn btn-primary btn-mini\" disabled>{i18n('product.item.edit.save')}</button>\n                ]) :\n                editing ?\n                ([\n                    <button key=\"cancel\" onClick={this.onCancel} className=\"cancel btn btn-link btn-default btn-mini\">{i18n('product.item.edit.cancel')}</button>,\n                    <button key=\"save\" onClick={this.onSave} disabled={invalid} className=\"btn btn-primary btn-mini\">{i18n('product.item.edit.save')}</button>\n                ]) :\n                ([\n                    <button key=\"edit\" onClick={this.onEdit} className=\"btn btn-default btn-mini\">{i18n('product.item.edit')}</button>,\n                    (confirmDelete ?\n                        (<button key=\"delete\" className=\"btn btn-danger btn-mini\" onClick={this.onConfirmDelete}>{i18n('product.item.delete')}</button>) :\n                        (<button key=\"confirmDelete\" className=\"btn btn-danger btn-mini\" onClick={this.onDelete}>{i18n('product.item.delete.confirm')}</button>)\n                    )\n                ]);\n            const cls = ['products-list-item']\n\n            if (isSelected) cls.push('active');\n            if (editing) cls.push('editing');\n            const inputAttrs = loading ? { disabled: true } : {};\n\n            return (\n                <div title={title}\n                    className={cls.join(' ')}\n                    onClick={this.onSelect}\n                    onMouseLeave={this.onLeaveItem}>\n                    <div className=\"buttons\">{editable ? buttons : null}</div>\n                    <div className={previewHash ? 'preview' : 'no-preview'} style={previewStyle}/>\n                    <div className=\"content\">\n                        <h1>{ editing ? (\n                            <input maxLength={MaxTitleLength} required\n                                onKeyUp={this.onTitleKeyUp}\n                                onChange={this.onChange}\n                                ref=\"titleField\"\n                                type=\"text\" defaultValue={title} {...inputAttrs} />\n                        ) : title}</h1>\n                        <h2>{i18n(`${kind}.name`)}</h2>\n                    </div>\n                </div>\n            );\n        },\n        onSelect(event) {\n            if (event.target !== this.refs.titleField) {\n                this.props.onSelectProduct(this.props.product.id);\n            }\n        },\n        onConfirmDelete(event) {\n            event.stopPropagation();\n            this.setState( { confirmDelete: false })\n        },\n        onLeaveItem() {\n            if (!this.state.confirmDelete) {\n                this.setState({ confirmDelete: true });\n            }\n        },\n        onDelete(event) {\n            event.stopPropagation();\n            this.props.onDeleteProduct(this.props.product.id);\n        },\n        onEdit(event) {\n            event.stopPropagation();\n            this.setState({ editing: true })\n        },\n        onSave(event) {\n            event.stopPropagation();\n            if (!this.checkInvalid()) {\n                const title = this.refs.titleField.value.trim();\n                this.setState({ loading: true })\n                this.props.onUpdateTitle(this.props.product.id, title);\n            }\n        },\n        onCancel(event) {\n            event.stopPropagation();\n            this.setState({ editing: false })\n        },\n        checkInvalid() {\n            const { invalid } = this.state;\n            const nowInvalid = this.refs.titleField.value.trim().length === 0;\n            if (nowInvalid !== invalid) {\n                this.setState({ invalid: nowInvalid })\n            }\n            return nowInvalid;\n        },\n        onChange(event) {\n            this.checkInvalid()\n        },\n        onTitleKeyUp(event) {\n            const invalid = this.checkInvalid()\n            if (!invalid && event.keyCode === 13) {\n                this.onSave(event);\n            } else if (event.keyCode === 27) {\n                this.setState({ editing: false, invalid: false })\n            }\n        }\n    });\n\n    const ProductListItemWithDroppable = DroppableHOC(ProductListItem);\n    const ProductListItemDroppable = function(props) {\n        return (<ProductListItemWithDroppable {...props}\n            mimeTypes={[VISALLO_MIMETYPES.ELEMENTS]}\n            onDrop={e => {\n                const elements = dnd.getElementsFromDataTransfer(e.dataTransfer);\n                if (elements) {\n                    props.onDropElements(props.product, elements);\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n            }}\n        />);\n    }\n\n    return ProductListItemDroppable;\n});\n"]}