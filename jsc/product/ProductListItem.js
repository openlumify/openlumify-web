var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};define(['create-react-class','prop-types','react-pure-render-mixin','components/DroppableHOC','util/dnd'],function(createReactClass,PropTypes,PureRenderMixin,DroppableHOC,dnd){'use strict';var MaxTitleLength=128;var ProductListItem=createReactClass({displayName:'ProductListItem',mixins:[PureRenderMixin],propTypes:{selected:PropTypes.string,editable:PropTypes.bool.isRequired,previewHash:PropTypes.string,product:PropTypes.shape({id:PropTypes.string.isRequired,title:PropTypes.string.isRequired,workspaceId:PropTypes.string.isRequired,kind:PropTypes.string.isRequired,loading:PropTypes.bool}).isRequired},getInitialState:function getInitialState(){return{confirmDelete:true,editing:false,invalid:false,loading:false};},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var product=nextProps.product;if('loading'in product&&!product.loading&&this.state.loading&&this.state.editing){this.setState({editing:false,loading:false});}},componentDidUpdate:function componentDidUpdate(prevProps,prevState){if(!prevState.editing&&this.state.editing&&this.refs.titleField){this.refs.titleField.focus();this.refs.titleField.select();}},render:function render(){var _props=this.props,product=_props.product,previewHash=_props.previewHash,selected=_props.selected,editable=_props.editable;var _state=this.state,confirmDelete=_state.confirmDelete,editing=_state.editing,invalid=_state.invalid,loading=_state.loading;var id=product.id,kind=product.kind,title=product.title,workspaceId=product.workspaceId;var isSelected=selected===id;var previewStyle=previewHash?{backgroundImage:'url(product/preview?productId='+encodeURIComponent(id)+'&workspaceId='+encodeURIComponent(workspaceId)+'&md5='+previewHash+')'}:{};var buttons=loading?[React.createElement('button',{key:'save',className:'loading btn btn-primary btn-mini',disabled:true},i18n('product.item.edit.save'))]:editing?[React.createElement('button',{key:'cancel',onClick:this.onCancel,className:'cancel btn btn-link btn-default btn-mini'},i18n('product.item.edit.cancel')),React.createElement('button',{key:'save',onClick:this.onSave,disabled:invalid,className:'btn btn-primary btn-mini'},i18n('product.item.edit.save'))]:[React.createElement('button',{key:'edit',onClick:this.onEdit,className:'btn btn-default btn-mini'},i18n('product.item.edit')),confirmDelete?React.createElement('button',{key:'delete',className:'btn btn-danger btn-mini',onClick:this.onConfirmDelete},i18n('product.item.delete')):React.createElement('button',{key:'confirmDelete',className:'btn btn-danger btn-mini',onClick:this.onDelete},i18n('product.item.delete.confirm'))];var cls=['products-list-item'];if(isSelected)cls.push('active');if(editing)cls.push('editing');var inputAttrs=loading?{disabled:true}:{};return React.createElement('div',{title:title,className:cls.join(' '),onClick:this.onSelect,onMouseLeave:this.onLeaveItem},React.createElement('div',{className:'buttons'},editable?buttons:null),React.createElement('div',{className:previewHash?'preview':'no-preview',style:previewStyle}),React.createElement('div',{className:'content'},React.createElement('h1',null,editing?React.createElement('input',_extends({maxLength:MaxTitleLength,required:true,onKeyUp:this.onTitleKeyUp,onChange:this.onChange,ref:'titleField',type:'text',defaultValue:title},inputAttrs)):title),React.createElement('h2',null,i18n(kind+'.name'))));},onSelect:function onSelect(event){if(event.target!==this.refs.titleField){this.props.onSelectProduct(this.props.product.id);}},onConfirmDelete:function onConfirmDelete(event){event.stopPropagation();this.setState({confirmDelete:false});},onLeaveItem:function onLeaveItem(){if(!this.state.confirmDelete){this.setState({confirmDelete:true});}},onDelete:function onDelete(event){event.stopPropagation();this.props.onDeleteProduct(this.props.product.id);},onEdit:function onEdit(event){event.stopPropagation();this.setState({editing:true});},onSave:function onSave(event){event.stopPropagation();if(!this.checkInvalid()){var title=this.refs.titleField.value.trim();this.setState({loading:true});this.props.onUpdateTitle(this.props.product.id,title);}},onCancel:function onCancel(event){event.stopPropagation();this.setState({editing:false});},checkInvalid:function checkInvalid(){var invalid=this.state.invalid;var nowInvalid=this.refs.titleField.value.trim().length===0;if(nowInvalid!==invalid){this.setState({invalid:nowInvalid});}return nowInvalid;},onChange:function onChange(event){this.checkInvalid();},onTitleKeyUp:function onTitleKeyUp(event){var invalid=this.checkInvalid();if(!invalid&&event.keyCode===13){this.onSave(event);}else if(event.keyCode===27){this.setState({editing:false,invalid:false});}}});var ProductListItemWithDroppable=DroppableHOC(ProductListItem);var ProductListItemDroppable=function ProductListItemDroppable(props){return React.createElement(ProductListItemWithDroppable,_extends({},props,{mimeTypes:[VISALLO_MIMETYPES.ELEMENTS],onDrop:function onDrop(e){var elements=dnd.getElementsFromDataTransfer(e.dataTransfer);if(elements){props.onDropElements(props.product,elements);e.preventDefault();e.stopPropagation();}}}));};return ProductListItemDroppable;});
//# sourceMappingURL=ProductListItem.js.map
