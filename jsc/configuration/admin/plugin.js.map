{"version":3,"sources":["../../../js/configuration/admin/plugin.js"],"names":["define","defineComponent","registry","alertTemplate","i18n","NODE_CLS_FOR_LESS_CONTAINMENT","componentInc","defineOpenLumifyAdminPlugin","ALL_COMPONENTS","Component","options","FlightComponent","apply","concat","mixins","attachTo","cls","console","warn","section","name","registerExtension","subtitle","less","applyStyleForClass","attachToWithLessClass","selector","$","each","addClass","self","prototype","initialize","_","wrap","init","showSuccess","message","$node","find","remove","prepend","showError","hideError","error","handleSubmitButton","button","promise","$button","text","prop","progress","v","require","F","number","percent","finally","Array","slice","call","arguments","push","extend","pick"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Base plugin file that defines a openlumify admin ui plugin.\n */\ndefine([\n    'flight/lib/component',\n    'configuration/plugins/registry',\n    'tpl!util/alert',\n    'util/messages'\n], function(defineComponent,\n    registry,\n    alertTemplate,\n    i18n) {\n    'use strict';\n\n    var NODE_CLS_FOR_LESS_CONTAINMENT = 'admin_less_cls_',\n        componentInc = 0;\n\n    defineOpenLumifyAdminPlugin.ALL_COMPONENTS = [];\n\n    return defineOpenLumifyAdminPlugin;\n\n    function defineOpenLumifyAdminPlugin(Component, options) {\n\n        var FlightComponent = defineComponent.apply(null, [Component].concat(options && options.mixins || [])),\n            attachTo = FlightComponent.attachTo,\n            cls = NODE_CLS_FOR_LESS_CONTAINMENT + (componentInc++);\n\n        console.warn('Admin plugin is deprecated, use registry for', options.section + '/' + options.name)\n        registry.registerExtension('org.openlumify.admin', {\n            Component: FlightComponent,\n            section: options.section,\n            name: options.name,\n            subtitle: options.subtitle\n        });\n\n        if (options && options.less) {\n            options.less.applyStyleForClass(cls);\n        }\n\n        FlightComponent.attachTo = function attachToWithLessClass(selector) {\n            $(selector).each(function() {\n                $(this).addClass(cls)\n            });\n\n            var self = this;\n            this.prototype.initialize = _.wrap(this.prototype.initialize, function(init) {\n                this.showSuccess = function(message) {\n                    this.$node.find('.alert').remove();\n                    this.$node.prepend(alertTemplate({ message: message || i18n('admin.plugin.success') }));\n                };\n                this.showError = function(message) {\n                    this.hideError();\n                    this.$node.prepend(alertTemplate({ error: message || i18n('admin.plugin.error') }));\n                };\n                this.hideError = function() {\n                    this.$node.find('.alert').remove();\n                };\n                this.handleSubmitButton = function(button, promise) {\n                    var $button = $(button),\n                        text = $button.text();\n\n                    $button.prop('disabled', true);\n\n                    if (promise.progress) {\n                        promise.progress(function(v) {\n                            require(['util/formatters'], function(F) {\n                                $button.text(F.number.percent(v) + ' ' + text);\n                            })\n                        })\n                    }\n\n                    return promise.finally(function() {\n                        $button.prop('disabled', false).text(text);\n                    });\n                };\n                return init.apply(this, Array.prototype.slice.call(arguments, 1));\n            });\n            attachTo.apply(this, arguments);\n        }\n\n        componentInc++;\n\n        defineOpenLumifyAdminPlugin.ALL_COMPONENTS.push(\n            $.extend({},\n                _.pick(options || {}, 'section', 'name', 'subtitle'),\n                {\n                    Component: FlightComponent\n                }\n            )\n        );\n\n        return FlightComponent;\n    }\n});\n"]}