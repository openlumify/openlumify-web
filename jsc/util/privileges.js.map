{"version":3,"sources":["../../js/util/privileges.js"],"names":["define","defineComponent","PRIVILEGES","split","Component","Privileges","workspaceEditable","after","on","onWorkspaceLoaded","onWorkspaceUpdated","update","event","data","workspace","editable","workspaceCommentable","commentable","user","openlumifyData","currentUser","cls","$","extend","privilegesHelper","_","indexBy","privileges","forEach","p","missingKey","push","removePrefixedClasses","addClass","join","trigger"],"mappings":"AAAAA,OAAO,CACH,sBADG,CAAP,CAEG,SAASC,eAAT,CAA0B,CACzB,aAEA,GAAIC,YAAa,2DAA2DC,KAA3D,CAAiE,GAAjE,CAAjB,CACIC,UAAYH,gBAAgBI,UAAhB,CADhB,CAGA,MAAOD,UAAP,CAEA,QAASC,WAAT,EAAsB,CAElB,KAAKC,iBAAL,CAAyB,KAAzB,CAEA,KAAKC,KAAL,CAAW,YAAX,CAAyB,UAAW,CAChC,KAAKD,iBAAL,CAAyB,IAAzB,CACA,KAAKE,EAAL,CAAQ,iBAAR,CAA2B,KAAKC,iBAAhC,EACA,KAAKD,EAAL,CAAQ,kBAAR,CAA4B,KAAKE,kBAAjC,EACA,KAAKC,MAAL,GACH,CALD,EAOA,KAAKD,kBAAL,CAA0B,SAASE,KAAT,CAAgBC,IAAhB,CAAsB,CAC5C,GAAIC,WAAYD,KAAKC,SAArB,CACA,KAAKR,iBAAL,CAAyBQ,UAAUC,QAAnC,CACA,KAAKC,oBAAL,CAA4BF,UAAUG,WAAtC,CACA,KAAKN,MAAL,GACH,CALD,CAOA,KAAKF,iBAAL,CAAyB,SAASG,KAAT,CAAgBE,SAAhB,CAA2B,CAChD,KAAKR,iBAAL,CAAyBQ,UAAUC,QAAnC,CACA,KAAKC,oBAAL,CAA4BF,UAAUG,WAAtC,CACA,KAAKN,MAAL,GACH,CAJD,CAMA,KAAKA,MAAL,CAAc,UAAW,CACrB,GAAIO,MAAOC,eAAeC,WAA1B,CACIL,SAAW,KAAKT,iBADpB,CAEIW,YAAc,KAAKD,oBAFvB,CAGIK,IAAM,EAHV,CAKA,GAAIH,IAAJ,CAAU,CACNI,EAAEC,MAAF,CAASL,IAAT,CAAe,CACXM,iBAAkBC,EAAEC,OAAF,CAAUR,KAAKS,UAAL,EAAmB,EAA7B,CADP,CAAf,EAGH,CACDzB,WAAW0B,OAAX,CAAmB,SAASC,CAAT,CAAY,CAC3B,GAAIC,YAAa,UAAYD,CAA7B,CAEA,GAAIA,IAAM,OAAV,CAAmB,CACfzB,UAAU0B,UAAV,EAAwB,CAACZ,IAAD,EAAS,CAACA,KAAKM,gBAAL,CAAsBK,CAAtB,CAAlC,CACH,CAFD,IAEO,IAAIA,IAAM,SAAV,CAAqB,CACxBzB,UAAU0B,UAAV,EAAwB,CAACZ,IAAD,EAAS,CAACA,KAAKM,gBAAL,CAAsBK,CAAtB,CAAV,EAAsC,CAACZ,WAA/D,CACH,CAFM,IAEA,CACHb,UAAU0B,UAAV,EAAwB,CAACZ,IAAD,EAAS,CAACA,KAAKM,gBAAL,CAAsBK,CAAtB,CAAV,EAAsC,CAACd,QAA/D,CACH,CACDX,UAAU,MAAQyB,CAAlB,EAAuB,CAACzB,UAAU0B,UAAV,CAAxB,CAEA,GAAI1B,UAAU0B,UAAV,CAAJ,CAA2B,CACvBT,IAAIU,IAAJ,CAAS,gBAAkBF,CAA3B,EACH,CACJ,CAfD,EAiBAP,EAAE,MAAF,EAAUU,qBAAV,CAAgC,eAAhC,EAAiDC,QAAjD,CAA0DZ,IAAIa,IAAJ,CAAS,GAAT,CAA1D,EACA,KAAKC,OAAL,CAAa,iBAAb,EACH,CA9BD,CAgCH,CACJ,CAnED","file":"privileges.js","sourcesContent":["define([\n    'flight/lib/component'\n], function(defineComponent) {\n    'use strict';\n\n    var PRIVILEGES = 'COMMENT EDIT PUBLISH ADMIN ONTOLOGY_ADD ONTOLOGY_PUBLISH'.split(' '),\n        Component = defineComponent(Privileges);\n\n    return Component;\n\n    function Privileges() {\n\n        this.workspaceEditable = false;\n\n        this.after('initialize', function() {\n            this.workspaceEditable = true;\n            this.on('workspaceLoaded', this.onWorkspaceLoaded);\n            this.on('workspaceUpdated', this.onWorkspaceUpdated);\n            this.update();\n        });\n\n        this.onWorkspaceUpdated = function(event, data) {\n            var workspace = data.workspace;\n            this.workspaceEditable = workspace.editable;\n            this.workspaceCommentable = workspace.commentable;\n            this.update();\n        };\n\n        this.onWorkspaceLoaded = function(event, workspace) {\n            this.workspaceEditable = workspace.editable;\n            this.workspaceCommentable = workspace.commentable;\n            this.update();\n        };\n\n        this.update = function() {\n            var user = openlumifyData.currentUser,\n                editable = this.workspaceEditable,\n                commentable = this.workspaceCommentable,\n                cls = [];\n\n            if (user) {\n                $.extend(user, {\n                    privilegesHelper: _.indexBy(user.privileges || [])\n                });\n            }\n            PRIVILEGES.forEach(function(p) {\n                var missingKey = 'missing' + p;\n\n                if (p === 'ADMIN') {\n                    Component[missingKey] = !user || !user.privilegesHelper[p];\n                } else if (p === 'COMMENT') {\n                    Component[missingKey] = !user || !user.privilegesHelper[p] || !commentable;\n                } else {\n                    Component[missingKey] = !user || !user.privilegesHelper[p] || !editable;\n                }\n                Component['can' + p] = !Component[missingKey];\n\n                if (Component[missingKey]) {\n                    cls.push('no-privilege-' + p);\n                }\n            });\n\n            $('html').removePrefixedClasses('no-privilege-').addClass(cls.join(' '));\n            this.trigger('privilegesReady');\n        };\n\n    }\n});\n"]}