{"version":3,"sources":["../../../js/util/actionbar/actionbar.js"],"names":["define","defineComponent","template","FPS","TOP_HIDE_THRESHOLD","ALIGN_TO_TYPES","ActionBar","around","original","$tip","hide","attr","alignTo","$node","tooltip","alreadyDisposed","call","after","actions","indexOf","join","removeAttr","trigger","title","Object","keys","map","action","a","_","isString","cls","event","name","className","style","placement","container","html","data","addClass","options","on","onActionClick","bind","updatePosition","throttle","document","self","defer","teardown","$target","$","target","blur","nodeUpdatePosition","offset","width","height","updateTipPositionWithDomElement","node","nodeInitializer","updatePositionOnScroll","nodeTeardown","scrollParent","off","textselectionUpdatePosition","selection","getSelection","range","rangeCount","getRangeAt","textselectionInitializer","closest","anchorNode","parentNode","textselectionTeardown","el","alignment","box","rects","getClientRects","length","sortBy","r","top","getBoundingClientRect","windowScroll","window","scrollTop","position","left","css","alignWithin","padding","parseInt","extraPadding","totalWidth","isNaN","tipWidth","Math","max","min","arrowPercent","find","toFixed","topThreshold","hideTopThreshold","opacity","each","value","key","isNumber","round"],"mappings":"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","file":"actionbar.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    './actionbar.hbs'\n], function(\n    defineComponent,\n    template\n) {\n    'use strict';\n\n    var FPS = 1000 / 60,\n        TOP_HIDE_THRESHOLD = 40,\n        ALIGN_TO_TYPES = [\n            'textselection',\n            'node'\n        ];\n\n    return defineComponent(ActionBar);\n\n    function ActionBar() {\n\n        this.around('teardown', function(original) {\n            this.$tip.hide();\n            this[this.attr.alignTo + 'Teardown']();\n            this.$node.tooltip('destroy');\n            if (this.alreadyDisposed) {\n                return;\n            }\n            original.call(this);\n            this.alreadyDisposed = true;\n        });\n\n        this.after('initialize', function() {\n            if (!this.attr.actions) {\n                throw 'actions attribute required';\n            }\n            if (ALIGN_TO_TYPES.indexOf(this.attr.alignTo) === -1) {\n                throw 'alignTo only supports ' + ALIGN_TO_TYPES.join(',');\n            }\n\n            this.$node.removeAttr('title');\n            var tooltip = this.$node.tooltip({\n                trigger: 'click',\n                title: template({\n                    actions: Object.keys(this.attr.actions).map(a => {\n                        const action = this.attr.actions[a];\n                        if (_.isString(action)) {\n                            return { cls: '', event: action, name: a };\n                        } else {\n                            return {\n                                cls: action.className || '',\n                                event: action.event,\n                                name: a,\n                                style: action.style || ''\n                            };\n                        }\n                    })\n                }),\n                placement: 'bottom',\n                container: 'body',\n                html: true\n            });\n\n            tooltip.tooltip('show');\n\n            this.$tip = tooltip.data('tooltip').$tip\n                .addClass('actionbar ' + (this.attr.options && this.attr.options.className || ''))\n                .on('click', '.actionbarbutton', this.onActionClick.bind(this));\n            this.updatePosition = _.throttle(this[this.attr.alignTo + 'UpdatePosition'].bind(this), FPS);\n\n            this[this.attr.alignTo + 'Initializer']();\n            this.updatePosition();\n            this.on(document, 'graphPaddingUpdated', this.updatePosition);\n            this.on(document, 'windowResize', this.updatePosition);\n\n            var self = this;\n\n            this.on(document, 'click', function() {\n                _.defer(function() {\n                    self.teardown();\n                });\n            });\n        });\n\n        this.onActionClick = function(event) {\n            var $target = $(event.target).blur();\n\n            this.trigger($target.data('event'));\n            this.$tip.hide();\n        };\n\n        this.nodeUpdatePosition = function() {\n            var offset = this.$node.offset(),\n                width = this.$node.width(),\n                height = this.$node.height();\n\n            this.updateTipPositionWithDomElement(this.node, 'center');\n        };\n\n        this.nodeInitializer = function() {\n            this.updatePositionOnScroll(this.node);\n        };\n\n        this.nodeTeardown = function() {\n            this.scrollParent.off('.actionbar');\n        };\n\n        this.textselectionUpdatePosition = function() {\n            var selection = getSelection(),\n                range = selection.rangeCount > 0 && selection.getRangeAt(0);\n\n            if (range) {\n                this.updateTipPositionWithDomElement(range);\n            } else this.teardown();\n        };\n\n        this.textselectionInitializer = function() {\n            var selection = getSelection(),\n                closest = selection.anchorNode.parentNode;\n\n            this.updatePositionOnScroll(closest);\n        };\n\n        this.textselectionTeardown = function() {\n            this.scrollParent.off('.actionbar');\n        };\n\n        this.updatePositionOnScroll = function(el) {\n\n            // Reposition on scroll events\n            this.scrollParent = $(el).scrollParent()\n                .off('.actionbar')\n                .on('scroll.actionbar', this.updatePosition);\n        };\n\n        this.updateTipPositionWithDomElement = function(el, alignment) {\n            var box = null,\n                rects = el.getClientRects();\n\n            if (rects.length) {\n                box = _.sortBy(rects, function(r) {\n                    return r.top * -1;\n                })[0];\n            } else {\n                box = el.getBoundingClientRect();\n            }\n\n            var windowScroll = $(window).scrollTop(), // for fullscreen view\n                top = box.top + windowScroll,\n                position = (alignment === 'center' && rects.length === 1) ?\n                    box.left + box.width / 2 :\n                    box.left + box.width,\n                css = {\n                    left: position - this.$tip.width() / 2,\n                    top: top + box.height\n                };\n\n            if (this.attr.alignWithin) {\n                var offset = this.attr.alignWithin.offset(),\n                    width = this.attr.alignWithin.width(),\n                    padding = parseInt(this.attr.alignWithin.css('padding-left')) * 2,\n                    extraPadding = 3,\n                    totalWidth = width + (isNaN(padding) ? 0 : padding),\n                    tipWidth = this.$tip.width();\n\n                css.left = Math.max(offset.left + extraPadding, css.left);\n                css.left = Math.min(offset.left + totalWidth - tipWidth - extraPadding, css.left);\n                var arrowPercent = (position - css.left) / tipWidth * 100;\n                this.$tip.find('.tooltip-arrow').css('left', arrowPercent.toFixed(2) + '%');\n            }\n\n            var topThreshold = this.attr.hideTopThreshold || 0;\n            css.opacity = top < topThreshold ? '0' : '1';\n\n            this.$tip.css(_.each(css, function(value, key) {\n                if (_.isNumber(value)) {\n                    css[key] = Math.round(value);\n                }\n            }));\n        };\n    }\n});\n"]}