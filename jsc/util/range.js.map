{"version":3,"sources":["../../js/util/range.js"],"names":["define","rangy","initialized","console","warn","init","api","clearSelection","getSelection","removeAllRanges","highlightOffsets","textElement","offsets","spans","querySelectorAll","found","i","length","info","JSON","parse","dataset","start","end","newEl","$newEl","$","scrollParent","scrollTo","offsetTop","clearQueue","animate","scrollTop","duration","easing","complete","on","ANIMATION_END","e","removeClass","addClass","getNodesWithinRange","range","r","createRange","setStart","startContainer","startOffset","setEnd","endContainer","endOffset","getNodes","createSnippetFromNode","node","numberWords","limitToContainer","document","nodeType","normalize","selectNode","Error","createSnippetFromRange","output","numberOfWords","text","toString","contextRange","expandRangeByWords","context","transform","str","prependEllipsis","match","words","trim","split","contextHighlight","before","after","splitBeforeAfterOutput","options","includeBlockContentTrailingSpace","includePreLineTrailingSpace","includeTrailingSpace","maxLoop","moveStart","closest","moveEnd"],"mappings":"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","file":"range.js","sourcesContent":["\ndefine([\n    'rangy-core',\n    'rangy-text'\n], function(rangy) {\n    'use strict';\n\n    if (!rangy.initialized) {\n        console.warn('Rangy should have been initialized by ClipboardManager…')\n        rangy.init();\n    }\n\n    var api = {\n\n        clearSelection: function() {\n            rangy.getSelection().removeAllRanges();\n        },\n\n        highlightOffsets: function(textElement, offsets) {\n            const spans = textElement.querySelectorAll('span[data-info]');\n\n            let found = null;\n            for (var i = 0; i < spans.length; i++) {\n                const info = JSON.parse(spans[i].dataset.info);\n                if (info.start === offsets[0] && info.end === offsets[1]) {\n                    found = spans[i]\n                    break;\n                }\n            }\n\n            if (!found) {\n                console.warn('Unable to find term mention at offsets', offsets)\n                return;\n            }\n\n            var newEl = found,\n                $newEl = $(newEl),\n                scrollParent = $newEl.scrollParent(),\n                scrollTo = newEl.offsetTop;\n\n            scrollParent.clearQueue().animate({\n                scrollTop: scrollTo - 100\n            }, {\n                duration: 'fast',\n                easing: 'easeInOutQuad',\n                complete: function() {\n                    $newEl.on(ANIMATION_END, function(e) {\n                        $newEl.removeClass('fade-slow');\n                    });\n                    $newEl.addClass('fade-slow');\n                }\n            });\n        },\n\n        getNodesWithinRange: function(range) {\n            var r = rangy.createRange();\n\n            r.setStart(range.startContainer, range.startOffset);\n            r.setEnd(range.endContainer, range.endOffset);\n\n            return r.getNodes()\n        },\n\n        createSnippetFromNode: function(node, numberWords, limitToContainer) {\n            var range = document.createRange();\n\n            if (node.nodeType === 1) {\n                node.normalize();\n                range.selectNode(node);\n            } else {\n                throw new Error('node must be nodeType=1');\n            }\n\n            return api.createSnippetFromRange(range, numberWords, limitToContainer);\n        },\n\n        createSnippetFromRange: function(range, numberWords, limitToContainer) {\n            var output = {},\n                numberOfWords = numberWords || 4,\n                text = range.toString(),\n                contextRange = api.expandRangeByWords(range, numberOfWords, output, limitToContainer),\n                context = contextRange.toString(),\n                transform = function(str, prependEllipsis) {\n                    if (str.match(/^[\\s\\n]*$/)) {\n                        return '';\n                    }\n\n                    var words = $.trim(str).split(/\\s+/);\n                    if (words.length < numberOfWords) {\n                        return str;\n                    }\n\n                    if (prependEllipsis) {\n                        return '…' + str;\n                    }\n\n                    return str + '…';\n                },\n                contextHighlight = transform(output.before, true) +\n                    '<span class=\"selection\">' + text + '</span>' +\n                    transform(output.after, false);\n\n            return contextHighlight;\n        },\n\n        expandRangeByWords: function(range, numberWords, splitBeforeAfterOutput, limitToContainer) {\n\n            var e = rangy.createRange(),\n                i = 0,\n                options = {\n                    includeBlockContentTrailingSpace: false,\n                    includePreLineTrailingSpace: false,\n                    includeTrailingSpace: false\n                },\n                maxLoop = 1000;\n\n            e.setStart(range.startContainer, range.startOffset);\n            e.setEnd(range.endContainer, range.endOffset);\n\n            // Move range start to include n more of words\n            e.moveStart('word', -numberWords, options);\n            if (limitToContainer) {\n                i = 0;\n                while (e.startContainer !== limitToContainer &&\n                       $(e.startContainer).closest(limitToContainer).length === 0) {\n                    if (++i > maxLoop) break;\n                    e.moveStart('character', 1, options);\n                }\n                if (i) {\n                    e.moveStart('character', -1, options);\n                }\n            }\n\n            // Move range end to include n more words\n            e.moveEnd('word', numberWords, options);\n\n            if (limitToContainer) {\n                i = 0;\n                while (e.endContainer !== limitToContainer &&\n                       $(e.endContainer).closest(limitToContainer).length === 0) {\n                    if (++i > maxLoop) break;\n                    e.moveEnd('character', -1, options);\n                }\n            }\n\n            // Calculate what we just included and send that back\n            if (splitBeforeAfterOutput) {\n                var output = rangy.createRange();\n                output.setStart(e.startContainer, e.startOffset);\n                output.setEnd(range.startContainer, range.startOffset);\n                splitBeforeAfterOutput.before = output.text();\n\n                output.setStart(range.endContainer, range.endOffset);\n                output.setEnd(e.endContainer, e.endOffset);\n                splitBeforeAfterOutput.after = output.text();\n            }\n\n            return e;\n        }\n    };\n\n    return api;\n});\n"]}