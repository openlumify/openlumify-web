{"version":3,"sources":["../../js/util/withAsyncQueue.js"],"names":["define","withAsyncQueue","before","self","deferreds","stacks","setupAsyncQueue","name","stack","objectData","callback","call","push","$","Deferred","state","undefined","data","Error","resolve","forEach","c","length"],"mappings":"AACAA,OAAO,EAAP,CAAW,UAAW,CAClB,aAEA,MAAOC,eAAP,CAEA,QAASA,eAAT,EAA0B,CAEtB,KAAKC,MAAL,CAAY,YAAZ,CAA0B,UAAW,CACjC,GAAIC,MAAO,IAAX,CACIC,UAAY,EADhB,CAEIC,OAAS,EAFb,CAIA,KAAKC,eAAL,CAAuB,SAASC,IAAT,CAAe,CAElC,GAAIC,OAAQH,OAAOE,IAAP,EAAe,EAA3B,CACIE,UADJ,CAGAN,KAAKI,KAAO,OAAZ,EAAuB,SAASG,QAAT,CAAmB,CACtC,GAAIA,QAAJ,CAAc,CAEV,GAAID,UAAJ,CAAgB,CACZC,SAASC,IAAT,CAAcR,IAAd,CAAoBM,UAApB,EACH,CAFD,IAEO,CACHD,MAAMI,IAAN,CAAWF,QAAX,EACH,CACJ,CAPD,IAOO,CACH,MAAON,WAAUG,IAAV,IAAoBH,UAAUG,IAAV,EAAkBM,EAAEC,QAAF,EAAtC,CAAP,CACH,CACJ,CAXD,CAaAX,KAAKI,KAAO,SAAZ,EAAyB,UAAW,CAChC,GAAIH,UAAUG,IAAV,CAAJ,CAAqB,CACjB,MAAOH,WAAUG,IAAV,EAAgBQ,KAAhB,KAA4B,UAAnC,CACH,CAED,MAAON,cAAeO,SAAtB,CACH,CAND,CAQAb,KAAKI,KAAO,WAAZ,EAA2B,SAASU,IAAT,CAAe,CACtC,GAAI,CAACA,IAAL,CAAW,KAAM,IAAIC,MAAJ,CAAU,uBAAyBX,IAAzB,CAAgC,WAA1C,CAAN,CAEX,GAAIH,UAAUG,IAAV,CAAJ,CAAqB,CACjBH,UAAUG,IAAV,EAAgBY,OAAhB,CAAwBF,IAAxB,EACH,CAFD,IAEO,CACHb,UAAUG,IAAV,EAAkBM,EAAEC,QAAF,EAAlB,CACAV,UAAUG,IAAV,EAAgBY,OAAhB,CAAwBF,IAAxB,EACH,CAEDR,WAAaQ,IAAb,CAEAT,MAAMY,OAAN,CAAc,SAASC,CAAT,CAAY,CACtBA,EAAEV,IAAF,CAAOR,IAAP,CAAaM,UAAb,EACH,CAFD,EAGAD,MAAMc,MAAN,CAAe,CAAf,CACH,CAhBD,CAkBAnB,KAAKI,KAAO,QAAZ,EAAwB,UAAW,CAC/BH,UAAUG,IAAV,EAAkBS,SAAlB,CACAP,WAAaO,SAAb,CACH,CAHD,CAIH,CAhDD,CAiDH,CAtDD,EAuDH,CACJ,CA/DD","file":"withAsyncQueue.js","sourcesContent":["\ndefine([], function() {\n    'use strict';\n\n    return withAsyncQueue;\n\n    function withAsyncQueue() {\n\n        this.before('initialize', function() {\n            var self = this,\n                deferreds = {},\n                stacks = {};\n\n            this.setupAsyncQueue = function(name) {\n\n                var stack = stacks[name] = [],\n                    objectData;\n\n                self[name + 'Ready'] = function(callback) {\n                    if (callback) {\n                        // Legacy non-promise\n                        if (objectData) {\n                            callback.call(self, objectData);\n                        } else {\n                            stack.push(callback);\n                        }\n                    } else {\n                        return deferreds[name] || (deferreds[name] = $.Deferred());\n                    }\n                };\n\n                self[name + 'IsReady'] = function() {\n                    if (deferreds[name]) {\n                        return deferreds[name].state() === 'resolved';\n                    }\n\n                    return objectData !== undefined;\n                };\n\n                self[name + 'MarkReady'] = function(data) {\n                    if (!data) throw new Error('No object passed to ' + name + 'MarkReady');\n\n                    if (deferreds[name]) {\n                        deferreds[name].resolve(data);\n                    } else {\n                        deferreds[name] = $.Deferred();\n                        deferreds[name].resolve(data);\n                    }\n\n                    objectData = data;\n\n                    stack.forEach(function(c) {\n                        c.call(self, objectData);\n                    });\n                    stack.length = 0;\n                };\n\n                self[name + 'Unload'] = function() {\n                    deferreds[name] = undefined;\n                    objectData = undefined;\n                };\n            };\n        });\n    }\n});\n"]}