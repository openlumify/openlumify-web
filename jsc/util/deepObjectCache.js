define([],function(){function ValueMap(){this.map={};}ValueMap.prototype.get=function(key){return this.map[key];};ValueMap.prototype.set=function(key,value){this.map[key]=value;};ValueMap.prototype.delete=function(key){delete this.map[key];};DeepObjectCache.prototype.getOrUpdate=getOrUpdate;DeepObjectCache.prototype.clear=clear;return DeepObjectCache;function DeepObjectCache(){if(this===window)throw new Error('Must instantiate cache with new');}function clear(){if(this.rootMap){this.rootMap=null;}}function getOrUpdate(fn){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}if(!_.isFunction(fn))throw new Error('fn must be a function');if(!args.length)throw new Error('Must have at least one argument');if(!this.rootMap)this.rootMap=createCache(args[0]);return _getOrUpdate(this.rootMap,[fn].concat(args),reevaluate);function reevaluate(){return fn.apply(null,args);}}function isCache(obj){return obj instanceof WeakMap||obj instanceof ValueMap;}function createCache(obj){return _.isObject(obj)&&!_.isString(obj)?new WeakMap():new ValueMap();}function _getOrUpdate(cache,keyObjects,reevaluate){if(keyObjects.length===0){return cache;}var nextKey=keyObjects.shift();var nextObject=cache.get(nextKey);if(nextObject){if(nextObject instanceof WeakMap&&keyObjects.length===0){nextObject=reevaluate();}else if(!isCache(nextObject)&&keyObjects.length){cache.delete(nextKey);nextObject=createCache(nextKey);}}else{nextObject=keyObjects.length?createCache(keyObjects[0]):reevaluate();}cache.set(nextKey,nextObject);return _getOrUpdate(nextObject,keyObjects,reevaluate);}});
//# sourceMappingURL=deepObjectCache.js.map
