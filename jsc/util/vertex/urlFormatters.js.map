{"version":3,"sources":["../../../js/util/vertex/urlFormatters.js"],"names":["define","URL_TYPES","FULLSCREEN","ADMIN","REDIRECT","TOOLS","V","url","vertices","workspaceId","openlumifyData","currentWorkspaceId","window","location","href","replace","_","map","v","isObject","type","encodeURIComponent","id","elementType","toLowerCase","substring","elementId","isString","join","fragmentUrl","isFullscreenUrl","toOpen","parametersInUrl","vertexIds","length","edgeIds","invert","match","tool","split","extend","mapObject","section","name","decodeURIComponent","redirectUrl","tools","uniq","trim","toolsWithOptions","object","optionsIndex","indexOf","options","unserialize","objects","data","chain","groupBy","o","ids","val","value","$","vertexUrl","str","chunks","obj","forEach","c"],"mappings":"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","file":"urlFormatters.js","sourcesContent":["\ndefine([], function() {\n    'use strict';\n\n    var URL_TYPES = {\n            FULLSCREEN: 'v',\n            ADMIN: 'admin',\n            REDIRECT: 'redirect',\n            TOOLS: 'tools'\n        },\n        V = {\n            url: function(vertices, workspaceId) {\n                if (!workspaceId) {\n                    workspaceId = openlumifyData.currentWorkspaceId;\n                }\n                return window.location.href.replace(/#.*$/, '') +\n                    '#v=' + _.map(vertices, function(v) {\n                        if (_.isObject(v) && 'type' in v) {\n                            if (v.type === 'extendedDataRow') {\n                                return encodeURIComponent(v.id.elementType.toLowerCase().substring(0, 1) + v.id.elementId);\n                            } else {\n                                return encodeURIComponent(v.type.substring(0, 1) + v.id);\n                            }\n                        }\n                        return encodeURIComponent(_.isString(v) ? v : v.id);\n                    }).join(',') + (\n                        workspaceId ? ('&w=' + encodeURIComponent(workspaceId)) : ''\n                    )\n            },\n\n            fragmentUrl: function(vertices, workspaceId) {\n                return V.url(vertices, workspaceId).replace(/^.*#/, '#');\n            },\n\n            isFullscreenUrl: function(url) {\n                var toOpen = V.parametersInUrl(url);\n\n                return toOpen &&\n                    toOpen.type === 'FULLSCREEN' &&\n                    ((toOpen.vertexIds && toOpen.vertexIds.length) ||\n                    (toOpen.edgeIds && toOpen.edgeIds.length));\n            },\n\n            parametersInUrl: function(url) {\n                var type = _.invert(URL_TYPES),\n                    match = url.match(/#(v|admin|redirect|tools)=(.+?)(?:&w=(.*))?$/);\n\n                if (match && match.length === 4) {\n                    if (match[1] === URL_TYPES.ADMIN) {\n                        var tool = match[2].split(':');\n                        if (tool.length !== 2) {\n                            return null;\n                        }\n\n                        return _.extend(_.mapObject({\n                            section: tool[0],\n                            name: tool[1]\n                        }, function(v) {\n                            return decodeURIComponent(v).replace(/\\+/g, ' ');\n                        }), { type: type[match[1]] });\n                    }\n\n                    if (match[1] === URL_TYPES.REDIRECT) {\n                        return {\n                            type: type[match[1]],\n                            redirectUrl: match[2]\n                        }\n                    }\n\n                    if (match[1] === URL_TYPES.TOOLS) {\n                        var tools = _.uniq(match[2].trim().split(','));\n                        var toolsWithOptions = _.object(tools.map(function(tool) {\n                            var optionsIndex = tool.indexOf('&');\n                            var name = tool;\n                            var options = {};\n                            if (optionsIndex > 0) {\n                                name = tool.substring(0, optionsIndex);\n                                options = unserialize(tool.substring(optionsIndex + 1)) || {};\n                            }\n                            if (match[3]) {\n                                options.workspaceId = match[3];\n                            }\n                            return [name, options || {}]\n                        }))\n\n                        return {\n                            type: type[match[1]],\n                            tools: toolsWithOptions\n                        };\n                    }\n\n                    var objects = _.map(match[2].split(','), function(v) {\n                            return decodeURIComponent(v);\n                        }),\n                        data = _.chain(objects)\n                            .groupBy(function(o) {\n                                var match = o.match(/^(v|e).*/);\n                                if (match) {\n                                    if (match[1] === 'v') return 'vertexIds';\n                                    if (match[1] === 'e') return 'edgeIds';\n                                }\n                                return 'vertexIds';\n                            })\n                            .mapObject(function(ids) {\n                                return ids.map(function(val) {\n                                    return val.substring(1);\n                                });\n                            })\n                            .value();\n\n                    return _.extend({ vertexIds: [], edgeIds: [] }, data, {\n                        workspaceId: decodeURIComponent(match[3] || ''),\n                        type: type[match[1]]\n                    });\n                }\n                return null;\n            }\n    };\n\n    return $.extend({}, { vertexUrl: V });\n\n\n    function unserialize(str) {\n      str = decodeURIComponent(str);\n      var chunks = str.split('&'),\n          obj = {};\n      chunks.forEach(function(c) {\n          var split = c.split('=', 2);\n          obj[split[0]] = split[1];\n      })\n      return obj;\n    }\n});\n"]}