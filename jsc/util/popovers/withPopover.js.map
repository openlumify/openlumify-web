{"version":3,"sources":["../../../js/util/popovers/withPopover.js"],"names":["define","ERROR_NO_POSITION_RESPONSE","withPopover","defaultAttrs","withPopoverInputSelector","hideDialog","keepInView","manualSetup","before","clearTimeout","positionChangeErrorCheck","$","document","off","trigger","removeSizeObserver","after","dialog","remove","self","attr","finishSetup","require","getTemplatePath","setupWithTemplate","bind","t","template","path","test","substring","tpl","closestModal","overlay","body","append","css","position","display","html","appendTo","$node","closest","length","parseInt","popover","find","on","positionDialog","teardown","withPopoverOnKeyup","withPopoverOnKeydown","teardownOnTap","mousedown","e","x","clientX","y","clientY","mouseup","target","x2","y2","distance","Math","sqrt","_","defer","registerAnchorTo","registerSizeObserver","event","$target","_preventSubmit","parent","enterShouldSubmit","which","ui","keyCode","ENTER","selector","not","console","warn","onPositionChange","delay","dialogPosition","error","w","window","width","height","data","isEqual","anchor","anchorTo","allBlank","every","val","dialogPositionIf","positionIf","dialogPositionZoom","zoom","throttledPositionDialog","throttle","pos","above","$arrow","scaling","zoomWithGraph","min","max","menubarWidth","padding","outerHeight","outerWidth","windowWidth","windowHeight","maxLeft","maxTop","proposedForPosition","aboveOrBelow","calcLeft","calcTop","yMin","yMax","left","top","preferredPosition","proposed","className","indexOf","removeClass","addClass","below","arrowLeft","arrowPadding","maxLeftAllowed","percent","transform","round","transformOrigin","toFixed","show","MutationObserver","_sizeObserver","observe","childList","subtree","disconnect","_sizeObserverTimer"],"mappings":"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","file":"withPopover.js","sourcesContent":["define([], function() {\n    'use strict';\n\n    var ERROR_NO_POSITION_RESPONSE =\n            'Unable to attach popover, ' +\n            'nothing responded to registerForPositionChanges';\n\n    return withPopover;\n\n    function withPopover() {\n\n        this.defaultAttrs({\n            withPopoverInputSelector: 'input,select',\n            hideDialog: false,\n            keepInView: true,\n            manualSetup: false\n        });\n\n        this.before('teardown', function() {\n            clearTimeout(this.positionChangeErrorCheck);\n            $(document).off('.popoverclose')\n            this.trigger('unregisterForPositionChanges')\n            this.removeSizeObserver();\n        });\n\n        this.after('teardown', function() {\n            this.dialog.remove();\n            $('.popover-bg-overlay').remove();\n        });\n\n        this.after('initialize', function() {\n            const self = this;\n\n            this.attr.finishSetup = () => {\n                return require([getTemplatePath()], this.setupWithTemplate.bind(this));\n            };\n\n            if (!this.attr.manualSetup) {\n                this.attr.finishSetup();\n            }\n\n            function getTemplatePath() {\n                const t = self.attr.template || 'noTemplate';\n                let path;\n\n                if (/^\\//.test(t)) {\n                    if (/\\.hbs$/.test(t)) {\n                        path = t.substring(1);\n                    } else {\n                        // Use legacy requirejs plugin since plugins may relay on it\n                        path = 'hbs!' + t.substring(1);\n                    }\n                } else {\n                    path = 'util/popovers/' + t + '.hbs';\n                }\n\n                return path;\n            }\n        });\n\n        this.setupWithTemplate = function(tpl) {\n            var self = this,\n                closestModal;\n\n            if (this.attr.overlay) {\n                $(document.body).append('<div class=\"popover-bg-overlay\">')\n            }\n\n            this.dialog = $('<div class=\"dialog-popover\">')\n                .css({\n                    position: 'absolute',\n                    display: this.attr.hideDialog ? 'none' : 'block'\n                })\n                .html(tpl(this.attr))\n                .appendTo(document.body);\n\n            closestModal = this.$node.closest('.modal');\n            if (closestModal.length) {\n                this.dialog.css('z-index', parseInt(closestModal.css('z-index'), 10) + 10);\n            }\n\n            this.popover = this.dialog.find('.popover');\n\n            this.on(this.popover, 'positionDialog', this.positionDialog);\n            this.on(this.popover, 'rendered', this.positionDialog);\n            this.on(this.popover, 'closePopover', this.teardown);\n            this.on(this.popover, 'keyup', {\n                withPopoverInputSelector: this.withPopoverOnKeyup\n            })\n            this.on(this.popover, 'keydown', {\n                withPopoverInputSelector: this.withPopoverOnKeydown\n            })\n\n            if (this.attr.teardownOnTap !== false) {\n                this.on(document, 'mousedown', function mousedown(e) {\n                    var x = e.clientX, y = e.clientY;\n                    this.on(document, 'mouseup', function mouseup(e) {\n                        this.off(document, 'mouseup', mouseup);\n\n                        if ($(e.target).closest(self.popover).length) {\n                            return;\n                        }\n                        var x2 = e.clientX, y2 = e.clientY,\n                            distance = Math.sqrt((x2 - x) * (x2 - x) + (y2 - y) * (y2 - y))\n\n                        if (distance < 5) {\n                            // Wait a little in case other event handlers are\n                            // looking for popover\n                            _.defer(function() {\n                                self.teardown();\n                            })\n                        }\n                    })\n                })\n            }\n\n            this.registerAnchorTo();\n            this.registerSizeObserver();\n        };\n\n        this.withPopoverOnKeydown = function(event) {\n                var $target = $(event.target);\n\n                // Prevent submit when using enter to select from open menu in react-select\n                if (!this._preventSubmit &&\n                    $target.parent('.Select-input').length &&\n                    $target.closest('.Select.is-open').length) {\n                    this._preventSubmit = true;\n                }\n        };\n\n        this.withPopoverOnKeyup = function(event) {\n            if (this.enterShouldSubmit && event.which === $.ui.keyCode.ENTER) {\n\n                if (this._preventSubmit) {\n                    this._preventSubmit = false;\n                } else {\n                    var selector = this.attr[this.enterShouldSubmit];\n                    if (selector) {\n                        this.popover.find(this.attr[this.enterShouldSubmit]).not(':disabled').trigger('click');\n                    } else {\n                        console.warn('Selector to trigger on enter not found in popover', selector);\n                    }\n                }\n            }\n        };\n\n        this.registerAnchorTo = function() {\n            var self = this;\n\n            this.on('positionChanged', this.onPositionChange);\n            this.trigger('registerForPositionChanges', this.attr);\n\n            this.positionChangeErrorCheck = _.delay(function() {\n                if (!self.dialogPosition) {\n                    console.error(ERROR_NO_POSITION_RESPONSE);\n                    var w = $(window),\n                        width = w.width(),\n                        height = w.height();\n                    self.dialogPosition = { x: width / 2, y: height / 2 };\n                    self.positionDialog();\n                }\n            }, 500)\n        };\n\n        this.onPositionChange = function(event, data) {\n            if (!_.isEqual(data.anchor, this.attr.anchorTo)) {\n                return;\n            }\n\n            clearTimeout(this.positionChangeErrorCheck);\n            var allBlank = !data || _.every(data.position, function(val) {\n                    return val === 0;\n                });\n\n            if (allBlank) {\n                if (!this.dialog.data('preventTeardown')) {\n                    this.teardown();\n                }\n            } else {\n                this.dialogPosition = data.position;\n                this.dialogPositionIf = data.positionIf;\n                this.dialogPositionZoom = data.zoom || 1;\n                this.positionDialog();\n                if (!this.throttledPositionDialog) {\n                    this.throttledPositionDialog = true;\n                    _.delay(function() {\n                        this.positionDialog = _.throttle(this.positionDialog.bind(this), 1000 / 60);\n                    }.bind(this), 500);\n                }\n            }\n        };\n\n        this.positionDialog = function() {\n            var self = this;\n            var pos = this.dialogPositionIf && this.dialogPositionIf.above || this.dialogPosition;\n            if (pos) {\n                var $arrow = this.dialog.find('.arrow'),\n                    scaling = this.attr.zoomWithGraph ?\n                        (Math.min(1, Math.max(0.1, this.dialogPositionZoom / 0.4))) : 1,\n                    menubarWidth = $('.menubar-pane').width() || 0,\n                    padding = $arrow.outerHeight(true) * scaling,\n                    width = this.popover.outerWidth() * scaling,\n                    height = this.popover.outerHeight() * scaling,\n                    windowWidth = $(window).width(),\n                    windowHeight = $(window).height(),\n                    maxLeft = windowWidth - width,\n                    maxTop = windowHeight - height,\n                    proposedForPosition = function(pos, aboveOrBelow) {\n                        var calcLeft = pos.x - (width / 2),\n                            calcTop;\n                        if (aboveOrBelow === 'above') {\n                            calcTop = (pos.yMin || pos.y) - height - padding;\n                        } else {\n                            calcTop = (pos.yMax || pos.y) + padding;\n                        }\n                        return {\n                            left: self.attr.keepInView ? Math.max(menubarWidth + padding, Math.min(maxLeft - padding, calcLeft)) : calcLeft,\n                            top: self.attr.keepInView ? Math.max(padding, Math.min(maxTop - padding, calcTop)) : calcTop\n                        };\n                    },\n                    preferredPosition = self.attr.preferredPosition === 'below' ? 'below' : 'above',\n                    proposed = proposedForPosition(\n                        this.dialogPositionIf && this.dialogPositionIf[preferredPosition] || this.dialogPosition,\n                        preferredPosition\n                    );\n\n                if (preferredPosition === 'below') {\n                    if (proposed.top < pos.y) {\n                        proposed = proposedForPosition(\n                            this.dialogPositionIf && this.dialogPositionIf.above || this.dialogPosition,\n                            'above'\n                        );\n                        if (!~this.popover[0].className.indexOf('top')) {\n                            this.popover.removeClass('bottom').addClass('top');\n                        }\n                    } else if (!~this.popover[0].className.indexOf('bottom')) {\n                        this.popover.removeClass('top').addClass('bottom');\n                    }\n                } else {\n                    if (proposed.top + height > pos.y) {\n                        proposed = proposedForPosition(\n                            this.dialogPositionIf && this.dialogPositionIf.below || this.dialogPosition,\n                            'below'\n                        );\n                        if (!~this.popover[0].className.indexOf('bottom')) {\n                            this.popover.removeClass('top').addClass('bottom');\n                        }\n                    } else if (!~this.popover[0].className.indexOf('top')) {\n                        this.popover.removeClass('bottom').addClass('top');\n                    }\n                }\n\n\n                var arrowLeft = pos.x - proposed.left,\n                    arrowPadding = padding * 1.5,\n                    maxLeftAllowed = width - arrowPadding,\n                    percent = (Math.max(arrowPadding, Math.min(maxLeftAllowed, arrowLeft)) / width * 100) + '%';\n\n                $arrow.css('left', percent);\n\n                proposed.transform = 'translate(' + Math.round(proposed.left) + 'px,' + Math.round(proposed.top) + 'px)';\n                proposed.transformOrigin = '0 0';\n                delete proposed.top;\n                delete proposed.left;\n\n                if (this.attr.zoomWithGraph) {\n                    proposed.transform += ' scale(' + scaling.toFixed(3) + ')';\n                }\n                this.dialog.css(proposed);\n                this.popover.show();\n            }\n        }\n\n        this.registerSizeObserver = function() {\n            if (typeof window.MutationObserver === 'undefined') {\n                return;\n            }\n\n            this._sizeObserver = new MutationObserver(() => {\n                this.positionDialog();\n            });\n            this._sizeObserver.observe(this.dialog[0], {\n                childList: true,\n                subtree: true\n            });\n        };\n\n        this.removeSizeObserver = function() {\n            if (this._sizeObserver) {\n                this._sizeObserver.disconnect();\n            }\n            if (this._sizeObserverTimer) {\n                clearTimeout(this._sizeObserverTimer);\n            }\n        };\n    }\n});\n"]}