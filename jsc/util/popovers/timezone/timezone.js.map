{"version":3,"sources":["../../../../js/util/popovers/timezone/timezone.js"],"names":["define","defineComponent","withPopover","F","jstz","Timezone","defaultAttrs","toggleSelector","before","node","config","localTimezone","determine","name","timezone","template","after","self","on","popover","onToggle","timezoneToInfo","find","val","typeahead","items","source","_","chain","olson","timezones","keys","map","p","components","split","offsetMinutes","parseInt","selected","offset","offsetDisplay","dst","length","value","matcher","query","Object","getPrototypeOf","apply","arguments","highlighter","info","updater","trigger","teardown","input","data","lookup","event","$element","$","isFunction","proxy","process","grep","item","render","slice","show","$menu","toArray","i","defer","addClass","get","scrollIntoView","select","positionDialog","e","stopPropagation","button","target","content","closest","toggleClass","tz","attr","sourceTimezone","shiftTime"],"mappings":"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","file":"timezone.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    '../withPopover',\n    'util/formatters',\n    'jstz'\n], function(\n    defineComponent,\n    withPopover,\n    F,\n    jstz) {\n    'use strict';\n\n    return defineComponent(Timezone, withPopover);\n\n    function Timezone() {\n\n        this.defaultAttrs({\n            toggleSelector: '.toggle'\n        });\n\n        this.before('initialize', function(node, config) {\n            var localTimezone = jstz.determine().name(),\n                timezone = config.timezone || (config.timezone = localTimezone);\n\n            config.template = 'timezone/template';\n            config.localTimezone = localTimezone;\n\n            this.after('setupWithTemplate', function() {\n                var self = this;\n\n                this.on(this.popover, 'click', {\n                    toggleSelector: this.onToggle\n                });\n\n                var timezoneToInfo = {};\n                this.popover.find('input').val(timezone).typeahead({\n                    items: 10000,\n                    source: _.chain(jstz.olson.timezones)\n                            .keys()\n                            .map(function(p) {\n                                var components = p.split(','),\n                                    offsetMinutes = parseInt(components[0], 10),\n                                    name = jstz.olson.timezones[p];\n\n                                timezoneToInfo[name] = {\n                                    selected: timezone === name,\n                                    name: name,\n                                    offset: F.timezone.offsetDisplay(offsetMinutes),\n                                    dst: components.length >= 2 && components[1] === '1'\n                                };\n                                return name;\n                            })\n                            .value(),\n                    matcher: function(name) {\n                        if (!this.query) {\n                            return true;\n                        }\n                        if (this.query === timezone) {\n                            return true;\n                        }\n\n                        return Object.getPrototypeOf(this).matcher.apply(this, arguments);\n                    },\n                    highlighter: function(name) {\n                        var info = timezoneToInfo[name];\n                        return '<span class=\"offset\">' + info.offset + '</span>' +\n                            '<header title=\"' + info.name + '\">' +\n                                name + (info.dst ? ' *' : '') +\n                            '</header>';\n                    },\n                    updater: function(name) {\n                        self.trigger('selectTimezone', {\n                            name: name\n                        });\n                        self.teardown();\n                    }\n                });\n                var input = this.popover.find('input'),\n                    typeahead = input.data('typeahead');\n\n                typeahead.lookup = function(event) {\n                        var items;\n\n                        this.query = this.$element.val();\n\n                        items = $.isFunction(this.source) ?\n                            this.source(this.query, $.proxy(this.process, this)) :\n                            this.source;\n\n                        return items ? this.process(items) : this\n                    };\n                typeahead.process = function(items) {\n                        var self = this;\n\n                        items = $.grep(items, function(item) {\n                            return self.matcher(item)\n                        });\n\n                        this.render(items.slice(0)).show();\n\n                        var selected = _.find(this.$menu.find('li').toArray(), function(i) {\n                            return $(i).data('value') === timezone;\n                        });\n                        if (selected) {\n                            _.defer(function() {\n                                $(selected).addClass('active').get(0).scrollIntoView();\n                            });\n                        }\n\n                        return this;\n                    };\n\n                typeahead.lookup().show();\n                typeahead.$element[0].select();\n                this.typeahead = typeahead;\n                this.positionDialog();\n            });\n        });\n\n        this.onToggle = function(e) {\n            e.stopPropagation();\n\n            var button = $(e.target),\n                content = button.closest('.popover-content').toggleClass('show-source'),\n                tz = this.attr.sourceTimezone;\n\n            this.trigger('selectTimezone', {\n                name: tz,\n                shiftTime: true\n            });\n            this.teardown();\n        };\n    }\n});\n"]}