{"version":3,"sources":["../../../../js/util/popovers/propertyInfo/propertyInfo.js"],"names":["define","defineComponent","withPopover","F","withDataRequest","Privileges","VisibilityViewer","acl","d3","PropertyInfo","defaultAttrs","deleteButtonSelector","editButtonSelector","addButtonSelector","searchButtonSelector","replyButtonSelector","justificationValueSelector","before","$node","find","add","teardownAllComponents","node","config","manualSetup","after","self","setupConfig","attr","dataRequest","done","splitRegex","metadataDisplay","split","map","i18n","metadataType","metadataProperties","length","Error","metadataPropertiesDisplayMap","_","object","metadataPropertiesTypeMap","on","popover","onDelete","onEdit","onAdd","onSearch","onReply","teardown","contentRoot","select","get","update","document","onVerticesUpdated","onEscapeKey","template","isFullscreen","openlumifyData","getPropertyAcls","data","then","propertyAcls","property","isComment","name","isVisibility","canAdd","canEdit","canDelete","propertyAcl","ontologyProperty","findPropertyAcl","key","currentWorkspaceCommentable","addable","undefined","updateable","deleteable","currentWorkspaceEditable","Boolean","currentUser","privilegesHelper","PUBLISH","isCompoundField","dependentPropertyIris","canSearch","searchable","streamingPropertyValue","hideDialog","finishSetup","element","first","vertex","props","positionDialog","bind","displayNames","displayTypes","metadata","chain","prop","value","compact","filter","m","tap","push","row","selectAll","call","enter","append","text","d","valueElement","each","typeName","formatter","formatterAsync","id","catch","finally","attachTo","source","console","warn","$","toggle","justification","justificationMetadata","justificationText","entityJustification","findWhere","properties","sourceInfo","renderJustification","requestDetails","isVertex","propertyDetails","exit","remove","dialog","show","model","service","isEdge","result","insert","classed","j","isEmpty","require","JustificationViewer","sourceMetadata","textContent","event","vertices","path","trigger","type","concept","conceptId","edgeLabel","label","trim","p","pick","compoundProperty","values","omit","e","stopPropagation","button","addClass"],"mappings":"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","file":"propertyInfo.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    '../withPopover',\n    'util/vertex/formatters',\n    'util/withDataRequest',\n    'util/privileges',\n    'util/visibility/view',\n    'util/acl',\n    'd3'\n], function(\n    defineComponent,\n    withPopover,\n    F,\n    withDataRequest,\n    Privileges,\n    VisibilityViewer,\n    acl,\n    d3) {\n    'use strict';\n\n    return defineComponent(PropertyInfo, withPopover, withDataRequest);\n\n    function PropertyInfo() {\n\n        this.defaultAttrs({\n            deleteButtonSelector: '.btn-danger',\n            editButtonSelector: '.btn-edit',\n            addButtonSelector: '.btn-add',\n            searchButtonSelector: '.btn-search',\n            replyButtonSelector: '.reply',\n            justificationValueSelector: 'a'\n        });\n\n        this.before('teardown', function() {\n            this.$node\n                .find('.property-value')\n                .add('.justificationValue')\n                .teardownAllComponents();\n        });\n\n        this.before('initialize', function(node, config) {\n            config.manualSetup = true;\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.setupConfig(this.attr);\n\n            this.after('setupWithTemplate', function() {\n                this.dataRequest('config', 'properties')\n                    .done(function(config) {\n                        var splitRegex = /\\s*,\\s*/,\n                            metadataDisplay =\n                                config['properties.metadata.propertyNamesDisplay'].split(splitRegex).map(i18n),\n                            metadataType =\n                                config['properties.metadata.propertyNamesType'].split(splitRegex);\n\n                        self.metadataProperties =\n                            config['properties.metadata.propertyNames'].split(splitRegex);\n\n                        if (self.metadataProperties.length !== metadataDisplay.length ||\n                            self.metadataProperties.length !== metadataType.length) {\n                            throw new Error('Metadata properties must have display names and types');\n                        }\n                        self.metadataPropertiesDisplayMap = _.object(self.metadataProperties, metadataDisplay);\n                        self.metadataPropertiesTypeMap = _.object(self.metadataProperties, metadataType);\n\n                        self.on(self.popover, 'click', {\n                            deleteButtonSelector: self.onDelete,\n                            editButtonSelector: self.onEdit,\n                            addButtonSelector: self.onAdd,\n                            searchButtonSelector: self.onSearch,\n                            replyButtonSelector: self.onReply,\n                            justificationValueSelector: self.teardown\n                        });\n\n                        self.contentRoot = d3.select(self.popover.get(0))\n                            .select('.popover-content');\n                        self.update();\n\n                        self.on(document, 'verticesUpdated', self.onVerticesUpdated);\n                        self.on(document, 'escape', self.onEscapeKey);\n                    });\n            });\n        });\n\n        this.setupConfig = function(config) {\n            config.template = 'propertyInfo/template';\n            config.isFullscreen = openlumifyData.isFullscreen;\n\n            acl.getPropertyAcls(config.data)\n                .then((propertyAcls) => {\n                    if (config.property) {\n                        config.isComment = config.property.name === 'http://openlumify.org/comment#entry';\n                        config.isVisibility = config.property.name === 'http://openlumify.org#visibilityJson';\n                        config.canAdd = config.canEdit = config.canDelete = false;\n\n                        var propertyAcl = config.isVisibility ? config.ontologyProperty :\n                            acl.findPropertyAcl(propertyAcls, config.property.name, config.property.key);\n\n                        if (config.isComment && openlumifyData.currentWorkspaceCommentable) {\n                            config.canAdd = config.property.addable !== undefined ? config.property.addable !== false : propertyAcl.addable !== false;\n                            config.canEdit = config.property.updateable !== undefined ? config.property.updateable !== false : propertyAcl.updateable !== false;\n                            config.canDelete = config.property.deleteable !== undefined ? config.property.deleteable !== false : propertyAcl.deleteable !== false;\n                        } else if (!config.isComment && openlumifyData.currentWorkspaceEditable) {\n                            config.canAdd = config.property.addable !== undefined ? config.property.addable !== false : propertyAcl.addable !== false;\n                            if (config.isVisibility) {\n                                // Only users with PUBLISH privilege can edit the element visibility\n                                config.canEdit = Boolean(openlumifyData.currentUser.privilegesHelper.PUBLISH);\n                            } else {\n                                config.canEdit = config.property.updateable !== undefined ? config.property.updateable !== false : propertyAcl.updateable !== false;\n                            }\n                            config.canDelete = (config.property.deleteable !== undefined ? config.property.deleteable !== false : propertyAcl.deleteable !== false) &&\n                                !config.isVisibility;\n                        }\n\n                        var isCompoundField = config.ontologyProperty && config.ontologyProperty.dependentPropertyIris &&\n                            config.ontologyProperty.dependentPropertyIris.length;\n\n                        config.canSearch = config.ontologyProperty &&\n                            (config.ontologyProperty.searchable || isCompoundField) &&\n                            !config.isFullscreen;\n\n                        if (config.property.streamingPropertyValue) {\n                            config.canAdd = config.canDelete = config.canSearch = false;\n                        }\n\n                    }\n\n                    config.hideDialog = true;\n\n                    this.attr.finishSetup();\n            });\n        };\n\n        this.onEscapeKey = function() {\n            this.teardown();\n        };\n\n        this.update = function() {\n            var self = this,\n                element = this.attr.data,\n                isVisibility = this.attr.property.name === 'http://openlumify.org#visibilityJson',\n                property = isVisibility ?\n                    _.first(F.vertex.props(this.attr.data, this.attr.property.name)) :\n                    _.first(F.vertex.props(this.attr.data, this.attr.property.name, this.attr.property.key)),\n                positionDialog = this.positionDialog.bind(this),\n                displayNames = this.metadataPropertiesDisplayMap,\n                displayTypes = this.metadataPropertiesTypeMap,\n                isComment = property.name === 'http://openlumify.org/comment#entry',\n                metadata = _.chain(this.metadataProperties || [])\n                    .map(function(name) {\n                        if (isVisibility) {\n                            var prop = _.first(F.vertex.props(element, name));\n                            if (prop) {\n                                return [name, prop.value];\n                            }\n                        } else if ('metadata' in property) {\n                            if (name in property.metadata) {\n                                return [name, property.metadata[name]];\n                            }\n                        }\n                        if (name in property) {\n                            return [name, property[name]];\n                        }\n                    })\n                    .compact()\n                    .filter(function(m) {\n                        if (property.name === 'http://openlumify.org#visibilityJson' &&\n                            m[0] === 'sandboxStatus') {\n                            return false;\n                        }\n                        if (m[0] === 'http://openlumify.org#confidence' && isComment) {\n                            return false;\n                        }\n                        return true;\n                    })\n                    .tap(function(metadata) {\n                        if (property.streamingPropertyValue) {\n                            var key = 'http://openlumify.org#visibilityJson';\n                            metadata.push([key, property.metadata && property.metadata[key]]);\n                            displayNames[key] = i18n('visibility.label');\n                            displayTypes[key] = 'visibility';\n                        }\n                    })\n                    .value(),\n                row = this.contentRoot.select('table')\n                    .selectAll('tr')\n                    .data(metadata)\n                    .call(function() {\n                        this.enter()\n                            .append('tr')\n                            .call(function() {\n                                this.append('td').attr('class', 'property-name');\n                                this.append('td').attr('class', 'property-value');\n                            });\n                    });\n\n            this.contentRoot.selectAll('tr')\n                .call(function() {\n                    this.select('td.property-name').text(function(d) {\n                        return displayNames[d[0]];\n                    });\n\n                    var valueElement = this.select('td.property-value')\n                        .each(function(d) {\n                            var self = this,\n                                typeName = displayTypes[d[0]],\n                                formatter = F.vertex.metadata[typeName],\n                                formatterAsync = F.vertex.metadata[typeName + 'Async'],\n                                value = d[1];\n\n                            if (formatter) {\n                                formatter(self, value);\n                            } else if (formatterAsync) {\n                                formatterAsync(self, value, property, element.id)\n                                    .catch(function() {\n                                        d3.select(self).text(i18n('popovers.property_info.error', value));\n                                    })\n                                    .finally(positionDialog);\n                                d3.select(this).text(i18n('popovers.property_info.loading'));\n                            } else if (typeName === 'visibility') {\n                                VisibilityViewer.attachTo(this, {\n                                    value: value && value.source,\n                                    property: property,\n                                    element: element\n                                });\n                            } else {\n                                console.warn('No metadata type formatter: ' + typeName);\n                                d3.select(this).text(value);\n                            }\n                        });\n                })\n\n                // Hide blank metadata\n                .each(function(d) {\n                    $(this).toggle($(this).find('.property-value').text() !== '');\n                });\n\n            // Justification\n            var justification = [],\n                justificationMetadata = property.metadata &&\n                    property.metadata['http://openlumify.org#justification'];\n\n            if (justificationMetadata && justificationMetadata.justificationText) {\n                justification.push({\n                    justificationText: justificationMetadata\n                })\n            }\n\n            if (isVisibility) {\n                var entityJustification = _.findWhere(this.attr.data.properties, { name: 'http://openlumify.org#justification' }),\n                    sourceInfo = entityJustification && entityJustification.value;\n                if (sourceInfo && 'justificationText' in sourceInfo) {\n                    justification = [{ justificationText: sourceInfo }];\n                } else {\n                    justification = [];\n                }\n                this.renderJustification(justification);\n                if (justification.length === 0) {\n                    this.requestDetails().then(function(sourceInfo) {\n                        if (sourceInfo) {\n                            self.renderJustification([{ sourceInfo: sourceInfo }]);\n                            positionDialog();\n                        }\n                    })\n                }\n            } else {\n                this.renderJustification(justification);\n                if ((!justificationMetadata || !('justificationText' in justificationMetadata))) {\n                    this.dataRequest(\n                        F.vertex.isVertex(element) ? 'vertex' : 'edge',\n                        'propertyDetails',\n                        this.attr.data.id,\n                        property.name,\n                        property.key,\n                        property.metadata &&\n                        property.metadata['http://openlumify.org#visibilityJson'] &&\n                        property.metadata['http://openlumify.org#visibilityJson'].source\n                    )\n                        .then(function(propertyDetails) {\n                            self.renderJustification(\n                                (propertyDetails && propertyDetails.sourceInfo) ?\n                                [{ sourceInfo: propertyDetails.sourceInfo }] : []\n                            );\n                        })\n                        .catch(function() {\n                            self.renderJustification([]);\n                        })\n                        .finally(positionDialog)\n                }\n            }\n\n            row.exit().remove();\n\n            this.dialog.show();\n            positionDialog();\n        };\n\n        this.requestDetails = function() {\n            var model = this.attr.data,\n                service = F.vertex.isEdge(model) ? 'edge' : 'vertex';\n\n            return this.dataRequest(service, 'details', model.id)\n                .then(function(result) {\n                    return result.sourceInfo;\n                });\n        };\n\n        this.renderJustification = function(justification) {\n            var self = this;\n\n            this.contentRoot.selectAll('.justification')\n                .data(justification)\n                .call(function() {\n                    this.enter()\n                        .call(function() {\n                            this.insert('div', '.buttons').attr('class', 'justification')\n                                .call(function() {\n                                    this.append('div')\n                                        .attr('class', 'property-name property-justification')\n                                        .text(i18n('popovers.property_info.justification'))\n                                        .append('span').attr('class', 'badge')\n                                    this.append('div')\n                                        .attr('class', 'justificationValue');\n                                });\n                        });\n                    this.exit().remove();\n\n                    this.select('.property-justification .badge').classed('loading', function(j) {\n                        return _.isEmpty(j);\n                    })\n                    this.select('.justificationValue').each(function(j) {\n                        if (j.justificationText || j.sourceInfo) {\n                            require(['util/vertex/justification/viewer'], function(JustificationViewer) {\n                                $(this).teardownAllComponents();\n                                JustificationViewer.attachTo(this, {\n                                    justificationMetadata: j.justificationText,\n                                    sourceMetadata: j.sourceInfo\n                                });\n                                self.positionDialog();\n                            }.bind(this));\n                        } else {\n                            this.textContent = _.isEmpty(j) ?\n                                '' :\n                                i18n('popovers.property_info.justification.none');\n                        }\n                    })\n                });\n        }\n\n        this.onVerticesUpdated = function(event, data) {\n            var vertex = _.findWhere(data.vertices, {\n                    id: this.attr.data.id\n                }),\n                property = vertex && _.findWhere(vertex.properties, {\n                    name: this.attr.property.name,\n                    key: this.attr.property.key\n                });\n            if (vertex && !property) {\n                this.teardown();\n            } else if (property) {\n                this.attr.data = vertex;\n                this.update();\n            }\n        };\n\n        this.onReply = function() {\n            var metadata = this.attr.property.metadata['http://openlumify.org/comment#path'],\n                path = (metadata ? (metadata + '/') : '') + this.attr.property.key;\n\n            this.trigger('editProperty', {\n                path: path\n            });\n            this.teardown();\n        };\n\n        this.onSearch = function() {\n            var element = this.attr.data,\n                data = {};\n            if (element.type === 'vertex') {\n                var concept = F.vertex.concept(element);\n                data.conceptId = concept && concept.id;\n            } else if (element.type === 'edge') {\n                data.edgeLabel = element.label\n            } else {\n                throw new Error('Unknown type', this.attr.data)\n            }\n\n            var trim = function(p) {\n                    return _.pick(p, 'name', 'value', 'values');\n                };\n\n            if (this.attr.property.compoundProperty) {\n                data.properties = this.attr.property.values.map(trim);\n            } else {\n                data.property = trim(this.attr.property);\n            }\n            this.trigger('searchByProperty', data);\n            this.teardown();\n        };\n\n        this.onAdd = function() {\n            this.trigger('editProperty', {\n                property: _.omit(this.attr.property, 'key')\n            });\n            this.teardown();\n        };\n\n        this.onEdit = function() {\n            this.trigger('editProperty', {\n                property: this.attr.property\n            });\n            this.teardown();\n        };\n\n        this.onDelete = function(e) {\n            e.stopPropagation();\n            var button = this.popover.find('.btn-danger').addClass('loading').prop('disabled', true);\n            this.trigger('deleteProperty', {\n                property: _.pick(this.attr.property, 'name', 'key')\n            });\n        };\n    }\n});\n"]}