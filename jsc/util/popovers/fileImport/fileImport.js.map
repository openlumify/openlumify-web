{"version":3,"sources":["../../../../js/util/popovers/fileImport/fileImport.js"],"names":["define","defineComponent","withPopover","fileTemplate","Justification","registry","VisibilityEditor","ConceptSelector","F","withFormFieldErrors","withDataRequest","Attacher","documentExtensionPoint","e","_","isString","identifier","componentPath","FileImport","defaultAttrs","importSelector","cancelSelector","toggleCheckboxSelector","importFileButtonSelector","importFileSelector","importCloudSelector","cloudExtensionsSelector","visibilityInputSelector","justificationSelector","conceptSelector","singleSelector","singleVisibilitySelector","individualVisibilitySelector","before","popover","find","attr","add","teardownAllComponents","after","request","cancel","getTitle","files","stringType","length","pluralString","i18n","node","config","template","hasFile","cloudExtensions","extensionsForPoint","hasCloudExtensions","multipleFiles","title","self","visibilitySource","visibilitySources","Array","concepts","on","onVisibilityChange","onJustificationChange","onConceptChange","enterShouldSubmit","onImport","onCancel","onImportCloud","onCloudExtension","onCheckboxCopy","onFileChange","setFiles","checkValid","event","html","$","addClass","map","text","end","removeClass","$li","target","closest","path","attacher","empty","behavior","importConfig","dataRequest","then","trigger","teardown","legacyMapping","attach","$single","hide","toggle","name","undefined","index","justification","size","bytes","pretty","show","chain","property","reduce","memo","num","value","file","i","attachTo","eq","focus","defaultText","positionDialog","$checkbox","checked","is","toggleClass","delay","bind","data","concept","collapsed","isVisibilityCollapsed","isValid","valid","every","each","$visibility","fileIndex","visibilityValid","prop","checkbox","button","cancelButton","conceptValue","id","c","visibilityValue","teardownOnTap","req","partial","string","type","stringMimeType","isFunction","progress","complete","percent","Math","round","result","vertexIds","isArray","page","anchorTo","position","defer","catch","error","markFieldErrors"],"mappings":"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","file":"fileImport.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    '../withPopover',\n    './formattedFile.hbs',\n    'detail/dropdowns/propertyForm/justification',\n    'configuration/plugins/registry',\n    'util/visibility/edit',\n    'util/ontology/conceptSelect',\n    'util/formatters',\n    'util/withFormFieldErrors',\n    'util/withDataRequest',\n    'util/component/attacher'\n], function(\n    defineComponent,\n    withPopover,\n    fileTemplate,\n    Justification,\n    registry,\n    VisibilityEditor,\n    ConceptSelector,\n    F,\n    withFormFieldErrors,\n    withDataRequest,\n    Attacher) {\n    'use strict';\n\n    /**\n     * Create custom endpoints to ingest content into OpenLumify. A Long running process\n     * will process the loading of content asynchronously. Plugins register a\n     * [`CloudResourceSource`](https://github.com/openlumify/openlumify/blob/master/core/core/src/main/java/org/openlumify/core/ingest/cloud/CloudResourceSource.java) that returns items given a JSON configuration\n     * object generated by a custom component in the UI.\n     *\n     * Cloud import items are available in the file import popover.\n     *\n     * OpenLumify includes a plugin for [Amazon S3](https://github.com/openlumify/openlumify/tree/master/web/plugins/ingest-cloud-s3)\n     *\n     * @param {string} identifier Unique identifier string for this cloud source item.\n     * Usually set to the class name of the `CloudResourceSource` implementation.\n     *\n     * Also used for the user displayable title in UI. Plugins should register a message bundle with:\n     * `[identifier].title=My Cloud Source Title`\n     *\n     * @param {string} componentPath Path to {@link org.openlumify.ingest.cloud~Component}\n     */\n    registry.documentExtensionPoint('org.openlumify.ingest.cloud',\n        'Specify cloud destinations for ingestion',\n        function(e) {\n            return _.isString(e.identifier) && _.isString(e.componentPath)\n        }\n    );\n\n    return defineComponent(FileImport, withPopover, withFormFieldErrors, withDataRequest);\n\n    function FileImport() {\n\n        this.defaultAttrs({\n            importSelector: '.fileimport',\n            cancelSelector: '.filecancel',\n            toggleCheckboxSelector: '.toggle-collapsed',\n            importFileButtonSelector: 'button.file-select',\n            importFileSelector: '.create-form input.file',\n            importCloudSelector: 'button.cloud-select',\n            cloudExtensionsSelector: '.cloud-extensions li',\n            visibilityInputSelector: '.visibility',\n            justificationSelector: '.justification',\n            conceptSelector: '.concept-container',\n            singleSelector: '.single',\n            singleVisibilitySelector: '.single .visibility',\n            individualVisibilitySelector: '.individual-visibility'\n        });\n\n        this.before('teardown', function() {\n            this.popover\n                .find(this.attr.justificationSelector)\n                .add(this.attr.visibilityInputSelector)\n                .add(this.attr.conceptSelector)\n                .teardownAllComponents();\n        });\n\n        this.after('teardown', function() {\n            if (this.request && this.request.cancel) {\n                this.request.cancel();\n            }\n        });\n\n        this.getTitle = function(files, stringType) {\n            if (files.length) {\n                var pluralString = i18n('popovers.file_import.files.' + (\n                    files.length === 1 || stringType ? 'one' : 'some'\n                ), files.length);\n                return i18n('popovers.file_import.title', pluralString);\n            }\n            return i18n('popovers.file_import.nofile.title');\n        };\n\n        this.before('initialize', function(node, config) {\n            config.template = 'fileImport/template';\n\n            if (!config.files) config.files = [];\n\n            config.hasFile = config.files.length > 0;\n            config.cloudExtensions = registry.extensionsForPoint('org.openlumify.ingest.cloud');\n            config.hasCloudExtensions = config.cloudExtensions.length > 0;\n            config.multipleFiles = config.files.length > 1;\n            config.title = this.getTitle(config.files, config.stringType);\n\n            this.after('setupWithTemplate', function() {\n                var self = this;\n\n                this.visibilitySource = null;\n                this.visibilitySources = new Array(config.files.length);\n                this.concepts = new Array(config.files.length);\n\n                this.on(this.popover, 'visibilitychange', this.onVisibilityChange);\n                this.on(this.popover, 'justificationchange', this.onJustificationChange);\n                this.on(this.popover, 'conceptSelected', this.onConceptChange);\n\n                this.enterShouldSubmit = 'importSelector';\n\n                this.on(this.popover, 'click', {\n                    importSelector: this.onImport,\n                    cancelSelector: this.onCancel,\n                    importCloudSelector: this.onImportCloud,\n                    cloudExtensionsSelector: this.onCloudExtension\n                });\n\n                this.on(this.popover, 'change', {\n                    toggleCheckboxSelector: this.onCheckboxCopy,\n                    importFileSelector: this.onFileChange\n                })\n\n                this.setFiles(this.attr.files);\n                this.checkValid();\n            })\n        });\n\n        this.onImportCloud = function(event) {\n            this.popover.find('.import-cloud-form')\n                .html($('<ul>').addClass('nav nav-list cloud-extensions')\n                    .html(\n                        this.attr.cloudExtensions.map(e =>\n                            $('<li><a>')\n                                .attr('data-path', e.componentPath)\n                                .attr('data-identifier', e.identifier)\n                                .find('a').text(i18n(e.identifier + '.title'))\n                                .end()\n                        )\n                    )\n                );\n            this.popover.find('.show-create-form').removeClass('show-create-form');\n        };\n\n        this.onCloudExtension = function(event) {\n            var self = this,\n                $li = $(event.target).closest('li'),\n                path = $li.attr('data-path'),\n                identifier = $li.attr('data-identifier'),\n                /**\n                 * Flight or React component that provides the configuration\n                 * for this cloud resource.\n                 *\n                 * @typedef org.openlumify.ingest.cloud~Component\n                 * @property {function} onImport Trigger the upload given the\n                 * configuration provided by the user and configuration\n                 * component.\n                 * @fires org.openlumify.ingest.cloud#cloudImported\n                 */\n                attacher = Attacher()\n                    .node(this.popover.find('.import-cloud-form').empty())\n                    .path(path)\n                    .behavior({\n                        onImport: function(attacher, importConfig) {\n                            self.dataRequest('vertex', 'cloudImport', identifier, importConfig)\n                                .then(() => {\n                                    self.trigger('showActivityDisplay');\n                                })\n                            self.teardown();\n                        }\n                    })\n                    .legacyMapping({\n                        /**\n                         * Flight event to fire when upload should be triggered\n                         *\n                         * @event org.openlumify.ingest.cloud#cloudImported\n                         */\n                        onImport: 'cloudImported'\n                    })\n\n            self.before('teardown', () => attacher.teardown())\n            attacher.attach();\n        };\n\n        this.onFileChange = function(event) {\n            var files = event.target.files;\n            if (files.length) {\n                this.setFiles(files);\n            }\n        };\n\n        this.setFiles = function(files) {\n            this.attr.files = files;\n            this.popover.find('.popover-title').text(this.getTitle(files, this.attr.stringType));\n            this.popover.find(this.attr.importSelector).text(files.length ?\n                i18n('popovers.file_import.button.import') :\n                i18n('popovers.file_import.button.nofile.import')\n            );\n            var $single = this.popover.find(this.attr.singleSelector).hide();\n\n            if (files.length === 0) {\n                this.popover.find(this.attr.importFileButtonSelector).toggle(!this.attr.stringType);\n                this.popover.find(this.attr.toggleCheckboxSelector).hide();\n                this.popover.find(this.attr.individualVisibilitySelector).hide();\n                $single.html(fileTemplate({\n                    name: this.attr.stringType || undefined,\n                    index: 'collapsed',\n                    justification: true\n                }))\n            } else if (files.length === 1) {\n                this.popover.find(this.attr.importFileButtonSelector).hide();\n                this.popover.find(this.attr.toggleCheckboxSelector).hide();\n                this.popover.find(this.attr.individualVisibilitySelector).hide();\n                $single.html(fileTemplate({\n                    name: files[0].name,\n                    size: F.bytes.pretty(files[0].size, 0),\n                    index: 'collapsed'\n                }));\n            } else {\n                this.popover.find(this.attr.importFileButtonSelector).hide();\n                this.popover.find(this.attr.toggleCheckboxSelector).show();\n                $single.html(fileTemplate({\n                    name: i18n('popovers.file_import.files.some', files.length),\n                    size: F.bytes.pretty(_.chain(files)\n                            .map(_.property('size'))\n                            .reduce(function(memo, num) {\n                                return memo + num;\n                            }, 0)\n                            .value()),\n                    index: 'collapsed'\n                }));\n                this.popover.find(this.attr.individualVisibilitySelector)\n                    .hide()\n                    .html(\n                        $.map(files, function(file, i) {\n                            return fileTemplate({\n                                name: file.name,\n                                size: F.bytes.pretty(file.size, 0),\n                                index: i\n                            })\n                        })\n                    )\n            }\n\n            Justification.attachTo(this.popover.find(this.attr.justificationSelector).eq(0));\n            VisibilityEditor.attachTo(this.popover.find(this.attr.visibilityInputSelector));\n            ConceptSelector.attachTo(this.popover.find(this.attr.conceptSelector).eq(0), {\n                focus: true,\n                defaultText: files.length ?\n                    i18n('popovers.file_import.concept.placeholder') :\n                    i18n('popovers.file_import.concept.nofile.placeholder')\n            });\n            ConceptSelector.attachTo(this.popover.find(this.attr.conceptSelector), {\n                defaultText: i18n('popovers.file_import.concept.placeholder')\n            });\n            $single.show();\n\n            this.positionDialog();\n        }\n\n        this.onCheckboxCopy = function(e) {\n            var $checkbox = $(e.target),\n                checked = $checkbox.is(':checked');\n\n            this.popover.find(this.attr.singleSelector).toggle(checked);\n            this.popover.toggleClass('collapseVisibility', checked);\n            this.popover.find(this.attr.individualVisibilitySelector).toggle(!checked);\n            this.popover.find('.errors').empty();\n            _.delay(this.positionDialog.bind(this), 50);\n            this.checkValid();\n        };\n\n        this.onConceptChange = function(event, data) {\n            var concept = data.concept,\n                index = $(event.target)\n                    .closest(this.attr.conceptSelector)\n                    .data('concept', concept)\n                    .data('fileIndex');\n\n            if (index === 'collapsed') {\n                this.concept = concept;\n            } else {\n                this.concepts[index] = concept;\n            }\n\n            this.checkValid();\n        };\n\n        this.onJustificationChange = function(event, data) {\n            this.justification = data;\n            this.checkValid();\n        };\n\n        this.onVisibilityChange = function(event, data) {\n            var index = $(event.target)\n                .data('visibility', data)\n                .data('fileIndex');\n\n            if (index === 'collapsed') {\n                this.visibilitySource = data;\n            } else {\n                this.visibilitySources[index] = data;\n            }\n\n            this.checkValid();\n        };\n\n        this.checkValid = function() {\n            var self = this;\n            var collapsed = this.isVisibilityCollapsed(),\n                isValid = collapsed ?\n                    (this.visibilitySource && this.visibilitySource.valid &&\n                     (this.attr.files.length || (\n                         this.justification && this.justification.valid))\n                    ) :\n                    _.every(this.visibilitySources, _.property('valid'));\n\n            if (collapsed) {\n                this.popover.find(this.attr.singleVisibilitySelector).find('input').toggleClass('invalid', !isValid);\n            } else {\n                this.popover.find(this.attr.individualVisibilitySelector).find('.visibility').each(function() {\n                    var $visibility = $(this);\n                    var fileIndex = $visibility.data('fileIndex')\n                    var visibilityValid = self.visibilitySources[fileIndex].valid;\n\n                    $visibility.find('input').toggleClass('invalid', !visibilityValid);\n                });\n            }\n            if (isValid && this.attr.files.length === 0 && !this.concept) {\n                isValid = false;\n            }\n\n            this.popover.find(this.attr.importSelector).prop('disabled', !isValid);\n\n            return isValid;\n        };\n\n        this.isVisibilityCollapsed = function() {\n            var checkbox = this.popover.find('.checkbox input');\n\n            return checkbox.length === 0 || checkbox.is(':checked');\n        };\n\n        this.onCancel = function() {\n            this.teardown();\n        };\n\n        this.onImport = function() {\n            if (!this.checkValid()) {\n                return false;\n            }\n\n            var self = this,\n                files = this.attr.files,\n                button = this.popover.find('.btn-primary')\n                    .text(files.length ?\n                          i18n('popovers.file_import.importing') :\n                          i18n('popovers.file_import.creating')\n                    )\n                    .prop('disabled', true),\n                cancelButton = this.popover.find('.btn-default').show(),\n                collapsed = this.isVisibilityCollapsed(),\n                conceptValue = collapsed ?\n                    this.concept && this.concept.id :\n                    _.map(this.concepts, function(c) {\n                        return c && c.id || '';\n                    }),\n                visibilityValue = collapsed ?\n                    this.visibilitySource.value :\n                    _.map(this.visibilitySources, _.property('value'));\n\n            this.attr.teardownOnTap = false;\n\n            var req = _.partial(this.dataRequest.bind(this), 'vertex', _, _, conceptValue, visibilityValue);\n            if (files.length) {\n                this.request = req('importFiles', files);\n            } else if (this.attr.string) {\n                this.request = req('importFileString', {\n                    string: this.attr.string,\n                    type: this.attr.stringMimeType\n                });\n            } else {\n                this.request = req('create', this.justification);\n            }\n\n            if (_.isFunction(this.request.progress)) {\n                this.request\n                    .progress(function(complete) {\n                        var percent = Math.round(complete * 100);\n                        button.text(percent + '% ' + (\n                            files.length ?\n                                  i18n('popovers.file_import.importing') :\n                                  i18n('popovers.file_import.creating')\n                        ));\n                    })\n            }\n\n            this.request.then(function(result) {\n                var vertexIds = _.isArray(result.vertexIds) ? result.vertexIds : [result.id];\n                var page = self.attr.anchorTo.page;\n\n                self.trigger('fileImportSuccess', { vertexIds, position: page });\n                self.trigger('selectObjects', { vertexIds })\n\n                _.defer(function() {\n                    self.teardown();\n                })\n            })\n            .catch(function(error) {\n                self.attr.teardownOnTap = true;\n                // TODO: fix error\n                self.markFieldErrors(error || 'Unknown Error', self.popover);\n                cancelButton.hide();\n                button.text(files.length ?\n                        i18n('popovers.file_import.button.import') :\n                        i18n('popovers.file_import.button.nofile.import')\n                    )\n                    .removeClass('loading')\n                    .prop('disabled', false)\n\n                _.defer(self.positionDialog.bind(self));\n            })\n        }\n    }\n});\n"]}