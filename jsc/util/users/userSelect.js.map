{"version":3,"sources":["../../../js/util/users/userSelect.js"],"names":["define","defineComponent","template","userTemplate","withDataRequest","UserSelect","defaultAttrs","inputSelector","filterUserIds","after","on","onClearUser","onUpdateFilterUserIds","$node","html","placeholder","attr","i18n","setupTypeahead","event","data","userIds","self","_","defer","select","val","userMap","typeahead","source","query","callback","$","trim","length","dataRequest","done","users","otherUsers","filter","user","indexOf","id","ids","pluck","indexBy","matcher","sorter","sortBy","userId","displayName","updater","trigger","highlighter","json","JSON","stringify","subtitle","toLowerCase","email","userName"],"mappings":"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","file":"userSelect.js","sourcesContent":["define([\n    'flight/lib/component',\n    './userSelectTpl.hbs',\n    './user.hbs',\n    'util/withDataRequest'\n], function(\n    defineComponent,\n    template,\n    userTemplate,\n    withDataRequest) {\n    'use strict';\n\n    return defineComponent(UserSelect, withDataRequest);\n\n    function UserSelect() {\n\n        this.defaultAttrs({\n            inputSelector: 'input',\n            filterUserIds: []\n        });\n\n        this.after('initialize', function() {\n            this.on('clearUser', this.onClearUser);\n            this.on('updateFilterUserIds', this.onUpdateFilterUserIds);\n\n            this.$node.html(template({\n                placeholder: this.attr.placeholder || i18n('user.selection.field.placeholder')\n            }));\n\n            this.setupTypeahead();\n        });\n\n        this.onUpdateFilterUserIds = function(event, data) {\n            this.attr.filterUserIds = data.userIds;\n        };\n\n        this.onClearUser = function() {\n            var self = this;\n\n            _.defer(function() {\n                self.select('inputSelector').val('');\n            });\n        };\n\n        this.setupTypeahead = function() {\n            var self = this,\n                userMap = {};\n\n            this.select('inputSelector').typeahead({\n                source: function(query, callback) {\n                    if ($.trim(query).length) {\n                        self.dataRequest('user', 'search', { query: query })\n                            .done(function(users) {\n                                var otherUsers = users.filter(function(user) {\n                                        return self.attr.filterUserIds.indexOf(user.id) === -1;\n                                    }),\n                                    ids = _.pluck(otherUsers, 'id');\n\n                                userMap = _.indexBy(otherUsers, 'id');\n\n                                callback(ids);\n                            });\n                    } else {\n                        callback([]);\n                    }\n                },\n                matcher: function() {\n                    return true;\n                },\n                sorter: function(userIds) {\n                    return _.sortBy(userIds, function(userId) {\n                        return userMap[userId].displayName;\n                    });\n                },\n                updater: function(userId) {\n                    self.trigger('userSelected', {\n                        user: userMap[userId]\n                    });\n                    return userMap[userId].displayName;\n                },\n                highlighter: function(userId) {\n                    const user = userMap[userId];\n                    return userTemplate({\n                        json: JSON.stringify(user),\n                        displayName: user.displayName,\n                        subtitle: (user.displayName.toLowerCase() !== (user.email || user.userName).toLowerCase()) ?\n                            (user.email || user.userName) : null\n                    });\n                }\n            });\n        };\n\n    }\n});\n"]}