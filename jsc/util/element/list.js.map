{"version":3,"sources":["../../../js/util/element/list.js"],"names":["define","defineComponent","registry","template","DetailRelationshipItem","VertexItem","EdgeItem","alertTemplate","F","withDataRequest","dnd","withPositionUpdates","MAX_ITEMS_BEFORE_FORCE_LOADING","documentExtensionPoint","e","_","isFunction","canHandle","component","componentPath","List","defaultAttrs","itemSelector","draggableSelector","infiniteScrolling","usageContext","after","self","attr","items","edges","vertices","renderers","extensionsForPoint","concat","item","relationship","vertex","isEdge","isVertex","on","onClick","rendererPromises","map","extension","Promise","require","then","resolve","all","done","promiseResults","localScrolling","length","$node","addClass","html","scrolling","isScrolling","attachEvents","offset","allItems","addItems","slice","loadVisibleResultPreviews","debounce","bind","triggerInfiniteScrollRequest","droppable","accept","tolerance","onObjectsSelected","openlumifyData","selectedObjects","onSelectAll","move","onContextMenu","trigger","defer","scrollTop","total","event","preventDefault","stopPropagation","vertexIds","edgeIds","$target","$","target","parents","pushData","data","vertexId","selectVertexIds","push","edgeId","selectEdgeIds","closest","isSelected","deselect","singleSelection","targetIndex","index","shiftKey","lastClickedIndex","min","Math","max","$items","parent","children","i","eq","find","metaKey","ctrlKey","omit","Object","keys","link","position","x","pageX","y","pageY","previousSelected","select","filter","type","moveTo","selectedVertexIds","selectedEdgeIds","document","message","i18n","selectItems","teardownAllComponents","off","scrollNode","empty","css","onResultsScroll","onHoverItem","onVerticesUpdated","onVerticesDeleted","onEdgesDeleted","onWorkspaceLoaded","onAddInfiniteItems","evt","disableHover","$anchor","loadingListElement","withinScrollable","conceptType","verticesConceptId","nextOffset","paging","attachItemRenderer","el","itemRenderer","renderer","attachTo","appendTo","applyDraggable","remove","_items","indexBy","pluck","loading","added","reduce","selection","$li","add","before","append","success","error","lisVisible","setAttribute","addEventListener","elements","siblings","addBack","each","dt","dataTransfer","setDataTransferWithElements","memo","$item","workspace","updatedVertices","idx","deletedVertices","$a","removeClass","showSelected","itemVertexId","itemEdgeId","contains"],"mappings":"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","file":"list.js","sourcesContent":["/**\n * The list could be a static list or a infinite loading list of elements. The\n * container component is responsible for listening for events to request more\n * elements and fulfilling that request.\n *\n * @module components/List\n * @flight Render lists of entities and relationships (vertices/edges)\n * @attr {Array.<Object>} items Elements (vertices/edges) to render\n * @attr {boolean} singleSelection Whether the user can use keyboard shift/alt to select multiple\n * @attr {boolean} infiniteScrolling Whether the component should request more elements after scrolling\n * @attr {number} total The total count of items. Required when `infiniteScrolling` enabled.\n * @attr {number} nextOffset When `infiniteScrolling` is enabled, specifies where the next request should start\n * @attr {string|undefined} usageContext Describes the context this component is used so ListItemRenderers can determine if they should override behavior.\n * @see org.openlumify.entity.listItemRenderer\n * @fires module:components/List#infiniteScrollRequest\n * @listens module:components/List#addInfiniteItems\n * @example <caption>Static list</caption>\n * List.attachTo(node, {\n *     items: [vertices]\n * })\n * @example <caption>Infinite Scroll</caption>\n * // See example below for listening for infiniteScrollRequest\n * List.attachTo(node, {\n *     items: [page1Elements]\n *     nextOffset: 10,\n *     total: 100\n * })\n */\ndefine([\n    'flight/lib/component',\n    'configuration/plugins/registry',\n    './list.hbs',\n    './detail-relationship-item',\n    './vertex-item',\n    './edge-item',\n    'tpl!util/alert',\n    'util/vertex/formatters',\n    'util/withDataRequest',\n    'util/dnd',\n    'util/popovers/withElementScrollingPositionUpdates',\n    'util/jquery.withinScrollable'\n], function(\n    defineComponent,\n    registry,\n    template,\n    DetailRelationshipItem,\n    VertexItem,\n    EdgeItem,\n    alertTemplate,\n    F,\n    withDataRequest,\n    dnd,\n    withPositionUpdates) {\n    'use strict';\n\n    var MAX_ITEMS_BEFORE_FORCE_LOADING = 10;\n\n    /**\n     * This allows plugins to adjust how list items are displayed in search results,\n     * details panels, or anywhere else the lists are used.\n     *\n     * Requires either `component` or `componentPath`.\n     *\n     * <div class=\"warning\">\n     * **The `item` property passed to {@link org.openlumify.entity.listItemRenderer~Component|Component}\n     * can differ depending on `usageContext`.**\n     * <p>\n     * `usageContext == 'detail/relationships'` => `{ vertex, relationship }`<br>\n     * `usageContext == 'searchresults'` => The element\n     * </div>\n     *\n     * @param {org.openlumify.entity.listItemRenderer~canHandle} canHandle Whether the extension should run given an item and usageContext\n     * @param {org.openlumify.entity.listItemRenderer~Component} [component] The FlightJS component to handle rendering\n     * @param {string} [componentPath] Path to {@link org.openlumify.entity.listItemRenderer~Component}\n     */\n    registry.documentExtensionPoint('org.openlumify.entity.listItemRenderer',\n        'Implement custom implementations for rendering items into element lists',\n        function(e) {\n            return _.isFunction(e.canHandle) && (e.component || e.componentPath);\n        },\n        'http://docs.openlumify.org/extension-points/front-end/entityListItemRenderer/'\n    );\n\n    return defineComponent(List, withPositionUpdates, withDataRequest);\n\n    function List() {\n\n        this.defaultAttrs({\n            itemSelector: 'ul > li.element-item',\n            draggableSelector: '.element-item a.draggable',\n            infiniteScrolling: false,\n            usageContext: 'search'\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            // Do this to support code that arrives here via the\n            // deprecated vertex/list and edge/list components\n            this.attr.items = this.attr.items || this.attr.edges || this.attr.vertices;\n\n            this.renderers = registry.extensionsForPoint('org.openlumify.entity.listItemRenderer').concat([\n                { canHandle: function(item, usageContext) {\n                        return usageContext === 'detail/relationships' &&\n                                item && item.relationship &&\n                                F.vertex.isEdge(item.relationship);\n                    }, component: DetailRelationshipItem },\n                { canHandle: function(item) { return F.vertex.isEdge(item); }, component: EdgeItem },\n                { canHandle: function(item) { return F.vertex.isVertex(item); }, component: VertexItem }\n            ])\n\n            this.on('click', {\n                draggableSelector: this.onClick\n            });\n\n            var rendererPromises = _.map(this.renderers, function(extension) {\n                    if (extension.componentPath && !extension.component) {\n                        return Promise.require(extension.componentPath).then(function(component) {\n                            extension.component = component;\n                        });\n                    }\n                    return Promise.resolve();\n                });\n\n            Promise.all(rendererPromises).done(function(promiseResults) {\n                    self.localScrolling = !self.attr.infiniteScrolling && self.attr.items.length > MAX_ITEMS_BEFORE_FORCE_LOADING;\n                    self.$node\n                        .addClass('element-list')\n                        .html(template({\n                            scrolling: self.isScrolling()\n                        }));\n\n                    self.attachEvents();\n\n                    if (self.localScrolling) {\n                        self.offset = 0;\n                        self.allItems = self.attr.items;\n                        self.addItems(self.allItems.slice(0, MAX_ITEMS_BEFORE_FORCE_LOADING));\n                    } else {\n                        self.addItems(self.attr.items);\n                    }\n\n                    self.loadVisibleResultPreviews();\n                    self.loadVisibleResultPreviews = _.debounce(self.loadVisibleResultPreviews.bind(self), 1000);\n\n                    self.triggerInfiniteScrollRequest = _.debounce(self.triggerInfiniteScrollRequest.bind(self), 1000);\n                    self.triggerInfiniteScrollRequest();\n\n                    self.$node.droppable({ accept: '*', tolerance: 'pointer' });\n\n                    self.onObjectsSelected(null, openlumifyData.selectedObjects);\n\n                    self.on('selectAll', self.onSelectAll);\n                    self.on('downUp', self.move);\n                    self.on('upUp', self.move);\n                    self.on('contextmenu', self.onContextMenu);\n                    self.trigger('renderFinished');\n\n                    _.defer(function() {\n                        self.$node.scrollTop(0);\n                    })\n                    self.trigger('listRendered');\n            });\n        });\n\n        this.isScrolling = function() {\n            return this.localScrolling || (\n                    this.attr.infiniteScrolling &&\n                    this.attr.total !== this.attr.items.length\n                );\n        };\n\n        this.onClick = function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            this.trigger('focusComponent');\n\n            let {vertexIds, edgeIds} = openlumifyData.selectedObjects;\n            const $target = $(event.target).parents('li');\n            const pushData = (data) => {\n                if (data.vertexId) selectVertexIds.push(data.vertexId)\n                if (data.edgeId) selectEdgeIds.push(data.edgeId)\n            };\n\n            let data = $(event.target).closest('a.draggable').data();\n            const isSelected = vertexIds[data.vertexId] || edgeIds[data.edgeId];\n            let deselect = false;\n            let [selectVertexIds, selectEdgeIds] = [[], []];\n\n            if (!this.attr.singleSelection) {\n                const targetIndex = $target.index();\n\n                if (event.shiftKey) {\n                    const index = this.lastClickedIndex || 0;\n                    const min = Math.min(index, targetIndex);\n                    const max = Math.max(index, targetIndex);\n                    const $items = $target.parent().children();\n                    for (let i = min; i <= max; i++) {\n                        pushData($items.eq(i).find('a.draggable').data());\n                    }\n                } else if (event.metaKey || event.ctrlKey) {\n                    if (isSelected) {\n                        deselect = true;\n                        if (data.vertexId) vertexIds = _.omit(vertexIds, data.vertexId);\n                        if (data.edgeId) edgeIds = _.omit(edgeIds, data.edgeId);\n                    }\n\n                    selectVertexIds = Object.keys(vertexIds);\n                    selectEdgeIds = Object.keys(edgeIds);\n                } else {\n                    if (data.vertexId && data.vertexId in vertexIds &&\n                        Object.keys(vertexIds).length === 1) {\n                        data = {};\n                    }\n                    if (data.edgeId && data.edgeId in edgeIds &&\n                        Object.keys(edgeIds).length === 1) {\n                        data = {};\n                    }\n                }\n\n                if (!event.shiftKey) {\n                    this.lastClickedIndex = targetIndex;\n                }\n            }\n\n            if (!deselect) {\n                pushData(data);\n            }\n\n            this.trigger('selectObjects', {\n                vertexIds: selectVertexIds,\n                edgeIds: selectEdgeIds\n            })\n        };\n\n        this.onContextMenu = function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            const link = $(e.target).closest('.element-item').children('a');\n            if (link.data('vertexId')) {\n                this.trigger(this.$node, 'showVertexContextMenu', {\n                    vertexId: link.data('vertexId'),\n                    position: {\n                        x: e.pageX,\n                        y: e.pageY\n                    }\n                });\n            } else if (link.data('edgeId')) {\n                this.trigger(this.$node, 'showEdgeContextMenu', {\n                    edgeIds: [link.data('edgeId')],\n                    position: {\n                        x: e.pageX,\n                        y: e.pageY\n                    }\n                });\n            }\n        };\n\n        this.move = function(e, data) {\n            var previousSelected = this.select('itemSelector').filter('.active')[e.type === 'upUp' ? 'first' : 'last'](),\n                moveTo = previousSelected[e.type === 'upUp' ? 'prev' : 'next']('.element-item');\n\n            if (moveTo.length) {\n                var selectedVertexIds = data.shiftKey ? _.keys(openlumifyData.selectedObjects.vertexIds) : [],\n                    selectedEdgeIds = data.shiftKey ? _.keys(openlumifyData.selectedObjects.edgeIds) : [],\n                    vertexId = moveTo.children('a').data('vertexId'),\n                    edgeId = moveTo.children('a').data('edgeId');\n\n                if (vertexId) selectedVertexIds.push(vertexId);\n                if (edgeId) selectedEdgeIds.push(edgeId);\n\n                this.trigger(document, 'defocusElements');\n                this.trigger('selectObjects', { vertexIds: selectedVertexIds, edgeIds: selectedEdgeIds });\n            }\n        };\n\n        this.onSelectAll = function(e) {\n            e.stopPropagation();\n\n            // Don't allow select all if all items are not loaded, it is misleading\n            if (this.isScrolling()) {\n                this.trigger('displayInformation', {\n                    message: i18n('search.noSelectAllWhileLoading')\n                });\n                return;\n            }\n\n            var items = this.select('itemSelector').addClass('active');\n            this.selectItems(items);\n        };\n\n        this.after('teardown', function() {\n            this.trigger(document, 'defocusElements');\n            this.select('itemSelector').children('a').teardownAllComponents();\n            this.$node.off('mouseenter mouseleave');\n            this.scrollNode.off('scroll.elementList');\n            this.$node.empty();\n        });\n\n        this.attachEvents = function() {\n            this.scrollNode = this.$node;\n            while (this.scrollNode.length && this.scrollNode.css('overflow') !== 'auto') {\n                this.scrollNode = this.scrollNode.parent();\n            }\n            this.scrollNode.on('scroll.elementList', this.onResultsScroll.bind(this));\n\n            this.$node.on('mouseenter mouseleave', '.element-item', this.onHoverItem.bind(this));\n\n            this.on(document, 'verticesUpdated', this.onVerticesUpdated);\n            this.on(document, 'verticesDeleted', this.onVerticesDeleted);\n            this.on(document, 'edgesDeleted', this.onEdgesDeleted);\n            this.on(document, 'objectsSelected', this.onObjectsSelected);\n            this.on('objectsSelected', this.onObjectsSelected);\n            this.on(document, 'workspaceLoaded', this.onWorkspaceLoaded);\n            this.on('addInfiniteItems', this.onAddInfiniteItems);\n        };\n\n        this.onHoverItem = function(evt) {\n            if (this.disableHover === 'defocused') {\n                return;\n            } else if (this.disableHover) {\n                this.disableHover = 'defocused';\n                return this.trigger(document, 'defocusElements');\n            }\n\n            var $anchor = $(evt.target).closest('.element-item').children('a'),\n                vertexId = $anchor.data('vertexId'),\n                edgeId = $anchor.data('edgeId');\n\n            if (evt.type === 'mouseenter' && vertexId) {\n                this.trigger(document, 'focusElements', { vertexIds: [vertexId] });\n            } else if (evt.type === 'mouseenter' && edgeId) {\n                this.trigger(document, 'focusElements', { edgeIds: [edgeId] });\n            } else {\n                this.trigger(document, 'defocusElements');\n            }\n        };\n\n        this.onResultsScroll = function(e) {\n            if (!this.disableHover) {\n                this.disableHover = true;\n            }\n\n            this.loadVisibleResultPreviews();\n\n            if (this.localScrolling || this.attr.infiniteScrolling) {\n                this.triggerInfiniteScrollRequest();\n            }\n        };\n\n        this.triggerInfiniteScrollRequest = function() {\n            if (!this.attr.infiniteScrolling && !this.localScrolling) return;\n\n            var loadingListElement = this.$node.find('.infinite-loading');\n\n            if (this.scrollNode.length) {\n                loadingListElement = loadingListElement.withinScrollable(this.scrollNode);\n            }\n\n            if (loadingListElement.length) {\n\n                if (this.localScrolling) {\n                    this.offset += MAX_ITEMS_BEFORE_FORCE_LOADING;\n                    this.addItems(this.attr.items.slice(this.offset, this.offset + MAX_ITEMS_BEFORE_FORCE_LOADING));\n                } else {\n                    /** TODO: is the concept type attr needed here? */\n                    var data = { conceptType: this.attr.verticesConceptId };\n                    if (!this.offset) this.offset = this.attr.nextOffset;\n                    data.paging = {\n                        offset: this.offset\n                    };\n\n                    /**\n                     * Fired when the user scrolls to the end of a list that has `infiniteScrolling` enabled.\n                     * The controlling component should listen and trigger\n                     * {@link module:components/List#event:addInfiniteItems addInfiniteItems} events.\n                     *\n                     * @event module:components/List#infiniteScrollRequest\n                     * @property {object} data\n                     * @property {object} data.paging\n                     * @property {number} data.paging.offset Paging offset\n                     */\n                    this.trigger('infiniteScrollRequest', data);\n                }\n            }\n        };\n\n        this.attachItemRenderer = function(el, item, relationship) {\n            var self = this,\n                usageContext = self.attr.usageContext,\n                itemRenderer = _.find(this.renderers, function(renderer) {\n\n                    /**\n                     * Defines whether the given extension should be used give\n                     * the item + usageContext pair.\n                     *\n                     * @callback org.openlumify.entity.listItemRenderer~canHandle\n                     * @param {object} item Element/Edge object\n                     * @param {string|undefined} usageContext The context this list is running. 'search, detail/relationships', etc.\n                     * @returns {boolean} If the extension renderer should be invoked\n                     */\n                    return renderer.component && renderer.canHandle(item, usageContext);\n                }).component;\n\n            el.children('a').teardownAllComponents();\n            el.empty();\n\n            /**\n             * Flight Component that handles row rendering for a given\n             * `item` and `usageContext`.\n             *\n             * @typedef org.openlumify.entity.listItemRenderer~Component\n             * @listens org.openlumify.entity.listItemRenderer#loadPreview\n             * @property {object} item The rows item value\n             * @property {string} usageContext The context of this element list\n             */\n            itemRenderer.attachTo($('<a class=\"draggable\"/>').appendTo(el), { item: item, usageContext: usageContext });\n\n            this.applyDraggable(el[0]);\n\n            return el;\n        };\n\n        this.addItems = function(items) {\n            if (this.localScrolling && (this.offset + MAX_ITEMS_BEFORE_FORCE_LOADING) >= this.allItems.length) {\n                this.$node.find('.infinite-loading').remove();\n            }\n            if (items.length && 'vertex' in items[0]) {\n                this._items = {\n                    ...(this._items || {}),\n                    ...(_.indexBy(_.pluck(items, 'vertex'), 'id')),\n                    ...(_.indexBy(_.pluck(items, 'relationship'), 'id'))\n                };\n            } else {\n                this._items = { ...(this._items || {}), ...(_.indexBy(items, 'id')) };\n            }\n\n            var self = this,\n                loading = this.$node.find('.infinite-loading'),\n                added = _.reduce(items, function(selection, item) {\n                    var $li = self.attachItemRenderer($('<li class=\"element-item\" />'), item);\n                    return selection.add($li);\n                }, $());\n\n            if (loading && loading.length) {\n                loading.before(added);\n            } else {\n                this.$node.children('ul').append(added);\n            }\n\n            this.loadVisibleResultPreviews();\n        };\n\n        /**\n         * The Element List component registers a listener for this event that\n         * should be fired by the consuming component in response to `infiniteScrollRequest` events.\n         *\n         * @event module:components/List#addInfiniteItems\n         * @property {object} data\n         * @property {boolean} data.success Whether the request succeeded or not\n         * @property {Array.<object>} data.items The new items to place\n         * @property {number} data.nextOffset The next offset to request\n         * @property {number|undefined} data.total The new total (optional)\n         * @example\n         * $node.on('infiniteScrollRequest', function(event, data) {\n         *     makeRequestStartingAtOffset(data.paging.offset)\n         *     .then(function(results) {\n         *         $(event.target).trigger('addInfiniteItems', {\n         *             items: results,\n         *             nextOffset: data.paging.offset + results.length\n         *         })\n         *     })\n         * });\n         * List.attachTo($node, {\n         *     items: [],\n         *     infiniteScrolling: true,\n         *     nextOffset: 10\n         * })\n         */\n        this.onAddInfiniteItems = function(evt, data) {\n            var loading = this.$node.find('.infinite-loading');\n\n            if (!data.success) {\n                loading.html(alertTemplate({\n                    error: i18n('element.list.infinite_scroll.error')\n                }));\n                this.attr.infiniteScrolling = false;\n            } else if (data.items.length === 0) {\n                loading.remove();\n                this.attr.infiniteScrolling = false;\n            } else {\n                this.addItems(data.items);\n\n                this.offset = data.nextOffset;\n\n                var total = data.total || this.attr.total || 0;\n                if (total === this.select('itemSelector').length) {\n                    loading.remove();\n                    this.attr.infiniteScrolling = false;\n                } else {\n                    this.triggerInfiniteScrollRequest();\n                }\n            }\n        };\n\n        this.loadVisibleResultPreviews = function() {\n            this.disableHover = false;\n\n            var lisVisible = this.select('itemSelector');\n            if (this.scrollNode.length) {\n                lisVisible = lisVisible.withinScrollable(this.scrollNode);\n            }\n\n            /**\n             * Triggered on all {@link org.openlumify.entity.listItemRenderer~Component}\n             * components when the user scrolls to make the row visible.\n             *\n             * The component should render any images, or make any auxillary\n             * requests.\n             *\n             * **This event might be triggered more than once, use `_.once`\n             * or another method to only take action once.**\n             *\n             * @event org.openlumify.entity.listItemRenderer#loadPreview\n             * @example\n             * this.on('loadPreview', _.once(this.onLoadPreview.bind(this)));\n             */\n            lisVisible.children('a').trigger('loadPreview');\n        };\n\n        this.applyDraggable = function(el) {\n            var self = this;\n\n            el.setAttribute('draggable', true)\n            el.addEventListener('dragstart', function(e) {\n                const $target = $(e.target);\n                const elements = [];\n\n                $target.siblings('.active').addBack().each(function() {\n                    var data = $(this).find('a.draggable').data();\n                    if (data.vertexId) {\n                        elements.push(self._items[data.vertexId])\n                    }\n                    if (data.edgeId) {\n                        elements.push(self._items[data.edgeId])\n                    }\n                })\n                const dt = e.dataTransfer;\n                dnd.setDataTransferWithElements(dt, { elements })\n            }, false)\n        };\n\n        this.selectItems = function(items) {\n            var selection = _.reduce(items.children('a'), function(memo, item) {\n                    var $item = $(item),\n                        vertexId = $item.data('vertexId'),\n                        edgeId = $item.data('edgeId');\n\n                    if (vertexId) memo.vertexIds.push(vertexId);\n                    if (edgeId) memo.edgeIds.push(edgeId);\n\n                    return memo;\n                }, { vertexIds: [], edgeIds: [] });\n\n            if (selection.vertexIds.length === 0 && selection.edgeIds.length === 0) {\n                return;\n            }\n\n            this.trigger(document, 'defocusElements');\n            this.trigger('selectObjects', selection);\n        };\n\n        this.onWorkspaceLoaded = function(evt, workspace) {\n            this.onVerticesUpdated(evt, workspace.data || {});\n        };\n\n        this.onVerticesUpdated = function(event, data) {\n            var self = this,\n                updatedVertices = _.indexBy(data.vertices || [], 'id');\n\n            this.select('itemSelector').each(function(idx, item) {\n                var $item = $(item),\n                    vertexId = $item.children('a').data('vertexId');\n                if (vertexId && vertexId in updatedVertices) {\n                    self.attachItemRenderer($item, updatedVertices[vertexId]);\n                }\n            });\n            this.loadVisibleResultPreviews();\n        };\n\n        this.onVerticesDeleted = function(event, data) {\n            var self = this,\n                deletedVertices = _.indexBy(data.vertexIds || []);\n            this.select('itemSelector').each(function(idx, item) {\n                var $item = $(item),\n                    $a = $item.children('a'),\n                    vertexId = $a.data('vertexId');\n                if (vertexId && vertexId in deletedVertices) {\n                    $a.teardownAllComponents();\n                    $item.remove();\n                }\n            });\n            this.loadVisibleResultPreviews();\n        };\n\n        this.onEdgesDeleted = function(event, data) {\n            var self = this;\n            this.select('itemSelector').each(function(idx, item) {\n                var $item = $(item),\n                    $a = $item.children('a'),\n                    edgeId = $a.data('edgeId');\n                if (edgeId && edgeId === data.edgeId) {\n                    $a.teardownAllComponents();\n                    $item.remove();\n                }\n            });\n            this.loadVisibleResultPreviews();\n        };\n\n        this.onObjectsSelected = function(event, data) {\n            var self = this,\n                vertexIds = _.pluck(data.vertices, 'id'),\n                edgeIds = _.pluck(data.edges, 'id'),\n                total = vertexIds.length + edgeIds.length;\n\n            this.$node.children('ul').children('.active').removeClass('active');\n\n            if (vertexIds.length === 0 && edgeIds.length === 0) {\n                return;\n            }\n            if (this.attr.showSelected === false && total > 1) return;\n\n            this.$node.addClass('active');\n            this.select('itemSelector').each(function(idx, item) {\n                var $item = $(item),\n                    itemVertexId = $item.children('a').data('vertexId'),\n                    itemEdgeId = $item.children('a').data('edgeId');\n                if ((itemVertexId && _.contains(vertexIds, itemVertexId)) ||\n                    (itemEdgeId && _.contains(edgeIds, itemEdgeId))) {\n                    $item.addClass('active');\n                    self.trigger($item.children('a'), 'itemActivated');\n                } else {\n                    self.trigger($item.children('a'), 'itemDeactivated');\n                }\n            });\n        };\n    }\n});\n"]}