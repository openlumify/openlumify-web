{"version":3,"sources":["../../../js/util/audio/scrubber.js"],"names":["define","defineComponent","template","audioTemplate","AudioScrubber","defaultAttrs","audioSelector","after","$node","html","_","tap","attr","attrs","url","rawUrl","indexOf","player","select","on","onTimeUpdate","bind","onSeekToTime","$player","event","data","self","time","seekTo","autoPlay","undefined","readyState","currentTime","play","pause","one","load","trigger","duration"],"mappings":"AACAA,OAAO,CACH,sBADG,CAEH,gBAFG,CAGH,aAHG,CAAP,CAIG,SAASC,eAAT,CAA0BC,QAA1B,CAAoCC,aAApC,CAAmD,CAClD,aAEA,MAAOF,iBAAgBG,aAAhB,CAAP,CAEA,QAASA,cAAT,EAAyB,CAErB,KAAKC,YAAL,CAAkB,CACdC,cAAe,OADD,CAAlB,EAIA,KAAKC,KAAL,CAAW,YAAX,CAAyB,UAAW,CAChC,KAAKC,KAAL,CAAWC,IAAX,CAAgBN,cACZO,EAAEC,GAAF,CAAM,KAAKC,IAAX,CAAiB,SAASC,KAAT,CAAgB,CAC7B,GAAIC,KAAMD,MAAME,MAAhB,CACA,GAAI,CAACD,IAAIE,OAAJ,CAAY,GAAZ,CAAL,CAAuB,CACnBF,KAAO,GAAP,CACH,CAFD,IAEO,CACHA,KAAO,GAAP,CACH,CACDA,KAAO,eAAP,CACAD,MAAMC,GAAN,CAAYA,GAAZ,CACH,CATD,CADY,CAAhB,EAaA,GAAIG,QAAS,KAAKC,MAAL,CAAY,eAAZ,CAAb,CAEAD,OAAOE,EAAP,CAAU,YAAV,CAAwB,KAAKC,YAAL,CAAkBC,IAAlB,CAAuB,IAAvB,CAA6BJ,OAAO,CAAP,CAA7B,CAAxB,EAEA,KAAKE,EAAL,CAAQ,YAAR,CAAsB,KAAKG,YAA3B,EACA,KAAKC,OAAL,CAAeN,MAAf,CACH,CApBD,EAsBA,KAAKK,YAAL,CAAoB,SAASE,KAAT,CAAgBC,IAAhB,CAAsB,CACtC,GAAIC,MAAO,IAAX,CACIC,KAAOF,KAAKG,MAAL,CAAc,IADzB,CAEIX,OAAS,KAAKM,OAAL,CAAa,CAAb,CAFb,CAGIM,SAAWJ,KAAKI,QAAL,GAAkBC,SAAlB,EAA+BL,KAAKI,QAHnD,CAKA,GAAIZ,OAAOc,UAAP,GAAsB,CAA1B,CAA6B,CACzBd,OAAOe,WAAP,CAAqBL,IAArB,CACA,GAAIE,QAAJ,CAAc,CACVZ,OAAOgB,IAAP,GACH,CAFD,IAEO,CACHhB,OAAOiB,KAAP,GACH,CACJ,CAPD,IAOO,CACH,KAAKX,OAAL,CAAaY,GAAb,CAAiB,SAAjB,CAA4B,UAAW,CACnClB,OAAOe,WAAP,CAAqBL,IAArB,CACA,GAAIE,QAAJ,CAAc,CACVZ,OAAOgB,IAAP,GACH,CAFD,IAEO,CACHhB,OAAOiB,KAAP,GACH,CACJ,CAPD,EAQAjB,OAAOmB,IAAP,GACH,CACJ,CAxBD,CA0BA,KAAKhB,YAAL,CAAoB,SAASH,MAAT,CAAiBO,KAAjB,CAAwB,CACxC,KAAKa,OAAL,CAAa,kBAAb,CAAiC,CAC7BL,YAAaf,OAAOe,WADS,CAE7BM,SAAUrB,OAAOqB,QAFY,CAAjC,EAIH,CALD,CAMH,CACJ,CAtED","file":"scrubber.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    './scrubber.hbs',\n    './audio.hbs'\n], function(defineComponent, template, audioTemplate) {\n    'use strict';\n\n    return defineComponent(AudioScrubber);\n\n    function AudioScrubber() {\n\n        this.defaultAttrs({\n            audioSelector: 'audio'\n        });\n\n        this.after('initialize', function() {\n            this.$node.html(audioTemplate(\n                _.tap(this.attr, function(attrs) {\n                    var url = attrs.rawUrl;\n                    if (~url.indexOf('?')) {\n                        url += '&';\n                    } else {\n                        url += '?';\n                    }\n                    url += 'playback=true';\n                    attrs.url = url;\n                })\n            ));\n\n            var player = this.select('audioSelector');\n\n            player.on('timeupdate', this.onTimeUpdate.bind(this, player[0]));\n\n            this.on('seekToTime', this.onSeekToTime);\n            this.$player = player;\n        });\n\n        this.onSeekToTime = function(event, data) {\n            var self = this,\n                time = data.seekTo / 1000,\n                player = this.$player[0],\n                autoPlay = data.autoPlay === undefined || data.autoPlay;\n\n            if (player.readyState === 4) {\n                player.currentTime = time;\n                if (autoPlay) {\n                    player.play();\n                } else {\n                    player.pause();\n                }\n            } else {\n                this.$player.one('canplay', function() {\n                    player.currentTime = time;\n                    if (autoPlay) {\n                        player.play();\n                    } else {\n                        player.pause();\n                    }\n                })\n                player.load();\n            }\n        };\n\n        this.onTimeUpdate = function(player, event) {\n            this.trigger('playerTimeUpdate', {\n                currentTime: player.currentTime,\n                duration: player.duration\n            });\n        };\n    }\n});\n"]}