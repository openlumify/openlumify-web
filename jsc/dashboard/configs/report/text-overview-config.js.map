{"version":3,"sources":["../../../../js/dashboard/configs/report/text-overview-config.js"],"names":["define","defineComponent","d3","template","LIMITS","value","display","i18n","noColorDefault","TextOverviewConfig","attributes","item","extension","limitSelector","limitOtherSelector","colorPickerSelector","after","self","config","getConfiguration","on","onChangeLimit","onChangeOtherLimit","onPickColor","color","$node","html","showOther","isOther","limit","currentLimit","colors","_","chain","scale","category10","range","map","c","noColor","tap","push","match","extend","selected","limits","l","String","attr","configuration","key","event","$","target","data","stopPropagation","triggerChange","Boolean","every","other","parseInt","val","isNaN","type","which","newLimit","select","toggle","trigger"],"mappings":"AAAAA,OAAO,CACH,sBADG,CAEH,IAFG,CAGH,gCAHG,CAAP,CAIG,SACCC,eADD,CAECC,EAFD,CAGCC,QAHD,CAGW,CACV,aAEA,GAAIC,QAAS,CACL,CAAEC,MAAO,EAAT,CAAaC,QAASC,KAAK,qCAAL,CAAtB,CADK,CAEL,CAAEF,MAAO,GAAT,CAAcC,QAAS,CAAvB,CAFK,CAGL,CAAED,MAAO,GAAT,CAAcC,QAAS,CAAvB,CAHK,CAIL,CAAED,MAAO,GAAT,CAAcC,QAAS,CAAvB,CAJK,CAKL,CAAED,MAAO,GAAT,CAAcC,QAASC,KAAK,sCAAL,CAAvB,CALK,CAAb,CAOIC,eAAiB,OAPrB,CASA,MAAOP,iBAAgBQ,kBAAhB,CAAP,CAEA,QAASA,mBAAT,EAA8B,CAE1B,KAAKC,UAAL,CAAgB,CACZC,KAAM,IADM,CAEZC,UAAW,IAFC,CAGZC,cAAe,QAHH,CAIZC,mBAAoB,OAJR,CAKZC,oBAAqB,kBALT,CAAhB,EAQA,KAAKC,KAAL,CAAW,YAAX,CAAyB,UAAW,CAChC,GAAIC,MAAO,IAAX,CACIC,OAAS,KAAKC,gBAAL,EADb,CAGA,KAAKC,EAAL,CAAQ,QAAR,CAAkB,CACdP,cAAe,KAAKQ,aADN,CAEdP,mBAAoB,KAAKQ,kBAFX,CAAlB,EAKA,KAAKF,EAAL,CAAQ,OAAR,CAAiB,CACbL,oBAAqB,KAAKQ,WADb,CAAjB,EAIA,KAAKH,EAAL,CAAQ,OAAR,CAAiB,CACbN,mBAAoB,KAAKQ,kBADZ,CAAjB,EAIA,GAAI,CAACJ,OAAOM,KAAZ,CAAmB,CACfN,OAAOM,KAAP,CAAehB,cAAf,CACH,CACD,KAAKiB,KAAL,CAAWC,IAAX,CAAgBvB,SAAS,CACrBwB,UAAW,KAAKC,OAAL,CAAaV,OAAOW,KAApB,CADU,CAErBC,aAAcZ,OAAOW,KAFA,CAGrBE,OAAQC,EAAEC,KAAF,CAAQ/B,GAAGgC,KAAH,CAASC,UAAT,GAAsBC,KAAtB,EAAR,EACHC,GADG,CACC,SAASC,CAAT,CAAY,CACb,MAAO,CAAEd,MAAOc,CAAT,CAAYC,QAAS,KAArB,CAAP,CACH,CAHG,EAIHC,GAJG,CAIC,SAAST,MAAT,CAAiB,CAClBA,OAAOU,IAAP,CAAY,CAAEjB,MAAOhB,cAAT,CAAyB+B,QAAS,IAAlC,CAAZ,EACH,CANG,EAOHF,GAPG,CAOC,SAASC,CAAT,CAAY,CACb,GAAII,OAAQxB,OAAOM,KAAP,GAAiBc,EAAEd,KAA/B,CACA,MAAOQ,GAAEW,MAAF,CAAS,CAAEC,SAAUF,KAAZ,CAAT,CAA8BJ,CAA9B,CAAP,CACH,CAVG,EAWHjC,KAXG,EAHa,CAerBwC,OAAQzC,OAAOiC,GAAP,CAAW,SAASS,CAAT,CAAY,CAC3B,MAAOd,GAAEW,MAAF,CAAS,CACZC,SAAW3B,KAAKW,OAAL,CAAaV,OAAOW,KAApB,GAA8BiB,EAAEzC,KAAF,GAAY,GAA3C,EACN0C,OAAO7B,OAAOW,KAAd,IAAyBiB,EAAEzC,KAFnB,CAAT,CAGJyC,CAHI,CAAP,CAIH,CALO,CAfa,CAAT,CAAhB,EAsBH,CA1CD,EA4CA,KAAK3B,gBAAL,CAAwB,UAAW,CAC/B,GAAID,QAAS,KAAK8B,IAAL,CAAUrC,IAAV,CAAesC,aAA5B,CACIC,IAAM,8BADV,CAGA,GAAI,CAAChC,OAAOgC,GAAP,CAAL,CAAkB,CACdhC,OAAOgC,GAAP,EAAc,EAAd,CACH,CAED,MAAOhC,QAAOgC,GAAP,CAAP,CACH,CATD,CAWA,KAAK3B,WAAL,CAAmB,SAAS4B,KAAT,CAAgB,CAC/B,GAAI3B,OAAQ4B,EAAED,MAAME,MAAR,EAAgBC,IAAhB,CAAqB,OAArB,CAAZ,CAEAH,MAAMI,eAAN,GAEA,KAAKpC,gBAAL,GAAwBK,KAAxB,CAAgCA,KAAhC,CACA,KAAKgC,aAAL,GACH,CAPD,CASA,KAAK5B,OAAL,CAAe,SAASC,KAAT,CAAgB,CAC3B,MAAO4B,SAAQ5B,QACXA,QAAU,GAAV,EACAG,EAAE0B,KAAF,CAAQtD,MAAR,CAAgB,SAAS0C,CAAT,CAAY,CACxB,MAAOA,GAAEzC,KAAF,GAAY0C,OAAOlB,KAAP,CAAnB,CACH,CAFD,CAFW,CAAR,CAAP,CAMH,CAPD,CASA,KAAKP,kBAAL,CAA0B,SAAS6B,KAAT,CAAgB,CACtC,GAAIQ,OAAQC,SAASR,EAAED,MAAME,MAAR,EAAgBQ,GAAhB,EAAT,CAAgC,EAAhC,CAAZ,CAEA,GAAI,CAACC,MAAMH,KAAN,CAAL,CAAmB,CACf,KAAKxC,gBAAL,GAAwBU,KAAxB,CAAgC8B,KAAhC,CACA,GAAIR,MAAMY,IAAN,GAAe,QAAf,EAA4BZ,MAAMY,IAAN,GAAe,OAAf,EAA0BZ,MAAMa,KAAN,GAAgB,EAA1E,CAA+E,CAC3E,KAAKR,aAAL,GACH,CACJ,CACJ,CATD,CAWA,KAAKnC,aAAL,CAAqB,SAAS8B,KAAT,CAAgB,CACjC,GAAIc,UAAWb,EAAED,MAAME,MAAR,EAAgBQ,GAAhB,EAAf,CACIlC,UAAY,KAAKC,OAAL,CAAaqC,QAAb,CADhB,CAEI/C,OAAS,KAAKC,gBAAL,EAFb,CAIA,KAAK+C,MAAL,CAAY,oBAAZ,EACKL,GADL,CACS3C,OAAOW,KADhB,EAEKsC,MAFL,CAEYxC,SAFZ,EAGA,GAAIA,SAAJ,CAAe,CACX,OACH,CAED,GAAIsC,QAAJ,CAAc,CACV/C,OAAOW,KAAP,CAAe+B,SAASK,QAAT,CAAmB,EAAnB,CAAf,CACH,CAFD,IAEO,CACH,MAAO/C,QAAOW,KAAd,CACH,CAED,KAAK2B,aAAL,GACH,CAnBD,CAqBA,KAAKA,aAAL,CAAqB,UAAW,CAC5B,KAAKY,OAAL,CAAa,sBAAb,CAAqC,CACjCxD,UAAW,KAAKoC,IAAL,CAAUpC,SADY,CAEjCD,KAAM,KAAKqC,IAAL,CAAUrC,IAFiB,CAArC,EAIH,CALD,CAOH,CACJ,CAhJD","file":"text-overview-config.js","sourcesContent":["define([\n    'flight/lib/component',\n    'd3',\n    './text-overview-config-tpl.hbs'\n], function(\n    defineComponent,\n    d3,\n    template) {\n    'use strict';\n\n    var LIMITS = [\n            { value: '', display: i18n('dashboard.text-overview.limits.none') },\n            { value: '1', display: 1 },\n            { value: '2', display: 2 },\n            { value: '5', display: 5 },\n            { value: '~', display: i18n('dashboard.text-overview.limits.other') }\n        ],\n        noColorDefault = 'white';\n\n    return defineComponent(TextOverviewConfig);\n\n    function TextOverviewConfig() {\n\n        this.attributes({\n            item: null,\n            extension: null,\n            limitSelector: 'select',\n            limitOtherSelector: 'input',\n            colorPickerSelector: '.color-picker li'\n        })\n\n        this.after('initialize', function() {\n            var self = this,\n                config = this.getConfiguration();\n\n            this.on('change', {\n                limitSelector: this.onChangeLimit,\n                limitOtherSelector: this.onChangeOtherLimit\n            });\n\n            this.on('click', {\n                colorPickerSelector: this.onPickColor\n            });\n\n            this.on('keyup', {\n                limitOtherSelector: this.onChangeOtherLimit\n            });\n\n            if (!config.color) {\n                config.color = noColorDefault;\n            }\n            this.$node.html(template({\n                showOther: this.isOther(config.limit),\n                currentLimit: config.limit,\n                colors: _.chain(d3.scale.category10().range())\n                    .map(function(c) {\n                        return { color: c, noColor: false };\n                    })\n                    .tap(function(colors) {\n                        colors.push({ color: noColorDefault, noColor: true })\n                    })\n                    .map(function(c) {\n                        var match = config.color === c.color;\n                        return _.extend({ selected: match }, c);\n                    })\n                    .value(),\n                limits: LIMITS.map(function(l) {\n                    return _.extend({\n                        selected: (self.isOther(config.limit) && l.value === '~') ||\n                            String(config.limit) === l.value\n                    }, l);\n                })\n            }));\n        });\n\n        this.getConfiguration = function() {\n            var config = this.attr.item.configuration,\n                key = 'org-openlumify-text-overview';\n\n            if (!config[key]) {\n                config[key] = {};\n            }\n\n            return config[key];\n        };\n\n        this.onPickColor = function(event) {\n            var color = $(event.target).data('color');\n\n            event.stopPropagation();\n\n            this.getConfiguration().color = color;\n            this.triggerChange();\n        };\n\n        this.isOther = function(limit) {\n            return Boolean(limit && (\n                limit === '~' ||\n                _.every(LIMITS, function(l) {\n                    return l.value !== String(limit);\n                })\n            ));\n        };\n\n        this.onChangeOtherLimit = function(event) {\n            var other = parseInt($(event.target).val(), 10);\n\n            if (!isNaN(other)) {\n                this.getConfiguration().limit = other;\n                if (event.type === 'change' || (event.type === 'keyup' && event.which === 13)) {\n                    this.triggerChange();\n                }\n            }\n        };\n\n        this.onChangeLimit = function(event) {\n            var newLimit = $(event.target).val(),\n                showOther = this.isOther(newLimit),\n                config = this.getConfiguration();\n\n            this.select('limitOtherSelector')\n                .val(config.limit)\n                .toggle(showOther);\n            if (showOther) {\n                return;\n            }\n\n            if (newLimit) {\n                config.limit = parseInt(newLimit, 10);\n            } else {\n                delete config.limit;\n            }\n\n            this.triggerChange();\n        };\n\n        this.triggerChange = function() {\n            this.trigger('configurationChanged', {\n                extension: this.attr.extension,\n                item: this.attr.item\n            });\n        };\n\n    }\n});\n"]}