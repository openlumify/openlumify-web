{"version":3,"sources":["../../../js/dashboard/reportRenderers/withRenderer.js"],"names":["define","withDataRequest","F","Color","d3","ontology","registry","require","d3tip","deepFreeze","NO_DATA","TOO_MANY_BUCKETS","TOO_MANY_BUCKETS_HISTOGRAM","TOO_MANY_BUCKETS_GEOHASH","MAX_BUCKETS_BEFORE_ERROR","MAX_GEOHASH_BUCKETS_BEFORE_ERROR","TYPE_ELEMENTS","TYPE_AGGREGATION","TYPE_UNKNOWN","FIELD_CONCEPT_TYPE","FIELD_EDGE_LABEL","TIP_UNIQUE_IDENTIFIER","withRenderer","call","after","CHART_PADDING","TRANSITION_DURATION","colorScale","scale","category20c","colors","range","highlightColors","_","map","color","lightenByRatio","toString","LEGEND_COLOR_SWATCH_SIZE","LEGEND_SWATCH_TO_TEXT_MARGIN","LEGEND_LABEL_HEIGHT","OTHER_COLOR_INDEX","self","displayed","savedResult","savedResultPreProcessing","$loading","report","attr","warn","once","msg","console","setAggregations","result","aggregations","root","aggregation","first","processData","Promise","resolve","getRootObject","then","transformer","mapping","transformerModulePath","optionallyApplyTransformer","item","configuration","reportRenderer","checkRendererSupportsResponse","trigger","extension","frozen","type","isArray","isEmpty","buckets","Error","bucketCount","length","aggregationType","isFunction","saveData","requestData","params","dataRequest","endpoint","render","containerNode","$node","width","height","removeClass","errorHandler","error","message","addClass","subtitle","i18n","$message","$","text","$dom","append","appendTo","node","loadUsingData","data","catch","refresh","event","endpointParameters","on","empty","loadingPromise","name","results","displayName","d","bind","fillSortedBucketGaps","interval","nameAsFloat","parseFloat","sortBy","min","max","last","i","currentData","splice","String","value","count","handleClick","object","eventTarget","endpointId","id","d3Target","target","filters","filtersPromise","searchUrl","reject","filter","propertyId","edgeLabel","values","conceptId","search","url","savedFilters","JSON","parse","parameters","uniq","isString","clickHandlerModulePath","clickHandler","apply","popupSearch","q","conceptType","stringify","includeChildNodes","omit","test","label","aggregationStr","field","predicate","isUndefined","ResultsPopover","attachTo","scrollSelector","createTooltip","svg","titleFunction","detailFunction","tip","html","n","show","wrap","fn","args","toArray","arguments","slice","reportRendererIdentifier","renderer","findWhere","extensionsForPoint","identifier","supportsResponse","resultsIncludeAggregations","keys","aggregates","aggregationsFromRequest","aggregationFromRequest","isConceptType","isEdgeLabel","isSpecialField","ontologyProperty","properties","byTitle","displayNameFn","concept","concepts","byId","relationship","relationships","vertex","propDisplay","tap","mapBucket","bucketValue","nameIri","list","fieldIri","key","nestedResults","nested","partial","r","parseInt","precision","resultsFromSearch","elements","isObject"],"mappings":"wYAAAA,OAAO,CACH,sBADG,CAEH,wBAFG,CAGH,SAHG,CAIH,IAJG,CAKH,qDALG,CAMH,gCANG,CAOH,SAPG,CAQH,QARG,CASH,oBATG,CAAP,CAUG,SACCC,eADD,CAECC,CAFD,CAGCC,KAHD,CAICC,EAJD,CAKCC,QALD,CAMCC,QAND,CAOCC,OAPD,CAQCC,KARD,CASCC,UATD,CASa,CACZ,aAEA,GAAIC,SAAU,gBAAd,CACIC,iBAAmB,kBADvB,CAEIC,2BAA6B,4BAFjC,CAGIC,yBAA2B,0BAH/B,CAIIC,yBAA2B,GAJ/B,CAKIC,iCAAmC,IALvC,CAMIC,cAAgB,eANpB,CAOIC,iBAAmB,kBAPvB,CAQIC,aAAe,cARnB,CASIC,mBAAqB,mCATzB,CAUIC,iBAAmB,aAVvB,CAWIC,sBAAwB,CAX5B,CAaA,MAAOC,aAAP,CAEA,QAASA,aAAT,EAAwB,CAEpBrB,gBAAgBsB,IAAhB,CAAqB,IAArB,EAEA,KAAKC,KAAL,CAAW,YAAX,CAAyB,UAAW,CAChC,KAAKC,aAAL,CAAqB,EAArB,CACA,KAAKC,mBAAL,CAA2B,GAA3B,CACA,KAAKC,UAAL,CAAkBvB,GAAGwB,KAAH,CAASC,WAAT,EAAlB,CACA,KAAKC,MAAL,CAAc,KAAKH,UAAL,CAAgBI,KAAhB,EAAd,CACA,KAAKC,eAAL,CAAuBC,EAAEC,GAAF,CAAM,KAAKJ,MAAX,CAAmB,SAASK,KAAT,CAAgB,CACtD,MAAO,IAAIhC,MAAJ,CAAUgC,KAAV,EAAiBC,cAAjB,CAAgC,EAAhC,EAAoCC,QAApC,EAAP,CACH,CAFsB,CAAvB,CAGA,KAAKC,wBAAL,CAAgC,EAAhC,CACA,KAAKC,4BAAL,CAAoC,CAApC,CACA,KAAKC,mBAAL,CAA2B,EAA3B,CACA,KAAKC,iBAAL,CAAyB,EAAzB,CAEA,GAAIC,MAAO,IAAX,CACIC,UAAY,KADhB,CAEIC,WAFJ,CAGIC,wBAHJ,CAIIC,QAJJ,CAKIC,OAAS,KAAKC,IAAL,CAAUD,MALvB,CAMIE,KAAOhB,EAAEiB,IAAF,CAAO,SAASC,GAAT,CAAc,CACxBC,QAAQH,IAAR,CAAaE,GAAb,CAAkBT,IAAlB,EACH,CAFM,CANX,CASIW,gBAAkB,QAAlBA,gBAAkB,CAASC,MAAT,CAAiB,CAC/BZ,KAAKa,YAAL,CAAoBD,OAAOE,IAA3B,CACAd,KAAKe,WAAL,CAAmBxB,EAAEyB,KAAF,CAAQhB,KAAKa,YAAb,CAAnB,CACA,MAAOD,OAAP,CACH,CAbL,CAcIK,YAAc,QAAdA,YAAc,CAASL,MAAT,CAAiB,CAC3B,MAAOM,SAAQC,OAAR,CAAgBC,cAAcf,MAAd,CAAsBO,MAAtB,CAAhB,EACFS,IADE,CACG,SAAST,MAAT,CAAiB,CACnB,GAAIU,aAAcjB,OAAOkB,OAAP,EAAkBlB,OAAOkB,OAAP,CAAeC,qBAAnD,CACA,GAAIF,WAAJ,CAAiB,CACb,MAAOG,4BAA2BH,WAA3B,CAAwCV,MAAxC,CAAP,CACH,CACD,MAAOA,OAAP,CACH,CAPE,EAQFS,IARE,CAQG,SAAST,MAAT,CAAiB,CACnB,GAAIZ,KAAKM,IAAL,CAAUoB,IAAV,CAAeC,aAAf,CAA6BC,cAA7B,EAA+C,CAACC,8BAA8B7B,KAAKM,IAAL,CAAUoB,IAAV,CAAeC,aAAf,CAA6BC,cAA3D,CAA2EhB,MAA3E,CAApD,CAAwI,CACpI,MAAOZ,MAAKM,IAAL,CAAUoB,IAAV,CAAeC,aAAf,CAA6BC,cAApC,CACA5B,KAAK8B,OAAL,CAAa,sBAAb,CAAqC,CACjCC,UAAW/B,KAAKM,IAAL,CAAUyB,SADY,CAEjCL,KAAM1B,KAAKM,IAAL,CAAUoB,IAFiB,CAArC,EAIH,CACD,MAAOd,OAAP,CACH,CAjBE,EAkBFS,IAlBE,CAkBGV,eAlBH,EAmBFU,IAnBE,CAmBG,SAAST,MAAT,CAAiB,CACnB,GAAIoB,QAASjE,WAAW6C,MAAX,CAAb,CACAT,yBAA2B6B,MAA3B,CACA,GAAIpB,OAAOqB,IAAP,GAAgB1D,gBAAhB,GAAqC,CAACgB,EAAE2C,OAAF,CAAUtB,OAAOE,IAAjB,CAAD,EAA2BvB,EAAE4C,OAAF,CAAUvB,OAAOE,IAAP,CAAY,CAAZ,EAAesB,OAAzB,CAAhE,CAAJ,CAAwG,CACpG,KAAM,IAAIC,MAAJ,CAAUrE,OAAV,CAAN,CACH,CACD,GAAI4C,OAAOqB,IAAP,GAAgB1D,gBAAhB,EAAoCgB,EAAE2C,OAAF,CAAUtB,OAAOE,IAAjB,CAAxC,CAAgE,CAC5D,GAAIwB,aAAc1B,OAAOE,IAAP,CAAY,CAAZ,EAAesB,OAAf,CAAuBG,MAAzC,CACIC,gBAAkB5B,OAAOE,IAAP,CAAY,CAAZ,EAAemB,IADrC,CAGA,GAAIO,kBAAoB,SAApB,EAAiCF,YAAcjE,gCAAnD,CAAqF,CACjF,KAAM,IAAIgE,MAAJ,CAAUlE,wBAAV,CAAN,CACH,CAFD,IAEO,IAAIqE,kBAAoB,SAApB,EAAiCF,YAAclE,wBAAnD,CAA6E,CAChF,GAAIoE,kBAAoB,WAAxB,CAAqC,CACjC,KAAM,IAAIH,MAAJ,CAAUnE,0BAAV,CAAN,CACH,CACD,KAAM,IAAImE,MAAJ,CAAUpE,gBAAV,CAAN,CACH,CACJ,CACD,GAAIsB,EAAEkD,UAAF,CAAazC,KAAKiB,WAAlB,CAAJ,CAAoC,CAChC,MAAOjB,MAAKiB,WAAL,CAAiBe,MAAjB,CAAP,CACH,CACD,MAAOA,OAAP,CACH,CA1CE,CAAP,CA2CH,CA1DL,CA2DIU,SAAW,QAAXA,SAAW,CAAS9B,MAAT,CAAiB,CACxBV,YAAcU,MAAd,CACH,CA7DL,CA8DI+B,YAAc,QAAdA,YAAc,CAASC,MAAT,CAAiB,CAC3B,MAAO5C,MAAK6C,WAAL,CAAiB,WAAjB,CAA8B,aAA9B,CAA6CxC,OAAOyC,QAApD,CAA8DF,QAAU,EAAxE,CAAP,CACH,CAhEL,CAiEIG,OAAS,QAATA,OAAS,EAAW,CAChB,GAAIxD,EAAEkD,UAAF,CAAazC,KAAK+C,MAAlB,CAAJ,CAA+B,CAC3B,GAAIC,eAAgBhD,KAAKiD,KAAzB,CACAhD,UAAY+C,cAAcE,KAAd,IAAyBF,cAAcG,MAAd,EAArC,CACA,GAAIlD,WAAaC,WAAjB,CAA8B,CAC1BF,KAAK+C,MAAL,CAAYrF,EAAZ,CAAgBsF,cAAc,CAAd,CAAhB,CAAkC9C,WAAlC,CAA+CpC,KAA/C,EACAkC,KAAKiD,KAAL,CAAWG,WAAX,CAAuB,OAAvB,EACApD,KAAK8B,OAAL,CAAa,iBAAb,EACH,CAJD,IAIO,MAAM,IAAIO,MAAJ,CAAUrE,OAAV,CAAN,CACV,CARD,IAQO,CACHuC,KAAK,uDAAL,EACH,CACJ,CA7EL,CA8EI8C,aAAe,QAAfA,aAAe,CAASC,KAAT,CAAgB,CAC3BtD,KAAK8B,OAAL,CAAa,iBAAb,EAEA,GAAIG,MAAO,OAAX,CACIsB,QAAUtB,IADd,CAGA,GAAIqB,OAASA,MAAMC,OAAN,GAAkBvF,OAA/B,CAAwC,CACpCiE,KAAO,MAAP,CACAsB,QAAU,SAAV,CACH,CAHD,IAGO,IAAID,OAASA,MAAMC,OAAN,GAAkBpF,wBAA/B,CAAyD,CAC5D8D,KAAO,MAAP,CACAsB,QAAU,yBAAV,CACH,CAHM,IAGA,IAAID,OAASA,MAAMC,OAAN,GAAkBrF,0BAA/B,CAA2D,CAC9D+D,KAAO,MAAP,CACAsB,QAAU,2BAAV,CACH,CAHM,IAGA,IAAID,OAASA,MAAMC,OAAN,GAAkBtF,gBAA/B,CAAiD,CACpDgE,KAAO,MAAP,CACAsB,QAAU,iBAAV,CACH,CAHM,IAGA,CACH7C,QAAQ4C,KAAR,CAAcA,KAAd,EACAtD,KAAKiD,KAAL,CAAWO,QAAX,CAAoB,OAApB,EACH,CACD,GAAIC,UAAWC,KAAK,IAAL,CAAW,aAAeH,OAAf,CAAyB,WAApC,CAAf,CACII,SAAWC,EAAE,MAAF,EAAUC,IAAV,CAAeH,KAAK,aAAeH,OAApB,CAAf,CADf,CAEIO,KAAOF,EAAE,OAAF,EAAWJ,QAAX,CAAoBvB,IAApB,EAA0B8B,MAA1B,CAAiCJ,QAAjC,CAFX,CAGA,GAAIF,QAAJ,CAAc,CACVE,SAASI,MAAT,CAAgBH,EAAE,OAAF,EAAWC,IAAX,CAAgBJ,QAAhB,CAAhB,EACH,CACDK,KAAKE,QAAL,CAAchE,KAAKiE,IAAnB,EACH,CA3GL,CA4GIC,cAAgB,QAAhBA,cAAgB,CAASC,IAAT,CAAe,CAC3B,MAAOjD,SAAQC,OAAR,CAAgBgD,IAAhB,EACF9C,IADE,CACGqB,QADH,EAEFrB,IAFE,CAEG0B,MAFH,EAGFqB,KAHE,CAGIf,YAHJ,CAAP,CAIH,CAjHL,CAkHIgB,QAAU,QAAVA,QAAU,CAASC,KAAT,CAAgBH,IAAhB,CAAsB,CAC5B,MAAOjD,SAAQC,OAAR,CAAgBd,OAAOkE,kBAAvB,EACFlD,IADE,CACGsB,WADH,EAEFtB,IAFE,CAEGJ,WAFH,EAGFI,IAHE,CAGG6C,aAHH,CAAP,CAIH,CAvHL,CAyHA,KAAKM,EAAL,CAAQ,QAAR,CAAkB,UAAW,CACzB,GAAI,CAACvE,SAAL,CAAgB,CACZ,KAAKgD,KAAL,CAAWwB,KAAX,GACH,CACDvD,QAAQC,OAAR,GACKE,IADL,CACU0B,MADV,EAEKqB,KAFL,CAEWf,YAFX,EAGH,CAPD,EAQA,KAAKmB,EAAL,CAAQ,aAAR,CAAuB,UAAW,CAC9B,KAAKvB,KAAL,CAAWwB,KAAX,GACAvD,QAAQC,OAAR,GACKE,IADL,CACUgD,OADV,EAEKD,KAFL,CAEWf,YAFX,EAGH,CALD,EAOA,GAAIqB,gBAAiB,KAAKpE,IAAL,CAAUM,MAAV,CACjBM,QAAQC,OAAR,CAAgB,KAAKb,IAAL,CAAUM,MAA1B,EACKS,IADL,CACUV,eADV,EAEKU,IAFL,CAEU6C,aAFV,CADiB,CAIjBG,UACKD,KADL,CACWf,YADX,CAJJ,CAOAqB,eACKN,KADL,CACWf,YADX,EAGA,KAAKmB,EAAL,CAAQ,kBAAR,CAA4B,UAAW,CACnCE,eAAerD,IAAf,CAAoB,UAAW,CAC3BrB,KAAK8B,OAAL,CAAa,8BAAb,CAA6C,CACzC6C,KAAM,eADmC,CAEzCR,KAAM,CACFS,QAASzE,wBADP,CAFmC,CAA7C,EAMH,CAPD,EAQH,CATD,EAWA,KAAK0E,WAAL,CAAmB,SAASC,CAAT,CAAY,CAC3B,GAAI,eAAiBA,EAArB,CAAwB,MAAOA,GAAED,WAAT,CACxB,GAAI,KAAK9D,WAAT,CAAsB,CAClB,MAAO,MAAKA,WAAL,CAAiB8D,WAAjB,CAA6BC,CAA7B,CAAP,CACH,CACD,MAAOA,GAAEH,IAAT,CACH,CANkB,CAMjBI,IANiB,CAMZ,IANY,CAAnB,CAQH,CAlLD,EAqLA,KAAKC,oBAAL,CAA4B,SAAS5C,OAAT,CAAkB6C,QAAlB,CAA4B,CACpD,GAAIC,aAAc,QAAdA,YAAc,CAASJ,CAAT,CAAY,CACtB,MAAOK,YAAWL,EAAEH,IAAb,CAAmB,EAAnB,CAAP,CACH,CAFL,CAIAvC,QAAU7C,EAAE6F,MAAF,CAAShD,OAAT,CAAkB8C,WAAlB,CAAV,CAEA,GAAIG,KAAMH,YAAY3F,EAAEyB,KAAF,CAAQoB,OAAR,CAAZ,CAAV,CACIkD,IAAMJ,YAAY3F,EAAEgG,IAAF,CAAOnD,OAAP,CAAZ,CADV,CAGA,IAAK,GAAIoD,GAAIH,GAAR,CAAaI,YAAc,CAAhC,CAAmCD,GAAKF,IAAML,QAA9C,CAAwDO,EAAIA,EAAIP,QAAhE,CAA0E,CACtE,GAAI,CAAC7C,QAAQqD,WAAR,CAAD,EAAyBD,IAAMN,YAAY9C,QAAQqD,WAAR,CAAZ,CAAnC,CAAsE,CAClErD,QAAQsD,MAAR,CAAeD,WAAf,CAA4B,CAA5B,CAA+B,CAC3Bd,KAAMgB,OAAOH,CAAP,CADqB,CAE3BI,MAAO,CACHC,MAAO,CADJ,CAFoB,CAA/B,EAMH,CACDJ,cACH,CACD,MAAOrD,QAAP,CACH,CAtBD,CAwBA,KAAK0D,WAAL,CAAmB,SAASC,MAAT,CAAiBC,WAAjB,CAA8B,gBAC7C,GAAMhG,MAAO,IAAb,CACA,GAAMK,QAAS,KAAKC,IAAL,CAAUD,MAAzB,CACA,GAAM4F,YAAa5F,OAAOkE,kBAAP,EAA6BlE,OAAOkE,kBAAP,CAA0B2B,EAA1E,CACA,GAAMC,UAAWH,aAAetI,GAAG4G,KAAH,EAAY5G,GAAG4G,KAAH,CAAS8B,MAArD,CACA,GAAIC,SAAUN,OAAOM,OAArB,CACA,GAAIC,sBAAJ,CACA,GAAIC,iBAAJ,CAEA,GAAIF,OAAJ,CAAa,CACTA,QAAU9G,EAAEiH,MAAF,CAASH,OAAT,CAAkB,SAASI,MAAT,CAAiB,CACzC,GAAIA,OAAOC,UAAP,GAAsBhI,gBAA1B,CAA4C,CACxCqH,OAAOY,SAAP,CAAmBF,OAAOG,MAAP,CAAc,CAAd,CAAnB,CACA,MAAO,KAAP,CACH,CACD,GAAIH,OAAOC,UAAP,GAAsBjI,kBAA1B,CAA8C,CAC1CsH,OAAOc,SAAP,CAAmBJ,OAAOG,MAAP,CAAc,CAAd,CAAnB,CACA,MAAO,KAAP,CACH,CACJ,CATS,CAAV,CAWA,GAAIP,SAAWJ,UAAf,CAA2B,CACvBK,eAAiB,KAAKzD,WAAL,CAAiB,QAAjB,CAA2B,KAA3B,CAAkCoD,UAAlC,EACZ5E,IADY,CACP,gBAAU,CACZkF,UAAYO,OAAOC,GAAnB,CACA,GAAMC,cAAeC,KAAKC,KAAL,CAAWJ,OAAOK,UAAP,CAAkBV,MAA7B,GAAwC,EAA7D,CACA,MAAOlH,GAAE6H,IAAF,8BAAYf,OAAZ,qBAAwBW,YAAxB,GAAwC,kBAAGN,WAAH,MAAGA,UAAH,OAAoBA,WAApB,EAAxC,CAAP,CACH,CALY,CAAjB,CAMH,CAPD,IAOO,CACHJ,eAAiBD,OAAjB,CACH,CACJ,CAED,GAAIhG,QAAUd,EAAE8H,QAAF,CAAWhH,OAAOiH,sBAAlB,CAAd,CAAyD,CACrD,GAAIlB,QAAS1I,GAAG4G,KAAH,CAAS8B,MAAtB,CACA,MAAOlF,SAAQrD,OAAR,CAAgBwC,OAAOiH,sBAAvB,EACFjG,IADE,CACG,SAASkG,YAAT,CAAuB,CACzB,GAAIhI,EAAEkD,UAAF,CAAa8E,YAAb,CAAJ,CAAgC,CAC5B,MAAOrG,SAAQC,OAAR,CAAgBoG,aAAaC,KAAb,CAAmBxH,IAAnB,CAAyB,CAACoG,MAAD,CAASL,MAAT,CAAzB,CAAhB,CAAP,CACH,CACD,KAAM,IAAI1D,MAAJ,CAAU,kCAAV,CAA8CkF,YAA9C,CAAN,CACH,CANE,CAAP,CAOH,CATD,IASO,IAAIxB,QAAUA,OAAOc,SAArB,CAAgC,CACnC3F,QAAQC,OAAR,CAAgBmF,cAAhB,EAAgCjF,IAAhC,CAAqC,UAAkB,IAAjBgF,QAAiB,2DAAP,EAAO,CACnD,MAAKoB,WAAL,CAAiB,gBAAjB,CAAmC,CAC/BC,EAAG,GAD4B,CAE/BC,YAAa5B,OAAOc,SAFW,CAG/BJ,OAAQQ,KAAKW,SAAL,CAAevB,OAAf,CAHuB,CAAnC,CAIGF,QAJH,EAKH,CAND,EAOH,CARM,IAQA,IAAIJ,QAAUA,OAAOY,SAArB,CAAgC,CACnCzF,QAAQC,OAAR,CAAgBmF,cAAhB,EAAgCjF,IAAhC,CAAqC,UAAkB,IAAjBgF,QAAiB,2DAAP,EAAO,CACnD,MAAKoB,WAAL,CAAiB,cAAjB,CAAiC,CAC7BC,EAAG,GAD0B,CAE7Bf,UAAWZ,OAAOY,SAFW,CAG7BF,OAAQQ,KAAKW,SAAL,CAAevB,OAAf,CAHqB,CAAjC,CAIGF,QAJH,EAKH,CAND,EAOH,CARM,IAQA,IAAIJ,QAAUxG,EAAE2C,OAAF,CAAUmE,OAAV,CAAd,CAAkC,CACrC,GAAIhG,OAAOyC,QAAP,GAAoB,aAAxB,CAAuC,CACnC5B,QAAQC,OAAR,CAAgBmF,cAAhB,EAAgCjF,IAAhC,CAAqC,UAAkB,IAAjBgF,QAAiB,2DAAP,EAAO,CACnD,MAAKoB,WAAL,CAAiBpH,OAAOyC,QAAxB,CAAkC,CAC9BoD,GAAI7F,OAAOkE,kBAAP,CAA0B2B,EADA,CAE9BO,OAAQQ,KAAKW,SAAL,CAAevB,OAAf,CAFsB,CAG9BU,IAAKR,SAHyB,CAI9BsB,kBAAmB,IAJW,CAAlC,CAKG1B,QALH,EAMH,CAPD,EAQH,CATD,IASO,CACH,GAAIvD,QAASrD,EAAEuI,IAAF,CAAOzH,OAAOkE,kBAAd,CAAkC,MAAlC,CAA0C,cAA1C,CAAb,CACArD,QAAQC,OAAR,CAAgBmF,cAAhB,EAAgCjF,IAAhC,CAAqC,UAAkB,IAAjBgF,QAAiB,2DAAP,EAAO,CACnD,MAAKoB,WAAL,CAAiB,iBAAjB,aACO7E,MADP,EAEI6D,OAAQQ,KAAKW,SAAL,CAAevB,OAAf,CAFZ,GAGGF,QAHH,EAIH,CALD,EAMH,CACJ,CAnBM,IAmBA,IAAIJ,QAAW,UAAD,CAAagC,IAAb,CAAkBhC,OAAOiC,KAAzB,CAAd,CAA+C,CAClD,GAAI3H,OAAOyC,QAAP,GAAoB,aAAxB,CAAuC,CACnC,GAAIjC,cAAeR,OAAOkE,kBAAP,CAA0B1D,YAA7C,CACIoH,eAAiB1I,EAAEyB,KAAF,CAAQH,YAAR,CADrB,CAEIE,YAAckH,gBAAkBhB,KAAKC,KAAL,CAAWe,cAAX,CAFpC,CAIA,GAAIlH,WAAJ,CAAiB,CACbG,QAAQC,OAAR,CAAgBmF,cAAhB,EAAgCjF,IAAhC,CAAqC,UAAkB,IAAjBgF,QAAiB,2DAAP,EAAO,CACnD,MAAKoB,WAAL,CAAiBpH,OAAOyC,QAAxB,CAAkC,CAC9BoD,GAAI7F,OAAOkE,kBAAP,CAA0B2B,EADA,CAE9BO,OAAQQ,KAAKW,SAAL,8BAAoBvB,OAApB,GAA6B,CACjCK,WAAY3F,YAAYmH,KADS,CAEjCC,UAAW,QAFsB,CAA7B,GAFsB,CAAlC,CAMGhC,QANH,EAOH,CARD,EASH,CACJ,CACJ,CACJ,CAhGD,CAkGA,KAAKsB,WAAL,CAAmB,SAASV,GAAT,CAAcD,MAAd,CAAsBV,MAAtB,CAA8B,CAC7CA,OAASA,QAAU1I,GAAG4G,KAAH,CAAS8B,MAA5B,CAEA,GAAI7G,EAAE6I,WAAF,CAActB,OAAOe,iBAArB,CAAJ,CAA6C,CACzCf,OAAOe,iBAAP,CAA2B,KAA3B,CACH,CAEDhK,QAAQ,CAAC,kBAAD,CAAR,CAA8B,SAASwK,cAAT,CAAyB,CACnDA,eAAeC,QAAf,CAAwBlC,MAAxB,CAAgC,CAC5BG,UAAWQ,GADiB,CAE5BD,OAAQA,MAFoB,CAG5ByB,eAAgB,gBAHY,CAAhC,EAKH,CAND,EAOH,CAdD,CAgBA,KAAKC,aAAL,CAAqB,SAASC,GAAT,CAAc3K,KAAd,CAAqB4K,aAArB,CAAoCC,cAApC,CAAoD,CACrE,GAAIC,KAAM9K,QACLwC,IADK,CACA,OADA,CACS,iBADT,EAELuI,IAFK,CAEA,SAAS/D,CAAT,CAAYU,CAAZ,CAAesD,CAAf,CAAkB,CACpB,MAAOlF,GAAE,OAAF,EACFG,MADE,CACKH,EAAE,MAAF,EAAUC,IAAV,CAAe6E,cAAc5D,CAAd,CAAiBU,CAAjB,CAAoBsD,CAApB,CAAf,CADL,EAEF/E,MAFE,CAEKH,EAAE,MAAF,EAAUC,IAAV,CAAe8E,eAAe7D,CAAf,CAAkBU,CAAlB,CAAqBsD,CAArB,CAAf,CAFL,EAGFD,IAHE,EAAP,CAIH,CAPK,EAQLvI,IARK,CAQA,IARA,CAQM,MAAS3B,uBARf,CAAV,CASA8J,IAAI5J,IAAJ,CAAS+J,GAAT,EACAA,IAAIG,IAAJ,CAAWxJ,EAAEyJ,IAAF,CAAOJ,IAAIG,IAAX,CAAiB,SAASE,EAAT,CAAa,CACrC,GAAIC,MAAO3J,EAAE4J,OAAF,CAAUC,SAAV,EAAqBC,KAArB,CAA2B,CAA3B,CAAX,CACAzF,EAAE,kBAAF,EAAsBa,KAAtB,GACA,MAAOwE,IAAGzB,KAAH,CAASoB,GAAT,CAAcM,IAAd,CAAP,CACH,CAJU,CAAX,CAMA,MAAON,IAAP,CACH,CAlBD,CAoBH,CAED,QAAS/G,8BAAT,CAAuCyH,wBAAvC,CAAiExI,IAAjE,CAAuE,CACnE,GAAMyI,UAAWhK,EAAEiK,SAAF,CACb5L,SAAS6L,kBAAT,CAA4B,yCAA5B,CADa,CAEb,CAAEC,WAAYJ,wBAAd,CAFa,CAAjB,CAIA,MAAOC,UAASI,gBAAT,CAA0B7I,IAA1B,CAAP,CACH,CAED,QAASM,cAAT,CAAuBf,MAAvB,CAA+BO,MAA/B,CAAuC,CACnC,GAAIgJ,2BAA2BhJ,MAA3B,CAAJ,CAAwC,CACpC,GAAIC,cAAetB,EAAEsK,IAAF,CAAOjJ,OAAOkJ,UAAd,CAAnB,CACA,GAAIjJ,aAAa0B,MAAjB,CAAyB,CACrB,GAAIwH,yBAA0B1J,OAAOkE,kBAAP,CAA0B1D,YAA1B,CAAuCrB,GAAvC,CAA2CyH,KAAKC,KAAhD,CAA9B,CACA,MAAO,CACHjF,KAAM1D,gBADH,CAEHuC,KAAMvB,EAAEC,GAAF,CAAMoB,OAAOkJ,UAAb,CAAyB,SAAS/I,WAAT,CAAsB4D,IAAtB,CAA4B,CACvD,GAAIqF,wBAAyBzK,EAAEiK,SAAF,CAAYO,uBAAZ,CAAqC,CAAEpF,KAAMA,IAAR,CAArC,CAA7B,CACIuD,MAAQ8B,wBAA0BA,uBAAuB9B,KAD7D,CAEIjG,KAAO+H,wBAA0BA,uBAAuB/H,IAF5D,CAGIgI,cAAgB/B,QAAUzJ,kBAH9B,CAIIyL,YAAchC,QAAUxJ,gBAJ5B,CAKIyL,eAAiBF,eAAiBC,WALtC,CAMIE,iBAAmB,CAACD,cAAD,EAAmBH,sBAAnB,EAA6CrM,SAAS0M,UAAT,CAAoBC,OAApB,CAA4BpC,KAA5B,CANpE,CAOIqC,cAAgB,QAAhBA,cAAgB,CAAS3J,MAAT,CAAiB,CAC7B,GAAIqJ,aAAJ,CAAmB,CACf,GAAIO,SAAU7M,SAAS8M,QAAT,CAAkBC,IAAlB,CAAuB9J,OAAO+D,IAA9B,CAAd,CACA,GAAI,CAAC6F,OAAL,CAAc9J,QAAQH,IAAR,CAAa,kCAAb,CAAiDK,OAAO+D,IAAxD,EACd,MAAO6F,SAAUA,QAAQ3F,WAAlB,CAAgCjE,OAAO+D,IAA9C,CACH,CAJD,IAIO,IAAIuF,WAAJ,CAAiB,CACpB,GAAIS,cAAehN,SAASiN,aAAT,CAAuBN,OAAvB,CAA+B1J,OAAO+D,IAAtC,CAAnB,CACA,GAAI,CAACgG,YAAL,CAAmBjK,QAAQH,IAAR,CAAa,uCAAb,CAAsDK,OAAO+D,IAA7D,EACnB,MAAOgG,cAAeA,aAAa9F,WAA5B,CAA0CjE,OAAO+D,IAAxD,CACH,CAJM,IAIA,CACH,MAAOnH,GAAEqN,MAAF,CAASC,WAAT,CAAqBlK,OAAOsH,KAAP,EAAgBA,KAArC,CAA4CtH,OAAO+D,IAAnD,CAAP,CACH,CACJ,CAnBL,CAqBA,GAAI,CAACuD,KAAL,CAAY,KAAM,IAAI7F,MAAJ,CAAU,wCAAV,CAAoDsC,IAApD,CAAN,CACZ,GAAI,CAACyF,gBAAD,EAAqB,CAACD,cAA1B,CAA0C,KAAM,IAAI9H,MAAJ,CAAU,0BAAV,CAAsC2H,uBAAuB9B,KAA7D,CAAN,CAE1C,MAAO3I,GAAEwL,GAAF,CAAM,CACTpG,KAAMA,IADG,CAETuD,MAAOA,KAFE,CAGTjG,KAAMA,IAHG,CAKT4C,YAAa0F,aALJ,CAMTnI,QAAS7C,EAAEC,GAAF,CAAMuB,YAAYqB,OAAlB,CAA2B,QAAS4I,UAAT,CAAmBC,WAAnB,CAAgCC,OAAhC,CAAyCC,IAAzC,CAA+CC,QAA/C,CAAyD,CACzF,GAAI,iBAAmBH,YAAvB,CAAoC,CAChC,GAAII,KAAM9L,EAAEyB,KAAF,CAAQzB,EAAEsK,IAAF,CAAOoB,YAAYK,aAAnB,CAAR,CAAV,CACIvK,YAAcxB,EAAEiK,SAAF,CAAYQ,uBAAuBuB,MAAnC,CAA2C,CAAE5G,KAAM0G,GAAR,CAA3C,CADlB,CAEA,GAAI,CAACtK,WAAL,CAAkB,KAAM,IAAIsB,MAAJ,CAAU,kCAAV,CAA8CgJ,GAA9C,CAAN,CAClB,GAAIjJ,SAAU7C,EAAEC,GAAF,CAAMyL,YAAYK,aAAZ,CAA0BD,GAA1B,EAA+BjJ,OAArC,CAA8C7C,EAAEiM,OAAF,CAAUR,SAAV,CAAqBzL,CAArB,CAAwBA,CAAxB,CAA2BA,CAA3B,CAA8BwB,YAAYmH,KAA1C,CAA9C,CAAd,CACA,GAAI9F,QAAQG,MAAZ,CAAoB,CAChB,MAAO,CACHoC,KAAMuG,OADH,CAEHhD,MAAOkD,UAAYlD,KAFhB,CAGHtC,MAAO,CACHC,MAAOoF,YAAYpF,KADhB,CAEH0F,OAAQnJ,OAFL,CAHJ,CAAP,CAQH,CACJ,CACD,MAAO,CACHuC,KAAMuG,OADH,CAEHhD,MAAOkD,UAAYlD,KAFhB,CAGHtC,MAAOqF,WAHJ,CAAP,CAKH,CAtBQ,CANA,CAAN,CA6BJ,SAASQ,CAAT,CAAY,CACX,GAAIxJ,OAAS,WAAT,EAAwB+H,sBAA5B,CAAoD,CAChDyB,EAAExG,QAAF,CAAayG,SAAS1B,uBAAuB/E,QAAhC,CAA0C,EAA1C,CAAb,CACH,CAFD,IAEO,IAAIhD,OAAS,SAAT,EAAsB+H,sBAA1B,CAAkD,CACrDyB,EAAEE,SAAF,CAAcD,SAAS1B,uBAAuB2B,SAAhC,CAA2C,EAA3C,CAAd,CACH,CACJ,CAnCM,CAAP,CAoCH,CA7DK,CAFH,CAAP,CAiEH,CAnED,IAmEO,CACH,KAAM,IAAItJ,MAAJ,CAAUrE,OAAV,CAAN,CACH,CACJ,CAxED,IAwEO,IAAI4N,kBAAkBhL,MAAlB,CAAJ,CAA+B,CAClC,MAAO,CACHqB,KAAM3D,aADH,CAEHwC,KAAMF,OAAOiL,QAFV,CAAP,CAIH,CALM,IAKA,CACH,GAAI,CAACxL,OAAOkB,OAAP,CAAeC,qBAApB,CAA2C,CACvC,KAAM,IAAIa,MAAJ,CAAU,iEAAV,CAA6EzB,MAA7E,CAAN,CACH,CACD,MAAO,CACHqB,KAAMzD,YADH,CAEHsC,KAAMF,MAFH,CAAP,CAIH,CACJ,CAED,QAASa,2BAAT,CAAoCD,qBAApC,CAA2DuE,MAA3D,CAAmE,CAC/D,GAAIxG,EAAE8H,QAAF,CAAW7F,qBAAX,GAAqCA,sBAAsBe,MAA/D,CAAuE,CACnE,MAAOrB,SAAQrD,OAAR,CAAgB2D,qBAAhB,EACFH,IADE,CACG,SAASC,WAAT,CAAsB,CACxB,GAAI/B,EAAEkD,UAAF,CAAanB,WAAb,CAAJ,CAA+B,CAC3B,MAAOJ,SAAQC,OAAR,CAAgBG,YAAYyE,MAAZ,CAAhB,CAAP,CACH,CACD,KAAM,IAAI1D,MAAJ,CAAU,gCAAV,CAA4Cf,WAA5C,CAAN,CACH,CANE,CAAP,CAOH,CAED,MAAOyE,OAAP,CACH,CAED,QAAS6F,kBAAT,CAA2BhL,MAA3B,CAAmC,CAC/B,MAAQ,aAAeA,OAAf,EAAyBrB,EAAEuM,QAAF,CAAWlL,OAAOkJ,UAAlB,CAAzB,EAA0DvK,EAAE2C,OAAF,CAAU,UAAV,CAAlE,CACH,CAED,QAAS0H,2BAAT,CAAoChJ,MAApC,CAA4C,CACxC,MAAOA,SAAU,CAACrB,EAAE4C,OAAF,CAAUvB,OAAOkJ,UAAjB,CAAlB,CACH,CACJ,CApfD","file":"withRenderer.js","sourcesContent":["define([\n    'util/withDataRequest',\n    'util/vertex/formatters',\n    'colorjs',\n    'd3',\n    'util/requirejs/promise!util/service/ontologyPromise',\n    'configuration/plugins/registry',\n    'require',\n    'd3-tip',\n    'deep-freeze-strict'\n], function(\n    withDataRequest,\n    F,\n    Color,\n    d3,\n    ontology,\n    registry,\n    require,\n    d3tip,\n    deepFreeze) {\n    'use strict';\n\n    var NO_DATA = 'NO_DATA_MARKER',\n        TOO_MANY_BUCKETS = 'TOO_MANY_BUCKETS',\n        TOO_MANY_BUCKETS_HISTOGRAM = 'TOO_MANY_BUCKETS_HISTOGRAM',\n        TOO_MANY_BUCKETS_GEOHASH = 'TOO_MANY_BUCKETS_GEOHASH',\n        MAX_BUCKETS_BEFORE_ERROR = 150,\n        MAX_GEOHASH_BUCKETS_BEFORE_ERROR = 1024,\n        TYPE_ELEMENTS = 'TYPE_ELEMENTS',\n        TYPE_AGGREGATION = 'TYPE_AGGREGATION',\n        TYPE_UNKNOWN = 'TYPE_UNKNOWN',\n        FIELD_CONCEPT_TYPE = 'http://openlumify.org#conceptType',\n        FIELD_EDGE_LABEL = '__edgeLabel',\n        TIP_UNIQUE_IDENTIFIER = 0;\n\n    return withRenderer;\n\n    function withRenderer() {\n\n        withDataRequest.call(this);\n\n        this.after('initialize', function() {\n            this.CHART_PADDING = 14;\n            this.TRANSITION_DURATION = 750;\n            this.colorScale = d3.scale.category20c();\n            this.colors = this.colorScale.range();\n            this.highlightColors = _.map(this.colors, function(color) {\n                return new Color(color).lightenByRatio(.1).toString();\n            });\n            this.LEGEND_COLOR_SWATCH_SIZE = 10;\n            this.LEGEND_SWATCH_TO_TEXT_MARGIN = 5;\n            this.LEGEND_LABEL_HEIGHT = 15;\n            this.OTHER_COLOR_INDEX = 19;\n\n            var self = this,\n                displayed = false,\n                savedResult,\n                savedResultPreProcessing,\n                $loading,\n                report = this.attr.report,\n                warn = _.once(function(msg) {\n                    console.warn(msg, self);\n                }),\n                setAggregations = function(result) {\n                    self.aggregations = result.root;\n                    self.aggregation = _.first(self.aggregations);\n                    return result;\n                },\n                processData = function(result) {\n                    return Promise.resolve(getRootObject(report, result))\n                        .then(function(result) {\n                            var transformer = report.mapping && report.mapping.transformerModulePath;\n                            if (transformer) {\n                                return optionallyApplyTransformer(transformer, result);\n                            }\n                            return result;\n                        })\n                        .then(function(result) {\n                            if (self.attr.item.configuration.reportRenderer && !checkRendererSupportsResponse(self.attr.item.configuration.reportRenderer, result)) {\n                                delete self.attr.item.configuration.reportRenderer;\n                                self.trigger('configurationChanged', {\n                                    extension: self.attr.extension,\n                                    item: self.attr.item\n                                });\n                            }\n                            return result;\n                        })\n                        .then(setAggregations)\n                        .then(function(result) {\n                            var frozen = deepFreeze(result);\n                            savedResultPreProcessing = frozen;\n                            if (result.type === TYPE_AGGREGATION && (!_.isArray(result.root) || _.isEmpty(result.root[0].buckets))) {\n                                throw new Error(NO_DATA);\n                            }\n                            if (result.type === TYPE_AGGREGATION && _.isArray(result.root)) {\n                                var bucketCount = result.root[0].buckets.length,\n                                    aggregationType = result.root[0].type;\n\n                                if (aggregationType === 'geohash' && bucketCount > MAX_GEOHASH_BUCKETS_BEFORE_ERROR) {\n                                    throw new Error(TOO_MANY_BUCKETS_GEOHASH);\n                                } else if (aggregationType !== 'geohash' && bucketCount > MAX_BUCKETS_BEFORE_ERROR) {\n                                    if (aggregationType === 'histogram') {\n                                        throw new Error(TOO_MANY_BUCKETS_HISTOGRAM);\n                                    }\n                                    throw new Error(TOO_MANY_BUCKETS);\n                                }\n                            }\n                            if (_.isFunction(self.processData)) {\n                                return self.processData(frozen);\n                            }\n                            return frozen;\n                        });\n                },\n                saveData = function(result) {\n                    savedResult = result;\n                },\n                requestData = function(params) {\n                    return self.dataRequest('dashboard', 'requestData', report.endpoint, params || {});\n                },\n                render = function() {\n                    if (_.isFunction(self.render)) {\n                        var containerNode = self.$node;\n                        displayed = containerNode.width() && containerNode.height();\n                        if (displayed && savedResult) {\n                            self.render(d3, containerNode[0], savedResult, d3tip);\n                            self.$node.removeClass('error');\n                            self.trigger('finishedLoading');\n                        } else throw new Error(NO_DATA);\n                    } else {\n                        warn('Implement render(d3, svgNode, data, [d3tip]) function');\n                    }\n                },\n                errorHandler = function(error) {\n                    self.trigger('finishedLoading');\n\n                    var type = 'error',\n                        message = type;\n\n                    if (error && error.message === NO_DATA) {\n                        type = 'info';\n                        message = 'no-data';\n                    } else if (error && error.message === TOO_MANY_BUCKETS_GEOHASH) {\n                        type = 'info';\n                        message = 'bucket-overload.geohash';\n                    } else if (error && error.message === TOO_MANY_BUCKETS_HISTOGRAM) {\n                        type = 'info';\n                        message = 'bucket-overload.histogram';\n                    } else if (error && error.message === TOO_MANY_BUCKETS) {\n                        type = 'info';\n                        message = 'bucket-overload';\n                    } else {\n                        console.error(error);\n                        self.$node.addClass('error');\n                    }\n                    var subtitle = i18n(true, 'dashboard.' + message + '.subtitle'),\n                        $message = $('<h1>').text(i18n('dashboard.' + message)),\n                        $dom = $('<div>').addClass(type).append($message);\n                    if (subtitle) {\n                        $message.append($('<div>').text(subtitle))\n                    }\n                    $dom.appendTo(self.node)\n                },\n                loadUsingData = function(data) {\n                    return Promise.resolve(data)\n                        .then(saveData)\n                        .then(render)\n                        .catch(errorHandler)\n                },\n                refresh = function(event, data) {\n                    return Promise.resolve(report.endpointParameters)\n                        .then(requestData)\n                        .then(processData)\n                        .then(loadUsingData)\n                };\n\n            this.on('reflow', function() {\n                if (!displayed) {\n                    this.$node.empty();\n                }\n                Promise.resolve()\n                    .then(render)\n                    .catch(errorHandler)\n            });\n            this.on('refreshData', function() {\n                this.$node.empty();\n                Promise.resolve()\n                    .then(refresh)\n                    .catch(errorHandler)\n            });\n\n            var loadingPromise = this.attr.result ?\n                Promise.resolve(this.attr.result)\n                    .then(setAggregations)\n                    .then(loadUsingData) :\n                refresh()\n                    .catch(errorHandler);\n\n            loadingPromise\n                .catch(errorHandler)\n\n            this.on('getReportResults', function() {\n                loadingPromise.then(function() {\n                    self.trigger('redirectEventToConfiguration', {\n                        name: 'reportResults',\n                        data: {\n                            results: savedResultPreProcessing\n                        }\n                    })\n                });\n            })\n\n            this.displayName = function(d) {\n                if ('displayName' in d) return d.displayName;\n                if (this.aggregation) {\n                    return this.aggregation.displayName(d);\n                }\n                return d.name;\n            }.bind(this);\n\n        });\n\n\n        this.fillSortedBucketGaps = function(buckets, interval) {\n            var nameAsFloat = function(d) {\n                    return parseFloat(d.name, 10);\n                };\n\n            buckets = _.sortBy(buckets, nameAsFloat);\n\n            var min = nameAsFloat(_.first(buckets)),\n                max = nameAsFloat(_.last(buckets));\n\n            for (var i = min, currentData = 0; i <= max + interval; i = i + interval) {\n                if (!buckets[currentData] || i !== nameAsFloat(buckets[currentData])) {\n                    buckets.splice(currentData, 0, {\n                        name: String(i),\n                        value: {\n                            count: 0\n                        }\n                    })\n                }\n                currentData++;\n            }\n            return buckets;\n        };\n\n        this.handleClick = function(object, eventTarget) {\n            const self = this;\n            const report = this.attr.report;\n            const endpointId = report.endpointParameters && report.endpointParameters.id;\n            const d3Target = eventTarget || d3.event && d3.event.target;\n            let filters = object.filters;\n            let filtersPromise;\n            let searchUrl;\n\n            if (filters) {\n                filters = _.reject(filters, function(filter) {\n                    if (filter.propertyId === FIELD_EDGE_LABEL) {\n                        object.edgeLabel = filter.values[0];\n                        return true;\n                    }\n                    if (filter.propertyId === FIELD_CONCEPT_TYPE) {\n                        object.conceptId = filter.values[0];\n                        return true;\n                    }\n                })\n\n                if (filters && endpointId) {\n                    filtersPromise = this.dataRequest('search', 'get', endpointId)\n                        .then(search => {\n                            searchUrl = search.url;\n                            const savedFilters = JSON.parse(search.parameters.filter) || [];\n                            return _.uniq([ ...filters, ...savedFilters ], ({ propertyId }) => propertyId)\n                        })\n                } else {\n                    filtersPromise = filters;\n                }\n            }\n\n            if (report && _.isString(report.clickHandlerModulePath)) {\n                var target = d3.event.target;\n                return Promise.require(report.clickHandlerModulePath)\n                    .then(function(clickHandler) {\n                        if (_.isFunction(clickHandler)) {\n                            return Promise.resolve(clickHandler.apply(self, [target, object]));\n                        }\n                        throw new Error('Click handler must be a function', clickHandler);\n                    });\n            } else if (object && object.conceptId) {\n                Promise.resolve(filtersPromise).then((filters = []) => {\n                    this.popupSearch('/vertex/search', {\n                        q: '*',\n                        conceptType: object.conceptId,\n                        filter: JSON.stringify(filters)\n                    }, d3Target)\n                })\n            } else if (object && object.edgeLabel) {\n                Promise.resolve(filtersPromise).then((filters = []) => {\n                    this.popupSearch('/edge/search', {\n                        q: '*',\n                        edgeLabel: object.edgeLabel,\n                        filter: JSON.stringify(filters)\n                    }, d3Target)\n                })\n            } else if (object && _.isArray(filters)) {\n                if (report.endpoint === '/search/run') {\n                    Promise.resolve(filtersPromise).then((filters = []) => {\n                        this.popupSearch(report.endpoint, {\n                            id: report.endpointParameters.id,\n                            filter: JSON.stringify(filters),\n                            url: searchUrl,\n                            includeChildNodes: true\n                        }, d3Target)\n                    });\n                } else {\n                    var params = _.omit(report.endpointParameters, 'size', 'aggregations');\n                    Promise.resolve(filtersPromise).then((filters = []) => {\n                        this.popupSearch('/element/search', {\n                            ...params,\n                            filter: JSON.stringify(filters)\n                        }, d3Target);\n                    })\n                }\n            } else if (object && (/^other$/i).test(object.label)) {\n                if (report.endpoint === '/search/run') {\n                    var aggregations = report.endpointParameters.aggregations,\n                        aggregationStr = _.first(aggregations),\n                        aggregation = aggregationStr && JSON.parse(aggregationStr);\n\n                    if (aggregation) {\n                        Promise.resolve(filtersPromise).then((filters = []) => {\n                            this.popupSearch(report.endpoint, {\n                                id: report.endpointParameters.id,\n                                filter: JSON.stringify([ ...filters, {\n                                    propertyId: aggregation.field,\n                                    predicate: 'hasNot'\n                                }])\n                            }, d3Target)\n                        })\n                    }\n                }\n            }\n        };\n\n        this.popupSearch = function(url, search, target) {\n            target = target || d3.event.target;\n\n            if (_.isUndefined(search.includeChildNodes)) {\n                search.includeChildNodes = false;\n            }\n\n            require(['./resultsPopover'], function(ResultsPopover) {\n                ResultsPopover.attachTo(target, {\n                    searchUrl: url,\n                    search: search,\n                    scrollSelector: '.grid-scroller'\n                });\n            })\n        };\n\n        this.createTooltip = function(svg, d3tip, titleFunction, detailFunction) {\n            var tip = d3tip()\n                .attr('class', 'dashboard-d3tip')\n                .html(function(d, i, n) {\n                    return $('<div>')\n                        .append($('<h1>').text(titleFunction(d, i, n)))\n                        .append($('<h2>').text(detailFunction(d, i, n)))\n                        .html()\n                })\n                .attr('id', 'tip' + (TIP_UNIQUE_IDENTIFIER++));\n            svg.call(tip);\n            tip.show = _.wrap(tip.show, function(fn) {\n                var args = _.toArray(arguments).slice(1);\n                $('.dashboard-d3tip').empty();\n                return fn.apply(tip, args);\n            })\n\n            return tip;\n        }\n\n    }\n\n    function checkRendererSupportsResponse(reportRendererIdentifier, root) {\n        const renderer = _.findWhere(\n            registry.extensionsForPoint('org.openlumify.dashboard.reportrenderer'),\n            { identifier: reportRendererIdentifier }\n        );\n        return renderer.supportsResponse(root);\n    }\n\n    function getRootObject(report, result) {\n        if (resultsIncludeAggregations(result)) {\n            var aggregations = _.keys(result.aggregates);\n            if (aggregations.length) {\n                var aggregationsFromRequest = report.endpointParameters.aggregations.map(JSON.parse);\n                return {\n                    type: TYPE_AGGREGATION,\n                    root: _.map(result.aggregates, function(aggregation, name) {\n                        var aggregationFromRequest = _.findWhere(aggregationsFromRequest, { name: name }),\n                            field = aggregationFromRequest && aggregationFromRequest.field,\n                            type = aggregationFromRequest && aggregationFromRequest.type,\n                            isConceptType = field === FIELD_CONCEPT_TYPE,\n                            isEdgeLabel = field === FIELD_EDGE_LABEL,\n                            isSpecialField = isConceptType || isEdgeLabel,\n                            ontologyProperty = !isSpecialField && aggregationFromRequest && ontology.properties.byTitle[field],\n                            displayNameFn = function(result) {\n                                if (isConceptType) {\n                                    var concept = ontology.concepts.byId[result.name];\n                                    if (!concept) console.warn('No concept matching bucket name:', result.name);\n                                    return concept ? concept.displayName : result.name;\n                                } else if (isEdgeLabel) {\n                                    var relationship = ontology.relationships.byTitle[result.name];\n                                    if (!relationship) console.warn('No relationship matching bucket name:', result.name);\n                                    return relationship ? relationship.displayName : result.name\n                                } else {\n                                    return F.vertex.propDisplay(result.field || field, result.name);\n                                }\n                            }\n\n                        if (!field) throw new Error('Aggregation name not found in request:', name);\n                        if (!ontologyProperty && !isSpecialField) throw new Error('Ontology field not found', aggregationFromRequest.field);\n\n                        return _.tap({\n                            name: name,\n                            field: field,\n                            type: type,\n                            //ontology: ontologyProperty || undefined,\n                            displayName: displayNameFn,\n                            buckets: _.map(aggregation.buckets, function mapBucket(bucketValue, nameIri, list, fieldIri) {\n                                if ('nestedResults' in bucketValue) {\n                                    var key = _.first(_.keys(bucketValue.nestedResults)),\n                                        aggregation = _.findWhere(aggregationFromRequest.nested, { name: key })\n                                    if (!aggregation) throw new Error('Nested name not found in request', key);\n                                    var buckets = _.map(bucketValue.nestedResults[key].buckets, _.partial(mapBucket, _, _, _, aggregation.field));\n                                    if (buckets.length) {\n                                        return {\n                                            name: nameIri,\n                                            field: fieldIri || field,\n                                            value: {\n                                                count: bucketValue.count,\n                                                nested: buckets\n                                            }\n                                        }\n                                    }\n                                }\n                                return {\n                                    name: nameIri,\n                                    field: fieldIri || field,\n                                    value: bucketValue\n                                };\n                            })\n                        }, function(r) {\n                            if (type === 'histogram' && aggregationFromRequest) {\n                                r.interval = parseInt(aggregationFromRequest.interval, 10);\n                            } else if (type === 'geohash' && aggregationFromRequest) {\n                                r.precision = parseInt(aggregationFromRequest.precision, 10);\n                            }\n                        });\n                    })\n                }\n            } else {\n                throw new Error(NO_DATA);\n            }\n        } else if (resultsFromSearch(result)) {\n            return {\n                type: TYPE_ELEMENTS,\n                root: result.elements\n            }\n        } else {\n            if (!report.mapping.transformerModulePath) {\n                throw new Error('Report response is not recognized and no transformer configured', result);\n            }\n            return {\n                type: TYPE_UNKNOWN,\n                root: result\n            };\n        }\n    }\n\n    function optionallyApplyTransformer(transformerModulePath, object) {\n        if (_.isString(transformerModulePath) && transformerModulePath.length) {\n            return Promise.require(transformerModulePath)\n                .then(function(transformer) {\n                    if (_.isFunction(transformer)) {\n                        return Promise.resolve(transformer(object));\n                    }\n                    throw new Error('Transformer must be a function', transformer);\n                });\n        }\n\n        return object;\n    }\n\n    function resultsFromSearch(result) {\n        return ('itemCount' in result || _.isObject(result.aggregates) || _.isArray('elements'));\n    }\n\n    function resultsIncludeAggregations(result) {\n        return result && !_.isEmpty(result.aggregates);\n    }\n});\n\n"]}