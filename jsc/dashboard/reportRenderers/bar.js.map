{"version":3,"sources":["../../../js/dashboard/reportRenderers/bar.js"],"names":["define","defineComponent","F","ontology","withRenderer","barCss","MAX_ROWS","BAR_OTHER_CATEGORY","nameAsFloat","_","compose","floatFn","nameFn","nameAsDate","d","Date","parseInt","name","d3","StackedBar","countFn","value","count","parseFloat","isOtherCategory","tickFormatInterval","interval","isDate","months","years","getFullYear","date","dateString","tickFormat","isNumber","number","prettyApproximate","format","processData","data","self","root","report","attr","isHistogram","type","buckets","sortBy","bucket","first","isNested","Boolean","nested","length","isHorizontal","item","configuration","reportRenderer","reportAggregations","endpointParameters","aggregations","map","JSON","parse","field","nestedField","nestedCategories","unique","flatten","pluck","sort","concat","reverse","render","renderStackedBar","_d3","node","d3tip","$node","$","colorScale","colors","empty","scale","category20","domain","range","padding","width","height","heightXAxis","heightDifference","heightTruncated","Math","floor","ceil","xAxisVerticalOffset","yAxisWidth","numBars","dataSlice","slice","ontologyProperty","properties","byTitle","isDates","dataType","yScale","linear","extent","xData","xScale","time","last","getTime","CHART_PADDING","min","max","ordinal","displayName","rangeRoundBands","xColorScale","countScale","dataScale","tmpScale","numTicks","isFunction","round","xAxis","svg","axis","orient","ticks","yAxis","select","selectAll","call","band","rangeBand","clip","x","y","enter","append","text","transition","duration","TRANSITION_DURATION","tip","tooltip","createTooltip","tipFormat","label","i18n","pretty","String","substring","gChartArea","xOffset","classed","gXAxis","undefined","each","box","getBoundingClientRect","style","overflowEllipsis","gYAxis","gBars","bars","barTransformFn","on","segIndex","barIndex","filter","propertyId","values","push","predicate","handleClick","filters","genClipPath","rowPart","col","row","id","genClipPathRef","pathId","fill","opacity","delay","y0","nestedCount","chain","extend","y1","tap","diff","insert","querySelector","barData","thisFilter","widthFn","yFn","heightFn","show","hide","exit","remove","r","updateText","xFn","initialDate","offset","textEl","textLength","getComputedTextLength"],"mappings":"AAAAA,OAAO,CACH,sBADG,CAEH,wBAFG,CAGH,qDAHG,CAIH,gBAJG,CAAP,CAKG,SACCC,eADD,CAECC,CAFD,CAGCC,QAHD,CAICC,YAJD,CAIe,CACd,aAEA,GAAMC,6SAAN,CAaA,GAAMC,UAAW,EAAjB,CACA,GAAMC,oBAAqB,oBAA3B,CACA,GAAMC,aAAcC,EAAEC,OAAF,CAAUC,OAAV,CAAmBC,MAAnB,CAApB,CACA,GAAMC,YAAa,QAAbA,WAAa,CAASC,CAAT,CAAY,CAC3B,MAAO,IAAIC,KAAJ,CAASC,SAASF,EAAEG,IAAX,CAAiB,EAAjB,CAAT,CAAP,CACH,CAFD,CAIA,GAAIC,GAAJ,CAEA,MAAOjB,iBAAgBkB,UAAhB,CAA4Bf,YAA5B,CAAP,CAEA,QAASgB,QAAT,CAAiBN,CAAjB,CAAoB,CAChB,MAAOA,GAAEO,KAAF,CAAQC,KAAf,CACH,CAED,QAASV,OAAT,CAAgBE,CAAhB,CAAmB,CACf,MAAOA,GAAEG,IAAT,CACH,CAED,QAASN,QAAT,CAAiBG,CAAjB,CAAoB,CAChB,MAAOS,YAAWT,CAAX,CAAc,EAAd,CAAP,CACH,CAED,QAASU,gBAAT,CAAyBV,CAAzB,CAA4B,CACxB,MAAOF,QAAOE,CAAP,IAAcP,kBAArB,CACH,CAED,QAASkB,mBAAT,CAA4BC,QAA5B,CAAsC,CAClC,MAAO,UAASZ,CAAT,CAAY,CACf,GAAIL,EAAEkB,MAAF,CAASb,CAAT,CAAJ,CAAiB,CACb,GAAIc,QAAS,KAAO,EAAP,CAAY,EAAZ,CAAiB,EAAjB,CAAsB,EAAnC,CACIC,MAAQD,OAAS,EADrB,CAEA,GAAIF,SAAWG,KAAf,CAAsB,CAClB,MAAOf,GAAEgB,WAAF,EAAP,CACH,CACD,MAAO5B,GAAE6B,IAAF,CAAOC,UAAP,CAAkBlB,CAAlB,CAAP,CACH,CAED,MAAOA,EAAP,CACH,CAXD,CAYH,CAED,QAASmB,WAAT,CAAoBnB,CAApB,CAAuB,CACnB,GAAIL,EAAEkB,MAAF,CAASb,CAAT,CAAJ,CAAiB,CACb,MAAOZ,GAAE6B,IAAF,CAAOC,UAAP,CAAkBlB,CAAlB,CAAP,CACH,CAFD,IAEO,IAAIL,EAAEyB,QAAF,CAAWpB,CAAX,CAAJ,CAAmB,CACtB,GAAIA,GAAK,IAAT,CAAe,CACX,MAAOZ,GAAEiC,MAAF,CAASC,iBAAT,CAA2BtB,CAA3B,CAAP,CACH,CACD,MAAOI,IAAGmB,MAAH,CAAU,GAAV,EAAevB,CAAf,CAAP,CACH,CACD,MAAOA,EAAP,CACH,CAED,QAASK,WAAT,EAAsB,CAElB,KAAKmB,WAAL,CAAmB,SAASC,IAAT,CAAe,CAC9B,GAAIC,MAAO,IAAX,CACIC,KAAOF,KAAKE,IAAL,CAAU,CAAV,CADX,CAEIC,OAAS,KAAKC,IAAL,CAAUD,MAFvB,CAIA,KAAKE,WAAL,CAAmBH,KAAKI,IAAL,GAAc,WAAjC,CAEA,GAAIC,SAAUrC,EAAEsC,MAAF,CAASN,KAAKK,OAAd,CAAuB,SAAShC,CAAT,CAAY,CACzC,GAAI,SAAWA,GAAEO,KAAjB,CAAwB,CACpB,MAAOmB,MAAKI,WAAL,CAAmBhC,OAAOE,CAAP,CAAnB,CAA+BM,QAAQN,CAAR,CAAtC,CACH,CACJ,CAJS,CAAd,CAKIkC,OAASvC,EAAEwC,KAAF,CAAQR,KAAKK,OAAb,CALb,CAOA,KAAKI,QAAL,CAAgBC,QAAQH,QAAUA,OAAO3B,KAAP,CAAa+B,MAAvB,EAAiCJ,OAAO3B,KAAP,CAAa+B,MAAb,CAAoBC,MAA7D,CAAhB,CACA,KAAKC,YAAL,CAAoB,KAAKX,IAAL,CAAUY,IAAV,CAAeC,aAAf,CAA6BC,cAA7B,GAAgD,+BAApE,CAEA,GAAIC,oBAAqBhB,OAAOiB,kBAAP,CAA0BC,YAA1B,CAAuCC,GAAvC,CAA2CC,KAAKC,KAAhD,CAAzB,CACA,KAAKC,KAAL,CAAaN,mBAAmB,CAAnB,EAAsBM,KAAnC,CACA,GAAI,KAAKd,QAAT,CAAmB,CACf,KAAKe,WAAL,CAAmBP,mBAAmB,CAAnB,EAAsBN,MAAtB,CAA6B,CAA7B,EAAgCY,KAAnD,CACA,KAAKE,gBAAL,CAAwBzD,EAAE0D,MAAF,CAAS1D,EAAE2D,OAAF,CAAU3B,KAAKK,OAAL,CAAae,GAAb,CAAiB,SAAS/C,CAAT,CAAY,CACpE,MAAOL,GAAE4D,KAAF,CAAQvD,EAAEO,KAAF,CAAQ+B,MAAhB,CAAwB,MAAxB,CAAP,CACH,CAF0C,CAAV,CAAT,EAEnBkB,IAFmB,GAEZC,MAFY,CAEL,CAAChE,kBAAD,CAFK,CAAxB,CAGH,CAED,GAAI,KAAKqC,WAAT,CAAsB,CAClB,KAAKlB,QAAL,CAAgBe,KAAKf,QAArB,CACA,MAAOjB,GAAEsC,MAAF,CAASD,OAAT,CAAkBtC,WAAlB,CAAP,CACH,CAED,MAAOsC,SAAQ0B,OAAR,EAAP,CACH,CAhCD,CAkCA,KAAKC,MAAL,CAAc,QAASC,iBAAT,CAA0BC,GAA1B,CAA+BC,IAA/B,CAAqCrC,IAArC,CAA2CsC,KAA3C,CAAkD,CAC5D3D,GAAKyD,GAAL,CAEA,GAAIG,OAAQC,EAAEH,IAAF,CAAZ,CACII,WAAa,KAAKA,UADtB,CAEIC,OAAS,KAAKA,MAFlB,CAIA,GAAI,CAAC1C,IAAD,EAAS,CAACA,KAAKc,MAAnB,CAA2B,CACvByB,MAAMI,KAAN,GACA,OACH,CAED,GAAI,KAAKhC,QAAT,CAAmB,CACf8B,WAAa9D,GAAGiE,KAAH,CAASC,UAAT,EAAb,CACAJ,WAAWK,MAAX,CAAkB,KAAKnB,gBAAvB,EACAe,OAASD,WAAWM,KAAX,EAAT,CACH,CAED,GAAI9C,MAAO,IAAX,CACI+C,QAAU,EADd,CAEIC,MAAQV,MAAMU,KAAN,EAFZ,CAGIC,OAASX,MAAMW,MAAN,GAAiBF,OAH9B,CAIIG,YAAc,EAJlB,CAKIC,iBAAmBF,OAASC,WALhC,CAMIE,gBAAkBD,iBAAmB,CAAnB,CAAuBE,KAAKC,KAAL,CAAWH,gBAAX,CAAvB,CAAsDE,KAAKE,IAAL,CAAUJ,gBAAV,CAN5E,CAOIK,oBAAsBJ,gBAAkB,GAP5C,CAQIK,WAAa,EARjB,CASIvD,OAAS,KAAKC,IAAL,CAAUD,MATvB,CAUIwD,QAAU,KAAKtD,WAAL,CAAmBL,KAAKc,MAAxB,CAAiC,KAAKC,YAAL,CAAoBmC,OAASC,WAA7B,CAA2CpF,QAV1F,CAWI6F,UAAY5D,KAAK6D,KAAL,CAAW,CAAX,CAAcF,OAAd,CAXhB,CAYIG,iBAAmBlG,SAASmG,UAAT,CAAoBC,OAApB,CAA4B,KAAKvC,KAAjC,CAZvB,CAaIwC,QAAUH,kBAAoBA,iBAAiBI,QAAjB,GAA8B,MAbhE,CAcIC,OAASxF,GAAGiE,KAAH,CAASwB,MAAT,GACItB,MADJ,CACW,CAAC,CAAD,CAAInE,GAAG0F,MAAH,CAAUT,SAAV,CAAqB/E,OAArB,EAA8B,CAA9B,CAAJ,CADX,EAEIkE,KAFJ,CAEU,CAACG,OAASC,WAAV,CAAuB,CAAvB,CAFV,CAdb,CAiBImB,MAAQ,KAAKjE,WAAL,EAAoBnC,EAAEoD,GAAF,CAAMsC,SAAN,CAAiBK,QAAU3F,UAAV,CAAuBL,WAAxC,CAjBhC,CAkBIsG,OAAS,KAAKlE,WAAL,CACL4D,QACItF,GAAG6F,IAAH,CAAQ5B,KAAR,GACKE,MADL,CACY,CAACwB,MAAM,CAAN,CAAD,CAAW,GAAI9F,KAAJ,CAASN,EAAEuG,IAAF,CAAOH,KAAP,EAAcI,OAAd,GAA0BzE,KAAKd,QAAxC,CAAX,CADZ,EAEK4D,KAFL,CAEW,CAAC,CAAD,CAAIE,MAAQS,UAAR,CAAqB,EAAI,KAAKiB,aAAlC,CAFX,CADJ,CAIIhG,GAAGiE,KAAH,CAASwB,MAAT,GACKtB,MADL,CACY,CAACnE,GAAGiG,GAAH,CAAON,KAAP,CAAD,CAAgB3F,GAAGkG,GAAH,CAAOP,KAAP,EAAgBrE,KAAKd,QAArC,CADZ,EAEK4D,KAFL,CAEW,CAAC,CAAD,CAAIE,MAAQS,UAAR,CAAqB,EAAI,KAAKiB,aAAlC,CAFX,CALC,CAQDhG,GAAGiE,KAAH,CAASkC,OAAT,GACKhC,MADL,CACY5E,EAAEoD,GAAF,CAAMsC,SAAN,CAAiB3D,KAAK8E,WAAtB,CADZ,EAEKC,eAFL,CAEqB,CAAC,CAAD,CAAI/B,MAAQS,UAAR,CAAqB,EAAI,KAAKiB,aAAlC,CAFrB,CAEuE,IAFvE,CA1BZ,CA6BIM,YAActG,GAAGiE,KAAH,CAASwB,MAAT,GACTrB,KADS,CACH,CAAC,GAAD,CAAM,GAAN,CADG,EAETD,MAFS,CAEFqB,OAAOrB,MAAP,EAFE,CA7BlB,CAgCIoC,WAAaf,MAhCjB,CAiCIgB,UAAYZ,MAjChB,CAmCA,GAAI,KAAKxD,YAAT,CAAuB,CACnB,GAAIqE,UAAWb,MAAf,CACAA,OAASJ,MAAT,CACAA,OAASiB,QAAT,CACAb,OAAOxB,KAAP,CAAa,CAAC,CAAD,CAAIE,MAAQ,EAAI,KAAK0B,aAArB,CAAb,EACA,GAAI,KAAKtE,WAAT,CAAsB,CAClB8D,OAAOpB,KAAP,CAAa,CAACG,OAASC,WAAV,CAAuB,CAAvB,CAAb,EACH,CAFD,IAEO,CACHgB,OAAOa,eAAP,CAAuB,CAAC,CAAD,CAAI9B,OAASC,WAAb,CAAvB,CAAkD,IAAlD,EACH,CACJ,CAED,GAAIkC,SAAJ,CACA,GAAI,CAACnH,EAAEoH,UAAF,CAAaf,OAAOS,eAApB,CAAL,CAA2C,CACvCK,SAAW/B,KAAKiC,KAAL,CAAWtC,MAAQ,EAAnB,CAAX,CACH,CACD,GAAIgB,SAAWhE,KAAKI,WAApB,CAAiC,CAC7BgF,SAAW/B,KAAKiC,KAAL,CAAWtC,MAAQ,GAAnB,CAAX,CACH,CAED,GAAIuC,OAAQ7G,GAAG8G,GAAH,CAAOC,IAAP,GACK9C,KADL,CACW2B,MADX,EAEKoB,MAFL,CAEY,QAFZ,CAAZ,CAGA,GAAI1B,OAAJ,CAAa,CACTuB,MAAM9F,UAAN,CAAiBR,mBAAmBe,KAAKd,QAAxB,CAAjB,EACH,CAFD,IAEO,CACHqG,MAAM9F,UAAN,CAAiBA,UAAjB,EACH,CACD,GAAI2F,SAAW,CAAf,CAAkB,CACdG,MAAMI,KAAN,CAAYP,QAAZ,EACH,CAED,GAAIQ,OAAQlH,GAAG8G,GAAH,CAAOC,IAAP,GACK9C,KADL,CACWuB,MADX,EAEKwB,MAFL,CAEY,MAFZ,EAGKjG,UAHL,CAGgBA,UAHhB,CAAZ,CAII+F,IAAM9G,GAAGmH,MAAH,CAAUzD,IAAV,EAAgB0D,SAAhB,CAA0B,KAA1B,EAAiC/F,IAAjC,CAAsC,CAAC,CAAD,CAAtC,EAA2CgG,IAA3C,CAAgD,UAAW,CACzD,GAAIC,MAAOhG,KAAKI,WAAL,CAAmB8E,UAAUA,UAAUrC,MAAV,GAAmB,CAAnB,EAAwB7C,KAAKd,QAAvC,CAAnB,CAAsEgG,UAAUe,SAAV,EAAjF,CACIC,KAAO,CAAEC,EAAGH,KAAO,CAAC,CAAb,CAAgBI,EAAG,CAAnB,CAAsBpD,MAAOgD,IAA7B,CAAmC/C,OAAQ,EAA3C,CADX,CAEA,KAAKoD,KAAL,GACKC,MADL,CACY,KADZ,EAEKP,IAFL,CAEU,UAAW,CACb,KAAKO,MAAL,CAAY,MAAZ,EACKP,IADL,CACU,UAAW,CACb,KAAKO,MAAL,CAAY,OAAZ,EAAqBnG,IAArB,CAA0B,MAA1B,CAAkC,UAAlC,EAA8CoG,IAA9C,CAAmD1I,MAAnD,EACA,KAAKyI,MAAL,CAAY,UAAZ,EAAwBnG,IAAxB,CAA6B,IAA7B,CAAmC,gBAAnC,EACKmG,MADL,CACY,MADZ,EAEKnG,IAFL,CAEU+F,IAFV,EAGH,CANL,EAOA,KAAKI,MAAL,CAAY,GAAZ,EACKnG,IADL,CACU,OADV,CACmB,SADnB,EAEKA,IAFL,CAEU,WAFV,CAEuB,gBAAkB4C,OAAlB,CAA4B,GAFnD,EAGH,CAbL,EAcA,KAAK5C,IAAL,CAAU,OAAV,CAAmB6C,KAAnB,EACK7C,IADL,CACU,QADV,CACoB8C,OAASF,OAD7B,EAEA,KAAK5C,IAAL,CAAU,SAAV,CAAqB,IAArB,EACA,KAAK0F,MAAL,CAAY,eAAZ,EAA6BW,UAA7B,GAA0CC,QAA1C,CAAmDzG,KAAK0G,mBAAxD,EAA6EvG,IAA7E,CAAkF+F,IAAlF,EACH,CArBC,EAqBCL,MArBD,CAqBQ,WArBR,CAJV,CA0BIc,IAAM,KAAKC,OAAL,CAAe,KAAKA,OAAL,EAAgB,KAAKC,aAAL,CAAmBrB,GAAnB,CAAwBnD,KAAxB,CACjC,SAAS/D,CAAT,CAAY,CACR,MAAOI,IAAGmB,MAAH,CAAUG,KAAKG,IAAL,CAAU2G,SAAV,EAAuB,GAAjC,EAAsClI,QAAQN,CAAR,CAAtC,CAAP,CACH,CAHgC,CAIjC,SAASA,CAAT,CAAY,CACR,GAAIyI,OAAQ/H,gBAAgBV,CAAhB,EAAqB0I,KAAK,wBAAL,CAArB,CAAsDhH,KAAK8E,WAAL,CAAiBxG,CAAjB,CAAlE,CACA,MAAO0B,MAAKI,WAAL,CACH4D,QACCtG,EAAE6B,IAAF,CAAOC,UAAP,CAAkBnB,WAAWC,CAAX,CAAlB,EAAmC,GAAnC,CAAyCZ,EAAE6B,IAAF,CAAOC,UAAP,CAAkB,GAAIjB,KAAJ,CAASF,WAAWC,CAAX,EAAcmG,OAAd,GAA0BzE,KAAKd,QAAxC,CAAlB,CAD1C,CAECxB,EAAEiC,MAAF,CAASsH,MAAT,CAAgBjJ,YAAYM,CAAZ,CAAhB,EAAkC,GAAlC,CAAwCZ,EAAEiC,MAAF,CAASsH,MAAT,CAAgBjJ,YAAYM,CAAZ,EAAiB0B,KAAKd,QAAtC,CAHtC,CAIFgI,OAAOH,KAAP,EAAclG,MAAd,CAAuB,EAAvB,CAA4BkG,MAAMI,SAAN,CAAgB,CAAhB,CAAmB,EAAnB,EAAyB,KAArD,CAA6DJ,KAJlE,CAKH,CAXgC,CA1BzC,CAsCIK,WAAa5B,IAAIM,SAAJ,CAAc,cAAd,EAA8B/F,IAA9B,CAAmC,CAAC,CAAD,CAAnC,EAAwCgG,IAAxC,CAA6C,UAAW,CAC7D,GAAIsB,SAAU,CAACrH,KAAKc,YAAL,CAAoB,CAApB,CAAwB2C,UAAzB,EAAuCzD,KAAK0E,aAA1D,CACA,KAAK2B,KAAL,GAAaC,MAAb,CAAoB,GAApB,EACKgB,OADL,CACa,YADb,CAC2B,IAD3B,EAEKnH,IAFL,CAEU,WAFV,CAEuB,aAAekH,OAAf,CAAyB,KAFhD,EAGH,CALQ,CAtCjB,CA4CIE,OAASH,WAAWtB,SAAX,CAAqB,UAArB,EAAiC/F,IAAjC,CAAsC,CAAC,CAAD,CAAtC,EAA2CgG,IAA3C,CAAgD,UAAW,CAC5D,KAAKM,KAAL,GAAaC,MAAb,CAAoB,GAApB,EACKnG,IADL,CACU,OADV,CACmB,QADnB,EAEKA,IAFL,CAEU,WAFV,CAEuB,eAAiBqD,mBAAjB,CAAuC,GAF9D,EAGA,KAAKgD,UAAL,GAAkBC,QAAlB,CAA2BzG,KAAK0G,mBAAhC,EACKvG,IADL,CACU,WADV,CACuB,eAAiBqD,mBAAjB,CAAuC,GAD9D,EAEKuC,IAFL,CAEUR,KAFV,EAGKQ,IAHL,CAGU,UAAW,CACb,GAAI,CAAC/F,KAAKc,YAAN,EAAsB,CAACd,KAAKI,WAAhC,CAA6C,CACzC,KAAK0F,SAAL,CAAe,MAAf,EACK3F,IADL,CACU,WADV,CACuBH,KAAKI,WAAL,CAAmBoH,SAAnB,CAA+B,sBADtD,EAEKC,IAFL,CAEU,UAAW,CACb,GAAIzB,MAAOhG,KAAKI,WAAL,CAAmB8E,UAAUlF,KAAKd,QAAf,EAA2B,CAA9C,CAAkDgG,UAAUe,SAAV,EAA7D,CACIyB,IAAM,KAAKC,qBAAL,EADV,CAEA,GAAID,IAAI1E,KAAJ,CAAYgD,IAAhB,CAAsB,CAClBtH,GAAGmH,MAAH,CAAU,IAAV,EACK1F,IADL,CACU,IADV,CACgB6F,KAAO,CAAC,CADxB,EAEK4B,KAFL,CAEW,aAFX,CAE0B,OAF1B,EAGH,CAJD,IAIO,CACHlJ,GAAGmH,MAAH,CAAU,IAAV,EACK1F,IADL,CACU,IADV,CACgB,IADhB,EAEH,CACJ,CAbL,EAcKsH,IAdL,CAcU,UAAW,CACb/I,GAAGmH,MAAH,CAAU,IAAV,EACK1F,IADL,CACU,IADV,CACgB,OADhB,EAEH,CAjBL,EAkBK4F,IAlBL,CAkBU8B,gBAlBV,CAkB4B3C,UAAUe,SAAV,EAlB5B,EAmBH,CACJ,CAzBL,EA0BH,CA9BI,CA5Cb,CA2EI6B,OAAS,CAAC9H,KAAKc,YAAN,EAAsBsG,WAAWtB,SAAX,CAAqB,UAArB,EAAiC/F,IAAjC,CAAsC,CAAC,CAAD,CAAtC,EAA2CgG,IAA3C,CAAgD,UAAW,CAClF,KAAKM,KAAL,GAAaC,MAAb,CAAoB,GAApB,EAAyBnG,IAAzB,CAA8B,OAA9B,CAAuC,QAAvC,EACA,KAAKqG,UAAL,GAAkBC,QAAlB,CAA2BzG,KAAK0G,mBAAhC,EAAqDX,IAArD,CAA0DH,KAA1D,EACH,CAH0B,CA3EnC,CA+EImC,MAAQX,WAAWtB,SAAX,CAAqB,QAArB,EAA+B/F,IAA/B,CAAoC,CAAC,CAAD,CAApC,EAAyCgG,IAAzC,CAA8C,UAAW,CACzD,KAAKM,KAAL,GAAaC,MAAb,CAAoB,GAApB,EAAyBgB,OAAzB,CAAiC,MAAjC,CAAyC,IAAzC,EACH,CAFG,CA/EZ,CAmFA,GAAIU,MAAOD,MAAMjC,SAAN,CAAgB,MAAhB,EAAwB/F,IAAxB,CAA6B4D,SAA7B,CAAwCvF,MAAxC,CAAX,CAEA4J,KAAK3B,KAAL,GACKC,MADL,CACY,GADZ,EACiBnG,IADjB,CACsB,OADtB,CAC+B,KAD/B,EAEKA,IAFL,CAEU,WAFV,CAEuB8H,cAFvB,EAGKlC,IAHL,CAGU,UAAW,CACb,KAAKD,SAAL,CAAe,UAAf,EACK/F,IADL,CACU,SAASzB,CAAT,CAAY,CACd,MAAO,CAACA,CAAD,CAAP,CACH,CAHL,EAIKyH,IAJL,CAIU,UAAW,CAEb,KAAKM,KAAL,GACKN,IADL,CACU,UAAW,CACb,KAAKO,MAAL,CAAY,MAAZ,EACKnG,IADL,CACU,OADV,CACmB,KADnB,EAEKmH,OAFL,CAEa,WAFb,CAE0B,SAAShJ,CAAT,CAAY,CAC9B,MAAO,CAAC,CAACA,EAAEkD,KAAX,CACH,CAJL,EAKKrB,IALL,CAKU,MALV,CAKkB,aALlB,EAMK+H,EANL,CAMQ,OANR,CAMiB,SAAS5J,CAAT,CAAY6J,QAAZ,CAAsBC,QAAtB,CAAgC,CACzC,GAAI,CAAC9J,EAAEkD,KAAP,CAAc,OAEd,GAAI6G,QAAS,CACTC,WAAYhK,EAAEkD,KADL,CAET+G,OAAQ,CAACnK,OAAOE,CAAP,CAAD,CAFC,CAAb,CAKA,GAAI0B,KAAKI,WAAT,CAAsB,CAClBiI,OAAOE,MAAP,CAAcC,IAAd,CAAmBtB,OAAOlJ,YAAYM,CAAZ,EAAiB0B,KAAKd,QAA7B,CAAnB,EACAmJ,OAAOI,SAAP,CAAmB,OAAnB,CACH,CAHD,IAGO,CACHJ,OAAOI,SAAP,CAAmB,OAAnB,CACH,CACDzI,KAAK0I,WAAL,CAAiB,CAAEC,QAAS,CAACN,MAAD,CAAX,CAAjB,EACH,CArBL,EAuBA,GAAIrI,KAAKc,YAAT,CAAuB,CACnB,GAAI8H,aAAc,QAAdA,YAAc,CAASC,OAAT,CAAkB,CAC5B,MAAO,UAASvK,CAAT,CAAYwK,GAAZ,CAAiBC,GAAjB,CAAsB,CACzB,MAAO,aAAe/I,KAAKG,IAAL,CAAUY,IAAV,CAAeiI,EAA9B,CAAmC,GAAnC,CAAyCD,GAAzC,CAA+C,GAA/C,CAAqDF,OAA5D,CACH,CAFD,CAGH,CAJL,CAKII,eAAiB,QAAjBA,eAAiB,CAASJ,OAAT,CAAkB,CAC/B,MAAO5K,GAAEC,OAAF,CAAU,SAASgL,MAAT,CAAiB,CAC9B,MAAO,QAAUA,MAAV,CAAmB,GAA1B,CACH,CAFM,CAEJN,YAAYC,OAAZ,CAFI,CAAP,CAGH,CATL,CAWA,KAAKvC,MAAL,CAAY,MAAZ,EACKP,IADL,CACU,UAAW,CACb,KAAKO,MAAL,CAAY,UAAZ,EACKnG,IADL,CACU,IADV,CACgByI,YAAY,CAAZ,CADhB,EAEKtC,MAFL,CAEY,MAFZ,EAEoBnG,IAFpB,CAEyB,OAFzB,CAEkC,UAFlC,EAGA,KAAKmG,MAAL,CAAY,UAAZ,EACKnG,IADL,CACU,IADV,CACgByI,YAAY,CAAZ,CADhB,EAEKtC,MAFL,CAEY,MAFZ,EAEoBnG,IAFpB,CAEyB,OAFzB,CAEkC,WAFlC,EAGH,CARL,EAUA,KAAKmG,MAAL,CAAY,GAAZ,EAAiBnG,IAAjB,CAAsB,OAAtB,CAA+B,YAA/B,EAA6CyH,KAA7C,CAAmD,SAAnD,CAA8D,CAA9D,EACK7B,IADL,CACU,UAAW,CACb,KAAKO,MAAL,CAAY,MAAZ,EACKnG,IADL,CACU,OADV,CACmB,QADnB,EAEKA,IAFL,CAEU,GAFV,CAEe,CAFf,EAGKyH,KAHL,CAGW,CAAEuB,KAAM,OAAR,CAAiBC,QAAS,CAA1B,CAHX,EAIKjJ,IAJL,CAIU,WAJV,CAIuB8I,eAAe,CAAf,CAJvB,EAKA,KAAK3C,MAAL,CAAY,MAAZ,EACKnG,IADL,CACU,OADV,CACmB,QADnB,EAEKA,IAFL,CAEU,GAFV,CAEe,CAFf,EAGKyH,KAHL,CAGW,CAAEuB,KAAMnJ,KAAKyC,MAAL,CAAY,CAAZ,CAAR,CAAwB2G,QAAS,CAAjC,CAHX,EAIKjJ,IAJL,CAIU,WAJV,CAIuB8I,eAAe,CAAf,CAJvB,EAKH,CAZL,EAaKzC,UAbL,GAcK6C,KAdL,CAcWrJ,KAAK0G,mBAAL,CAA2B1G,KAAK0G,mBAAL,CAA2B,CAdjE,EAeKD,QAfL,CAeczG,KAAK0G,mBAAL,CAA2B,CAfzC,EAgBKkB,KAhBL,CAgBW,SAhBX,CAgBsB,CAhBtB,EAiBH,CAvCD,IAuCO,CACH,KAAKtB,MAAL,CAAY,GAAZ,EAAiBnG,IAAjB,CAAsB,OAAtB,CAA+B,YAA/B,EACH,CACJ,CAnEL,EAqEH,CA3EL,EA4EH,CAhFL,EAiFK2F,SAjFL,CAiFe,UAjFf,EAkFK/F,IAlFL,CAkFU,SAASzB,CAAT,CAAY,CACd,GAAIgL,IAAK,CAAT,CACIxK,MAAQR,EAAEO,KAAF,CAAQC,KADpB,CAEIyK,YAAc,CAFlB,CAGA,MAAOtL,GAAEuL,KAAF,CAAQxJ,KAAKU,QAAL,CAAgBpC,EAAEO,KAAF,CAAQ+B,MAAxB,CAAiC,CAACtC,CAAD,CAAzC,EACFiC,MADE,CACK,SAASjC,CAAT,CAAY,CAChB,MAAOA,GAAEO,KAAF,CAAQC,KAAR,CAAgB,CAAC,CAAxB,CACH,CAHE,EAIFuC,GAJE,CAIE,SAAS/C,CAAT,CAAY,CACbiL,aAAejL,EAAEO,KAAF,CAAQC,KAAvB,CACA,GAAI0B,QAASvC,EAAEwL,MAAF,CAAS,EAAT,CAAanL,CAAb,CAAgB,CACzBgL,GAAIA,EADqB,CAEzBI,GAAIJ,IAAMhL,EAAEO,KAAF,CAAQC,KAAR,EAAiB,CAFF,CAAhB,CAAb,CAIA,MAAO0B,OAAP,CACH,CAXE,EAYFmJ,GAZE,CAYE,SAASrJ,OAAT,CAAkB,CACnB,GAAIN,KAAKU,QAAT,CAAmB,CACf,GAAIkJ,MAAO9K,MAAQyK,WAAnB,CACA,GAAIK,KAAO,CAAX,CAAc,CACVtJ,QAAQkI,IAAR,CAAa,CACT/J,KAAMV,kBADG,CAETyD,MAAOxB,KAAKyB,WAFH,CAGT5C,MAAO,CACHC,MAAO8K,IADJ,CAHE,CAMTN,GAAIA,EANK,CAOTI,GAAIJ,IAAMM,MAAQ,CAPT,CAAb,EASH,CACJ,CACJ,CA3BE,EA4BF/K,KA5BE,EAAP,CA6BH,CAnHL,EAoHKkH,IApHL,CAoHU,UAAW,CACb,KAAKM,KAAL,GAAawD,MAAb,CAAoB,MAApB,CAA4B,UAAW,CACnC,MAAO,MAAKC,aAAL,CAAmB,aAAnB,CAAP,CACH,CAFD,EAEG3J,IAFH,CAEQ,OAFR,CAEiB,KAFjB,EAGK4F,IAHL,CAGU,UAAW,CACb,GAAI/F,KAAK0I,WAAT,CAAsB,CAClB,KAAKR,EAAL,CAAQ,OAAR,CAAiB,SAAS5J,CAAT,CAAY6J,QAAZ,CAAsBC,QAAtB,CAAgC,CAC7C,GAAI2B,SAAU/B,KAAKjI,IAAL,GAAYqI,QAAZ,CAAd,CACI4B,WAAa,CACT1B,WAAYhK,EAAEkD,KADL,CADjB,CAKA,GAAIxC,gBAAgBV,CAAhB,CAAJ,CAAwB,CACpB0L,WAAWvB,SAAX,CAAuB,QAAvB,CACH,CAFD,IAEO,IAAIzI,KAAKI,WAAT,CAAsB,CACzB4J,WAAWzB,MAAX,CAAoB,CAACnK,OAAOE,CAAP,CAAD,CAAY4I,OAAOlJ,YAAYM,CAAZ,EAAiB0B,KAAKd,QAA7B,CAAZ,CAApB,CACA8K,WAAWvB,SAAX,CAAuB,OAAvB,CACH,CAHM,IAGA,CACHuB,WAAWzB,MAAX,CAAoB,CAACjK,EAAEG,IAAH,CAApB,CACAuL,WAAWvB,SAAX,CAAuB,OAAvB,CACH,CACDzI,KAAK0I,WAAL,CAAiB,CACbC,QAAS,CACLqB,UADK,EAEPjI,MAFO,CAEA/B,KAAKU,QAAL,CACL,CAAC,CACG4H,WAAYyB,QAAQvI,KADvB,CAEG+G,OAAQ,CAACwB,QAAQtL,IAAT,CAFX,CAGGgK,UAAW,OAHd,CAAD,CADK,CAKA,EAPA,CADI,CAAjB,EAWH,CA1BD,EA2BA,KAAKnB,OAAL,CAAa,WAAb,CAA0B,IAA1B,EACH,CACJ,CAlCL,EAmCKnH,IAnCL,CAmCU,OAnCV,CAmCmBH,KAAKc,YAAL,CAAoB,CAApB,CAAwBmJ,OAnC3C,EAoCK9J,IApCL,CAoCU,GApCV,CAoCeH,KAAKc,YAAL,CAAoBoJ,GAApB,CAA0B,SAAS5L,CAAT,CAAY,CAAE,MAAOkF,oBAAP,CAA6B,CApCpF,EAqCKrD,IArCL,CAqCU,GArCV,CAqCe,CArCf,EAsCKA,IAtCL,CAsCU,QAtCV,CAsCoBH,KAAKc,YAAL,CAAoBqJ,QAApB,CAA+B,CAtCnD,EAuCKvC,KAvCL,CAuCW,MAvCX,CAuCmB,SAAStJ,CAAT,CAAY,CAAE,MAAO0B,MAAKU,QAAL,CAAgB8B,WAAWpE,OAAOE,CAAP,CAAX,CAAhB,CAAwCmE,OAAO,CAAP,CAA/C,CAA2D,CAvC5F,EAwCKyF,EAxCL,CAwCQ,WAxCR,CAwCqB,SAAS5J,CAAT,CAAY,CAAEqI,IAAIyD,IAAJ,CAAS9L,CAAT,CAAY,IAAZ,EAAoB,CAxCvD,EAyCK4J,EAzCL,CAyCQ,UAzCR,CAyCoBvB,IAAI0D,IAzCxB,EA0CKnC,EA1CL,CA0CQ,WA1CR,CA0CqBvB,IAAI0D,IA1CzB,EA4CA,KAAKzC,KAAL,CAAW,MAAX,CAAmB,SAAStJ,CAAT,CAAY,CAAE,MAAO0B,MAAKU,QAAL,CAAgB8B,WAAWpE,OAAOE,CAAP,CAAX,CAAhB,CAAwCmE,OAAO,CAAP,CAA/C,CAA2D,CAA5F,EAEA,KAAK6H,IAAL,GAAYC,MAAZ,GACH,CApKL,EAsKAvC,KAAKP,IAAL,CAAU,UAAW,CACjB/I,GAAGmH,MAAH,CAAU,IAAV,EACKE,IADL,CACU,UAAW,CACb,KAAKF,MAAL,CAAY,MAAZ,EACK1F,IADL,CACU,OADV,CACmBH,KAAKc,YAAL,CAAoBkC,KAApB,CAA4BiH,OAD/C,EAEK9J,IAFL,CAEU,GAFV,CAEe,CAFf,EAGKA,IAHL,CAGU,QAHV,CAGoBH,KAAKc,YAAL,CAAoBqJ,QAApB,CAA+BlH,MAHnD,EAIA,KAAK4C,MAAL,CAAY,gBAAZ,EACK1F,IADL,CACU,GADV,CACe+J,GADf,EAEK/J,IAFL,CAEU,OAFV,CAEmB,SAAS7B,CAAT,CAAY,CACvB,MAAO2G,YAAWrG,QAAQN,CAAR,CAAX,CAAP,CACH,CAJL,EAKK6B,IALL,CAKU,QALV,CAKoBgK,QALpB,EAMA,KAAKtE,MAAL,CAAY,iBAAZ,EACK1F,IADL,CACU,GADV,CACe,SAAS7B,CAAT,CAAY,CACnB,MAAO2G,YAAWrG,QAAQN,CAAR,CAAX,CAAP,CACH,CAHL,EAIK6B,IAJL,CAIU,GAJV,CAIe+J,GAJf,EAKK/J,IALL,CAKU,OALV,CAKmB,SAAS7B,CAAT,CAAY,CACvB,GAAIkM,GAAIvF,WAAWnC,KAAX,EAAR,CACA,MAAO0H,GAAE,CAAF,EAAOA,EAAE,CAAF,CAAP,CAAcvF,WAAWrG,QAAQN,CAAR,CAAX,CAArB,CACH,CARL,EASK6B,IATL,CASU,QATV,CASoBgK,QATpB,EAUA,KAAKtE,MAAL,CAAY,SAAZ,EAAuBE,IAAvB,CAA4B0E,UAA5B,EACA,KAAK5E,MAAL,CAAY,SAAZ,EAAuBE,IAAvB,CAA4B0E,UAA5B,EAEA,QAASA,WAAT,EAAsB,CAClB,KAAKlE,IAAL,CAAU,SAASjI,CAAT,CAAY,CACd,MAAO0B,MAAK8E,WAAL,CAAiBxG,CAAjB,CAAP,CACH,CAFL,EAGK6B,IAHL,CAGU,IAHV,CAGgB,SAAS7B,CAAT,CAAY,CACpB,MAAO,IAAK,CAAL,CAAS6L,SAAS7L,CAAT,EAAc,CAA9B,CACH,CALL,EAMH,CACJ,CAjCL,EAkCH,CAnCD,EAqCA0J,KAAKxB,UAAL,GAAkBC,QAAlB,CAA2BzG,KAAK0G,mBAAhC,EACKvG,IADL,CACU,WADV,CACuB8H,cADvB,EAEKnC,SAFL,CAEe,UAFf,EAGK8B,KAHL,CAGW,SAHX,CAGsB,SAAStJ,CAAT,CAAY,CAC1B,GAAI0B,KAAKU,QAAT,CAAmB,OACnB,MAAOsE,aAAYpG,QAAQN,CAAR,CAAZ,CAAP,CACH,CANL,EAOK6B,IAPL,CAOU,OAPV,CAOmB8J,OAPnB,EAQK9J,IARL,CAQU,GARV,CAQe+J,GARf,EASK/J,IATL,CASU,GATV,CASeuK,GATf,EAUKvK,IAVL,CAUU,QAVV,CAUoBgK,QAVpB,EAWAnC,KAAKsC,IAAL,GAAYC,MAAZ,GAEA,QAASN,QAAT,CAAiB3L,CAAjB,CAAoB,CAChB,GAAI0B,KAAKc,YAAT,CAAuB,CACnB,MAAOmE,YAAW3G,EAAEoL,EAAb,EAAmBzE,WAAW3G,EAAEgL,EAAb,CAA1B,CACH,CAED,GAAItJ,KAAKI,WAAT,CAAsB,CAClB,GAAI4D,OAAJ,CAAa,CACT,GAAI2G,aAAczF,UAAUrC,MAAV,GAAmB,CAAnB,EAAsB4B,OAAtB,EAAlB,CACA,MAAOpB,MAAKuB,GAAL,CAAS,CAAT,CAAYM,UAAU,GAAI3G,KAAJ,CAASoM,YAAc3K,KAAKd,QAA5B,CAAV,EAAmDgG,UAAUyF,WAAV,CAA/D,CAAP,CACH,CAHD,IAGO,CACH,MAAOtH,MAAKuB,GAAL,CAAS,CAAT,CAAYM,UAAUA,UAAUrC,MAAV,GAAmB,CAAnB,EAAwB7C,KAAKd,QAAvC,CAAZ,CAAP,CACH,CACJ,CAPD,IAOO,CACH,MAAOgG,WAAUe,SAAV,CAAoB3H,CAApB,CAAP,CACH,CACJ,CAED,QAAS6L,SAAT,CAAkB7L,CAAlB,CAAqB,CACjB,GAAI0B,KAAKc,YAAT,CAAuB,CACnB,GAAId,KAAKI,WAAT,CAAsB,CAClB,GAAI4D,OAAJ,CAAa,CACT,GAAI2G,aAAczF,UAAUrC,MAAV,GAAmB,CAAnB,EAAsB4B,OAAtB,EAAlB,CACA,MAAOpB,MAAKuB,GAAL,CAAS,CAAT,CAAYM,UAAU,GAAI3G,KAAJ,CAASoM,YAAc3K,KAAKd,QAA5B,CAAV,EAAmDgG,UAAUyF,WAAV,CAA/D,CAAP,CACH,CAHD,IAGO,CACH,MAAOtH,MAAKuB,GAAL,CAAS,CAAT,CAAYM,UAAUlF,KAAKd,QAAf,CAAZ,CAAP,CACH,CACJ,CAPD,IAOO,CACH,MAAOgG,WAAUe,SAAV,CAAoB3H,CAApB,CAAP,CACH,CACJ,CACD,MAAO2G,YAAW3G,EAAEgL,EAAb,EAAmBrE,WAAW3G,EAAEoL,EAAb,CAA1B,CACH,CAED,QAASgB,IAAT,CAAapM,CAAb,CAAgB,CACZ,GAAI0B,KAAKc,YAAT,CAAuB,CACnB,MAAOmE,YAAW3G,EAAEgL,EAAb,CAAP,CACH,CACD,MAAO,EAAP,CACH,CAED,QAASY,IAAT,CAAa5L,CAAb,CAAgB,CACZ,GAAI0B,KAAKc,YAAT,CAAuB,CACnB,MAAOoE,WAAU5G,EAAEoL,EAAZ,CAAP,CACH,CACD,MAAOzE,YAAW3G,EAAEoL,EAAb,CAAP,CAEH,CAED,QAASzB,eAAT,CAAwB3J,CAAxB,CAA2B,CACvB,GAAIsM,QAAS1F,UAAUlF,KAAKI,WAAL,CAAmBpC,YAAYM,CAAZ,CAAnB,CAAoC0B,KAAK8E,WAAL,CAAiBxG,CAAjB,CAA9C,CAAb,CACA,GAAI0B,KAAKc,YAAT,CAAuB,CACnB,MAAO,eAAiB8J,MAAjB,CAA0B,GAAjC,CACH,CACD,MAAO,aAAeA,MAAf,CAAwB,KAA/B,CACH,CAED,QAAS/C,iBAAT,CAA0BtB,IAA1B,CAAgCvD,KAAhC,CAAuC,CACnCuD,KAAKkB,IAAL,CAAU,UAAW,CACjB,GAAIoD,QAASnM,GAAGmH,MAAH,CAAU,IAAV,CAAb,CACA,GAAIiF,YAAaD,OAAOzI,IAAP,GAAc2I,qBAAd,EAAjB,CACA,GAAIxE,MAAOsE,OAAOtE,IAAP,EAAX,CAEA,MAAOuE,WAAa9H,KAAb,EAAsBuD,KAAK1F,MAAL,CAAc,CAA3C,CAA8C,CAC1C0F,KAAOA,KAAK3C,KAAL,CAAW,CAAX,CAAc,CAAC,CAAf,CAAP,CACAiH,OAAOtE,IAAP,CAAYA,KAAO,KAAnB,EACAuE,WAAaD,OAAOzI,IAAP,GAAc2I,qBAAd,EAAb,CACH,CACJ,CAVD,EAWH,CACJ,CAvcD,CAwcH,CACJ,CA5jBD","file":"bar.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/vertex/formatters',\n    'util/requirejs/promise!util/service/ontologyPromise',\n    './withRenderer'\n], function(\n    defineComponent,\n    F,\n    ontology,\n    withRenderer) {\n    'use strict';\n\n    const barCss = `\n        .axis path, .axis .tick line {\n          fill: none;\n          stroke: #767676;\n          stroke-width: 1px;\n        }\n        .axis text {\n            fill: #767676;\n        }\n        text {\n          font-family: HelveticaNeue, AvenirNext-Medium, Arial;\n        }\n    `;\n    const MAX_ROWS = 10;\n    const BAR_OTHER_CATEGORY = 'BAR_OTHER_CATEGORY';\n    const nameAsFloat = _.compose(floatFn, nameFn);\n    const nameAsDate = function(d) {\n        return new Date(parseInt(d.name, 10))\n    };\n\n    var d3;\n\n    return defineComponent(StackedBar, withRenderer);\n\n    function countFn(d) {\n        return d.value.count;\n    }\n\n    function nameFn(d) {\n        return d.name;\n    }\n\n    function floatFn(d) {\n        return parseFloat(d, 10);\n    }\n\n    function isOtherCategory(d) {\n        return nameFn(d) === BAR_OTHER_CATEGORY;\n    }\n\n    function tickFormatInterval(interval) {\n        return function(d) {\n            if (_.isDate(d)) {\n                var months = 1000 * 60 * 60 * 24 * 30,\n                    years = months * 12;\n                if (interval > years) {\n                    return d.getFullYear();\n                }\n                return F.date.dateString(d);\n            }\n\n            return d;\n        }\n    }\n\n    function tickFormat(d) {\n        if (_.isDate(d)) {\n            return F.date.dateString(d);\n        } else if (_.isNumber(d)) {\n            if (d >= 1000) {\n                return F.number.prettyApproximate(d);\n            }\n            return d3.format('d')(d);\n        }\n        return d;\n    }\n\n    function StackedBar() {\n\n        this.processData = function(data) {\n            var self = this,\n                root = data.root[0],\n                report = this.attr.report;\n\n            this.isHistogram = root.type === 'histogram';\n\n            var buckets = _.sortBy(root.buckets, function(d) {\n                    if ('count' in d.value) {\n                        return self.isHistogram ? nameFn(d) : countFn(d);\n                    }\n                }),\n                bucket = _.first(root.buckets);\n\n            this.isNested = Boolean(bucket && bucket.value.nested && bucket.value.nested.length);\n            this.isHorizontal = this.attr.item.configuration.reportRenderer === 'org-openlumify-bar-horizontal';\n\n            var reportAggregations = report.endpointParameters.aggregations.map(JSON.parse);\n            this.field = reportAggregations[0].field;\n            if (this.isNested) {\n                this.nestedField = reportAggregations[0].nested[0].field;\n                this.nestedCategories = _.unique(_.flatten(root.buckets.map(function(d) {\n                    return _.pluck(d.value.nested, 'name');\n                }))).sort().concat([BAR_OTHER_CATEGORY]);\n            }\n\n            if (this.isHistogram) {\n                this.interval = root.interval;\n                return _.sortBy(buckets, nameAsFloat);\n            }\n\n            return buckets.reverse();\n        };\n\n        this.render = function renderStackedBar(_d3, node, data, d3tip) {\n            d3 = _d3;\n\n            var $node = $(node),\n                colorScale = this.colorScale,\n                colors = this.colors;\n\n            if (!data || !data.length) {\n                $node.empty();\n                return;\n            }\n\n            if (this.isNested) {\n                colorScale = d3.scale.category20();\n                colorScale.domain(this.nestedCategories);\n                colors = colorScale.range();\n            }\n\n            var self = this,\n                padding = 10,\n                width = $node.width(),\n                height = $node.height() - padding,\n                heightXAxis = 20,\n                heightDifference = height - heightXAxis,\n                heightTruncated = heightDifference > 0 ? Math.floor(heightDifference) : Math.ceil(heightDifference),\n                xAxisVerticalOffset = heightTruncated + 0.5,\n                yAxisWidth = 30,\n                report = this.attr.report,\n                numBars = this.isHistogram ? data.length : this.isHorizontal ? height / heightXAxis : MAX_ROWS,\n                dataSlice = data.slice(0, numBars),\n                ontologyProperty = ontology.properties.byTitle[this.field],\n                isDates = ontologyProperty && ontologyProperty.dataType === 'date',\n                yScale = d3.scale.linear()\n                            .domain([0, d3.extent(dataSlice, countFn)[1]])\n                            .range([height - heightXAxis, 0]),\n                xData = this.isHistogram && _.map(dataSlice, isDates ? nameAsDate : nameAsFloat),\n                xScale = this.isHistogram ?\n                    isDates ?\n                        d3.time.scale()\n                            .domain([xData[0], new Date(_.last(xData).getTime() + self.interval)])\n                            .range([0, width - yAxisWidth - 2 * this.CHART_PADDING]) :\n                        d3.scale.linear()\n                            .domain([d3.min(xData), d3.max(xData) + self.interval])\n                            .range([0, width - yAxisWidth - 2 * this.CHART_PADDING]) :\n                        d3.scale.ordinal()\n                            .domain(_.map(dataSlice, self.displayName))\n                            .rangeRoundBands([0, width - yAxisWidth - 2 * this.CHART_PADDING], 0.05),\n                xColorScale = d3.scale.linear()\n                    .range([0.3, 1.0])\n                    .domain(yScale.domain()),\n                countScale = yScale,\n                dataScale = xScale;\n\n            if (this.isHorizontal) {\n                var tmpScale = xScale;\n                xScale = yScale;\n                yScale = tmpScale;\n                xScale.range([0, width - 2 * this.CHART_PADDING]);\n                if (this.isHistogram) {\n                    yScale.range([height - heightXAxis, 0]);\n                } else {\n                    yScale.rangeRoundBands([0, height - heightXAxis], 0.05);\n                }\n            }\n\n            var numTicks;\n            if (!_.isFunction(xScale.rangeRoundBands)) {\n                numTicks = Math.round(width / 50);\n            }\n            if (isDates && self.isHistogram) {\n                numTicks = Math.round(width / 110);\n            }\n\n            var xAxis = d3.svg.axis()\n                            .scale(xScale)\n                            .orient('bottom');\n            if (isDates) {\n                xAxis.tickFormat(tickFormatInterval(self.interval));\n            } else {\n                xAxis.tickFormat(tickFormat);\n            }\n            if (numTicks > 0) {\n                xAxis.ticks(numTicks);\n            }\n\n            var yAxis = d3.svg.axis()\n                            .scale(yScale)\n                            .orient('left')\n                            .tickFormat(tickFormat),\n                svg = d3.select(node).selectAll('svg').data([1]).call(function() {\n                        var band = self.isHistogram ? dataScale(dataScale.domain()[0] + self.interval) : dataScale.rangeBand(),\n                            clip = { x: band / -2, y: 0, width: band, height: 30 };\n                        this.enter()\n                            .append('svg')\n                            .call(function() {\n                                this.append('defs')\n                                    .call(function() {\n                                        this.append('style').attr('type', 'text/css').text(barCss);\n                                        this.append('clipPath').attr('id', 'xAxisLabelClip')\n                                            .append('rect')\n                                            .attr(clip)\n                                    })\n                                this.append('g')\n                                    .attr('class', 'padding')\n                                    .attr('transform', 'translate(0, ' + padding + ')');\n                            })\n                        this.attr('width', width)\n                            .attr('height', height + padding);\n                        this.attr('viewBox', null);\n                        this.select('clipPath rect').transition().duration(self.TRANSITION_DURATION).attr(clip);\n                    }).select('g.padding'),\n                tip = this.tooltip = this.tooltip || this.createTooltip(svg, d3tip,\n                    function(d) {\n                        return d3.format(self.attr.tipFormat || ',')(countFn(d));\n                    },\n                    function(d) {\n                        var label = isOtherCategory(d) ? i18n('dashboard.report.other') : self.displayName(d);\n                        return self.isHistogram ?\n                            isDates ?\n                            (F.date.dateString(nameAsDate(d)) + '-' + F.date.dateString(new Date(nameAsDate(d).getTime() + self.interval))) :\n                            (F.number.pretty(nameAsFloat(d)) + '-' + F.number.pretty(nameAsFloat(d) + self.interval)) :\n                            (String(label).length > 20 ? label.substring(0, 20) + '...' : label)\n                    }),\n                gChartArea = svg.selectAll('g.chart-area').data([1]).call(function() {\n                        var xOffset = (self.isHorizontal ? 0 : yAxisWidth) + self.CHART_PADDING;\n                        this.enter().append('g')\n                            .classed('chart-area', true)\n                            .attr('transform', 'translate(' + xOffset + ',0)');\n                    }),\n                gXAxis = gChartArea.selectAll('g.x.axis').data([1]).call(function() {\n                        this.enter().append('g')\n                            .attr('class', 'x axis')\n                            .attr('transform', 'translate(0,' + xAxisVerticalOffset + ')');\n                        this.transition().duration(self.TRANSITION_DURATION)\n                            .attr('transform', 'translate(0,' + xAxisVerticalOffset + ')')\n                            .call(xAxis)\n                            .call(function() {\n                                if (!self.isHorizontal && !self.isHistogram) {\n                                    this.selectAll('text')\n                                        .attr('clip-path', self.isHistogram ? undefined : 'url(#xAxisLabelClip)')\n                                        .each(function() {\n                                            var band = self.isHistogram ? dataScale(self.interval) - 1 : dataScale.rangeBand(),\n                                                box = this.getBoundingClientRect();\n                                            if (box.width > band) {\n                                                d3.select(this)\n                                                    .attr('dx', band / -2)\n                                                    .style('text-anchor', 'start')\n                                            } else {\n                                                d3.select(this)\n                                                    .attr('dx', null)\n                                            }\n                                        })\n                                        .each(function() {\n                                            d3.select(this)\n                                                .attr('dy', '.55em')\n                                        })\n                                        .call(overflowEllipsis, dataScale.rangeBand())\n                                }\n                            })\n                    }),\n                gYAxis = !self.isHorizontal && gChartArea.selectAll('g.y.axis').data([1]).call(function() {\n                        this.enter().append('g').attr('class', 'y axis')\n                        this.transition().duration(self.TRANSITION_DURATION).call(yAxis)\n                    }),\n                gBars = gChartArea.selectAll('g.bars').data([1]).call(function() {\n                        this.enter().append('g').classed('bars', true);\n                    });\n\n            var bars = gBars.selectAll('.bar').data(dataSlice, nameFn);\n\n            bars.enter()\n                .append('g').attr('class', 'bar')\n                .attr('transform', barTransformFn)\n                .call(function() {\n                    this.selectAll('rect.all')\n                        .data(function(d) {\n                            return [d];\n                        })\n                        .call(function() {\n                            // TODO: Fix for horizontal\n                            this.enter()\n                                .call(function() {\n                                    this.append('rect')\n                                        .attr('class', 'all')\n                                        .classed('clickable', function(d) {\n                                            return !!d.field;\n                                        })\n                                        .attr('fill', 'transparent')\n                                        .on('click', function(d, segIndex, barIndex) {\n                                            if (!d.field) return;\n\n                                            var filter = {\n                                                propertyId: d.field,\n                                                values: [nameFn(d)]\n                                            };\n\n                                            if (self.isHistogram) {\n                                                filter.values.push(String(nameAsFloat(d) + self.interval));\n                                                filter.predicate = 'range';\n                                            } else {\n                                                filter.predicate = 'equal';\n                                            }\n                                            self.handleClick({ filters: [filter] });\n                                        });\n\n                                    if (self.isHorizontal) {\n                                        var genClipPath = function(rowPart) {\n                                                return function(d, col, row) {\n                                                    return 'clip-path-' + self.attr.item.id + '-' + row + '-' + rowPart;\n                                                }\n                                            },\n                                            genClipPathRef = function(rowPart) {\n                                                return _.compose(function(pathId) {\n                                                    return 'url(#' + pathId + ')';\n                                                }, genClipPath(rowPart))\n                                            }\n\n                                        this.append('defs')\n                                            .call(function() {\n                                                this.append('clipPath')\n                                                    .attr('id', genClipPath(0))\n                                                    .append('rect').attr('class', 'clipRect')\n                                                this.append('clipPath')\n                                                    .attr('id', genClipPath(1))\n                                                    .append('rect').attr('class', 'clipRect2')\n                                            })\n\n                                        this.append('g').attr('class', 'text-label').style('opacity', 0)\n                                            .call(function() {\n                                                this.append('text')\n                                                    .attr('class', 'text-1')\n                                                    .attr('x', 5)\n                                                    .style({ fill: 'white', opacity: 1 })\n                                                    .attr('clip-path', genClipPathRef(0))\n                                                this.append('text')\n                                                    .attr('class', 'text-2')\n                                                    .attr('x', 5)\n                                                    .style({ fill: self.colors[0], opacity: 1 })\n                                                    .attr('clip-path', genClipPathRef(1))\n                                            })\n                                            .transition()\n                                            .delay(self.TRANSITION_DURATION - self.TRANSITION_DURATION / 4)\n                                            .duration(self.TRANSITION_DURATION / 4)\n                                            .style('opacity', 1)\n                                    } else {\n                                        this.append('g').attr('class', 'text-label')\n                                    }\n                                })\n\n                        })\n                })\n                .selectAll('rect.seg')\n                .data(function(d) {\n                    var y0 = 0,\n                        count = d.value.count,\n                        nestedCount = 0;\n                    return _.chain(self.isNested ? d.value.nested : [d])\n                        .sortBy(function(d) {\n                            return d.value.count * -1;\n                        })\n                        .map(function(d) {\n                            nestedCount += d.value.count;\n                            var bucket = _.extend({}, d, {\n                                y0: y0,\n                                y1: y0 += d.value.count || 0\n                            });\n                            return bucket;\n                        })\n                        .tap(function(buckets) {\n                            if (self.isNested) {\n                                var diff = count - nestedCount;\n                                if (diff > 0) {\n                                    buckets.push({\n                                        name: BAR_OTHER_CATEGORY,\n                                        field: self.nestedField,\n                                        value: {\n                                            count: diff\n                                        },\n                                        y0: y0,\n                                        y1: y0 += diff || 0\n                                    })\n                                }\n                            }\n                        })\n                        .value()\n                })\n                .call(function() {\n                    this.enter().insert('rect', function() {\n                        return this.querySelector('.text-label');\n                    }).attr('class', 'seg')\n                        .call(function() {\n                            if (self.handleClick) {\n                                this.on('click', function(d, segIndex, barIndex) {\n                                    var barData = bars.data()[barIndex],\n                                        thisFilter = {\n                                            propertyId: d.field\n                                        };\n\n                                    if (isOtherCategory(d)) {\n                                        thisFilter.predicate = 'hasNot';\n                                    } else if (self.isHistogram) {\n                                        thisFilter.values = [nameFn(d), String(nameAsFloat(d) + self.interval)];\n                                        thisFilter.predicate = 'range';\n                                    } else {\n                                        thisFilter.values = [d.name];\n                                        thisFilter.predicate = 'equal';\n                                    }\n                                    self.handleClick({\n                                        filters: [\n                                            thisFilter\n                                        ].concat(self.isNested ?\n                                            [{\n                                                propertyId: barData.field,\n                                                values: [barData.name],\n                                                predicate: 'equal'\n                                            }] : []\n                                        )\n                                    });\n                                });\n                                this.classed('clickable', true);\n                            }\n                        })\n                        .attr('width', self.isHorizontal ? 0 : widthFn)\n                        .attr('y', self.isHorizontal ? yFn : function(d) { return xAxisVerticalOffset; })\n                        .attr('x', 0)\n                        .attr('height', self.isHorizontal ? heightFn : 0)\n                        .style('fill', function(d) { return self.isNested ? colorScale(nameFn(d)) : colors[0]; })\n                        .on('mouseover', function(d) { tip.show(d, this); })\n                        .on('mouseout', tip.hide)\n                        .on('mousedown', tip.hide)\n\n                    this.style('fill', function(d) { return self.isNested ? colorScale(nameFn(d)) : colors[0]; })\n\n                    this.exit().remove();\n                })\n\n            bars.each(function() {\n                d3.select(this)\n                    .call(function() {\n                        this.select('.all')\n                            .attr('width', self.isHorizontal ? width : widthFn)\n                            .attr('y', 0)\n                            .attr('height', self.isHorizontal ? heightFn : height)\n                        this.select('defs .clipRect')\n                            .attr('y', yFn)\n                            .attr('width', function(d) {\n                                return countScale(countFn(d));\n                            })\n                            .attr('height', heightFn)\n                        this.select('defs .clipRect2')\n                            .attr('x', function(d) {\n                                return countScale(countFn(d));\n                            })\n                            .attr('y', yFn)\n                            .attr('width', function(d) {\n                                var r = countScale.range();\n                                return r[1] - r[0] - countScale(countFn(d));\n                            })\n                            .attr('height', heightFn)\n                        this.select('.text-1').call(updateText)\n                        this.select('.text-2').call(updateText)\n\n                        function updateText() {\n                            this.text(function(d) {\n                                    return self.displayName(d);\n                                })\n                                .attr('dy', function(d) {\n                                    return 16 / 4 + heightFn(d) / 2;\n                                })\n                        }\n                    })\n            })\n\n            bars.transition().duration(self.TRANSITION_DURATION)\n                .attr('transform', barTransformFn)\n                .selectAll('rect.seg')\n                .style('opacity', function(d) {\n                    if (self.isNested) return;\n                    return xColorScale(countFn(d));\n                })\n                .attr('width', widthFn)\n                .attr('y', yFn)\n                .attr('x', xFn)\n                .attr('height', heightFn);\n            bars.exit().remove();\n\n            function widthFn(d) {\n                if (self.isHorizontal) {\n                    return countScale(d.y1) - countScale(d.y0);\n                }\n\n                if (self.isHistogram) {\n                    if (isDates) {\n                        var initialDate = dataScale.domain()[0].getTime();\n                        return Math.max(1, dataScale(new Date(initialDate + self.interval)) - dataScale(initialDate));\n                    } else {\n                        return Math.max(1, dataScale(dataScale.domain()[0] + self.interval))\n                    }\n                } else {\n                    return dataScale.rangeBand(d);\n                }\n            }\n\n            function heightFn(d) {\n                if (self.isHorizontal) {\n                    if (self.isHistogram) {\n                        if (isDates) {\n                            var initialDate = dataScale.domain()[0].getTime();\n                            return Math.max(1, dataScale(new Date(initialDate + self.interval)) - dataScale(initialDate));\n                        } else {\n                            return Math.max(1, dataScale(self.interval))\n                        }\n                    } else {\n                        return dataScale.rangeBand(d);\n                    }\n                }\n                return countScale(d.y0) - countScale(d.y1);\n            }\n\n            function xFn(d) {\n                if (self.isHorizontal) {\n                    return countScale(d.y0)\n                }\n                return 0;\n            }\n\n            function yFn(d) {\n                if (self.isHorizontal) {\n                    return dataScale(d.y1)\n                }\n                return countScale(d.y1);\n\n            }\n\n            function barTransformFn(d) {\n                var offset = dataScale(self.isHistogram ? nameAsFloat(d) : self.displayName(d));\n                if (self.isHorizontal) {\n                    return 'translate(0,' + offset + ')';\n                }\n                return 'translate(' + offset + ',0)';\n            }\n\n            function overflowEllipsis(text, width) {\n                text.each(function() {\n                    var textEl = d3.select(this);\n                    var textLength = textEl.node().getComputedTextLength();\n                    var text = textEl.text();\n\n                    while (textLength > width && text.length > 0) {\n                        text = text.slice(0, -1);\n                        textEl.text(text + '...');\n                        textLength = textEl.node().getComputedTextLength();\n                    }\n                });\n            }\n        };\n    }\n});\n"]}