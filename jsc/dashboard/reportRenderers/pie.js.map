{"version":3,"sources":["../../../js/dashboard/reportRenderers/pie.js"],"names":["define","defineComponent","F","ontology","withRenderer","pieCss","PIE_OTHER_CATEGORY","nameAsFloat","_","compose","floatFn","nameFn","nameAsDate","d","Date","parseInt","Pie","isOtherCategory","clickableFn","countFn","data","value","count","percentageFn","percentage","labelFn","label","name","parseFloat","processData","self","report","attr","root","buckets","totalValue","reduce","memo","partitionedData","chain","map","b","copy","extend","partition","numBuckets","length","isHistogram","type","reportAggregations","endpointParameters","aggregations","JSON","parse","field","ontologyProperty","properties","byTitle","isDates","dataType","sortedData","sortBy","reverse","push","tap","otherSlice","otherValue","displayName","i18n","numLabels","render","renderPieChart","d3","node","d3tip","$node","$","empty","date","dateString","getTime","aggregation","interval","join","number","pretty","width","height","radius","Math","min","CHART_PADDING","pie","layout","sort","svg","select","selectAll","call","enter","append","text","gPie","slices","gLegend","size","classed","gLabels","bind","tip","tooltip","createTooltip","format","tipFormat","labelLimit","transition","duration","TRANSITION_DURATION","i","colors","OTHER_COLOR_INDEX","each","_current","startAngle","endAngle","padAngle","on","hide","show","highlightColors","$tip","style","left","event","pageX","top","pageY","attrTween","a","ia","interpolate","ir","t","arc","outerRadius","exit","remove","labelTransform","LEGEND_LABEL_HEIGHT","LEGEND_COLOR_SWATCH_SIZE","LEGEND_SWATCH_TO_TEXT_MARGIN","n","order","maxLabels","floor","legendInfoItem","hiddenBuckets","hidden","gLabelXOffset","availableLegendSpace","availableLegendTextWidth","getBBox","d3Self","substring","handleClick","filter","propertyId","values","predicate","console","info","String","filters","object"],"mappings":"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","file":"pie.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/formatters',\n    'util/requirejs/promise!util/service/ontologyPromise',\n    './withRenderer'\n], function(\n    defineComponent,\n    F,\n    ontology,\n    withRenderer) {\n    'use strict';\n\n    const pieCss = `\n        .legend text { font-family: HelveticaNeue, AvenirNext-Medium, Arial; font-size: 90%; font-weight: normal; fill: #555; }\n        .legend-item.hidden, .legend-info.hidden { display: none; }\n    `;\n    const PIE_OTHER_CATEGORY = 'PIE_OTHER_CATEGORY',\n        nameAsFloat = _.compose(floatFn, nameFn),\n        nameAsDate = function(d) {\n            return new Date(parseInt(nameFn(d), 10))\n        };\n\n    return defineComponent(Pie, withRenderer);\n\n    function isOtherCategory(d) {\n        return nameFn(d) === PIE_OTHER_CATEGORY;\n    }\n\n    function clickableFn(d) {\n        return !isOtherCategory(d);\n    }\n\n    function countFn(d) {\n        return (d.data || d).value.count;\n    }\n\n    function percentageFn(d) {\n        return (d.data || d).value.percentage;\n    }\n\n    function labelFn(d) {\n        return (d.data || d).label;\n    }\n\n    function nameFn(d) {\n        return (d.data || d).name;\n    }\n\n    function floatFn(d) {\n        return parseFloat(d, 10);\n    }\n\n    function Pie() {\n\n        this.processData = function(data) {\n            var self = this,\n                report = this.attr.report,\n                root = data.root[0],\n                buckets = root.buckets,\n                totalValue = _.reduce(buckets, function(memo, d) { return memo + countFn(d) }, 0),\n                partitionedData = _.chain(buckets)\n                    .map(function(b) {\n                        var copy = _.extend({}, b);\n                        copy.value = _.extend({}, copy.value, { percentage: countFn(b) / totalValue });\n                        return copy;\n                    })\n                    .partition(function(d) {\n                        return percentageFn(d) > 0.05;\n                    })\n                    .value();\n\n            this.numBuckets = buckets.length;\n            this.isHistogram = root.type === 'histogram';\n            var reportAggregations = report.endpointParameters.aggregations.map(JSON.parse);\n            this.field = reportAggregations[0].field;\n            var ontologyProperty = ontology.properties.byTitle[this.field];\n            this.isDates = ontologyProperty && ontologyProperty.dataType === 'date';\n\n            var sortedData = this.isHistogram ?\n                _.sortBy(partitionedData[0], nameAsFloat) :\n                _.sortBy(partitionedData[0], countFn).reverse();\n\n            if (partitionedData[1].length) {\n                sortedData.push(_.tap({ value: {}, name: '' }, function(otherSlice) {\n                    var otherValue = _.reduce(partitionedData[1], function(memo, d) { return memo + countFn(d); }, 0);\n                    otherSlice.field = data.root[0].field;\n                    otherSlice.value.percentage = otherValue / totalValue;\n                    otherSlice.value.count = otherValue;\n                    otherSlice.name = PIE_OTHER_CATEGORY;\n                    otherSlice.displayName = i18n('dashboard.report.other');\n                }));\n            }\n            this.numLabels = sortedData.length;\n\n            return sortedData;\n        };\n\n        this.render = function renderPieChart(d3, node, data, d3tip) {\n            var $node = $(node);\n            if (!data || !data.length) {\n                $node.empty();\n                return;\n            }\n\n            var self = this,\n                displayName = function(d) {\n                    if (self.isHistogram) {\n                        if (labelFn(d)) {\n                            return labelFn(d);\n                        } else if (isOtherCategory(d)) {\n                            return d.data.displayName;\n                        } else if (self.isDates) {\n                            return [\n                                F.date.dateString(nameAsDate(d)),\n                                F.date.dateString(new Date(nameAsDate(d).getTime() + self.aggregation.interval))\n                            ].join('-')\n                        } else {\n                            return [\n                                F.number.pretty(parseFloat(nameFn(d))),\n                                F.number.pretty(parseFloat(nameFn(d)) + self.aggregation.interval)\n                            ].join('-')\n                        }\n                    }\n                    return d.data.displayName || self.aggregation.displayName(d.data);\n                },\n                width = $node.width(),\n                height = $node.height(),\n                report = this.attr.report,\n                radius = (Math.min(width, height) - this.CHART_PADDING) / 2,\n                pie = d3.layout.pie().sort(null).value(countFn)(data),\n                svg = d3.select(node).selectAll('svg').data([1]).call(function() {\n                    this.enter().append('svg');\n                    this.attr('width', width).attr('height', height);\n                    this.append('defs').append('style').attr('type', 'text/css').text(pieCss);\n                }),\n                gPie = svg.selectAll('g').data([1]).call(function() {\n                        this.enter().append('g')\n                            .attr('transform', 'translate(' + radius + ',' + radius + ')');\n                    }),\n                slices = gPie.selectAll('path').data(pie),\n                gLegend = svg.select('.legend').size() ? svg.select('.legend') : svg.append('g').classed('legend', true),\n                gLabels = gLegend.selectAll('.legend-item').data(pie, displayName.bind(this)),\n                tip = this.tooltip = this.tooltip || this.createTooltip(svg, d3tip, function(d) {\n                        return d3.format('%')(percentageFn(d)) +\n                            ' (' +\n                            d3.format(self.attr.tipFormat || ',')(countFn(d)) +\n                            ')';\n                    },\n                    function(d) {\n                        var label = displayName(d),\n                            labelLimit = 25;\n                        return label;\n                    }\n                );\n\n            gPie.transition()\n                .duration(self.TRANSITION_DURATION)\n                .attr('transform', 'translate(' + radius + ',' + radius + ')');\n\n            slices.enter().append('path')\n                    .attr('fill', function(d, i) { return self.colors[isOtherCategory(d) ? self.OTHER_COLOR_INDEX : i]; })\n                    .each(function(d) {\n                        this._current = { startAngle: 0, endAngle: 0, padAngle: 0, radius: radius };\n                    })\n                    .on('mousedown', tip.hide)\n                    .on('mouseout', function(d, i) {\n                        tip.hide();\n                        d3.select(this).attr('fill', self.colors[isOtherCategory(d) ? self.OTHER_COLOR_INDEX : i]);\n                    })\n                    .on('mouseover', function(d, i) {\n                        tip.show(d, gPie[0][0]);\n                        d3.select(this).attr('fill', self.highlightColors[isOtherCategory(d) ? self.OTHER_COLOR_INDEX : i]);\n\n                    })\n                    .on('mousemove', function() {\n                        var $tip = $('#' + tip.attr('id'));\n                        tip.style({left: event.pageX - ($tip.width() / 1.5) + 'px', top: event.pageY - ($tip.height() * 1.75) + 'px'});\n                    });\n\n            slices.transition().duration(self.TRANSITION_DURATION)\n                    .attrTween('d', function(a) {\n                        var ia = d3.interpolate(this._current, a),\n                            ir = d3.interpolate(this._current.radius, radius);\n                        this._current = _.extend(a, { radius: radius });\n                        return function(t) {\n                            return d3.svg.arc().outerRadius(ir(t))(ia(t));\n                        };\n                    });\n\n            slices.exit().remove();\n\n            var labelTransform = function(d, i) {\n                return 'translate(0,' + (i * self.LEGEND_LABEL_HEIGHT) + ')';\n            };\n\n            gLabels.enter().append('g').classed('legend-item', true)\n                .call(function() {\n                   this.append('text')\n                       .attr('x', self.LEGEND_COLOR_SWATCH_SIZE + self.LEGEND_SWATCH_TO_TEXT_MARGIN)\n                       .style('text-anchor', 'start')\n                       .text(displayName.bind(self));\n                   this.append('rect')\n                        .attr({ width: self.LEGEND_COLOR_SWATCH_SIZE, height: self.LEGEND_COLOR_SWATCH_SIZE})\n                        .attr('y', -self.LEGEND_COLOR_SWATCH_SIZE);\n                })\n                .attr('transform', labelTransform)\n                .style('opacity', 0)\n                .on('mousedown', tip.hide)\n                .on('mouseout', function(d, i, n) {\n                    tip.hide();\n                    d3.select(slices[0][i]).attr('fill', self.colors[isOtherCategory(d) ? self.OTHER_COLOR_INDEX : i]);\n                })\n                .on('mouseover', function(d, i, n) {\n                    tip.show(d, gPie[0][0]);\n                    d3.select(slices[0][i]).attr('fill', self.highlightColors[isOtherCategory(d) ? self.OTHER_COLOR_INDEX : i]);\n                });\n\n            gLabels.exit().transition().duration(self.TRANSITION_DURATION)\n                .style('opacity', 0)\n                .remove();\n\n            gLabels.order().transition().duration(self.TRANSITION_DURATION)\n                .style('opacity', 1)\n                .attr('transform', labelTransform)\n                .selectAll('rect')\n                .style('fill', function(d, i, n) {\n                    return self.colors[isOtherCategory(d) ? self.OTHER_COLOR_INDEX : n];\n                });\n\n            var maxLabels = (Math.floor(height / self.LEGEND_LABEL_HEIGHT) - 1);\n            gLabels.classed('hidden', function(d, i) {\n                return i >= maxLabels;\n            });\n\n            if (this.numLabels > maxLabels) {\n                var legendInfoItem = gLegend.select('.legend-info');\n                var hiddenBuckets = this.numBuckets - maxLabels;\n\n                if (!legendInfoItem.empty()) {\n                    legendInfoItem.classed('hidden', false)\n                        .select('text').text(i18n('dashboard.report.pie.more', hiddenBuckets));\n                } else {\n                    gLegend.append('g')\n                       .classed({ 'legend-info': true, hidden: false })\n                       .attr('transform', function(d) {\n                           return labelTransform(d, maxLabels);\n                       })\n                       .style('opacity', 0)\n                       .append('text')\n                       .text(i18n('dashboard.report.pie.more', hiddenBuckets))\n                       .attr('x', self.LEGEND_COLOR_SWATCH_SIZE + self.LEGEND_SWATCH_TO_TEXT_MARGIN)\n                       .style('text-anchor', 'start');\n                }\n                gLegend.select('.legend-info').transition().duration(self.TRANSITION_DURATION)\n                    .style('opacity', 1)\n\n            } else {\n                gLegend.select('.legend-info').classed('hidden', true);\n            }\n\n            var gLabelXOffset = 2 * radius + self.CHART_PADDING,\n                availableLegendSpace = width - self.CHART_PADDING - gLabelXOffset,\n                availableLegendTextWidth = availableLegendSpace - self.LEGEND_COLOR_SWATCH_SIZE - self.LEGEND_SWATCH_TO_TEXT_MARGIN;\n            gLegend.attr('transform', 'translate(' + gLabelXOffset + ',' + self.CHART_PADDING + ')');\n            if (availableLegendTextWidth < 10 /* 10 is a totally arbitrary min width */) {\n                gLegend.style('opacity', 0);\n            } else {\n                gLegend.style('opacity', 1);\n                if (gLegend.node().getBBox().width > availableLegendSpace) {\n                    gLegend.selectAll('g:not(.hidden) > text').each(function(d) {\n                        var d3Self = d3.select(this),\n                            text = d3.select(this).text();\n                        while (text.length > 0 && this.getBBox().width > availableLegendTextWidth) {\n                            text = text.substring(0, text.length - 1);\n                            d3Self.text(text + '...');\n                        }\n                    });\n                } else {\n                    gLabels.selectAll('text').text(displayName.bind(self));\n                }\n            }\n\n            if (this.handleClick) {\n                slices.on('click', function(d) {\n                    var filter = {\n                        propertyId: d.data.field,\n                        values: [nameFn(d)],\n                        predicate: 'equal'\n                    }\n                    if (isOtherCategory(d)) {\n                        console.info('Unable to search on other list', d.data.field);\n                        return;\n                    } else if (self.isHistogram) {\n                        filter.values.push(String(nameAsFloat(d) + self.aggregation.interval));\n                        filter.predicate = 'range';\n                    }\n                    self.handleClick({ filters: [filter] });\n                });\n                gLabels.on('click', function(object) {\n                    self.handleClick(object.data);\n                })\n                gLabels.classed('clickable', clickableFn);\n                slices.classed('clickable', clickableFn);\n            }\n        };\n\n    }\n});\n"]}