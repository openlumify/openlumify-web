{"version":3,"sources":["../../../js/dashboard/reportRenderers/resultsPopover.js"],"names":["define","defineComponent","withDataRequest","ElementList","withPopover","SearchResultsPopover","defaultAttrs","openSearchSelector","before","node","config","template","hideDialog","after","self","$content","popover","find","$list","position","dialog","show","positionDialog","error","message","isError","$","text","addClass","appendTo","empty","finishedRender","dataRequest","attr","searchUrl","search","then","results","_","isEmpty","elements","removeClass","i18n","Promise","f","on","finished","off","attachTo","items","catch","onOpenInSearch","timeout","event","parametersUrl","url","searchParameters","trigger","parameters","teardown"],"mappings":"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","file":"resultsPopover.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/withDataRequest',\n    'util/element/list',\n    'util/popovers/withPopover'\n], function(\n    defineComponent,\n    withDataRequest,\n    ElementList,\n    withPopover) {\n    'use strict';\n\n    return defineComponent(SearchResultsPopover, withPopover, withDataRequest);\n\n    function SearchResultsPopover() {\n\n        this.defaultAttrs({\n            openSearchSelector: '.open-in-search'\n        });\n\n        this.before('initialize', function(node, config) {\n            config.template = '/dashboard/reportRenderers/resultsPopoverTpl.hbs';\n            config.hideDialog = true;\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.after('setupWithTemplate', function() {\n                var $content = this.popover.find('.popover-content'),\n                    $list = $content.find('.list'),\n                    position = function() {\n                        self.dialog.show();\n                        self.positionDialog();\n                    },\n                    error = function(message, isError) {\n                        $('<div>')\n                            .text(message)\n                            .addClass('message')\n                            .appendTo($list.empty());\n                    },\n                    finishedRender = this.dataRequest('dashboard', 'postData', this.attr.searchUrl || '/element/search', this.attr.search || {})\n                        .then(function(results) {\n                            if (_.isEmpty(results.elements)) {\n                                $list.removeClass('loading-small-animate');\n                                error(i18n('dashboard.search.results.none'));\n                            } else {\n                                return new Promise(function(f) {\n                                    self.on(self.popover, 'renderFinished', function finished() {\n                                        self.off('renderFinished', finished);\n                                        $list.removeClass('loading-small-animate');\n                                        f();\n                                    });\n                                    ElementList.attachTo($list.empty(), {\n                                        items: results.elements\n                                    });\n                                });\n                            }\n                        })\n                        .catch(function() {\n                            $list.removeClass('loading-small-animate');\n                            error(i18n('dashboard.search.results.error'));\n                        })\n                        .then(position);\n\n                this.on(this.popover, 'click', {\n                    openSearchSelector: this.onOpenInSearch\n                })\n\n                Promise.timeout(100).then(position);\n            });\n        });\n\n        this.onOpenInSearch = function(event) {\n            const { searchUrl, search } = this.attr;\n            const { url: parametersUrl, ...searchParameters } = search;\n            const url = parametersUrl || searchUrl;\n\n            this.trigger('searchByParameters', {\n                url,\n                parameters: searchParameters\n            });\n            this.teardown();\n        };\n    }\n});\n"]}