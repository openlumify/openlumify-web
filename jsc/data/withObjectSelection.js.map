{"version":3,"sources":["../../js/data/withObjectSelection.js"],"names":["define","selectionActions","elementActions","productActions","productSelectors","registry","withObjectSelection","defaultNoObjectsOrData","data","baseObj","vertices","edges","vertexIds","edgeIds","returnable","_","extend","indexBy","selectedObjects","previousSelectedObjects","GRAPH_SELECTION_THROTTLE","after","self","selectedObjectsStack","subscribeForSelection","setPublicApi","currentSelectObjectsPromise","Promise","resolve","openlumifyData","selectedObjectsPromise","bind","on","onSelectObjects","onFocusElements","onDefocusElements","onDeleteSelected","onEdgesLoaded","event","findWhere","id","edgeId","length","trigger","reject","e","removeFromStack","newSelection","v","indexOf","onSearchTitle","onSearchRelated","onAddRelatedItems","onObjectsSelected","selector","state","selection","idsByType","storePromise","then","store","observe","options","dispatch","displayInfo","i18nMessage","message","i18n","apply","arguments","product","getProduct","getState","vertexId","pluck","extension","extensionsForPoint","identifier","kind","storeActions","isFunction","removeElements","undoable","setFocus","console","warn","focus","action","payload","set","clear","f","hasItems","promises","dataRequestPromise","done","dataRequest","isArray","push","all","result","compact","selectedObjectsToIds","obj","isEqual","appendToStack","transformedObjects","postData","chain","clone","mapObject","value","target","require","F","text","vertexUrl","url","concat","currentWorkspaceId","window","DEBUG","results","shift","vertex","title","submit","parameters","q","getVertexIdsFromDataEventOrCurrentSelection","async","outsideGraph","$","closest","currentWorkspaceEditable","RP","teardownAll","attachTo","relatedToVertexIds","anchorTo","getConfigurationMaxHistory","configurationPropertiesPromise","properties","parseInt","currentObjects","currentVertexIds","keys","currentEdgeIds","isEmpty","multiple","stack","last","hide","updateStack","ids","forEach","difference","spread","max","vertexIdsToRequest","filter","s","map","edgeIdsToRequest","flatten","edgesById","unique","edge","outVertexId","inVertexId","verticesById","removedEdgeIds","each","hasOutVertex","contains","hasInVertex","checkStackForRemovedEdges","updateStackLabels","notHidden","slice","Math","numSelections","stackIds","sortedIds","sortBy","toString","relationships","hadVertexIds","number","pretty","source","ontologyEdge","byTitle","label","string","truncate","join"],"mappings":"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","file":"withObjectSelection.js","sourcesContent":["define([\n    'data/web-worker/store/selection/actions',\n    'data/web-worker/store/element/actions',\n    'data/web-worker/store/product/actions',\n    'data/web-worker/store/product/selectors',\n    'configuration/plugins/registry'\n], function(selectionActions, elementActions, productActions, productSelectors, registry) {\n    'use strict';\n\n    return withObjectSelection;\n\n    function defaultNoObjectsOrData(data) {\n        var baseObj = {\n                vertices: [],\n                edges: [],\n                vertexIds: {},\n                edgeIds: {}\n            },\n            returnable = _.extend({}, baseObj, data || {});\n\n        returnable.vertexIds = _.indexBy(returnable.vertices, 'id');\n        returnable.edgeIds = _.indexBy(returnable.edges, 'id');\n\n        return returnable;\n    }\n\n    function withObjectSelection() {\n\n        var selectedObjects,\n            previousSelectedObjects,\n            GRAPH_SELECTION_THROTTLE = 100;\n\n        this.after('initialize', function() {\n            var self = this;\n            this.selectedObjectsStack = [];\n\n            this.subscribeForSelection();\n\n            this.setPublicApi('selectedObjects', defaultNoObjectsOrData());\n\n            // Guarantees that we aren't after a selectObjects call but before objectsSelected\n            this.currentSelectObjectsPromise = Promise.resolve();\n            openlumifyData.selectedObjectsPromise = this.selectedObjectsPromise.bind(this);\n\n            this.on('selectObjects', this.onSelectObjects);\n            this.on('focusElements', this.onFocusElements);\n            this.on('defocusElements', this.onDefocusElements);\n            this.on('deleteSelected', this.onDeleteSelected);\n            this.on('edgesLoaded', this.onEdgesLoaded);\n            this.on('edgesDeleted', function(event, data) {\n                if (selectedObjects && _.findWhere(selectedObjects.edges, { id: data.edgeId })) {\n                    if (selectedObjects.edges.length === 1) {\n                        this.trigger('selectObjects');\n                    } else {\n                        selectedObjects.edges = _.reject(selectedObjects.edges, function(e) {\n                            return data.edgeId === e.id\n                        })\n                    }\n                }\n                this.removeFromStack([data.edgeId]);\n            });\n            this.on('verticesDeleted', function(event, data) {\n                if (selectedObjects) {\n                    if (selectedObjects.vertices.length) {\n                        var newSelection = _.reject(selectedObjects.vertices, function(v) {\n                                return ~data.vertexIds.indexOf(v.id)\n                            });\n                        if (selectedObjects.vertices.length !== newSelection.length) {\n                            this.trigger('selectObjects', {\n                                vertices: newSelection\n                            });\n                        }\n                    }\n                }\n                this.removeFromStack(data.vertexIds);\n            });\n            this.on('switchWorkspace', function() {\n                this.selectedObjectsStack = [];\n                this.setPublicApi('selectedObjectsStack');\n            });\n            this.on('searchTitle', this.onSearchTitle);\n            this.on('searchRelated', this.onSearchRelated);\n            this.on('addRelatedItems', this.onAddRelatedItems);\n            this.on('objectsSelected', this.onObjectsSelected);\n        });\n\n        this.subscribeForSelection = function() {\n            const selector = state => state.selection.idsByType;\n\n            openlumifyData.storePromise.then((store) => store.observe(selector, (newSelection) => {\n                this.trigger('selectObjects', {\n                    vertexIds: newSelection.vertices,\n                    edgeIds: newSelection.edges,\n                    options: newSelection.options,\n                    dispatch: false\n                });\n            }))\n        };\n\n        this.displayInfo = function(i18nMessage) {\n            this.trigger('displayInformation', {\n                message: i18n.apply(null, arguments)\n            });\n        };\n\n        this.selectedObjectsPromise = function() {\n            return this.currentSelectObjectsPromise.then(function() {\n                return selectedObjects;\n            });\n        };\n\n        this.onEdgesLoaded = function(event, data) {\n            this.setPublicApi('workspaceEdges', data.edges);\n        };\n\n        this.onDeleteSelected = function(event, data) {\n            var self = this;\n\n            openlumifyData.storePromise.then(store => {\n                var vertexIds = [],\n                    product = productSelectors.getProduct(store.getState());\n\n                if (product) {\n                    if (data && data.vertexId) {\n                        vertexIds = [data.vertexId]\n                    } else if (selectedObjects && selectedObjects.vertices.length) {\n                        vertexIds = _.pluck(selectedObjects.vertices, 'id')\n                    }\n\n                    const extension = _.findWhere(registry.extensionsForPoint('org.openlumify.workproduct'), {\n                        identifier: product.kind\n                    });\n\n                    if (extension.storeActions && _.isFunction(extension.storeActions.removeElements)) {\n                        store.dispatch(extension.storeActions.removeElements(product.id, { vertexIds }, { undoable: true }));\n                    }\n                }\n            })\n        };\n\n        this.onFocusElements = function(event, data) {\n            openlumifyData.storePromise.then(store => {\n                store.dispatch(elementActions.setFocus(data));\n            });\n        };\n\n        this.onDefocusElements = function(event, data) {\n            openlumifyData.storePromise.then(store => {\n                store.dispatch(elementActions.setFocus({ vertexIds: [], edgeIds: [] }));\n            });\n        };\n\n        /**\n         * Trigger this event to select edges or vertices. This will show blue selected\n         * background on these elements and open the Inspector.\n         *\n         * @global\n         * @event selectObjects\n         * @property {object} [data]\n         * @property {Array.<string>} [data.vertexIds=[]] The vertexIds to select\n         * @property {Array.<string>} [data.edgeIds=[]] The edgeIds to select\n         * @property {Array.<object>} [data.vertices=[]] The vertices to select\n         * @property {Array.<object>} [data.edges=[]] The edges to select\n         * @example <caption>From Flight component</caption>\n         * this.trigger('selectObjects', { vertexIds: ['v1'] })\n         * @example <caption>From anywhere</caption>\n         * $(document).trigger('selectObjects', { edgeIds: ['e1'] })\n         */\n        this.onSelectObjects = function(event, data) {\n            if (data && 'focus' in data) {\n                console.warn(`selectObjects event with \"focus\" should be moved to options object.\nSupport will be removed in future versions, use:\n\n    this.trigger('selectObjects', { options: { focus: true }})`);\n                data.options = { focus: data.focus, ...(data.options || {}) };\n            }\n            if (!data || data.dispatch !== false) {\n                openlumifyData.storePromise.then(store => {\n                    var action;\n                    if (data) {\n                        let payload = {\n                            vertices: data.vertexIds,\n                            edges: data.edgeIds,\n                            options: data.options\n                        };\n                        if (data.vertices) payload.vertices = _.pluck(data.vertices, 'id');\n                        if (data.edges) payload.edges = _.pluck(data.edges, 'id');\n                        action = selectionActions.set(payload);\n                    } else {\n                        action = selectionActions.clear();\n                    }\n                    store.dispatch(action);\n                })\n                return;\n            }\n\n            var self = this;\n            this.currentSelectObjectsPromise = new Promise(function(f) {\n                var hasItems = data &&\n                        (\n                            (data.vertexIds || data.vertices || []).length > 0 ||\n                            (data.edgeIds || data.edges || []).length > 0\n                        ),\n                    promises = [];\n\n                self.dataRequestPromise.done(function(dataRequest) {\n                    if (data && data.vertexIds) {\n                        if (!_.isArray(data.vertexIds)) {\n                            data.vertexIds = [data.vertexIds];\n                        }\n                        promises.push(\n                            dataRequest('vertex', 'store', { vertexIds: data.vertexIds })\n                        );\n                    } else if (data && data.vertices) {\n                        promises.push(Promise.resolve(data.vertices));\n                    } else {\n                        promises.push(Promise.resolve([]));\n                    }\n\n                    if (data && data.edgeIds && data.edgeIds.length) {\n                        promises.push(\n                            dataRequest('edge', 'store', { edgeIds: data.edgeIds })\n                        );\n                    } else if (data && data.edges) {\n                        promises.push(Promise.resolve(data.edges));\n                    } else {\n                        promises.push(Promise.resolve([]));\n                    }\n\n                    Promise.all(promises)\n                        .done(function(result) {\n                            var vertices = _.compact(result[0] || []),\n                                edges = _.compact(result[1] || []),\n                                selectedObjectsToIds = function(obj) {\n                                    return {\n                                        vertices: _.pluck(obj && obj.vertices || [], 'id'),\n                                        edges: _.pluck(obj && obj.edges || [], 'id')\n                                    };\n                                };\n\n                            if (!edges.length && !vertices.length && hasItems) {\n                                self.trigger('objectsSelectedAborted');\n                                f();\n                                return;\n                            }\n\n                            selectedObjects = {\n                                vertices: vertices,\n                                edges: edges\n                            };\n\n                            if (previousSelectedObjects &&\n                                selectedObjects &&\n                                _.isEqual(\n                                    selectedObjectsToIds(previousSelectedObjects),\n                                    selectedObjectsToIds(selectedObjects)\n                                )) {\n                                self.trigger('objectsSelectedAborted');\n                                f();\n                                return;\n                            }\n\n                            self.appendToStack(selectedObjects)\n                                .done(function() {\n                                    previousSelectedObjects = selectedObjects;\n\n                                    var transformedObjects = defaultNoObjectsOrData(selectedObjects);\n                                    self.setPublicApi('selectedObjects', transformedObjects);\n\n                                    var postData = _.chain(selectedObjects)\n                                        .clone()\n                                        .mapObject(function(value) {\n                                            return _.clone(value);\n                                        })\n                                        .value();\n                                    if (data && 'options' in data) {\n                                        postData.options = data.options;\n                                    } else {\n                                        postData.options = {};\n                                    }\n\n                                    /**\n                                     * Listen for this event to be notified of selection changes\n                                     *\n                                     * @global\n                                     * @event objectsSelected\n                                     * @property {object} data\n                                     * @property {Array.<object>} data.vertices\n                                     * @property {Array.<object>} data.edges\n                                     * @property {object} data.options\n                                     * @property {object} data.options.focus Used to scroll to sourceInfo of document text\n                                     * @example <caption>From Flight</caption>\n                                     * this.on(document, 'objectsSelected', function(event, data) {\n                                     *     console.log('Selection:', data.vertices, data.edges);\n                                     * })\n                                     * @example <caption>Anywhere</caption>\n                                     * $(document).on('objectsSelected', function(e, data) {\n                                     *     console.log('Selection:', data.vertices, data.edges);\n                                     * })\n                                     */\n                                    self.trigger(event.target, 'objectsSelected', postData);\n                                    f();\n                                });\n                        });\n                });\n            });\n        };\n\n        this.onObjectsSelected = function(event, data) {\n            var self = this;\n\n            if (data.vertices.length || data.edges.length) {\n                require(['util/vertex/urlFormatters'], function(F) {\n                    self.trigger('clipboardSet', {\n                        text: F.vertexUrl.url(data.vertices.concat(data.edges), openlumifyData.currentWorkspaceId)\n                    });\n                })\n            } else {\n                this.trigger('clipboardClear');\n            }\n\n            if (window.DEBUG) {\n                DEBUG.selectedObjects = data;\n            }\n        };\n\n        this.onSearchTitle = function(event, data) {\n            var self = this,\n                vertexId = data.vertexId || (\n                    selectedObjects &&\n                    selectedObjects.vertices.length === 1 &&\n                    selectedObjects.vertices[0].id\n                );\n\n            if (vertexId) {\n                Promise.all([\n                    Promise.require('util/vertex/formatters'),\n                    this.dataRequestPromise.then(function(dataRequest) {\n                        return dataRequest('vertex', 'store', { vertexIds: vertexId });\n                    })\n                ]).done(function(results) {\n                    var F = results.shift(),\n                        vertex = results.shift(),\n                        title = F.vertex.title(vertex);\n\n                    self.trigger('searchByParameters', { submit: true, parameters: { q: title }});\n                })\n            }\n        };\n\n        this.onSearchRelated = function(event, data) {\n            var self = this;\n\n            Promise.require('util/vertex/formatters')\n                .then(function(F) {\n                    return F.vertex.getVertexIdsFromDataEventOrCurrentSelection(data, { async: true });\n                })\n                .then(function(vertexIds) {\n                    self.trigger('searchByRelatedEntity', { vertexIds: vertexIds });\n                })\n        };\n\n        this.onAddRelatedItems = function(event, data) {\n            var self = this;\n\n            const outsideGraph = $(event.target).closest('.org-openlumify-graph').length === 0;\n            if (outsideGraph) {\n                return;\n            }\n            if (!openlumifyData.currentWorkspaceEditable) {\n                this.displayInfo('graph.workspace.readonly')\n                return;\n            }\n\n            Promise.require('util/vertex/formatters')\n                .then(function(F) {\n                    return F.vertex.getVertexIdsFromDataEventOrCurrentSelection(data, { async: true });\n                })\n                .then(function(vertexIds) {\n\n                    if (vertexIds.length) {\n                        Promise.all([\n                            Promise.require('util/popovers/addRelated/addRelated'),\n                            self.dataRequestPromise.then(function(dataRequest) {\n                                return dataRequest('vertex', 'store', { vertexIds: vertexIds })\n                            })\n                        ]).done(function(results) {\n                            var RP = results.shift(),\n                                vertex = results.shift();\n\n                            RP.teardownAll();\n\n                            RP.attachTo(event.target, {\n                                vertex: vertex,\n                                relatedToVertexIds: vertexIds,\n                                anchorTo: {\n                                    vertexId: vertexIds[0]\n                                }\n                            });\n                        });\n                    }\n                });\n        };\n\n        this.getConfigurationMaxHistory = function() {\n            if (!this.configurationPropertiesPromise) {\n                this.configurationPropertiesPromise =\n                    this.dataRequestPromise\n                        .then(function(dataRequest) {\n                            return dataRequest('config', 'properties');\n                        })\n                        .then(function(properties) {\n                            return parseInt(properties['detail.history.stack.max'], 10);\n                        });\n            }\n\n            return this.configurationPropertiesPromise\n        };\n\n        this.appendToStack = function(selectedObjects) {\n            var self = this,\n                currentObjects = defaultNoObjectsOrData(selectedObjects),\n                currentVertexIds = _.keys(currentObjects.vertexIds),\n                currentEdgeIds = _.keys(currentObjects.edgeIds);\n\n            if (!_.isEmpty(currentVertexIds) || !_.isEmpty(currentEdgeIds)) {\n                var multiple = (currentVertexIds.length + currentEdgeIds.length) > 1;\n\n                this.selectedObjectsStack = _.reject(this.selectedObjectsStack, function(stack) {\n                    return _.isEqual(stack.vertexIds, currentVertexIds) &&\n                           _.isEqual(stack.edgeIds, currentEdgeIds);\n                });\n\n                if (this.selectedObjectsStack.length) {\n                    _.last(this.selectedObjectsStack).hide = false;\n                }\n\n                this.selectedObjectsStack.push({\n                    vertexIds: currentVertexIds || [],\n                    edgeIds: currentEdgeIds || [],\n                    hide: true,\n                    multiple: multiple\n                });\n\n                return this.updateStack();\n            } else {\n                return Promise.resolve();\n            }\n        };\n\n        this.removeFromStack = function(ids) {\n            this.selectedObjectsStack.forEach(function(stack) {\n                stack.vertexIds = _.difference(stack.vertexIds, ids);\n                stack.edgeIds = _.difference(stack.edgeIds, ids);\n            });\n\n            return this.updateStack()\n        };\n\n        this.updateStack = function() {\n            var self = this;\n\n            return Promise.all([\n                this.getConfigurationMaxHistory(),\n                this.dataRequestPromise\n            ]).spread(function(max, dataRequest) {\n                var vertexIdsToRequest = _.chain(self.selectedObjectsStack)\n                        .filter(function(s) {\n                            return s.vertexIds.length === 1;\n                        })\n                        .map(function(s) {\n                            return s.vertexIds[0];\n                        })\n                        .value();\n                var edgeIdsToRequest = _.chain(self.selectedObjectsStack)\n                        .filter(function(s) {\n                            return s.edgeIds.length;\n                        })\n                        .map(function(s) {\n                            return s.edgeIds;\n                        })\n                        .flatten()\n                        .value();\n                var edgesById;\n\n                return (edgeIdsToRequest.length ?\n                        dataRequest('edge', 'store', { edgeIds: _.unique(edgeIdsToRequest) }) :\n                        Promise.resolve([])\n                    ).then(function(edges) {\n                        edgesById = _.indexBy(_.compact(edges), 'id');\n                        edges.forEach(function(edge) {\n                            vertexIdsToRequest.push(edge.outVertexId);\n                            vertexIdsToRequest.push(edge.inVertexId);\n                        });\n\n                        if (vertexIdsToRequest.length) {\n                            return dataRequest('vertex', 'store', { vertexIds: _.unique(vertexIdsToRequest) });\n                        }\n                        return Promise.resolve([]);\n                    }).then(function(vertices) {\n                        var verticesById = _.indexBy(_.compact(vertices), 'id');\n                        var vertexIds = _.pluck(verticesById, 'id');\n                        var removedEdgeIds = [];\n\n                        _.each(edgesById, function(edge) {\n                            var hasOutVertex = _.contains(vertexIds, edge.outVertexId);\n                            var hasInVertex = _.contains(vertexIds, edge.inVertexId);\n\n                            if (!hasOutVertex || !hasInVertex) {\n                                removedEdgeIds.push(edge.id);\n                            }\n                        });\n\n                        self.checkStackForRemovedEdges(removedEdgeIds);\n\n                        return self.updateStackLabels(verticesById, edgesById)\n                            .then(function() {\n                                var notHidden = _.reject(self.selectedObjectsStack, function(s) {\n                                    return s.hide;\n                                });\n                                self.setPublicApi('selectedObjectsStack', notHidden.slice(Math.max(0, notHidden.length - max)));\n                            });\n                    });\n            });\n        };\n\n        this.checkStackForRemovedEdges = function(edgeIds) {\n            this.selectedObjectsStack = _.chain(this.selectedObjectsStack)\n                .map(function(stack) {\n                    stack.edgeIds = _.difference(stack.edgeIds, edgeIds);\n\n                    var numSelections = stack.edgeIds.length + stack.vertexIds.length;\n                    stack.multiple = numSelections > 1;\n                    if (numSelections === 0) {\n                        stack = null;\n                    }\n\n                    return stack;\n                })\n                .unique(function(stack) {\n                    if (stack) {\n                        var stackIds = stack.vertexIds.concat(stack.edgeIds);\n                        var sortedIds = _.sortBy(stackIds);\n                        sortedIds.push(stack.hide);\n                        return sortedIds.toString()\n                    } else {\n                        return '';\n                    }\n                })\n                .compact()\n                .value();\n        };\n\n        this.updateStackLabels = function(verticesById, edgesById) {\n            var self = this;\n\n            return Promise.all([\n               Promise.require('util/vertex/formatters'),\n               this.dataRequestPromise.then(function(dataRequest) {\n                   return dataRequest('ontology', 'relationships')\n               })\n            ]).spread(function(F, relationships) {\n                var notHidden = _.reject(self.selectedObjectsStack, function(s) {\n                    return s.hide;\n                });\n\n                notHidden.forEach(function(s) {\n                    var hadVertexIds = s.vertexIds.length;\n                    if (!s.multiple) {\n                        s.vertexIds = _.filter(s.vertexIds, function(vertexId) {\n                            return vertexId in verticesById;\n                        });\n                        s.edgeIds = _.filter(s.edgeIds, function(edgeId) {\n                            return edgeId in edgesById;\n                        });\n                    }\n\n                    if (s.vertexIds.length && s.edgeIds.length) {\n                        s.title = F.number.pretty(s.vertexIds.length + s.edgeIds.length) + ' items';\n                    } else if (hadVertexIds) {\n                        if (s.vertexIds.length === 1) {\n                            s.title = F.vertex.title(verticesById[s.vertexIds[0]]);\n                        } else if (s.vertexIds.length) {\n                            s.title = F.number.pretty(s.vertexIds.length) + ' entities';\n                        } else {\n                            s.hide = true;\n                        }\n                    } else if (s.edgeIds.length === 1) {\n                        var edge = edgesById[s.edgeIds[0]],\n                            source = edge && verticesById[edge.outVertexId],\n                            target = edge && verticesById[edge.inVertexId],\n                            ontologyEdge = edge && relationships.byTitle[edge.label],\n                            label = ' → ';\n                        if (source && target) {\n                            s.title = [\n                                F.string.truncate(F.vertex.title(source), 2),\n                                F.string.truncate(F.vertex.title(target), 2)\n                            ].join(label);\n                        } else {\n                            s.hide = true;\n                        }\n                    } else if (s.edgeIds.length) {\n                        s.title = F.number.pretty(s.edgeIds.length) + ' relationships';\n                    } else {\n                        s.hide = true;\n                    }\n                });\n            });\n        };\n    }\n});\n"]}