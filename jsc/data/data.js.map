{"version":3,"sources":["../../js/data/data.js"],"names":["define","defineComponent","PATH_TO_WORKER","mixins","apply","Data","concat","after","self","setupDataWorker","dataRequestPromise","Promise","fulfill","reject","openlumifyData","readyForDataRequests","timer","_","delay","on","clearTimeout","off","then","require","withDataRequest","dataRequest","messagesPromise","setupMessages","bind","DEBUG","logCacheStats","worker","postMessage","type","i18n","window","Worker","openlumifyCacheBreaker","JSON","stringify","cacheBreaker","webWorkerResources","openlumifyPluginResources","webWorker","environment","openlumifyEnvironment","onmessage","onDataWorkerMessage","onerror","onDataWorkerError","event","console","error","data","isArray","forEach","processWorkerMessage","message","warn"],"mappings":"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","file":"data.js","sourcesContent":["/*eslint strict:0 */\ndefine([\n    'flight/lib/component',\n    './withReduxStore',\n    './withPublicApi',\n    './withBrokenWorkerConsole',\n    './withDataRequestHandler',\n    './withCurrentUser',\n    './withDocumentCopyText',\n    './withWebsocket',\n    './withWebsocketLegacy',\n    './withKeyboardRegistration',\n    './withObjectSelection',\n    './withObjectsUpdated',\n    './withClipboard',\n    './withWorkspaces',\n    './withSessionTimeout'\n], function(\n    defineComponent,\n    ...mixins\n) {\n\n    var PATH_TO_WORKER = 'jsc/data/web-worker/data-worker.js';\n\n    return defineComponent.apply(null, [Data].concat(mixins));\n\n    function Data() {\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.setupDataWorker();\n\n            this.dataRequestPromise = new Promise(function(fulfill, reject) {\n                    if (self.openlumifyData.readyForDataRequests) {\n                        fulfill();\n                    } else {\n                        var timer = _.delay(reject, 10000);\n                        self.on('readyForDataRequests', function readyForDataRequests() {\n                            if (timer) {\n                                clearTimeout(timer);\n                            }\n                            fulfill();\n                            self.off('readyForDataRequests', readyForDataRequests);\n                        });\n                    }\n                }).then(function() {\n                    return Promise.require('util/withDataRequest');\n                }).then(function(withDataRequest) {\n                    return withDataRequest.dataRequest;\n                });\n\n            this.messagesPromise = this.dataRequestPromise.then(function() {\n                    return Promise.require('util/messages');\n                }).then(this.setupMessages.bind(this));\n\n            if (typeof DEBUG !== 'undefined') {\n                DEBUG.logCacheStats = function() {\n                    self.worker.postMessage({\n                        type: 'postCacheStats'\n                    });\n                }\n            }\n        });\n\n        this.setupMessages = function(i18n) {\n            window.i18n = i18n;\n            return i18n;\n        };\n\n        this.setupDataWorker = function() {\n            var self = this;\n\n            this.worker = new Worker(PATH_TO_WORKER + '?' + openlumifyCacheBreaker);\n            this.worker.postMessage(JSON.stringify({\n                cacheBreaker: openlumifyCacheBreaker,\n                webWorkerResources: openlumifyPluginResources.webWorker,\n                environment: openlumifyEnvironment\n            }));\n            this.worker.onmessage = this.onDataWorkerMessage.bind(this);\n            this.worker.onerror = this.onDataWorkerError.bind(this);\n        };\n\n        this.onDataWorkerError = function(event) {\n            console.error('data-worker error', event);\n        };\n\n        this.onDataWorkerMessage = function(event) {\n            var data = event.data;\n\n            if (_.isArray(data)) {\n                data.forEach(this.processWorkerMessage.bind(this));\n            } else {\n                this.processWorkerMessage(data);\n            }\n        };\n\n        this.processWorkerMessage = function(message) {\n            if (message.type && (message.type in this)) {\n                this[message.type](message);\n            } else {\n                console.warn('Unhandled message from worker', message);\n            }\n        }\n    }\n});\n"]}