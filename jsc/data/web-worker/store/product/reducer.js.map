{"version":3,"sources":["../../../../../js/data/web-worker/store/product/reducer.js"],"names":["define","u","product","state","type","payload","workspaces","types","interacting","updateList","updateTypes","updateTitle","selectProduct","updateProduct","updatePreview","removeProduct","updateViewport","updateData","updateExtendedData","setInteracting","updateUnauthorizedElements","workspaceId","productId","title","loading","update","products","viewport","viewports","constant","md5","previewHashes","extractPreviewsAndActive","reduce","result","previewMD5","active","rest","id","selected","loaded","productsNoHash","extra","productNoPreviewOrActive","existing","localData","omit","key","value","data","extendedData","updateLocalData","interactingIds","updates","omitBy","val","vertices","edges","productVertices","productEdges","transformElements","productElements","idKey","updateElements","_","mapObject","element","unauthorized","find","e","undefined","_DELETED","some","map"],"mappings":"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","file":"reducer.js","sourcesContent":["define(['updeep'], function(u) {\n    'use strict';\n\n    return function product(state, { type, payload }) {\n        if (!state) return { workspaces: {}, types: [], interacting: {} };\n\n        switch (type) {\n            case 'PRODUCT_LIST': return updateList(state, payload);\n            case 'PRODUCT_UPDATE_TYPES': return updateTypes(state, payload);\n            case 'PRODUCT_UPDATE_TITLE': return updateTitle(state, payload);\n            case 'PRODUCT_SELECT': return selectProduct(state, payload);\n            case 'PRODUCT_UPDATE': return updateProduct(state, payload);\n            case 'PRODUCT_PREVIEW_UPDATE': return updatePreview(state, payload);\n            case 'PRODUCT_REMOVE': return removeProduct(state, payload);\n            case 'PRODUCT_UPDATE_VIEWPORT': return updateViewport(state, payload);\n            case 'PRODUCT_UPDATE_DATA': return updateData(state, payload);\n            case 'PRODUCT_UPDATE_EXTENDED_DATA': return updateExtendedData(state, payload);\n\n            case 'PRODUCT_SET_INTERACTING': return setInteracting(state, payload);\n\n            case 'ELEMENT_UPDATE': return updateUnauthorizedElements(state, payload);\n        }\n\n        return state;\n    };\n\n    function updateTitle(state, { workspaceId, productId, title, loading }) {\n        var update;\n        if (loading) {\n            update = { loading: true }\n        } else if (title) {\n            update = { loading: false, title }\n        }\n        if (update) {\n            return u({\n                workspaces: {\n                    [workspaceId]: {\n                        products: {\n                            [productId]: update\n                        }\n                    }\n                }\n            }, state);\n        }\n        return state;\n    }\n\n    function updateViewport(state, { workspaceId, viewport, productId }) {\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    viewports: {\n                        [productId]: u.constant(viewport)\n                    }\n                }\n            }\n        }, state);\n    }\n\n    function updateTypes(state, { types }) {\n        return u({ types: u.constant(types) }, state);\n    }\n\n    function updatePreview(state, { workspaceId, productId, md5 }) {\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    previewHashes: {\n                        [productId]: md5\n                    }\n                }\n            }\n        }, state);\n    }\n\n    function extractPreviewsAndActive(products = []) {\n        return (products || []).reduce((result, product) => {\n            const { products, previewHashes } = result;\n            const { previewMD5, active, ...rest } = product;\n\n            products[product.id] = rest;\n            previewHashes[product.id] = previewMD5;\n            if (active && !result.selected) {\n                result.selected = product.id\n            }\n\n            return result;\n        }, { products: {}, previewHashes: {} });\n    }\n\n    function updateList(state, { loading, loaded, workspaceId, products }) {\n        const { products: productsNoHash, previewHashes, selected } = extractPreviewsAndActive(products);\n        const extra = {};\n        if (selected) {\n            extra.selected = selected;\n        }\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    products: u.constant(productsNoHash),\n                    previewHashes: u.constant(previewHashes),\n                    loading,\n                    loaded,\n                    ...extra\n                }\n            }\n        }, state);\n    }\n\n    function selectProduct(state, { productId, workspaceId }) {\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    selected: productId ? productId : null\n                }\n            }\n        }, state);\n    }\n\n    function updateProduct(state, { product }) {\n        const { previewMD5, active, ...productNoPreviewOrActive } = product;\n        const { id, workspaceId } = productNoPreviewOrActive;\n        const existing = state.workspaces[workspaceId].products[id];\n        const localData = existing && existing.localData || {};\n        const extra = {};\n        product.localData = localData;\n\n        if (active) {\n            extra.selected = id;\n        }\n\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    products: {\n                        [id]: u.constant(productNoPreviewOrActive)\n                    },\n                    previewHashes: {\n                        [id]: previewMD5\n                    },\n                    ...extra\n                }\n            }\n        }, state);\n    }\n\n    function removeProduct(state, { productId, workspaceId }) {\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    products: u.omit(productId),\n                    previewHashes: u.omit(productId)\n                }\n            }\n        }, state);\n    }\n\n    function updateData(state, {workspaceId, productId, key, value}) {\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    products: {\n                        [productId]: {\n                            data: {\n                                [key]: u.constant(value)\n                            }\n                        }\n                    }\n                }\n            }\n        }, state);\n    }\n\n    function updateExtendedData(state, {workspaceId, productId, key, value}) {\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    products: {\n                        [productId]: {\n                            extendedData: {\n                                [key]: u.constant(value)\n                            }\n                        }\n                    }\n                }\n            }\n        }, state);\n    }\n\n    function updateLocalData(state, {workspaceId, productId, localData}) {\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    products: {\n                        [productId]: {\n                            localData: u.constant(localData)\n                        }\n                    }\n                }\n            }\n        }, state);\n    }\n\n    function setInteracting(state, { interactingIds }) {\n        const updates = u({\n            interacting: interactingIds\n        }, state);\n\n        return u({\n            interacting: u.omitBy(val => !val)\n        }, updates)\n    }\n\n    function updateUnauthorizedElements(state, {workspaceId, vertices, edges}) {\n        const updateProduct = (product) => {\n            if (product.extendedData) {\n                const { vertices: productVertices, edges: productEdges } = product.extendedData;\n                const transformElements = (productElements, idKey, updateElements) => {\n                    return _.mapObject(productElements, (element) => {\n                        const { [idKey]: id, unauthorized, ...rest } = element;\n                        const update = updateElements.find((e) => e.id === id);\n                        if (update !== undefined) {\n                            if (update._DELETED !== true) {\n                                return { [idKey]: id, ...rest }\n                            } else {\n                                return { [idKey]: id, unauthorized: true, ...rest };\n                            }\n                        } else {\n                            return element;\n                        }\n                    });\n                };\n                const updates = { ...product.extendedData };\n\n                if (productVertices && vertices && vertices.some(({ id }) => productVertices[id])) {\n                    updates.vertices = transformElements(productVertices, 'id', vertices);\n                }\n                if (productEdges && edges && edges.some(({ id }) => productEdges[id])) {\n                    updates.edges = transformElements(productEdges, 'edgeId', edges);\n                }\n\n                return u({ extendedData: u.constant(updates) }, product)\n            } else {\n                return product;\n            }\n        }\n\n        return u({\n            workspaces: {\n                [workspaceId]: {\n                    products: u.map(updateProduct)\n                }\n            }\n        }, state);\n    }\n});\n"]}