var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}define(['updeep'],function(u){'use strict';return function product(state,_ref){var type=_ref.type,payload=_ref.payload;if(!state)return{workspaces:{},types:[],interacting:{}};switch(type){case'PRODUCT_LIST':return updateList(state,payload);case'PRODUCT_UPDATE_TYPES':return updateTypes(state,payload);case'PRODUCT_UPDATE_TITLE':return updateTitle(state,payload);case'PRODUCT_SELECT':return selectProduct(state,payload);case'PRODUCT_UPDATE':return updateProduct(state,payload);case'PRODUCT_PREVIEW_UPDATE':return updatePreview(state,payload);case'PRODUCT_REMOVE':return removeProduct(state,payload);case'PRODUCT_UPDATE_VIEWPORT':return updateViewport(state,payload);case'PRODUCT_UPDATE_DATA':return updateData(state,payload);case'PRODUCT_UPDATE_EXTENDED_DATA':return updateExtendedData(state,payload);case'PRODUCT_SET_INTERACTING':return setInteracting(state,payload);case'ELEMENT_UPDATE':return updateUnauthorizedElements(state,payload);}return state;};function updateTitle(state,_ref2){var workspaceId=_ref2.workspaceId,productId=_ref2.productId,title=_ref2.title,loading=_ref2.loading;var update;if(loading){update={loading:true};}else if(title){update={loading:false,title:title};}if(update){return u({workspaces:_defineProperty({},workspaceId,{products:_defineProperty({},productId,update)})},state);}return state;}function updateViewport(state,_ref3){var workspaceId=_ref3.workspaceId,viewport=_ref3.viewport,productId=_ref3.productId;return u({workspaces:_defineProperty({},workspaceId,{viewports:_defineProperty({},productId,u.constant(viewport))})},state);}function updateTypes(state,_ref4){var types=_ref4.types;return u({types:u.constant(types)},state);}function updatePreview(state,_ref5){var workspaceId=_ref5.workspaceId,productId=_ref5.productId,md5=_ref5.md5;return u({workspaces:_defineProperty({},workspaceId,{previewHashes:_defineProperty({},productId,md5)})},state);}function extractPreviewsAndActive(){var products=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return(products||[]).reduce(function(result,product){var products=result.products,previewHashes=result.previewHashes;var previewMD5=product.previewMD5,active=product.active,rest=_objectWithoutProperties(product,['previewMD5','active']);products[product.id]=rest;previewHashes[product.id]=previewMD5;if(active&&!result.selected){result.selected=product.id;}return result;},{products:{},previewHashes:{}});}function updateList(state,_ref6){var loading=_ref6.loading,loaded=_ref6.loaded,workspaceId=_ref6.workspaceId,products=_ref6.products;var _extractPreviewsAndAc=extractPreviewsAndActive(products),productsNoHash=_extractPreviewsAndAc.products,previewHashes=_extractPreviewsAndAc.previewHashes,selected=_extractPreviewsAndAc.selected;var extra={};if(selected){extra.selected=selected;}return u({workspaces:_defineProperty({},workspaceId,_extends({products:u.constant(productsNoHash),previewHashes:u.constant(previewHashes),loading:loading,loaded:loaded},extra))},state);}function selectProduct(state,_ref7){var productId=_ref7.productId,workspaceId=_ref7.workspaceId;return u({workspaces:_defineProperty({},workspaceId,{selected:productId?productId:null})},state);}function updateProduct(state,_ref8){var product=_ref8.product;var previewMD5=product.previewMD5,active=product.active,productNoPreviewOrActive=_objectWithoutProperties(product,['previewMD5','active']);var id=productNoPreviewOrActive.id,workspaceId=productNoPreviewOrActive.workspaceId;var existing=state.workspaces[workspaceId].products[id];var localData=existing&&existing.localData||{};var extra={};product.localData=localData;if(active){extra.selected=id;}return u({workspaces:_defineProperty({},workspaceId,_extends({products:_defineProperty({},id,u.constant(productNoPreviewOrActive)),previewHashes:_defineProperty({},id,previewMD5)},extra))},state);}function removeProduct(state,_ref9){var productId=_ref9.productId,workspaceId=_ref9.workspaceId;return u({workspaces:_defineProperty({},workspaceId,{products:u.omit(productId),previewHashes:u.omit(productId)})},state);}function updateData(state,_ref10){var workspaceId=_ref10.workspaceId,productId=_ref10.productId,key=_ref10.key,value=_ref10.value;return u({workspaces:_defineProperty({},workspaceId,{products:_defineProperty({},productId,{data:_defineProperty({},key,u.constant(value))})})},state);}function updateExtendedData(state,_ref11){var workspaceId=_ref11.workspaceId,productId=_ref11.productId,key=_ref11.key,value=_ref11.value;return u({workspaces:_defineProperty({},workspaceId,{products:_defineProperty({},productId,{extendedData:_defineProperty({},key,u.constant(value))})})},state);}function updateLocalData(state,_ref12){var workspaceId=_ref12.workspaceId,productId=_ref12.productId,localData=_ref12.localData;return u({workspaces:_defineProperty({},workspaceId,{products:_defineProperty({},productId,{localData:u.constant(localData)})})},state);}function setInteracting(state,_ref13){var interactingIds=_ref13.interactingIds;var updates=u({interacting:interactingIds},state);return u({interacting:u.omitBy(function(val){return!val;})},updates);}function updateUnauthorizedElements(state,_ref14){var workspaceId=_ref14.workspaceId,vertices=_ref14.vertices,edges=_ref14.edges;var updateProduct=function updateProduct(product){if(product.extendedData){var _product$extendedData=product.extendedData,productVertices=_product$extendedData.vertices,productEdges=_product$extendedData.edges;var transformElements=function transformElements(productElements,idKey,updateElements){return _.mapObject(productElements,function(element){var id=element[idKey],unauthorized=element.unauthorized,rest=_objectWithoutProperties(element,[idKey,'unauthorized']);var update=updateElements.find(function(e){return e.id===id;});if(update!==undefined){if(update._DELETED!==true){return _extends(_defineProperty({},idKey,id),rest);}else{var _extends3;return _extends((_extends3={},_defineProperty(_extends3,idKey,id),_defineProperty(_extends3,'unauthorized',true),_extends3),rest);}}else{return element;}});};var updates=_extends({},product.extendedData);if(productVertices&&vertices&&vertices.some(function(_ref15){var id=_ref15.id;return productVertices[id];})){updates.vertices=transformElements(productVertices,'id',vertices);}if(productEdges&&edges&&edges.some(function(_ref16){var id=_ref16.id;return productEdges[id];})){updates.edges=transformElements(productEdges,'edgeId',edges);}return u({extendedData:u.constant(updates)},product);}else{return product;}};return u({workspaces:_defineProperty({},workspaceId,{products:u.map(updateProduct)})},state);}});
//# sourceMappingURL=reducer.js.map
