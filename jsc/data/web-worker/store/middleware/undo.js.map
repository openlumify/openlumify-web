{"version":3,"sources":["../../../../../js/data/web-worker/store/middleware/undo.js"],"names":["define","createUndoMiddleware","registry","markUndocumentedExtensionPoint","undoExtensions","extensionsForPoint","filter","e","undoActions","undoActionsByType","map","reduce","actions","a","dispatch","getState","action","type","payload","scope","undoScope","history","undoActionHistory","undos","length","undo","redos","redo","next"],"mappings":"gOAAAA,OAAO,CACH,gCADG,CAAP,CAEG,QAASC,qBAAT,CAA8BC,QAA9B,CAAwC,CACvCA,SAASC,8BAAT,CAAwC,sBAAxC,EAEA,GAAMC,gBAAiBF,SAASG,kBAAT,CAA4B,sBAA5B,EAClBC,MADkB,CACX,kBAAKC,GAAEC,WAAP,EADW,CAAvB,CAEA,GAAMC,mBAAoBL,eACrBM,GADqB,CACjB,kBAAKH,GAAEC,WAAP,EADiB,EAErBG,MAFqB,CAEd,SAACC,OAAD,CAAUC,CAAV,qBAEGD,OAFH,CAGGC,CAHH,GAFc,CAOnB,EAPmB,CAA1B,CASA,MAAO,mBAAGC,SAAH,MAAGA,QAAH,CAAaC,QAAb,MAAaA,QAAb,OAA4B,sBAAQ,iBAAU,CACjD,GAAIC,OAAOC,IAAP,GAAgB,MAApB,CAA4B,IAChBC,QADgB,CACJF,MADI,CAChBE,OADgB,CAExB,GAAMC,OAAQD,SAAWA,QAAQE,SAAnB,EAAgC,QAA9C,CACA,GAAMC,SAAUN,WAAWO,iBAAX,CAA6BH,KAA7B,CAAhB,CACA,GAAIE,OAAJ,CAAa,IACDE,MADC,CACSF,OADT,CACDE,KADC,WAEcA,MAAMA,MAAMC,MAAN,CAAe,CAArB,GAA2B,EAFzC,CAEDP,IAFC,OAEDA,IAFC,CAEKQ,IAFL,OAEKA,IAFL,CAGT,GAAIA,MAAQhB,kBAAkBQ,IAAlB,CAAZ,CAAqC,CACjCH,SAASL,kBAAkBQ,IAAlB,EAAwBQ,IAAxB,CAA6BA,IAA7B,CAAT,EACH,CACJ,CACJ,CACD,GAAIT,OAAOC,IAAP,GAAgB,MAApB,CAA4B,IAChBC,SADgB,CACJF,MADI,CAChBE,OADgB,CAExB,GAAMC,QAAQD,UAAWA,SAAQE,SAAnB,EAAgC,QAA9C,CACA,GAAMC,UAAUN,WAAWO,iBAAX,CAA6BH,MAA7B,CAAhB,CACA,GAAIE,QAAJ,CAAa,IACDK,MADC,CACSL,QADT,CACDK,KADC,WAEcA,MAAMA,MAAMF,MAAN,CAAe,CAArB,GAA2B,EAFzC,CAEDP,KAFC,OAEDA,IAFC,CAEKU,IAFL,OAEKA,IAFL,CAGT,GAAIA,MAAQlB,kBAAkBQ,KAAlB,CAAZ,CAAqC,CACjCH,SAASL,kBAAkBQ,KAAlB,EAAwBU,IAAxB,CAA6BA,IAA7B,CAAT,EACH,CACJ,CACJ,CACD,MAAOC,MAAKZ,MAAL,CAAP,CACH,CA1BkC,EAA5B,EAAP,CA2BH,CA3CD","file":"undo.js","sourcesContent":["define([\n    'configuration/plugins/registry',\n], function createUndoMiddleware(registry) {\n    registry.markUndocumentedExtensionPoint('org.openlumify.store');\n\n    const undoExtensions = registry.extensionsForPoint('org.openlumify.store')\n        .filter(e => e.undoActions);\n    const undoActionsByType = undoExtensions\n        .map(e => e.undoActions)\n        .reduce((actions, a) => (\n            {\n                ...actions,\n                ...a\n            }\n        ), {});\n\n    return ({ dispatch, getState }) => next => action => {\n        if (action.type === 'UNDO') {\n            const { payload } = action;\n            const scope = payload && payload.undoScope || 'global';\n            const history = getState().undoActionHistory[scope];\n            if (history) {\n                const { undos } = history;\n                const { type, undo } = undos[undos.length - 1] || {};\n                if (undo && undoActionsByType[type]) {\n                    dispatch(undoActionsByType[type].undo(undo));\n                }\n            }\n        }\n        if (action.type === 'REDO') {\n            const { payload } = action;\n            const scope = payload && payload.undoScope || 'global';\n            const history = getState().undoActionHistory[scope];\n            if (history) {\n                const { redos } = history;\n                const { type, redo } = redos[redos.length - 1] || {};\n                if (redo && undoActionsByType[type]) {\n                    dispatch(undoActionsByType[type].redo(redo));\n                }\n            }\n        }\n        return next(action);\n    };\n});\n"]}