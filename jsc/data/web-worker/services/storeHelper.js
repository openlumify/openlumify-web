function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}define(['../store','../util/ajax','../store/element/actions-impl'],function(store,ajax,elementActions){'use strict';function propertyUrl(elementType,property){return'/'+elementType+'/'+(property.name==='http://openlumify.org/comment#entry'?'comment':'property');}function indexElementProperties(element){if(element){element.propertiesByName=element.properties?_.groupBy(element.properties,'name'):{};}}registerStoreListenerAndFireVerticesUpdated();return{updateElement:function updateElement(workspaceId,element){if(arguments.length===1){element=workspaceId;workspaceId=store.getStore().getState().workspace.currentId;}store.getStore().dispatch(elementActions.updateElement(workspaceId,element));},putSearchResults:function putSearchResults(elements){if(!_.isEmpty(elements)){store.getStore().dispatch(elementActions.putSearchResults(elements));}},indexSearchResultsProperties:function indexSearchResultsProperties(results){var _results$elements=results.elements,elements=_results$elements===undefined?[]:_results$elements,_results$referencedEl=results.referencedElements,referencedElements=_results$referencedEl===undefined?[]:_results$referencedEl;if(elements){elements.forEach(indexElementProperties);}if(referencedElements){referencedElements.forEach(indexElementProperties);}return results;},indexElementProperties:indexElementProperties,createStoreAccessorOrDownloader:function createStoreAccessorOrDownloader(type){return function(options){var key=type+'Ids';var resultKey=type==='vertex'?'vertices':'edges';var state=store.getStore().getState();var workspaceId=state.workspace.currentId;var elements=state.element[workspaceId];var returnSingular=!_.isArray(options[key]);var elementIds=returnSingular?[options[key]]:options[key];var toRequest=elementIds;if(elements){toRequest=_.reject(toRequest,function(id){return id in elements[resultKey];});}return(toRequest.length?ajax('POST','/'+type+'/multiple',_defineProperty({},key,toRequest)):Promise.resolve(_defineProperty({},resultKey,[]))).then(function(result){var results=result[resultKey];if(results.length){var _elementActions$updat;store.getStore().dispatch(elementActions.update((_elementActions$updat={},_defineProperty(_elementActions$updat,resultKey,results),_defineProperty(_elementActions$updat,'workspaceId',workspaceId),_elementActions$updat)));}if(elements){var existing=_.pick(elements[resultKey],elementIds);return Object.values(existing).concat(results);}return results;}).then(function(ret){return returnSingular&&ret.length?ret[0]:ret;});};},vertexPropertyUrl:function vertexPropertyUrl(property){return propertyUrl('vertex',property);},edgePropertyUrl:function edgePropertyUrl(property){return propertyUrl('edge',property);}};function registerStoreListenerAndFireVerticesUpdated(){var redux=store.getStore();var previousElements,previousElementsWorkspaceId;redux.subscribe(function(){var state=redux.getState();var workspaceId=state.workspace.currentId;var newElements=state.element[workspaceId];var workspaceChanged=workspaceId!==previousElementsWorkspaceId;if(previousElements&&!workspaceChanged&&newElements!==previousElements){['vertices','edges'].forEach(function(type){var updated=[];var deleted=[];_.each(newElements[type],function(el,id){if(id in previousElements[type]&&el!==previousElements[type][id]){if(el===null){deleted.push(id);}else{updated.push(el);}}});if(updated.length){dispatchMain('rebroadcastEvent',{eventName:type+'Updated',data:_defineProperty({},type,updated)});}if(deleted.length){var fire=function fire(data){dispatchMain('rebroadcastEvent',{eventName:type+'Deleted',data:data});};if(type==='vertices'){fire({vertexIds:deleted});}else{deleted.forEach(function(id){return fire({edgeId:id});});}}});}previousElements=newElements;previousElementsWorkspaceId=workspaceId;});}});
//# sourceMappingURL=storeHelper.js.map
