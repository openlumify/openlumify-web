{"version":3,"sources":["../../js/admin/admin.js"],"names":["define","defineComponent","registry","template","attacher","documentExtensionPoint","e","Component","componentPath","url","section","name","subtitle","adminList","AdminList","getExtensions","userPrivileges","openlumifyData","currentUser","privileges","extensionsForPoint","filter","extension","_","isFunction","requiredPrivilege","indexOf","defaultAttrs","listSelector","pluginItemSelector","formSelector","after","loadingAdminExtension","Promise","resolve","on","document","onShowAdminPlugin","didToggleDisplay","onClickPluginItem","$node","html","update","event","data","visible","find","removeClass","cancel","form","select","hide","removePrefixedClasses","node","teardown","empty","preventDefault","trigger","$","target","closest","self","toLowerCase","$adminListItem","isEqual","container","hasClass","addClass","siblings","end","resizable","handles","minWidth","maxWidth","resize","window","open","delay","promise","component","path","params","attach","then","show","finally","extensions","require","d3","get","selectAll","chain","groupBy","pairs","sortBy","d","each","sortHint","options","Number","isInteger","MAX_VALUE","value","flatten","call","exit","remove","enter","append","attr","isString","textContent","JSON","stringify","pick","tap","c","text"],"mappings":"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","file":"admin.js","sourcesContent":["define([\n    'flight/lib/component',\n    'configuration/plugins/registry',\n    './template.hbs',\n    'util/component/attacher',\n    './bundled/index'\n], function(\n    defineComponent,\n    registry,\n    template,\n    attacher) {\n    'use strict';\n\n    /**\n     * Renders a new link to an admin form in the admin list (opened from\n     * menubar icon.)\n     *\n     * The component is placed in a pane next to the admin list and\n     * automatically will scroll if the height is larger than window.\n     *\n     * One of `Component`, `componentPath`, or `url` is required.\n     *\n     * @param {org.openlumify.admin~Component} [Component]\n     * @param {string} [componentPath] Path to {@link org.openlumify.admin~Component}\n     * @param {string} [url] Open a url in a new window instead of rendering a\n     * form\n     * @param {string} section The section to place new admin link. Either\n     * existing or new group\n     * @param {string} name The title of the admin link\n     * @param {string} subtitle The subtitle of the admin link displayed below\n     * `name`\n     * @param {string|org.openlumify.admin~requiredPrivilege} [requiredPrivilege] Only show link if user has the given\n     * privilege\n     * @param {object} [options]\n     * @param {number} [options.sortHint] A number indicating the admin tool's position within the section. If not\n    included, admin items will be sorted within a section by `name`.\n     */\n    registry.documentExtensionPoint('org.openlumify.admin',\n        'Add admin tools to admin pane',\n        function(e) {\n            return (e.Component || e.componentPath || e.url) &&\n                e.section && e.name && e.subtitle\n        },\n        'http://docs.openlumify.org/extension-points/front-end/admin'\n    );\n\n    var adminList = defineComponent(AdminList);\n\n    adminList.getExtensions = function() {\n        var userPrivileges = openlumifyData.currentUser.privileges;\n        return registry.extensionsForPoint('org.openlumify.admin')\n            .filter(function(extension) {\n                /**\n                 * @callback org.openlumify.admin~requiredPrivilege\n                 * @param {Array.<object>} userPrivileges The current users\n                 * privileges\n                 * @return {boolean} If the admin tool should be shown to user\n                 */\n                if (_.isFunction(extension.requiredPrivilege)) {\n                    if (!extension.requiredPrivilege(userPrivileges)) {\n                        return false;\n                    }\n                } else if (!extension.requiredPrivilege) {\n                    if (userPrivileges.indexOf('ADMIN') < 0) {\n                        return false;\n                    }\n                } else {\n                    if (userPrivileges.indexOf(extension.requiredPrivilege) < 0) {\n                        return false;\n                    }\n                }\n                return true;\n            });\n    };\n\n    return adminList;\n\n    function AdminList() {\n        this.defaultAttrs({\n            listSelector: '.admin-list',\n            pluginItemSelector: '.admin-list > li a',\n            formSelector: '.admin-form'\n        });\n\n        this.after('initialize', function() {\n            this.loadingAdminExtension = Promise.resolve();\n            this.on(document, 'showAdminPlugin', this.onShowAdminPlugin);\n            this.on(document, 'didToggleDisplay', this.didToggleDisplay);\n            this.on('click', {\n                pluginItemSelector: this.onClickPluginItem\n            });\n            this.$node.html(template({}));\n            this.update();\n        });\n\n        this.didToggleDisplay = function(event, data) {\n            if (data.name === 'admin' && !data.visible) {\n                this.$node.find('.admin-list .active').removeClass('active');\n                this.loadingAdminExtension.cancel();\n                var form = this.select('formSelector').hide().find('.content').removePrefixedClasses('admin_less_cls')\n                attacher().node(form).teardown();\n                form.empty();\n            }\n        };\n\n        this.onClickPluginItem = function(event) {\n            event.preventDefault();\n            this.trigger('showAdminPlugin', $(event.target).closest('li').data('component'));\n        };\n\n        this.onShowAdminPlugin = function(event, data) {\n            var self = this;\n\n            if (data && data.name && data.section) {\n                data.name = data.name.toLowerCase();\n                data.section = data.section.toLowerCase();\n            }\n\n            var $adminListItem = this.select('listSelector').find('li').filter(function() {\n                    return _.isEqual($(this).data('component'), data);\n                }),\n                container = this.select('formSelector'),\n                form = container.find('.content');\n\n            if ($adminListItem.hasClass('active')) {\n                attacher().node(form).teardown();\n                $adminListItem.removeClass('active');\n                self.select('formSelector').hide();\n                self.trigger(container, 'paneResized');\n                return;\n            }\n            this.loadingAdminExtension.cancel();\n            $adminListItem.addClass('active').siblings('.active').removeClass('active loading').end();\n\n            container.resizable({\n                handles: 'e',\n                minWidth: 120,\n                maxWidth: 500,\n                resize: function() {\n                    self.trigger(document, 'paneResized');\n                }\n            });\n            var extension = _.find(adminList.getExtensions(), function(e) {\n                    return e.name.toLowerCase() === data.name &&\n                        e.section.toLowerCase() === data.section;\n                });\n\n            form.removePrefixedClasses('admin_less_cls');\n\n            if (extension) {\n                if (extension.url) {\n                    window.open(extension.url, 'ADMIN_OPEN_URL');\n                    container.hide();\n                    self.trigger(document, 'paneResized');\n                    _.delay(function() {\n                        $adminListItem.removeClass('active');\n                    }, 100)\n                } else {\n                    $adminListItem.addClass('loading');\n\n                    /**\n                     * FlightJS or React component displaying the admin\n                     * interface.\n                     *\n                     * @typedef org.openlumify.admin~Component\n                     * @property {object} data Admin-tool specific data passed from router\n                     */\n                    var promise = attacher()\n                        .node(form)\n                        .component(extension.component)\n                        .path(extension.componentPath)\n                        .params(data)\n                        .attach({ teardown: true, empty: true })\n                        .then(function() {\n                            self.trigger(container.show(), 'paneResized');\n                        });\n\n                    promise.finally(function() {\n                        $adminListItem.removeClass('loading');\n                    });\n                    this.loadingAdminExtension = promise;\n                }\n            } else {\n                this.trigger(container, 'paneResized');\n            }\n        };\n\n        this.update = function() {\n            var self = this,\n                extensions = adminList.getExtensions();\n\n            require(['d3'], function(d3) {\n                d3.select(self.select('listSelector').get(0))\n                    .selectAll('li')\n                    .data(\n                        _.chain(extensions)\n                        .groupBy('section')\n                        .pairs()\n                        .sortBy(function(d) {\n                            return d[0];\n                        })\n                        .each(function(d) {\n                            d[1] = _.chain(d[1])\n                                .sortBy('name')\n                                .sortBy(function sortHint({ options }) {\n                                    return options && Number.isInteger(options.sortHint) ?\n                                        options.sortHint : Number.MAX_VALUE;\n                                })\n                                .value();\n                        })\n                        .flatten()\n                        .value()\n                    )\n                    .call(function() {\n                        this.exit().remove();\n                        this.enter().append('li')\n                            .attr('class', function(component) {\n                                if (_.isString(component)) {\n                                    return 'nav-header';\n                                }\n                            }).each(function(component) {\n                                if (!_.isString(component)) {\n                                    d3.select(this).append('a');\n                                }\n                            });\n\n                        this.each(function(component) {\n                            if (_.isString(component)) {\n                                this.textContent = component;\n                                return;\n                            }\n\n                            d3.select(this)\n                                .attr('data-component', JSON.stringify(\n                                    _.chain(component)\n                                    .pick('section', 'name')\n                                    .tap(function(c) {\n                                        c.name = c.name.toLowerCase();\n                                        c.section = c.section.toLowerCase();\n                                    }).value()\n                                ))\n                                .select('a')\n                                .call(function() {\n                                    this.append('div')\n                                        .attr('class', 'nav-list-title')\n                                        .text(component.name);\n\n                                    this.append('div')\n                                        .attr('class', 'nav-list-subtitle')\n                                        .attr('title', component.subtitle)\n                                        .text(component.subtitle)\n                                });\n                        });\n                    });\n            });\n        };\n    }\n});\n"]}