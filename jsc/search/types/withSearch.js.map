{"version":3,"sources":["../../../js/search/types/withSearch.js"],"names":["define","registry","Filters","template","withDataRequest","F","ElementList","withSearch","call","attributes","resultsSelector","resultsContainerSelector","filtersSelector","after","render","on","document","onToggleDisplay","onSearchByParameters","event","data","success","result","self","elements","$searchResults","select","$resultsContainer","teardownAllComponents","empty","$hits","find","text","i18n","end","toggle","_","isUndefined","totalHits","length","hide","show","children","scrollTop","attachTo","items","usageContext","nextOffset","infiniteScrolling","attr","total","makeResizable","trigger","clearMatch","hideAndClearSearchResults","filters","match","type","name","$node","closest","hideSearchResults","html","showSearchResults","filtersNode","stopPropagation","$","target","is","searchType","supportsHistogram","supportsSorting","searchOptions","clear","node","resizable","handles","minWidth","maxWidth","resize"],"mappings":"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","file":"withSearch.js","sourcesContent":["define([\n    'flight/lib/registry',\n    '../filters/filters',\n    './templates/type.hbs',\n    'util/withDataRequest',\n    'util/formatters',\n    'util/element/list'\n], function(\n    registry,\n    Filters,\n    template,\n    withDataRequest,\n    F,\n    ElementList\n) {\n    'use strict';\n\n    return withSearch;\n\n    function withSearch() {\n\n        withDataRequest.call(this);\n\n        this.attributes({\n            resultsSelector: '.search-results',\n            resultsContainerSelector: '.search-results .content > div',\n            filtersSelector: '.search-filters'\n        });\n\n        this.after('initialize', function() {\n            this.render();\n\n            this.on(document, 'menubarToggleDisplay', this.onToggleDisplay);\n\n            this.on('searchByParameters', this.onSearchByParameters);\n            this.on('searchRequestCompleted', function(event, data) {\n                if (data.success && data.result) {\n                    var self = this,\n                        result = data.result,\n                        elements = result.elements,\n                        $searchResults = this.select('resultsSelector'),\n                        $resultsContainer = this.select('resultsContainerSelector')\n                            .teardownAllComponents()\n                            .empty(),\n                        $hits = $searchResults.find('.total-hits').find('span').text(\n                            i18n('search.results.none')\n                        ).end().toggle(\n                            _.isUndefined(result.totalHits) ?\n                                result.elements.length === 0 :\n                                result.totalHits === 0\n                        );\n\n                    if (result.totalHits === 0) {\n                        $searchResults.hide();\n                    } else {\n                        $searchResults.show().children('.content').scrollTop(0);\n\n                        ElementList.attachTo($resultsContainer, {\n                            items: result.elements,\n                            usageContext: 'searchresults',\n                            nextOffset: result.nextOffset,\n                            infiniteScrolling: this.attr.infiniteScrolling,\n                            total: result.totalHits\n                        });\n\n                        this.makeResizable($searchResults);\n                    }\n                    this.trigger($searchResults, 'paneResized');\n                }\n\n                this.on(document, 'switchWorkspace', () => {\n                    this.trigger('clearSearch', { clearMatch: false })\n                });\n            });\n            this.on('clearSearch', function(event, data) {\n                this.hideAndClearSearchResults();\n\n                var filters = this.select('filtersSelector').find('.content')\n                this.trigger(filters, 'clearfilters', data);\n            });\n            this.on('searchtypeloaded', function(event, data) {\n                var filters = this.select('filtersSelector').find('.content')\n                this.trigger(filters, 'enableMatchSelection', {\n                    match: data.type === 'OpenLumify'\n                })\n            })\n        });\n\n        this.onToggleDisplay = function(event, data) {\n            if (data.name === 'search') {\n                if (this.$node.closest('.visible').length === 0) {\n                    this.hideSearchResults();\n                } else {\n                    if (this.select('resultsContainerSelector').html().length > 0) {\n                        this.showSearchResults();\n                    }\n                }\n            }\n        };\n\n        this.onSearchByParameters = function(event, data) {\n            var filtersNode = this.select('filtersSelector').find('.content')\n            event.stopPropagation();\n            if ($(event.target).is(filtersNode)) return;\n            filtersNode.trigger(event.type, data);\n        };\n\n        this.render = function() {\n            this.$node.html(template({}));\n\n            this.hideSearchResults();\n\n            this.on('filtersLoaded', function() {\n                this.trigger('searchtypeloaded', { type: this.attr.searchType });\n            });\n\n            var filters = this.select('filtersSelector');\n            Filters.attachTo(filters.find('.content'), {\n                supportsHistogram: this.attr.supportsHistogram === true,\n                supportsSorting: this.attr.supportsSorting !== false,\n                searchType: this.attr.searchType,\n                match: this.searchOptions && this.searchOptions.match || 'vertex'\n            });\n        };\n\n        this.hideAndClearSearchResults = function() {\n            return this.hideSearchResults(true);\n        };\n\n        this.hideSearchResults = function(clear) {\n            this.select('resultsSelector')\n                .hide();\n            if (clear) {\n                this.select('resultsContainerSelector')\n                    .teardownAllComponents()\n                    .empty();\n            }\n            this.trigger(document, 'paneResized');\n        };\n\n        this.showSearchResults = function() {\n            this.select('resultsSelector')\n                .show();\n            this.trigger(document, 'paneResized');\n        };\n\n        this.makeResizable = function(node) {\n            var self = this;\n\n            // Add splitbar to search results\n            return node.resizable({\n                handles: 'e',\n                minWidth: 200,\n                maxWidth: 350,\n                resize: function() {\n                    self.trigger(document, 'paneResized');\n                }\n            });\n        };\n\n    }\n});\n"]}