{"version":3,"sources":["../../../js/search/dashboard/savedSearch.js"],"names":["define","defineComponent","withDataRequest","SavedSearch","attributes","resultsContainerSelector","item","after","on","onInfiniteScrollRequest","loadSearch","attr","configuration","searchId","dataRequest","then","search","off","loadItems","catch","e","trigger","extension","setConfiguring","self","config","limitResults","searchParameters","_","isNumber","size","$node","text","i18n","results","elements","length","require","List","attachTo","$","appendTo","empty","css","edges","vertices","infiniteScrolling","totalHits","nextOffset","html","error","console","select","teardownAllComponents","event","data","bind","options","extend","paging","success","items","total"],"mappings":"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","file":"savedSearch.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/withDataRequest'\n], function(defineComponent, withDataRequest) {\n    'use strict';\n\n    return defineComponent(SavedSearch, withDataRequest);\n\n    function SavedSearch() {\n\n        this.attributes({\n            resultsContainerSelector: '.element-list',\n            item: null\n        });\n\n        this.after('initialize', function() {\n            this.on('infiniteScrollRequest', this.onInfiniteScrollRequest);\n\n            this.loadSearch();\n        });\n\n        this.loadSearch = function() {\n            const item = this.attr.item;\n            if (item.configuration.searchId) {\n                this.dataRequest('search', 'get', this.attr.item.configuration.searchId)\n                    .then((search) => {\n                        this.off('refreshData', this.loadSearch);\n                        this.on('refreshData', this.loadSearch);\n                        this.loadItems();\n                    })\n                    .catch((e) => {\n                        item.configuration.searchId = '';\n                        this.trigger('configurationChanged', {\n                            item: item,\n                            extension: this.attr.extension\n                        });\n                    });\n            } else {\n                this.setConfiguring();\n            }\n        };\n\n        this.loadItems = function() {\n            var self = this,\n                config = this.attr.item.configuration,\n                limitResults = config.searchParameters && _.isNumber(config.searchParameters.size);\n\n            this.$node.text(i18n('dashboard.savedsearches.loading'));\n            this.dataRequest('search', 'run', config.searchId, config.searchParameters)\n                .then(function(results) {\n                    if (results.elements.length) {\n                        require(['util/element/list'], function(List) {\n                            List.attachTo($('<div>').appendTo(self.$node.empty().css('overflow', 'auto')), {\n                                edges: results.elements,\n                                vertices: results.elements,\n                                infiniteScrolling: !limitResults && (results.elements.length < results.totalHits),\n                                nextOffset: results.nextOffset\n                            })\n                        })\n                    } else {\n                        self.$node.html('<i>No results</i>');\n                    }\n                })\n                .catch(function(error) {\n                    console.error(error);\n                    self.trigger('showError');\n                })\n        }\n\n        this.setConfiguring = function() {\n            const self = this;\n\n            this.select('resultsContainerSelector').teardownAllComponents();\n            this.$node\n                .css('overflow', 'inherit')\n                .html(\n                    $('<a>')\n                        .text(i18n('dashboard.savedsearches.configure'))\n                        .on('click', function() {\n                            self.trigger('configureItem');\n                        })\n                );\n        }\n\n       this.onInfiniteScrollRequest = function(event, data) {\n            var trigger = this.trigger.bind(this,\n               this.select('resultsContainerSelector'),\n               'addInfiniteItems'\n            );\n            var options = _.extend({}, this.attr.item.configuration.searchParameters, data.paging)\n\n            this.dataRequest('search', 'run',\n                this.attr.item.configuration.searchId,\n                options\n            )\n            .then(function(results) {\n                 if (results) {\n                     trigger({\n                         success: true,\n                         items: results.elements,\n                         total: results.totalHits,\n                         nextOffset: results.nextOffset\n                     })\n                 }\n            })\n            .catch(function() {\n                trigger({success: false});\n            })\n        };\n    }\n});\n"]}