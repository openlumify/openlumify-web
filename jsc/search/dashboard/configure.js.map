{"version":3,"sources":["../../../js/search/dashboard/configure.js"],"names":["define","defineComponent","withDataRequest","template","require","LIMITS","value","name","i18n","SavedSearchConfig","serializeSortField","sortField","field","direction","defaultAttrs","searchSelector","aggregationSectionSelector","limitSelector","after","self","on","onChangeSearch","onChangeLimit","onSortFieldsUpdated","onAggregationsUpdated","onStatisticsForAggregation","aggregations","getAggregations","sortFields","getSortFields","limit","getLimit","render","then","updateAggregationVisibility","bind","trigger","event","data","configuration","attr","item","searchId","params","_","omit","searchParameters","paramsWithStats","extend","size","type","aggregation","map","JSON","stringify","dataRequest","r","aggregates","$","target","success","statistics","Error","catch","previousAggregations","isEqual","$node","find","toggle","length","report","endpoint","endpointParameters","id","isDate","interval","checkToTrigger","changed","isEmpty","sort","compact","triggerChange","preventTrigger","conceptId","searchesById","parameters","conceptType","Promise","Aggregation","node","select","a","attachTo","teardownComponent","first","updateAggregationDependents","html","loading","searches","indexBy","config","search","selected","limits","l","String","sortRegex","isArray","chain","match","parse","hide","val","closest","show","all","spread","properties","Sort","sortFieldsNode","sorts","aggregationField","attachPropertySelection","options","done","results","shift","FieldSelection","selectedProperty","byTitle","list","showAdminProperties","placeholder","setTitle","title","extension","initialTitle","parseInt"],"mappings":"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","file":"configure.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/withDataRequest',\n    './configureTpl.hbs',\n    'require'\n], function(\n    defineComponent,\n    withDataRequest,\n    template,\n    require) {\n    'use strict';\n\n    var LIMITS = [\n            { value: '', name: i18n('dashboard.savedsearches.limit.none')},\n            { value: '1', name: i18n('dashboard.savedsearches.limit.1')},\n            { value: '5', name: i18n('dashboard.savedsearches.limit.5')},\n            { value: '10', name: i18n('dashboard.savedsearches.limit.10')},\n            { value: '25', name: i18n('dashboard.savedsearches.limit.25')}\n        ];\n\n    return defineComponent(SavedSearchConfig, withDataRequest);\n\n    function serializeSortField(sortField) {\n        if (sortField) {\n            return sortField.field + ':' + sortField.direction;\n        }\n    }\n\n    function SavedSearchConfig() {\n\n        this.defaultAttrs({\n            searchSelector: 'select.search',\n            aggregationSectionSelector: 'section.aggregation',\n            limitSelector: '.limit select'\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n            this.on('change', {\n                searchSelector: this.onChangeSearch,\n                limitSelector: this.onChangeLimit\n            });\n            this.on('sortFieldsUpdated', this.onSortFieldsUpdated);\n            this.on('aggregationsUpdated', this.onAggregationsUpdated);\n            this.on('statisticsForAggregation', this.onStatisticsForAggregation);\n\n            this.aggregations = this.getAggregations();\n            this.sortFields = this.getSortFields();\n            this.limit = this.getLimit();\n\n            this.render()\n                .then(this.updateAggregationVisibility.bind(this, true))\n                .then(function() {\n                    self.trigger('positionDialog');\n                })\n        });\n\n        this.onStatisticsForAggregation = function(event, data) {\n            var configuration = this.attr.item.configuration,\n                searchId = configuration.searchId,\n                params = _.omit(configuration.searchParameters, 'aggregations'),\n                paramsWithStats = _.extend(params, {\n                    size: 0,\n                    aggregations: [{\n                        type: 'statistics',\n                        field: data.aggregation.field,\n                        name: 'field'\n                    }].map(JSON.stringify)\n                })\n\n            return this.dataRequest('search', 'run', searchId, paramsWithStats)\n                .then(function(r) {\n                    if (r && r.aggregates) {\n                        $(event.target).trigger('aggregationStatistics', {\n                            success: true,\n                            statistics: _.extend({\n                                field: data.aggregation.field\n                            }, r.aggregates.field)\n                        })\n                    } else throw new Error('No aggregates');\n                })\n                .catch(function() {\n                    $(event.target).trigger('aggregationStatistics', {\n                        success: false\n                    });\n                })\n        };\n\n        this.onAggregationsUpdated = function(event, data) {\n            let previousAggregations = this.aggregations;\n            if (_.isEqual(previousAggregations, data.aggregations)) return;\n\n            this.aggregations = data.aggregations;\n            this.$node.find('.sort,.limit').toggle(this.aggregations.length === 0);\n\n            if (this.aggregations.length) {\n                this.attr.item.configuration.report = {\n                    endpoint: '/search/run',\n                    endpointParameters: {\n                        id: this.attr.item.configuration.searchId,\n                        size: 0,\n                        aggregations: this.aggregations\n                            .map(function(aggregation) {\n                                if (aggregation.isDate) {\n                                    aggregation.interval = aggregation.interval + 'ms';\n                                    delete aggregation.isDate;\n                                }\n                                return aggregation;\n                            })\n                            .map(JSON.stringify)\n                    }\n                }\n            } else if (!previousAggregations) return;\n\n            this.checkToTrigger(true);\n        };\n\n        this.onSortFieldsUpdated = function(event, data) {\n            this.sortFields = data.sortFields;\n            this.checkToTrigger(true);\n        };\n\n        this.checkToTrigger = function(changed) {\n            if (_.isEmpty(this.aggregations) && !this.sortFields && !changed) return;\n\n            var item = this.attr.item,\n                aggregations = this.aggregations;\n\n            if (!_.isEmpty(aggregations)) {\n                item.configuration.searchParameters = {\n                    aggregations: aggregations.map(JSON.stringify)\n                }\n            } else {\n                delete item.configuration.report;\n                item.configuration.searchParameters = {\n                    sort: _.compact((this.sortFields || []).map(serializeSortField))\n                }\n                if (this.limit) {\n                    item.configuration.searchParameters.size = this.limit;\n                }\n            }\n            this.triggerChange();\n        };\n\n        this.updateAggregationVisibility = function(preventTrigger) {\n            var self = this,\n                searchId = this.attr.item.configuration.searchId,\n                conceptId = searchId ? this.searchesById[searchId].parameters.conceptType : null;\n\n            return Promise.require('search/dashboard/aggregation').then(function(Aggregation) {\n                const node = self.select('aggregationSectionSelector');\n                let aggregations;\n                if (self.aggregations) {\n                    aggregations = self.aggregations.map(a => ({ ...a}));\n                }\n\n                node.toggle(!!self.attr.item.configuration.searchId);\n                Aggregation.attachTo(node.teardownComponent(Aggregation), {\n                    aggregations\n                })\n                if (conceptId) {\n                    node.trigger('filterProperties', { conceptId });\n                }\n                var aggregation = _.first(self.aggregations);\n                return self.updateAggregationDependents(aggregation && aggregation.type, preventTrigger);\n\n            });\n        };\n\n        this.render = function() {\n            var self = this;\n            this.$node.html(template({ loading: true }));\n\n            return this.dataRequest('search', 'all')\n                .then(function(searches) {\n                    self.searchesById = _.indexBy(searches, 'id');\n\n                    var config = self.attr.item.configuration;\n\n                    self.$node.html(template({\n                        searches: searches.map(function(search) {\n                            var selected = false;\n                            if (search.id === config.searchId) {\n                                selected = true;\n                            }\n                            return _.extend({}, search, {\n                                selected: selected\n                            })\n                        }),\n                        limits: LIMITS.map(function(l) {\n                            return _.extend({}, l, {\n                                selected: l.value === String(self.limit)\n                            })\n                        })\n                    }));\n                })\n        };\n\n        this.getLimit = function(event) {\n            var searchParameters = this.attr.item.configuration.searchParameters;\n            if (searchParameters && searchParameters.size) {\n                return searchParameters.size;\n            }\n        };\n\n        this.getSortFields = function() {\n            var sortRegex = /^(.*):(ASCENDING|DESCENDING)$/,\n                searchParameters = this.attr.item.configuration.searchParameters;\n            if (searchParameters && _.isArray(searchParameters.sort)) {\n                return _.chain(searchParameters.sort)\n                    .map(function(sort) {\n                        var match = sort.match(sortRegex);\n                        if (match && match.length === 3) {\n                            return {\n                                field: match[1],\n                                direction: match[2]\n                            };\n                        }\n                    })\n                    .compact()\n                    .value();\n            }\n        };\n\n        this.getAggregations = function() {\n            var searchParameters = this.attr.item.configuration.searchParameters;\n            if (searchParameters && searchParameters.aggregations && searchParameters.aggregations.length) {\n                return searchParameters.aggregations.map(JSON.parse)\n            }\n        }\n\n        this.updateAggregationDependents = function(type, preventTrigger) {\n            var self = this,\n                item = this.attr.item,\n                searchId = this.attr.item.configuration.searchId,\n                conceptId = searchId ? this.searchesById[searchId].parameters.conceptType : null;\n\n            if (type) {\n                if (item.configuration.searchParameters) {\n                    delete item.configuration.searchParameters.sort;\n                    delete item.configuration.searchParameters.size;\n                }\n                this.sortFields = null;\n                this.limit = null;\n                this.$node.find('.sort, .limit').hide();\n            } else {\n                this.$node.find('.agg').hide();\n                this.$node.find('.limit select').val(this.limit && this.limit || '')\n                    .closest('.limit').show();\n\n                Promise.all([\n                    this.dataRequest('ontology', 'properties'),\n                    Promise.require('search/sort')\n                ]).spread(function(properties, Sort) {\n                    var node = self.$node.find('.sort').show(),\n                        sortFieldsNode = node.find('.sort-fields');\n\n                    Sort.attachTo(sortFieldsNode.teardownComponent(Sort), {\n                        sorts: self.sortFields\n                    });\n\n                    if (conceptId) {\n                        sortFieldsNode.trigger('filterProperties', { conceptId });\n                    }\n                });\n                this.aggregationField = null;\n                if (item.configuration.searchParameters) {\n                    delete item.configuration.searchParameters.aggregations;\n                }\n                delete this.attr.item.configuration.report;\n                if (preventTrigger !== true) {\n                    this.triggerChange();\n                }\n\n                return Promise.all([\n                    this.dataRequest('ontology', 'properties'),\n                    Promise.require('search/sort')\n                ]).spread(function(properties, Sort) {\n                    var node = self.$node.find('.sort').show();\n\n                    Sort.attachTo(node.find('.sort-fields').teardownComponent(Sort), {\n                        sorts: self.sortFields\n                    })\n                });\n            }\n        };\n\n        this.attachPropertySelection = function(node, options) {\n            if (!options) {\n                options = {};\n            }\n            return Promise.all([\n                this.dataRequest('ontology', 'properties'),\n                Promise.require('util/ontology/propertySelect')\n            ]).done(function(results) {\n                var properties = results.shift(),\n                    FieldSelection = results.shift();\n\n                node.teardownComponent(FieldSelection);\n                FieldSelection.attachTo(node, {\n                    selectedProperty: options.selected && properties.byTitle[options.selected] || null,\n                    properties: properties.list,\n                    showAdminProperties: true,\n                    placeholder: options.placeholder || ''\n                });\n            });\n        };\n\n        this.setTitle = function(search) {\n            var title = this.attr.extension.title;\n            if (search) {\n                title += ': ' + search.name;\n            }\n\n            if (this.attr.item.title === this.attr.item.configuration.initialTitle) {\n                this.attr.item.title = title;\n                this.trigger('cardTitleChanged', { title: title });\n            }\n\n            this.attr.item.configuration.initialTitle = title;\n        };\n\n        this.onChangeLimit = function(event) {\n            var val = $(event.target).val();\n            if (!this.attr.item.configuration.searchParameters) {\n                this.attr.item.configuration.searchParameters = {};\n            }\n\n            if (val) {\n                this.limit = parseInt(val, 10);\n                this.attr.item.configuration.searchParameters.size = this.limit;\n            } else {\n                this.limit = null;\n                delete this.attr.item.configuration.searchParameters.size;\n            }\n            this.checkToTrigger(true);\n        };\n\n        this.onChangeSearch = function(event) {\n            var searchId = $(event.target).val(),\n                item = this.attr.item;\n\n            item.configuration.searchId = searchId;\n            this.setTitle(this.searchesById[searchId]);\n\n            this.updateAggregationVisibility(true);\n            this.checkToTrigger(true);\n        };\n\n        this.triggerChange = function() {\n            this.trigger('configurationChanged', {\n                extension: this.attr.extension,\n                item: this.attr.item\n            });\n        };\n\n    }\n});\n"]}