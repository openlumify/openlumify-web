{"version":3,"sources":["../../../js/detail/toolbar/toolbar.js"],"names":["define","defineComponent","template","registry","F","withDataRequest","acl","documentExtensionPoint","e","divider","DIVIDER","ToolbarComponent","Toolbar","ITEMS","BACK","title","FORWARD","FULLSCREEN","i18n","cls","subtitle","event","ADD_PROPERTY","ADD_IMAGE","options","fileSelector","ADD_COMMENT","AUDIT","DELETE_ITEM","defaultAttrs","toolbarItemSelector","after","on","onUpdateModel","render","model","attr","Promise","resolve","calculateConfigForModel","then","initializeToolbar","items","data","config","toolbarItems","objects","toolbarExtensions","_","sortBy","extensionsForPoint","forEach","item","isFunction","canHandle","eventData","insertIntoMenuItems","push","onToolbarItem","length","$node","html","find","each","$this","$","shouldHide","hasClass","all","map","css","toArray","hide","isArray","vertices","where","type","edges","submenu","concat","selectionHistory","number","pretty","right","getPropertyAcls","compact","sourceUrlToolbarItem","openToolbarItem","downloadToolbarItem","addPropertyToolbarItem","propertyAcls","addImageToolbarItem","addCommentToolbarItem","icon","deleteToolbarItem","self","$target","target","closest","eventName","preventDefault","stopPropagation","is","one","files","trigger","extend","hideMenu","defer","node","addClass","remove","once","removeClass","window","openlumifyData","menus","stack","selectedObjectsStack","i","s","vertexIds","edgeIds","splice","rawProps","vertex","props","isObject","properties","sourceUrl","findWhere","name","value","commentPropertyAcls","reject","property","hasAddableProperties","addable","currentUser","privilegesHelper","ONTOLOGY_ADD","disableAdd","hasOwnProperty","updateable","displayType","disableAddImage","hasAddableCommentProperty","disableDelete","deleteable"],"mappings":"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","file":"toolbar.js","sourcesContent":["define([\n    'flight/lib/component',\n    './template.hbs',\n    'configuration/plugins/registry',\n    'util/vertex/formatters',\n    'util/withDataRequest',\n    'util/acl'\n], function(\n    defineComponent,\n    template,\n    registry,\n    F,\n    withDataRequest,\n    acl) {\n    'use strict';\n\n\n    /**\n     * These items can be added to single entity/edge inspectors, or the\n     * multiple selection inspector (or both). Use `canHandle` to specify\n     * what inspectors to apply to.\n     *\n     * @param {string} event The event to fire when clicked\n     * @param {string} title The text to display in the toolbar\n     * @param {string} [subtitle] The text to display underneath the title\n     * @param {string} [cls] A CSS classname to add to the items element. Add `disabled` to prevent events from firing\n     * @param {org.openlumify.detail.toolbar~canHandle} [canHandle] Whether this item should be added based on what's in the detail pane.\n     * @param {boolean} [divider=false] Specify `true` for a toolbar menu divider instead of an actionable item\n     * @param {Array.<object>} [submenu] Specify list of submenu toolbar items. Only one level supported\n     * @param {boolean} [right=false] Specify `true` to float item to the right\n     * @param {object} [options]\n     * @param {org.openlumify.detail.toolbar~insertIntoMenuItems} [options.insertIntoMenuItems] function to place the item in a specific location/order\n     * @example <caption>Add Button</caption>\n     * registry.registerExtension('org.openlumify.detail.toolbar', {\n     *     event: 'myEvent',\n     *     title: 'Test Button'\n     * })\n     * @example <caption>Add Divider</caption>\n     * registry.registerExtension('org.openlumify.detail.toolbar', { divider: true })\n     */\n    registry.documentExtensionPoint('org.openlumify.detail.toolbar',\n        'Add Inspector toolbar items',\n        function(e) {\n            return e.divider || (('event' in e) && ('title' in e));\n        },\n        'http://docs.openlumify.org/extension-points/front-end/detailToolbar'\n    );\n\n    var DIVIDER = {\n            divider: true\n        },\n        ToolbarComponent = defineComponent(Toolbar, withDataRequest);\n\n    ToolbarComponent.ITEMS = {\n        DIVIDER: DIVIDER,\n        BACK: { title: '◀' },\n        FORWARD: { title: '▶' },\n        FULLSCREEN: {\n            title: i18n('detail.toolbar.open.fullscreen'),\n            cls: 'hide-in-fullscreen-details',\n            subtitle: i18n('detail.toolbar.open.fullscreen.subtitle'), //'Open in New Window / Tab',\n            event: 'openFullscreen'\n        },\n        ADD_PROPERTY: {\n            title: i18n('detail.toolbar.add.property'),\n            subtitle: i18n('detail.toolbar.add.property.entity.subtitle'), // 'Add New Property to Entity',\n            cls: 'requires-EDIT',\n            event: 'addNewProperty'\n        },\n        ADD_IMAGE: {\n            title: i18n('detail.toolbar.add.image'),\n            subtitle: i18n('detail.toolbar.add.image.subtitle'), // 'Upload an Image for Entity',\n            cls: 'requires-EDIT',\n            event: 'addImage',\n            options: {\n                fileSelector: true\n            }\n        },\n        ADD_COMMENT: {\n            title: i18n('detail.toolbar.add.comment'),\n            subtitle: i18n('detail.toolbar.add.comment.entity.subtitle'), // 'Add New Comment to Entity',\n            cls: 'requires-COMMENT',\n            event: 'addNewComment'\n        },\n        AUDIT: {\n            title: i18n('detail.toolbar.audit'),\n            subtitle: i18n('detail.toolbar.audit.subtitle'),\n            cls: 'audits',\n            event: 'toggleAudit'\n        },\n        DELETE_ITEM: {\n            title: i18n('detail.toolbar.delete'),\n            cls: 'requires-EDIT',\n            event: 'deleteItem'\n        }\n    };\n\n    return ToolbarComponent;\n\n    function Toolbar() {\n        this.defaultAttrs({\n            toolbarItemSelector: 'li'\n        });\n\n        this.after('initialize', function() {\n            this.on('updateModel', this.onUpdateModel)\n\n            this.render();\n        });\n\n        this.render = function() {\n            const model = this.attr.model;\n\n            Promise.resolve(this.calculateConfigForModel(model))\n                .then(items => this.initializeToolbar(items));\n        };\n\n        this.onUpdateModel = function(event, data) {\n            this.attr.model = data.model;\n            this.render();\n        };\n\n        this.initializeToolbar = function(config) {\n            var toolbarItems = config.items,\n                objects = config.objects,\n                toolbarExtensions = _.sortBy(registry.extensionsForPoint('org.openlumify.detail.toolbar'), 'title');\n\n            toolbarExtensions.forEach(function(item) {\n\n                /**\n                 * @callback org.openlumify.detail.toolbar~canHandle\n                 * @param {Array.<object>} objects List of all objects displayed in detail pane\n                 * @returns {boolean} Whether this extension should display for `objects`\n                 */\n                if (!_.isFunction(item.canHandle) || item.canHandle(objects)) {\n                    item.eventData = objects;\n                    if (item.options && _.isFunction(item.options.insertIntoMenuItems)) {\n                        /**\n                         * Function that is responsible for inserting `item`\n                         * into `items`.\n                         *\n                         * The `items` array should be mutated, placing the\n                         * `item` into the list, or into a submenu of an item\n                         * in the list.\n                         *\n                         * @callback org.openlumify.detail.toolbar~insertIntoMenuItems\n                         * @param {object} item the toolbar item to insert\n                         * @param {Array.<object>} items The existing toolbar items\n                         * @example\n                         * insertIntoMenuItems: function(item, items) {\n                         *     // Insert item into specific position in items list\n                         *     items.splice(3, 0, item);\n                         * }\n                         */\n                        item.options.insertIntoMenuItems(item, toolbarItems);\n                    } else {\n                        toolbarItems.push(item);\n                    }\n                }\n            });\n\n            this.on('click', {\n                toolbarItemSelector: this.onToolbarItem\n            });\n            if (toolbarItems.length) {\n                this.$node.html(template(config));\n                this.$node.find('li').each(function() {\n                    var $this = $(this),\n                        shouldHide = $this.hasClass('has-submenu') ?\n                            _.all($this.find('li').map(function() {\n                                return $(this).css('display') === 'none';\n                            }).toArray()) :\n                            $this.hasClass('no-event');\n\n                    if (shouldHide) {\n                        $this.hide();\n                    }\n                })\n            } else {\n                this.$node.hide();\n            }\n        };\n\n        this.calculateConfigForModel = function(model) {\n            var isArray = _.isArray(model),\n                vertices = isArray ? _.where(model, { type: 'vertex' }) : (model.type === 'vertex' ? [model] : []),\n                edges = isArray ? _.where(model, { type: 'edge' }) : (model.type === 'edge' ? [model] : []);\n\n            if (isArray) {\n                return {\n                    items: [\n                        {\n                            title: i18n('detail.toolbar.open'),\n                            submenu: [\n                                ToolbarComponent.ITEMS.FULLSCREEN\n                            ].concat(this.selectionHistory())\n                        },\n                        {\n                            title: i18n('detail.multiple.selected', F.number.pretty(model.length)),\n                            cls: 'disabled',\n                            right: true,\n                            event: 'none'\n                        }\n                    ],\n                    objects: { vertices: vertices, edges: edges }\n                }\n            } else {\n                return acl.getPropertyAcls(model).then(propertyAcls => {\n                    return {\n                        items: [\n                            {\n                                title: i18n('detail.toolbar.open'),\n                                submenu: _.compact([\n                                    ToolbarComponent.ITEMS.FULLSCREEN,\n                                    this.sourceUrlToolbarItem(model),\n                                    this.openToolbarItem(model),\n                                    this.downloadToolbarItem(model)\n                                ]).concat(this.selectionHistory())\n                            },\n                            {\n                                title: i18n('detail.toolbar.add'),\n                                submenu: _.compact([\n                                    this.addPropertyToolbarItem(model, propertyAcls),\n                                    this.addImageToolbarItem(model),\n                                    this.addCommentToolbarItem(model, propertyAcls)\n                                ])\n                            },\n                            {\n                                icon: 'img/glyphicons/white/glyphicons_157_show_lines@2x.png',\n                                right: true,\n                                submenu: _.compact([\n                                    this.deleteToolbarItem(model)\n                                ])\n                            }\n                        ],\n                        objects: { vertices: vertices, edges: edges }\n                    };\n                });\n            }\n        };\n\n        this.onToolbarItem = function(event) {\n            var self = this,\n                $target = $(event.target).closest('li'),\n                eventName = $target.data('event'),\n                eventData = $target.data('eventData');\n\n            if ($target.length && $target.hasClass('disabled')) {\n                event.preventDefault();\n                event.stopPropagation();\n                return;\n            }\n\n            if (eventName && $(event.target).is('input[type=file]')) {\n                $(event.target).one('change', function(e) {\n                    if (e.target.files && e.target.files.length) {\n                        self.trigger(eventName, $.extend({\n                            files: e.target.files\n                        }, eventData));\n                    }\n                });\n                this.hideMenu();\n                return;\n            }\n\n            if (eventName) {\n                event.preventDefault();\n                event.stopPropagation();\n\n                _.defer(function() {\n                    self.trigger(eventName, eventData);\n                });\n\n                this.hideMenu();\n            }\n        };\n\n        this.hideMenu = function() {\n            var node = this.$node.addClass('hideSubmenus'),\n                remove = _.once(function() {\n                    node.removeClass('hideSubmenus');\n                });\n            $(window).one('mousemove click', remove);\n        };\n\n        this.selectionHistory = function() {\n            if ('selectedObjectsStack' in openlumifyData) {\n                var menus = [],\n                    stack = openlumifyData.selectedObjectsStack;\n\n                for (var i = stack.length - 1; i >= 0; i--) {\n                    var s = stack[i];\n                    menus.push({\n                        title: s.title,\n                        cls: 'history-item',\n                        event: 'selectObjects',\n                        eventData: {\n                            vertexIds: s.vertexIds,\n                            edgeIds: s.edgeIds\n                            //options: {\n                                //ignoreMultipleSelectionOverride: true\n                            //}\n                        }\n                    });\n                }\n                if (menus.length) {\n                    menus.splice(0, 0, DIVIDER, {\n                        title: i18n('detail.toolbar.open.previous'),\n                        cls: 'disabled'\n                    });\n                }\n                return menus;\n            }\n        };\n\n        this.openToolbarItem = function(model) {\n            var rawProps = F.vertex.props(model, 'http://openlumify.org#raw');\n            if (rawProps.length) {\n                return {\n                    title: i18n('detail.artifact.open.original'),\n                    subtitle: i18n('detail.artifact.open.original.subtitle'),\n                    event: 'openOriginal'\n                };\n            }\n        };\n\n        this.downloadToolbarItem = function(model) {\n            var rawProps = F.vertex.props(model, 'http://openlumify.org#raw');\n            if (rawProps.length) {\n                return {\n                    title: i18n('detail.artifact.open.download.original'),\n                    subtitle: i18n('detail.artifact.open.download.original.subtitle'),\n                    event: 'downloadOriginal'\n                };\n            }\n        };\n\n        this.sourceUrlToolbarItem = function(model) {\n            if (_.isObject(model) && _.isArray(model.properties)) {\n                var sourceUrl = _.findWhere(model.properties, { name: 'http://openlumify.org#sourceUrl' });\n\n                if (sourceUrl) {\n                    return {\n                        title: i18n('detail.toolbar.open.source_url'),\n                        subtitle: i18n('detail.toolbar.open.source_url.subtitle'),\n                        event: 'openSourceUrl',\n                        eventData: {\n                            sourceUrl: sourceUrl.value\n                        }\n                    };\n                }\n            }\n        };\n\n        this.addPropertyToolbarItem = function(model, propertyAcls) {\n            var commentPropertyAcls = _.reject(propertyAcls, function(property) {\n                    return property.name === 'http://openlumify.org/comment#entry';\n                }),\n                hasAddableProperties = _.where(commentPropertyAcls, { addable: true }).length > 0 ||\n                    openlumifyData.currentUser.privilegesHelper.ONTOLOGY_ADD,\n                disableAdd = (model.hasOwnProperty('updateable') && !model.updateable) || !hasAddableProperties;\n\n            if (!disableAdd) {\n                return {\n                    ...ToolbarComponent.ITEMS.ADD_PROPERTY,\n                    subtitle: model.type === 'vertex' ? i18n('detail.toolbar.add.property.entity.subtitle') : i18n('detail.toolbar.add.property.relationship.subtitle')\n                };\n            }\n        };\n\n        this.addImageToolbarItem = function(model) {\n            var displayType = F.vertex.displayType(model);\n            var disableAddImage = (model.hasOwnProperty('updateable') && !model.updateable || model.type === 'edge');\n\n            if (!disableAddImage && (displayType !== 'image' && displayType !== 'video')) {\n                return ToolbarComponent.ITEMS.ADD_IMAGE;\n            }\n        };\n\n        this.addCommentToolbarItem = function(model, propertyAcls) {\n            var hasAddableCommentProperty = _.where(propertyAcls, { name: 'http://openlumify.org/comment#entry', addable: true }).length > 0,\n                disableAdd = (model.hasOwnProperty('updateable') && !model.updateable) || !hasAddableCommentProperty;\n\n            if (!disableAdd) {\n                return {\n                    ...ToolbarComponent.ITEMS.ADD_COMMENT,\n                    subtitle: model.type === 'vertex' ? i18n('detail.toolbar.add.comment.entity.subtitle') : i18n('detail.toolbar.add.comment.relationship.subtitle')\n                };\n            }\n        };\n\n        this.deleteToolbarItem = function(model) {\n            var disableDelete = model.hasOwnProperty('deleteable') && !model.deleteable;\n\n            if (!disableDelete) {\n                return _.extend(ToolbarComponent.ITEMS.DELETE_ITEM, {\n                    title: model.type === 'vertex' ? i18n('detail.toolbar.delete.entity') : i18n('detail.toolbar.delete.edge'),\n                    subtitle: model.type === 'vertex' ? i18n('detail.toolbar.delete.entity.subtitle') : i18n('detail.toolbar.delete.edge.subtitle')\n                })\n            }\n        };\n    }\n});\n"]}