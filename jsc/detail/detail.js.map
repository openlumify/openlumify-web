{"version":3,"sources":["../../js/detail/detail.js"],"names":["define","defineComponent","F","withDataRequest","registry","DetailPane","defaultAttrs","mapCoordinatesSelector","detailTypeContentSelector","after","on","onMapCoordinatesClicked","onFinishedTypeContent","document","onObjectsSelected","onSelectObjects","preventDropEventsFromPropagating","before","teardownComponents","$node","html","removeClass","droppable","tolerance","accept","evt","data","preventDefault","$target","$","target","closest","trigger","event","collapsed","is","vertices","edges","options","moduleName","moduleData","moduleName2","pane","length","cancelTransitionTeardown","TRANSITION_END","e","test","originalEvent","propertyName","self","off","addClass","_","unique","Promise","all","require","f","resolve","done","results","Module","shift","attachTo","select","teardownAllComponents","model","concat","constraints","focus","find","empty"],"mappings":"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","file":"detail.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/vertex/formatters',\n    'util/withDataRequest',\n    'configuration/plugins/registry'\n], function(defineComponent, F, withDataRequest, registry) {\n    'use strict';\n\n    return defineComponent(DetailPane, withDataRequest);\n\n    function DetailPane() {\n\n        this.defaultAttrs({\n            mapCoordinatesSelector: '.map-coordinates',\n            detailTypeContentSelector: '.type-content'\n        });\n\n        this.after('initialize', function() {\n            this.on('click', {\n                mapCoordinatesSelector: this.onMapCoordinatesClicked\n            });\n            this.on('finishedLoadingTypeContent', this.onFinishedTypeContent);\n\n            this.on(document, 'objectsSelected', this.onObjectsSelected);\n            this.on(document, 'selectObjects', this.onSelectObjects);\n            this.preventDropEventsFromPropagating();\n\n            this.before('teardown', this.teardownComponents);\n\n            this.$node.html('<div class=\"type-content\"></div>');\n        });\n\n        this.onFinishedTypeContent = function() {\n            this.$node.removeClass('loading');\n        };\n\n        // Ignore drop events so they don't propagate to the graph/map\n        this.preventDropEventsFromPropagating = function() {\n            this.$node.droppable({ tolerance: 'pointer', accept: '*' });\n        };\n\n        this.onMapCoordinatesClicked = function(evt, data) {\n            evt.preventDefault();\n            var $target = $(evt.target).closest('a');\n            this.trigger('mapCenter', $target.data());\n        };\n\n        this.onSelectObjects = function(event, data) {\n            this.collapsed = !this.$node.closest('.detail-pane').is('.visible');\n        };\n\n        this.onObjectsSelected = function(evt, data) {\n            var self = this,\n                { vertices, edges, options } = data,\n                moduleName, moduleData, moduleName2,\n                pane = this.$node.closest('.detail-pane');\n\n            if (!vertices.length && !edges.length) {\n\n                this.cancelTransitionTeardown = false;\n\n                return pane.on(TRANSITION_END, function(e) {\n                    if (/transform/.test(e.originalEvent && e.originalEvent.propertyName)) {\n                        if (self.cancelTransitionTeardown !== true) {\n                            self.teardownComponents();\n                        }\n                        pane.off(TRANSITION_END);\n                    }\n                });\n            }\n\n            this.cancelTransitionTeardown = true;\n            this.teardownComponents();\n            this.$node.addClass('loading');\n\n            vertices = _.unique(vertices, 'id');\n            edges = _.unique(edges, 'id');\n\n            Promise.all([\n                Promise.require('detail/item/item'),\n                this.collapsed ?\n                    new Promise(function(f) {\n                        pane.on(TRANSITION_END, function(e) {\n                            if (/transform/.test(e.originalEvent && e.originalEvent.propertyName)) {\n                                pane.off(TRANSITION_END);\n                                f();\n                            }\n                        });\n                    }) :\n                    Promise.resolve()\n            ]).done(function(results) {\n                var Module = results.shift();\n                Module.attachTo(self.select('detailTypeContentSelector').teardownAllComponents(), {\n                    model: vertices.concat(edges),\n                    constraints: ['width'],\n                    focus: options.focus\n                });\n            })\n        };\n\n        this.teardownComponents = function() {\n            this.select('detailTypeContentSelector').find('*').teardownAllComponents();\n            this.select('detailTypeContentSelector').teardownAllComponents().empty();\n        }\n    }\n});\n"]}