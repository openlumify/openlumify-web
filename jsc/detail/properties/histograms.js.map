{"version":3,"sources":["../../../js/detail/properties/histograms.js"],"names":["define","defineComponent","F","d3","ontology","HISTOGRAM_STYLE","GRAPH_TYPE","EDGE_LABEL","CONCEPT_TYPE","MIN_VALUES_PRESENT_TO_DISPLAY","BAR_HEIGHT","PADDING","ANIMATION_DURATION","BINABLE_TYPES","split","SCALE_COLOR_BASED_ON_WIDTH","SCALE_COLOR_BASED_ON_WIDTH_RANGE","SCALE_OPACITY_BASED_ON_WIDTH","SCALE_OPACITY_BASED_ON_WIDTH_RANGE","NO_HISTOGRAM_DATATYPES","MAX_BINS_FOR_NON_HISTOGRAM_TYPES","OTHER_PLACEHOLDER","PropertyHistograms","attributes","model","histogramSelector","histogramListSelector","histogramBarSelector","before","$node","off","after","self","addClass","html","on","histogramClick","histogramHover","bind","renderHistograms","attr","duration","previousSize","debouncedRender","_","debounce","event","data","$","document","padding","r","elements","options","opacityScale","scale","linear","domain","range","colorScale","animationDuration","isNumber","propertySections","chain","map","element","minimalElement","elementType","type","elementId","id","typeProperty","name","value","extras","push","label","properties","concat","p","extend","flatten","filter","shouldDisplayProperty","groupBy","pairs","each","pair","reject","ontologyProperty","byTitle","indexOf","dataType","valueCounts","values","key","length","len","orderedCounts","unique","sort","a","b","collapseSmallest","moveToOtherWithCount","shift","toMove","toMoveNames","i","j","sortBy","displayName","toLowerCase","container","select","width","get","selectAll","d","call","enter","append","exit","remove","order","text","propertyDisplayName","pluck","vertex","rollup","join","transition","possibleValues","bins","layout","histogram","property","bin","xScale","yScale","ordinal","clone","domainValues","v","isUndefined","rangeRoundBands","groupedByValue","f","propertyValueDisplay","String","createMask","barHeight","style","JSON","stringify","elementIds","compose","toPercent","barOpacity","barWidth","barColor","maskId","maskWidth","maskX","textId","setTextY","textNumberId","textNumberValue","textNumberX","positionTextNumber","markOther","toRefId","toUrlId","useTag","classed","toAppend","str","k","height","getBBox","e","setAttribute","barIndex","barNumber","ignored","rangeBand","y","percent","undefined","number","object","ids","eventToElementIdMap","eventName","trigger","bar","target","closest","datum","mapObject","vertexIds","edgeIds","edge","i18n","o","propertyValue","propertyName","display","concepts","byId","relationships","min","propDisplay","x","max","dx","streamingPropertyValue","userVisible","t","previousSibling","tX","baseVal","getItem","getWidthOfNodeByClass","cls","node","parentNode","nextSibling","getAttribute","textWidth","textNumberWidth","barRect","getBoundingClientRect","remainingBarWidth","mask0","querySelector","Math"],"mappings":"AAAAA,OAAO,CACH,sBADG,CAEH,wBAFG,CAGH,IAHG,CAIH,qDAJG,CAAP,CAKG,SAASC,eAAT,CAA0BC,CAA1B,CAA6BC,EAA7B,CAAiCC,QAAjC,CAA2C,CAC1C,aAEA,GAAIC,iBAAkB,KAAtB,CACIC,WAAa,YADjB,CAEIC,WAAa,WAFjB,CAGIC,aAAe,mCAHnB,CAIIC,8BAAgC,CAJpC,CAKIC,WAAa,EALjB,CAMIC,QAAU,CANd,CAOIC,mBAAqB,GAPzB,CAQIC,cAAgB,sCAAsCC,KAAtC,CAA4C,GAA5C,CARpB,CASIC,2BAA6B,KATjC,CAUIC,iCAAmC,CAAC,SAAD,CAAY,SAAZ,CAVvC,CAWIC,6BAA+B,IAXnC,CAYIC,mCAAqC,CAAC,EAAD,CAAK,EAAL,CAZzC,CAaIC,uBAAyB,CACrB,aADqB,CAb7B,CAgBIC,iCAAmC,CAhBvC,CAiBIC,kBAAoB,mBAjBxB,CAmBA,MAAOpB,iBAAgBqB,kBAAhB,CAAP,CAEA,QAASA,mBAAT,EAA8B,CAE1B,KAAKC,UAAL,CAAgB,CACZC,MAAO,IADK,CAEZC,kBAAmB,YAFP,CAGZC,sBAAuB,aAHX,CAIZC,qBAAsB,iBAJV,CAAhB,EAOA,KAAKC,MAAL,CAAY,UAAZ,CAAwB,UAAW,CAC/B,KAAKC,KAAL,CAAWC,GAAX,CAAe,uBAAf,EACH,CAFD,EAIA,KAAKC,KAAL,CAAW,YAAX,CAAyB,UAAW,CAChC,GAAIC,MAAO,IAAX,CAEA,KAAKH,KAAL,CAAWI,QAAX,CAAoB,UAApB,EAAgCC,IAAhC,CAAqC,yBAArC,EAEA,KAAKC,EAAL,CAAQ,OAAR,CAAiB,CACbR,qBAAsB,KAAKS,cADd,CAAjB,EAGA,KAAKP,KAAL,CAAWM,EAAX,CAAc,uBAAd,CAAuC,gBAAvC,CAAyD,KAAKE,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAAzD,EAEA,KAAKC,gBAAL,CAAsB,KAAKC,IAAL,CAAUhB,KAAhC,CAAuC,CAAEiB,SAAU,CAAZ,CAAvC,EAEA,GAAIC,cAAe,CAAC,CAApB,CACA,KAAKC,eAAL,CAAuBC,EAAEC,QAAF,CAAW,SAASC,KAAT,CAAgBC,IAAhB,CAAsB,CACpDf,KAAKO,gBAAL,CAAsBP,KAAKQ,IAAL,CAAUhB,KAAhC,CAAuC,CAAEiB,SAAU,CAAZ,CAAvC,EACH,CAFsB,CAEpB,GAFoB,CAAvB,CAIAO,EAAEC,QAAF,EAAYnB,GAAZ,CAAgB,oBAAhB,EACA,KAAKK,EAAL,CAAQc,QAAR,CAAkB,uCAAlB,CAA2D,SAASH,KAAT,CAAgBC,IAAhB,CAAsB,CAC7E,GAAIA,KAAKG,OAAL,CAAaC,CAAb,CAAiB,CAAjB,GAAuBT,aAAe,CAAf,EAAoBK,KAAKG,OAAL,CAAaC,CAAb,GAAmBT,YAA9D,CAAJ,CAAiF,CAC7EA,aAAeK,KAAKG,OAAL,CAAaC,CAA5B,CACA,KAAKR,eAAL,GACH,CACD,GAAII,KAAKG,OAAL,CAAaC,CAAb,GAAmB,CAAvB,CAA0B,CACtBH,EAAEC,QAAF,EAAYnB,GAAZ,CAAgB,oBAAhB,EACH,CACJ,CARD,EAUA,KAAKK,EAAL,CAAQ,aAAR,CAAuB,SAASW,KAAT,CAAgBC,IAAhB,CAAsB,CACzC,KAAKP,IAAL,CAAUhB,KAAV,CAAkBuB,KAAKvB,KAAvB,CACA,KAAKe,gBAAL,CAAsBQ,KAAKvB,KAA3B,EACH,CAHD,EAIH,CAhCD,EAkCA,KAAKe,gBAAL,CAAwB,SAASa,QAAT,CAAmBC,OAAnB,CAA4B,CAChD,GAAIrB,MAAO,IAAX,CACIsB,aAAenD,GAAGoD,KAAH,CAASC,MAAT,GAAkBC,MAAlB,CAAyB,CAAC,CAAD,CAAI,GAAJ,CAAzB,EAAmCC,KAAnC,CAAyCxC,kCAAzC,CADnB,CAEIyC,WAAaxD,GAAGoD,KAAH,CAASC,MAAT,GAAkBC,MAAlB,CAAyB,CAAC,CAAD,CAAI,GAAJ,CAAzB,EAAmCC,KAAnC,CAAyC1C,gCAAzC,CAFjB,CAGI4C,kBAAqBP,SAAWT,EAAEiB,QAAF,CAAWR,QAAQZ,QAAnB,CAAZ,CAA4CY,QAAQZ,QAApD,CAA+D7B,kBAHvF,CAKA,GAAIkD,kBAAmBlB,EAAEmB,KAAF,CAAQX,QAAR,EACdY,GADc,CACV,SAASC,OAAT,CAAkB,CACnB,GAAIC,gBAAiB,CACbC,YAAaF,QAAQG,IADR,CAEbC,UAAWJ,QAAQK,EAFN,CAArB,CAIIC,aAAe,CACXC,KAAMlE,UADK,CAEXmE,MAAOR,QAAQG,IAFJ,CAJnB,CAQIM,OAAS,CAACH,YAAD,CARb,CASA,GAAIN,QAAQG,IAAR,GAAiB,MAArB,CAA6B,CACzBM,OAAOC,IAAP,CAAY,CAAEF,MAAOR,QAAQW,KAAjB,CAAwBJ,KAAMjE,UAA9B,CAAZ,EACH,CACD,MAAO0D,SAAQY,UAAR,CAAmBC,MAAnB,CAA0BJ,MAA1B,EAAkCV,GAAlC,CAAsC,SAASe,CAAT,CAAY,CACrD,MAAO/B,GAAEgC,MAAF,CAAS,EAAT,CAAaD,CAAb,CAAgBb,cAAhB,CAAP,CACH,CAFM,CAAP,CAGH,CAjBc,EAkBde,OAlBc,GAmBdC,MAnBc,CAmBPC,qBAnBO,EAoBdC,OApBc,CAoBN,MApBM,EAqBdC,KArBc,GAsBdC,IAtBc,CAsBT,SAASC,IAAT,CAAe,CACjB,GAAIA,KAAK,CAAL,IAAY/E,YAAhB,CAA8B,CAC1B+E,KAAK,CAAL,EAAU3C,EAAE4C,MAAF,CAASD,KAAK,CAAL,CAAT,CAAkB,SAAStB,OAAT,CAAkB,CAC1C,MAAOA,SAAQE,WAAR,GAAwB,MAA/B,CACH,CAFS,CAAV,CAGH,CACJ,CA5Bc,EA6Bde,MA7Bc,CA6BP,SAASK,IAAT,CAAe,CACnB,GAAIE,kBAAmBrF,SAASyE,UAAT,CAAoBa,OAApB,CAA4BH,KAAK,CAAL,CAA5B,CAAvB,CACA,GAAIE,kBAAoB,CAAC5E,cAAc8E,OAAd,CAAsBF,iBAAiBG,QAAvC,CAAzB,CAA2E,CACvE,MAAO,KAAP,CACH,CAED,GAAIC,aAAcjD,EAAEwC,OAAF,CAAUG,KAAK,CAAL,CAAV,CAAmB,OAAnB,CAAlB,CACIO,OAASlD,EAAEoB,GAAF,CAAM6B,WAAN,CAAmB,SAASpB,KAAT,CAAgBsB,GAAhB,CAAqB,CAC7C,MAAOtB,OAAMuB,MAAb,CACH,CAFQ,CADb,CAIIC,IAAMH,OAAOE,MAJjB,CAMA,GAAIC,KAAO7E,gCAAX,CAA6C,CACzC,MAAO,KAAP,CACH,CAED,GAAI8E,eAAgBtD,EAAEuD,MAAF,CAASL,MAAT,EACXM,IADW,CACN,SAASC,CAAT,CAAYC,CAAZ,CAAe,CACjB,MAAOD,GAAIC,CAAX,CACH,CAHW,CAApB,CAIIC,iBAAmB,QAAnBA,iBAAmB,CAASL,aAAT,CAAwBL,WAAxB,CAAqCI,GAArC,CAA0C,CACzD,GAAIC,cAAcF,MAAd,GAAyB,CAAzB,EAA8BC,KAAO7E,gCAAzC,CAA2E,CACvE,OACH,CAED,GAAIoF,sBAAuBN,cAAcO,KAAd,EAA3B,CACIC,OAAS9D,EAAEmB,KAAF,CAAQ8B,WAAR,EACJR,KADI,GAEJH,MAFI,CAEG,SAASH,CAAT,CAAY,CAChB,MAAOA,GAAE,CAAF,EAAKiB,MAAL,GAAgBQ,oBAAvB,CACH,CAJI,EAKJ/B,KALI,EADb,CAOIkC,YAAc/D,EAAEoB,GAAF,CAAM0C,MAAN,CAAc,SAAS3B,CAAT,CAAY,CAChC,MAAOA,GAAE,CAAF,CAAP,CACH,CAFS,CAPlB,CAWAQ,KAAK,CAAL,EAAU3C,EAAE4C,MAAF,CAASD,KAAK,CAAL,CAAT,CAAkB,SAASR,CAAT,CAAY,CACpC,MAAO,CAAC4B,YAAYhB,OAAZ,CAAoBZ,EAAEN,KAAtB,CAAR,CACH,CAFS,CAAV,CAIA,IAAK,GAAImC,GAAI,CAAb,CAAgBA,EAAIF,OAAOV,MAA3B,CAAmCY,GAAnC,CAAwC,CACpC,IAAK,GAAIC,GAAI,CAAb,CAAgBA,EAAIH,OAAOE,CAAP,EAAU,CAAV,EAAaZ,MAAjC,CAAyCa,GAAzC,CAA8C,CAC1CtB,KAAK,CAAL,EAAQZ,IAAR,CAAa,CACTF,MAAOpD,iBADE,CAET8C,YAAauC,OAAOE,CAAP,EAAU,CAAV,EAAaC,CAAb,EAAgB1C,WAFpB,CAGTE,UAAWqC,OAAOE,CAAP,EAAU,CAAV,EAAaC,CAAb,EAAgBxC,SAHlB,CAAb,EAKH,CACJ,CAEDwB,YAAcjD,EAAEwC,OAAF,CAAUG,KAAK,CAAL,CAAV,CAAmB,OAAnB,CAAd,CACAO,OAASlD,EAAEoB,GAAF,CAAM6B,WAAN,CAAmB,SAASpB,KAAT,CAAgBsB,GAAhB,CAAqB,CAC7C,MAAOtB,OAAMuB,MAAb,CACH,CAFQ,CAAT,CAGAC,IAAMH,OAAOE,MAAb,CAEAO,iBAAiBL,aAAjB,CAAgCL,WAAhC,CAA6CI,GAA7C,EACH,CAzCL,CA2CAM,iBAAiBL,aAAjB,CAAgCL,WAAhC,CAA6CI,GAA7C,EAEA,MAAO,KAAP,CACH,CA3Fc,EA4Fdf,MA5Fc,CA4FP,SAASK,IAAT,CAAe,CACnB,MAAOA,MAAK,CAAL,EAAQS,MAAR,EAAkBvF,6BAAzB,CACH,CA9Fc,EA+FdqG,MA/Fc,CA+FP,SAASvB,IAAT,CAAe,CACnB,GAAIE,kBAAmBrF,SAASyE,UAAT,CAAoBa,OAApB,CAA4BH,KAAK,CAAL,CAA5B,CAAvB,CACId,MAAQc,KAAK,CAAL,CADZ,CAGA,GAAId,QAAUnE,UAAd,CAA0B,CACtB,MAAO,GAAP,CACH,CACD,GAAImE,QAAUjE,YAAd,CAA4B,CACxB,MAAO,GAAP,CACH,CACD,GAAIiE,QAAUlE,UAAd,CAA0B,CACtB,MAAO,GAAP,CACH,CACD,GAAIkF,kBAAoBA,iBAAiBsB,WAAzC,CAAsD,CAClDtC,MAAQgB,iBAAiBsB,WAAzB,CACH,CACD,MAAO,IAAMtC,MAAMuC,WAAN,EAAb,CACH,CAhHc,EAiHdF,MAjHc,CAiHP,SAASvB,IAAT,CAAe,CACnB,MAAOA,MAAK,CAAL,EAAQS,MAAR,CAAiB,CAAC,CAAzB,CACH,CAnHc,EAoHdvB,KApHc,EAAvB,CAqHIwC,UAAY,KAAKC,MAAL,CAAY,uBAAZ,CArHhB,CAsHIC,MAAQF,UAAUE,KAAV,EAtHZ,CAwHAhH,GAAG+G,MAAH,CAAUD,UAAUG,GAAV,CAAc,CAAd,CAAV,EACSC,SADT,CACmB,qBADnB,EAEStE,IAFT,CAEce,gBAFd,CAEgC,SAASwD,CAAT,CAAY,CAChC,MAAOA,GAAE,CAAF,CAAP,CACH,CAJT,EAKSC,IALT,CAKc,UAAW,CACb,KAAKC,KAAL,GACKC,MADL,CACY,IADZ,EACkBjF,IADlB,CACuB,OADvB,CACgC,kBADhC,EAEK+E,IAFL,CAEU,UAAW,CACb,KAAKE,MAAL,CAAY,KAAZ,EAAmBjF,IAAnB,CAAwB,OAAxB,CAAiC,YAAjC,EACA,KAAKiF,MAAL,CAAY,KAAZ,EAAmBjF,IAAnB,CAAwB,OAAxB,CAAiC,MAAjC,EACH,CALL,EAMA,KAAKkF,IAAL,GAAYC,MAAZ,GAEA,KAAKC,KAAL,GACKL,IADL,CACU,UAAW,CACb,KAAKL,MAAL,CAAY,aAAZ,EACKW,IADL,CACUC,mBADV,EAEKL,MAFL,CAEY,MAFZ,EAGKI,IAHL,CAGU,SAASP,CAAT,CAAY,CACd,GAAI7B,kBAAmBrF,SAASyE,UAAT,CAAoBa,OAApB,CAA4B4B,EAAE,CAAF,CAA5B,CAAvB,CACIxB,OAASlD,EAAEmF,KAAF,CAAQT,EAAE,CAAF,CAAR,CAAc,OAAd,CADb,CAIA,MAAO1E,GAAEoB,GAAF,CAAM9D,EAAE8H,MAAF,CAASC,MAAT,CAAgBX,EAAE,CAAF,CAAhB,CAAsBxB,MAAtB,CAAN,CAAqC,SAASrB,KAAT,CAAgBG,KAAhB,CAAuB,CAC/D,MAAOA,OAAQ,GAAR,CAAcH,KAArB,CACH,CAFM,EAEJyD,IAFI,CAEC,IAFD,CAAP,CAGH,CAXL,EAYA,KAAKhB,MAAL,CAAY,KAAZ,EACKK,IADL,CACU,UAAW,CACb,KAAKY,UAAL,GACK1F,QADL,CACcmB,iBADd,EAEKpB,IAFL,CAEU,QAFV,CAEoB,SAAS8E,CAAT,CAAY,CACxB,GAAI7B,kBAAmBrF,SAASyE,UAAT,CAAoBa,OAApB,CAA4B4B,EAAE,CAAF,CAA5B,CAAvB,CACIxB,OAASlD,EAAEmF,KAAF,CAAQT,EAAE,CAAF,CAAR,CAAc,OAAd,CADb,CAGAA,EAAExB,MAAF,CAAWA,MAAX,CAEA,GAAIL,kBACA,CAAC5E,cAAc8E,OAAd,CAAsBF,iBAAiBG,QAAvC,CADD,EAED,CAACH,iBAAiB2C,cAFrB,CAEqC,CAEjC,GAAIC,MAAOzF,EAAE4C,MAAF,CACPrF,GAAGmI,MAAH,CAAUC,SAAV,GAAsB9D,KAAtB,CAA4B7B,EAAE4F,QAAF,CAAW,OAAX,CAA5B,EAAiDlB,EAAE,CAAF,CAAjD,CADO,CACiD,SAASmB,GAAT,CAAc,CACtE,MAAOA,KAAIzC,MAAJ,GAAe,CAAtB,CACH,CAHU,CAAX,CAKAsB,EAAEe,IAAF,CAASA,IAAT,CACA,MAAOA,MAAKrC,MAAL,CAActF,UAArB,CACH,CAED,GAAI,QAAU4G,EAAd,CAAiB,CACb,MAAOA,GAAEe,IAAT,CACH,CAED,MAAOzF,GAAEuD,MAAF,CAASvD,EAAEmF,KAAF,CAAQT,EAAE,CAAF,CAAR,CAAc,OAAd,CAAT,EAAiCtB,MAAjC,CAA0CtF,UAAjD,CACH,CA1BL,EA2BH,CA7BL,EA8BK2G,SA9BL,CA8Be,gBA9Bf,EA+BKtE,IA/BL,CA+BU,SAASuE,CAAT,CAAY,CACd,GAAIoB,OAAJ,CAAYC,MAAZ,CACIN,IADJ,CAEIvC,OAASwB,EAAExB,MAFf,CAIA,GAAI,QAAUwB,EAAd,CAAiB,CACbe,KAAOf,EAAEe,IAAT,CAEAK,OAASvI,GAAGoD,KAAH,CAASC,MAAT,GAAkBE,KAAlB,CAAwB,CAAC,CAAD,CAAI,GAAJ,CAAxB,CAAT,CACAiF,OAASxI,GAAGoD,KAAH,CAASqF,OAAT,EAAT,CAEAP,KAAOA,KAAKrE,GAAL,CAAS,SAASyE,GAAT,CAAc,CACtBA,IAAIrF,QAAJ,CAAeR,EAAEiG,KAAF,CAAQJ,GAAR,CAAf,CACAA,IAAIC,MAAJ,CAAaA,MAAb,CACAD,IAAIE,MAAJ,CAAaA,MAAb,CACAF,IAAIjE,IAAJ,CAAW8C,EAAE,CAAF,CAAX,CACA,IAAK,GAAIV,GAAI,CAAb,CAAgBA,EAAI6B,IAAIzC,MAAxB,CAAgCY,GAAhC,CAAqC,CACjC6B,IAAI7B,CAAJ,EAAS6B,IAAI7B,CAAJ,EAAOnC,KAAhB,CACH,CACD,MAAOgE,IAAP,CACH,CATE,CAAP,CAUA,GAAIK,cAAelG,EAAE4C,MAAF,CAAS5C,EAAEmF,KAAF,CAAQM,IAAR,CAAc,GAAd,CAAT,CAA6B,SAASU,CAAT,CAAY,CACxD,MAAOnG,GAAEoG,WAAF,CAAcD,CAAd,CAAP,CACH,CAFkB,CAAnB,CAGAJ,OAAOlF,MAAP,CAAcqF,YAAd,EACAH,OAAOM,eAAP,CAAuB,CAAC,CAAD,CAAIZ,KAAKrC,MAAL,CAActF,UAAlB,CAAvB,CAAsD,GAAtD,CAA2D,CAA3D,EACAgI,OAAOjF,MAAP,CAAc,CAAC,CAAD,CAAItD,GAAGE,eAAH,EAAoBgI,IAApB,CAA0B,SAASf,CAAT,CAAY,CACpD,MAAOA,GAAEtB,MAAT,CACH,CAFiB,CAAJ,CAAd,EAIA,MAAOqC,KAAP,CACH,CAEDK,OAASvI,GAAGoD,KAAH,CAASC,MAAT,GACJE,KADI,CACE,CAAC,CAAD,CAAI,GAAJ,CADF,CAAT,CAGA,GAAIwF,gBAAiBtG,EAAEwC,OAAF,CAAUkC,EAAE,CAAF,CAAV,CAAgB,OAAhB,CAArB,CACAqB,OAASxI,GAAGoD,KAAH,CAASqF,OAAT,GACJnF,MADI,CAEDb,EAAEmB,KAAF,CAAQ+B,MAAR,EACCK,MADD,GAECW,MAFD,CAEQ,SAASqC,CAAT,CAAY,CAChB,GAAIA,IAAM9H,iBAAV,CAA6B,CACzB,MAAO,IAAP,CACH,CAED,GAAIoH,KAAM,CAACU,CAAD,CAAV,CACAV,IAAIjE,IAAJ,CAAW8C,EAAE,CAAF,CAAX,CACA,GAAI7C,OAAQ2E,qBAAqBX,GAArB,CAAZ,CACA,MAAQ,KAAMS,eAAeC,CAAf,EAAkBnD,MAAzB,CACHqD,OAAO5E,KAAP,EAAcuC,WAAd,EADJ,CAEH,CAZD,EAaCvC,KAbD,EAFC,CAAT,CAkBA4D,KAAOzF,EAAEmB,KAAF,CAAQmF,cAAR,EACE7D,KADF,GAEErB,GAFF,CAEM,SAASyE,GAAT,CAAc,CACfA,IAAIC,MAAJ,CAAaA,MAAb,CACAD,IAAIE,MAAJ,CAAaA,MAAb,CACAF,IAAIjE,IAAJ,CAAW8C,EAAE,CAAF,CAAX,CACAmB,IAAIrF,QAAJ,CAAeqF,IAAI,CAAJ,CAAf,CACAA,IAAI,CAAJ,EAASA,IAAI,CAAJ,EAAOzC,MAAhB,CACA,MAAOyC,IAAP,CACH,CATF,EAUEhE,KAVF,EAAP,CAYAkE,OAAOM,eAAP,CAAuB,CAAC,CAAD,CAAIZ,KAAKrC,MAAL,CAActF,UAAlB,CAAvB,CAAsD,GAAtD,CAA2D,CAA3D,EACAgI,OAAOjF,MAAP,CAAc,CAAC,CAAD,CAAItD,GAAGE,eAAH,EAAoBgI,IAApB,CAA0B,SAASf,CAAT,CAAY,CACpD,MAAOA,GAAE,CAAF,CAAP,CACH,CAFiB,CAAJ,CAAd,EAIA,MAAOe,KAAP,CACH,CAxGL,EAyGKd,IAzGL,CAyGU,UAAW,CACb,KAAKC,KAAL,GACKC,MADL,CACY,GADZ,EAESjF,IAFT,CAEc,OAFd,CAEuB,eAFvB,EAGS+E,IAHT,CAGc,UAAW,CACb,KAAKE,MAAL,CAAY,MAAZ,EACKF,IADL,CACU,UAAW,CACb,KAAKA,IAAL,CAAU+B,UAAV,EACA,KAAK/B,IAAL,CAAU+B,UAAV,EACA,KAAK7B,MAAL,CAAY,MAAZ,EACKjF,IADL,CACU,OADV,CACmB,MADnB,EAEKA,IAFL,CAEU,GAFV,CAEe7B,OAFf,EAGK6B,IAHL,CAGU,aAHV,CAGyB,OAHzB,EAIA,KAAKiF,MAAL,CAAY,MAAZ,EACKjF,IADL,CACU,OADV,CACmB,aADnB,EAGA,QAAS8G,WAAT,EAAsB,CAClB,KAAK7B,MAAL,CAAY,MAAZ,EACKjF,IADL,CACU,WADV,CACuB,gBADvB,EAEKA,IAFL,CAEU,GAFV,CAEe,CAFf,EAGKiF,MAHL,CAGY,MAHZ,EAISjF,IAJT,CAIc,GAJd,CAImB,CAJnB,EAKSA,IALT,CAKc,GALd,CAKmB,CALnB,EAMSA,IANT,CAMc,MANd,CAMsB,OANtB,EAOH,CACJ,CApBL,EAqBA,KAAKiF,MAAL,CAAY,MAAZ,EAAoBjF,IAApB,CAAyB,OAAzB,CAAkC,gBAAlC,EACA,KAAKiF,MAAL,CAAY,MAAZ,EACKjF,IADL,CACU,OADV,CACmB,MADnB,EAEKA,IAFL,CAEU,OAFV,CAEmB,cAFnB,EAGKA,IAHL,CAGU,QAHV,CAGoB+G,SAHpB,EAIA,KAAK9B,MAAL,CAAY,KAAZ,EAAmBjF,IAAnB,CAAwB,OAAxB,CAAiC,aAAjC,EACA,KAAKiF,MAAL,CAAY,KAAZ,EAAmBjF,IAAnB,CAAwB,OAAxB,CAAiC,cAAjC,EACA,KAAKiF,MAAL,CAAY,KAAZ,EAAmBjF,IAAnB,CAAwB,OAAxB,CAAiC,oBAAjC,EACA,KAAKiF,MAAL,CAAY,KAAZ,EAAmBjF,IAAnB,CAAwB,OAAxB,CAAiC,qBAAjC,EACH,CAlCT,EAmCA,KAAKkF,IAAL,GACKS,UADL,GAEK1F,QAFL,CAEcmB,iBAFd,EAGK4F,KAHL,CAGW,SAHX,CAGsB,CAHtB,EAIK7B,MAJL,GAMA,KAAKC,KAAL,GACKpF,IADL,CACU,kBADV,CAC8B,SAAS8E,CAAT,CAAY,CAClC,MAAOmC,MAAKC,SAAL,CAAepC,EAAEqC,UAAF,EAAgB,EAA/B,CAAP,CACH,CAHL,EAIKxB,UAJL,GAKK1F,QALL,CAKcmB,iBALd,EAMKpB,IANL,CAMU,WANV,CAMuB,SAAS8E,CAAT,CAAY,CAC3B,MAAO,eAAiBA,EAAEqB,MAAF,CAASrB,EAAE,CAAF,CAAT,CAAjB,CAAkC,GAAzC,CACH,CARL,EAUA,KAAKJ,MAAL,CAAY,qBAAZ,EACKsC,KADL,CACW,cADX,CAC2B5G,EAAEgH,OAAF,CAAUC,SAAV,CAAqBC,UAArB,CAAiCC,QAAjC,CAD3B,EAEKP,KAFL,CAEW,MAFX,CAEmB5G,EAAEgH,OAAF,CAAUI,QAAV,CAAoBD,QAApB,CAFnB,EAGKvH,IAHL,CAGU,QAHV,CAGoB+G,SAHpB,EAIK/G,IAJL,CAIU,OAJV,CAImBI,EAAEgH,OAAF,CAAUC,SAAV,CAAqBE,QAArB,CAJnB,EAMA,KAAK7C,MAAL,CAAY,MAAZ,EACKK,IADL,CACU,UAAW,CACb,KAAKL,MAAL,CAAY,kBAAZ,EACK1E,IADL,CACU,IADV,CACgBI,EAAEgH,OAAF,CAAUnC,OAAO,IAAP,CAAV,CAAwBwC,MAAxB,CADhB,EAEKzH,IAFL,CAEU,QAFV,CAEoB+G,SAFpB,EAGK/G,IAHL,CAGU,OAHV,CAGmBI,EAAEgH,OAAF,CAAUC,SAAV,CAAqBK,UAAU,CAAV,CAArB,CAHnB,EAIK1H,IAJL,CAIU,GAJV,CAIeI,EAAEgH,OAAF,CAAUC,SAAV,CAAqBM,MAAM,CAAN,CAArB,CAJf,EAKKjD,MALL,CAKY,MALZ,EAMS1E,IANT,CAMc,OANd,CAMuB,MANvB,EAOSA,IAPT,CAOc,QAPd,CAOwB+G,SAPxB,EAQA,KAAKrC,MAAL,CAAY,mBAAZ,EACK1E,IADL,CACU,IADV,CACgBI,EAAEgH,OAAF,CAAUnC,OAAO,IAAP,CAAV,CAAwBwC,MAAxB,CADhB,EAEKzH,IAFL,CAEU,QAFV,CAEoB+G,SAFpB,EAGK/G,IAHL,CAGU,OAHV,CAGmBI,EAAEgH,OAAF,CAAUC,SAAV,CAAqBK,UAAU,CAAV,CAArB,CAHnB,EAIK1H,IAJL,CAIU,GAJV,CAIeI,EAAEgH,OAAF,CAAUC,SAAV,CAAqBM,MAAM,CAAN,CAArB,CAJf,EAKKjD,MALL,CAKY,MALZ,EAMS1E,IANT,CAMc,OANd,CAMuB,MANvB,EAOSA,IAPT,CAOc,QAPd,CAOwB+G,SAPxB,EASA,KAAKrC,MAAL,CAAY,OAAZ,EACK1E,IADL,CACU,IADV,CACgB4H,MADhB,EAEKvC,IAFL,CAEUuB,oBAFV,EAGK9D,IAHL,CAGU+E,SAAS,IAAT,CAHV,EAKA,KAAKnD,MAAL,CAAY,cAAZ,EACK1E,IADL,CACU,IADV,CACgB8H,YADhB,EAEKzC,IAFL,CAEU0C,eAFV,EAGK/H,IAHL,CAGU,GAHV,CAGegI,WAHf,EAIKhI,IAJL,CAIU,IAJV,CAIgB7B,QAAU,CAAC,CAJ3B,EAKK6B,IALL,CAKU,aALV,CAKyB,KALzB,EAMK8C,IANL,CAMUmF,kBANV,EAOKnF,IAPL,CAOU+E,SAAS,GAAT,CAPV,EAQH,CAhCL,EAkCA,KAAKnD,MAAL,CAAY,iBAAZ,EACKK,IADL,CACUmD,SADV,EAEKlI,IAFL,CAEU,YAFV,CAEwBI,EAAEgH,OAAF,CAAUe,OAAV,CAAmBP,MAAnB,CAFxB,EAGK5H,IAHL,CAGU,MAHV,CAGkBI,EAAEgH,OAAF,CAAUgB,OAAV,CAAmBnD,OAAO,IAAP,CAAnB,CAAiCwC,MAAjC,CAHlB,EAIA,KAAK/C,MAAL,CAAY,kBAAZ,EACKK,IADL,CACUmD,SADV,EAEKlI,IAFL,CAEU,YAFV,CAEwBI,EAAEgH,OAAF,CAAUe,OAAV,CAAmBP,MAAnB,CAFxB,EAGK5H,IAHL,CAGU,MAHV,CAGkBI,EAAEgH,OAAF,CAAUgB,OAAV,CAAmBnD,OAAO,IAAP,CAAnB,CAAiCwC,MAAjC,CAHlB,EAIA,KAAK/C,MAAL,CAAY,wBAAZ,EACK1E,IADL,CACU,YADV,CACwBI,EAAEgH,OAAF,CAAUe,OAAV,CAAmBL,YAAnB,CADxB,EAEA,KAAKpD,MAAL,CAAY,yBAAZ,EACK1E,IADL,CACU,YADV,CACwBI,EAAEgH,OAAF,CAAUe,OAAV,CAAmBL,YAAnB,CADxB,EAEK9H,IAFL,CAEU,MAFV,CAEkBI,EAAEgH,OAAF,CAAUgB,OAAV,CAAmBnD,OAAO,IAAP,CAAnB,CAAiCwC,MAAjC,CAFlB,EAIA9J,GAAGkH,SAAH,CAAa,mBAAb,EACK/B,IADL,CACUmF,kBADV,EAGH,CAtNL,EAwNA,QAASC,UAAT,CAAmBG,MAAnB,CAA2B,CACvBA,OAAOC,OAAP,CAAe,OAAf,CAAwB,SAASvF,IAAT,CAAe,CACnC,MAAOA,MAAK,CAAL,IAAYlE,iBAAnB,CACH,CAFD,EAGH,CAED,QAASoG,OAAT,CAAgBsD,QAAhB,CAA0B,CACtB,MAAO,UAASC,GAAT,CAAc,CACjB,MAAOA,KAAMD,QAAb,CACH,CAFD,CAGH,CAED,QAASV,SAAT,CAAkBY,CAAlB,CAAqB,CACjB,MAAO,WAAW,CAEd,GAAIC,QAAS,EAAb,CACA,GAAI,CACAA,OAAS,KAAKC,OAAL,GAAeD,MAAxB,CACH,CAAC,MAAME,CAAN,CAAS,CAAyB,CACpC,KAAKC,YAAL,CAAkB,GAAlB,CAAwB3K,WAAa,CAAb,CAAiBwK,OAASD,CAA3B,CAAgC,IAAvD,EACH,CAPD,CAQH,CACD,QAAShB,OAAT,CAAgB3C,CAAhB,CAAmBV,CAAnB,CAAsB0E,QAAtB,CAAgC,CAC5B,MAAO,WAAaA,QAAb,CAAwB,OAAxB,CAAkC1E,CAAlC,CAAsC,OAA7C,CACH,CACD,QAASwD,OAAT,CAAgB9C,CAAhB,CAAmBV,CAAnB,CAAsB0E,QAAtB,CAAgC,CAC5B,MAAO,WAAaA,QAAb,CAAwB,OAAxB,CAAkC1E,CAAlC,CAAsC,OAA7C,CACH,CACD,QAAS0D,aAAT,CAAsBhD,CAAtB,CAAyBV,CAAzB,CAA4B0E,QAA5B,CAAsC,CAClC,MAAO,WAAaA,QAAb,CAAwB,OAAxB,CAAkC1E,CAAlC,CAAsC,aAA7C,CACH,CACD,QAAS2D,gBAAT,CAAyBjD,CAAzB,CAA4BV,CAA5B,CAA+B0E,QAA/B,CAAyC,CACrC,MAAOC,WAAUjE,CAAV,CAAP,CACH,CACD,QAASkD,YAAT,CAAqBlD,CAArB,CAAwBV,CAAxB,CAA2B0E,QAA3B,CAAqC,CACjC,MAAOzB,WAAUE,SAASzC,CAAT,CAAYV,CAAZ,CAAe0E,QAAf,CAAV,CAAP,CACH,CACD,QAASX,QAAT,CAAiBrG,EAAjB,CAAqB,CACjB,MAAO,IAAMA,EAAb,CACH,CACD,QAASsG,QAAT,CAAiBtG,EAAjB,CAAqB,CACjB,MAAO,QAAUA,EAAV,CAAe,GAAtB,CACH,CACD,QAAS6F,MAAT,CAAevD,CAAf,CAAkB,CACd,MAAO,UAASU,CAAT,CAAYkE,OAAZ,CAAqBF,QAArB,CAA+B,CAClC,GAAI1E,IAAM,CAAV,CAAa,CACT,MAAO,GAAP,CACH,CAED,MAAOmD,UAASzC,CAAT,CAAYV,CAAZ,CAAe0E,QAAf,CAAP,CACH,CAND,CAOH,CACD,QAASpB,UAAT,CAAmBtD,CAAnB,CAAsB,CAClB,MAAO,UAASU,CAAT,CAAYkE,OAAZ,CAAqBF,QAArB,CAA+B,CAClC,GAAInE,OAAQ4C,SAASzC,CAAT,CAAYV,CAAZ,CAAe0E,QAAf,CAAZ,CACA,GAAI1E,IAAM,CAAV,CAAa,CACT,MAAOO,MAAP,CACH,CAED,MAAO,KAAMA,KAAb,CACH,CAPD,CAQH,CACD,QAASoC,UAAT,CAAmBjC,CAAnB,CAAsB,CAClB,MAAOA,GAAEqB,MAAF,CAAS8C,SAAT,EAAP,CACH,CACD,QAASF,UAAT,CAAmBjE,CAAnB,CAAsB,CAClB,GAAI,MAAQA,EAAZ,CAAe,CACX,MAAOA,GAAEoE,CAAT,CACH,CACD,MAAOpE,GAAE,CAAF,CAAP,CACH,CACD,QAASyC,SAAT,CAAkBzC,CAAlB,CAAqB,CACjB,MAAOA,GAAEoB,MAAF,CAAS6C,UAAUjE,CAAV,CAAT,CAAP,CACH,CACD,QAAS0C,SAAT,CAAkB2B,OAAlB,CAA2B,CACvB,GAAI5K,0BAAJ,CAAgC,CAC5B,MAAO4C,YAAWgI,OAAX,CAAP,CACH,CACD,MAAOC,UAAP,CACH,CACD,QAAS9B,WAAT,CAAoB6B,OAApB,CAA6B,CACzB,GAAI1K,4BAAJ,CAAkC,CAC9B,MAAOqC,cAAaqI,OAAb,CAAP,CACH,CACD,MAAO,IAAP,CACH,CACD,QAAS9B,UAAT,CAAmBgC,MAAnB,CAA2B,CACvB,MAAOA,QAAS,GAAhB,CACH,CACJ,CA/TL,EAgUH,CA9UT,EA+UH,CA7cD,CA+cA,KAAKxJ,cAAL,CAAsB,SAASS,KAAT,CAAgBgJ,MAAhB,CAAwB,CAC1C,GAAIC,KAAMC,oBAAoBlJ,KAApB,CAAV,CACImJ,UAAYnJ,MAAMsB,IAAN,GAAe,YAAf,CAA8B,OAA9B,CAAwC,SADxD,CAEA,KAAK8H,OAAL,CAAajJ,QAAb,CAAuBgJ,UAAY,UAAnC,CAA+CF,GAA/C,EACH,CAJD,CAMA,KAAK3J,cAAL,CAAsB,SAASU,KAAT,CAAgB,CAClC,GAAIiJ,KAAMC,oBAAoBlJ,KAApB,CAAV,CACA,GAAIiJ,GAAJ,CAAS,CACL,KAAKG,OAAL,CAAajJ,QAAb,CAAuB,eAAvB,CAAwC8I,GAAxC,EACA,KAAKG,OAAL,CAAajJ,QAAb,CAAuB,iBAAvB,EACH,CACJ,CAND,CAOH,CAED,QAAS+I,oBAAT,CAA6BlJ,KAA7B,CAAoC,CAChC,GAAIqJ,KAAMnJ,EAAEF,MAAMsJ,MAAR,EAAgBC,OAAhB,CAAwB,GAAxB,CAAV,CACIjJ,SAAW+I,IAAInG,MAAJ,EAAc7F,GAAG+G,MAAH,CAAUiF,IAAI/E,GAAJ,CAAQ,CAAR,CAAV,EAAsBkF,KAAtB,GAA8BlJ,QAD3D,CAEI2I,IAAM3I,UAAYR,EAAEmB,KAAF,CAAQX,QAAR,EACbgC,OADa,CACL,aADK,EAEbmH,SAFa,CAEH,SAASnJ,QAAT,CAAmB,CAC1B,MAAOR,GAAEmF,KAAF,CAAQ3E,QAAR,CAAkB,WAAlB,CAAP,CACH,CAJa,EAKbqB,KALa,EAFtB,CAQA,GAAIsH,GAAJ,CAAS,CACL,MAAO,CACHS,UAAWT,IAAI/D,MADZ,CAEHyE,QAASV,IAAIW,IAFV,CAAP,CAIH,CACJ,CAED,QAAS5E,oBAAT,CAA6BvC,IAA7B,CAAmC,CAC/B,GAAIA,KAAK,CAAL,IAAYhF,UAAhB,CAA4B,CACxB,MAAOoM,MAAK,qCAAL,CAAP,CACH,CACD,GAAIpH,KAAK,CAAL,IAAYjF,UAAhB,CAA4B,CACxB,MAAOqM,MAAK,sCAAL,CAAP,CACH,CACD,GAAIC,GAAIxM,SAASyE,UAAT,CAAoBa,OAApB,CAA4BH,KAAK,CAAL,CAA5B,CAAR,CACA,MAAOqH,IAAKA,EAAE7F,WAAP,EAAsB6F,CAA7B,CACH,CAED,QAASxD,qBAAT,CAA8BX,GAA9B,CAAmC,CAC/B,GAAIoE,eAAgBpE,IAAI,CAAJ,CAApB,CACIqE,aAAerE,IAAIjE,IADvB,CAEIuI,QAAUF,aAFd,CAIA,GAAIC,eAAiBxM,UAArB,CAAiC,CAC7ByM,QAAUJ,KAAK,wCAA0CI,OAA/C,CAAV,CACH,CAFD,IAEO,IAAID,eAAiBtM,YAAjB,EAAiCJ,SAAS4M,QAAT,CAAkBC,IAAlB,CAAuBJ,aAAvB,CAArC,CAA4E,CAC/EE,QAAU3M,SAAS4M,QAAT,CAAkBC,IAAlB,CAAuBJ,aAAvB,EAAsC9F,WAAhD,CACH,CAFM,IAEA,IAAI+F,eAAiBvM,UAAjB,EAA+BH,SAAS8M,aAAT,CAAuBxH,OAAvB,CAA+BmH,aAA/B,CAAnC,CAAkF,CACrFE,QAAU3M,SAAS8M,aAAT,CAAuBxH,OAAvB,CAA+BmH,aAA/B,EAA8C9F,WAAxD,CACH,CAFM,IAEA,IAAIgG,UAAY1L,iBAAhB,CAAmC,CACtC0L,QAAUJ,KAAK,iCAAL,CAAV,CACH,CAFM,IAEA,IAAIvM,SAASyE,UAAT,CAAoBa,OAApB,CAA4BoH,YAA5B,CAAJ,CAA+C,CAClD,GAAI,MAAQrE,IAAZ,CAAiB,CACb,GAAM0E,KAAMjN,EAAE8H,MAAF,CAASoF,WAAT,CAAqBN,YAArB,CAAmCrE,IAAI4E,CAAvC,CAAZ,CACA,GAAMC,KAAMpN,EAAE8H,MAAF,CAASoF,WAAT,CAAqBN,YAArB,CAAmCrE,IAAI4E,CAAJ,CAAQ5E,IAAI8E,EAA/C,CAAZ,CACAR,QAAUI,MAAQG,GAAR,CAAcH,GAAd,CAAoBA,IAAM,KAAN,CAAcG,GAA5C,CACH,CAJD,IAIO,CACHP,QAAU7M,EAAE8H,MAAF,CAASoF,WAAT,CAAqBN,YAArB,CAAmCD,aAAnC,CAAV,CACH,CACJ,CACD,GAAIE,UAAY,EAAhB,CAAoB,MAAOJ,MAAK,iCAAL,CAAP,CACpB,MAAOI,QAAP,CACH,CAGD,QAAS5H,sBAAT,CAA+BqD,QAA/B,CAAyC,CACrC,GAAIsE,cAAetE,SAAShE,IAA5B,CAEA,GAAIgE,SAASgF,sBAAb,CAAqC,CACjC,MAAO,MAAP,CACH,CAED,GAAIV,eAAiBtM,YAAjB,EACDsM,eAAiBxM,UADhB,EAEDwM,eAAiBvM,UAFpB,CAEgC,CAC5B,MAAO,KAAP,CACH,CAJD,IAIO,CACH,GAAIkF,kBAAmBrF,SAASyE,UAAT,CAAoBa,OAApB,CAA4BoH,YAA5B,CAAvB,CACA,GAAIrH,kBAAoB,CAACtE,uBAAuBwE,OAAvB,CAA+BF,iBAAiBG,QAAhD,CAAzB,CAAoF,CAChF,MAAO,MAAP,CACH,CACD,MAAO,CAAC,EAAEH,kBAAoBA,iBAAiBgI,WAAvC,CAAR,CACH,CACJ,CAED,QAAShD,mBAAT,EAA8B,CAC1B,GAAIzI,MAAO,IAAX,CACI0L,EAAI,KAAKC,eADb,CAEIC,GAAK,CAACF,EAAEL,CAAF,CAAIQ,OAAJ,CAAY,CAAZ,GAAkBH,EAAEL,CAAF,CAAIQ,OAAJ,CAAYC,OAAZ,CAAoB,CAApB,CAAnB,EAA2CrJ,KAFpD,CAGIsJ,sBAAwB,QAAxBA,sBAAwB,CAASC,GAAT,CAAc,CAClC,GAAIC,MAAOjM,KAAKkM,UAAhB,CACA,MAAQD,KAAOA,KAAKE,WAApB,CAAkC,CAC9B,GAAIF,KAAKG,YAAL,CAAkB,OAAlB,EAA2BzI,OAA3B,CAAmCqI,GAAnC,IAA4C,CAAC,CAAjD,CAAoD,CAChD,MAAOC,MAAK9C,OAAL,GAAehE,KAAtB,CACH,CACJ,CACD,MAAO,EAAP,CACH,CAXL,CAYIkH,UAAYN,sBAAsB,aAAtB,CAZhB,CAaIO,gBAAkBP,sBAAsB,oBAAtB,CAbtB,CAcIQ,QAAU,KAAKL,UAAL,CAAgBC,WAd9B,CAeIpE,SAAWwE,QAAQC,qBAAR,GAAgCrH,KAf/C,CAgBIsH,kBAAoB1E,SAAWsE,SAAX,CAAuBT,EAAvB,CAA4BjN,OAhBpD,CAiBI+N,MAAQ,KAAKR,UAAL,CAAgBS,aAAhB,CAA8B,uBAA9B,CAjBZ,CAmBA,GAAIF,mBAAqBH,eAAzB,CAA0C,CACtC,GAAII,KAAJ,CAAWA,MAAMrD,YAAN,CAAmB,OAAnB,CAA4B,MAA5B,EACX,KAAKA,YAAL,CAAkB,GAAlB,CAAuBuD,KAAKtB,GAAL,CAASvD,QAAT,CAAmB6D,GAAKS,SAAxB,EAAqC1N,OAA5D,EACA,KAAK0K,YAAL,CAAkB,aAAlB,CAAiC,OAAjC,EACA,KAAKA,YAAL,CAAkB,IAAlB,CAAwB,CAAxB,EACH,CALD,IAKO,CACH,GAAIqD,KAAJ,CAAWA,MAAMrD,YAAN,CAAmB,OAAnB,CAA4B,CAAC,EAAI,CAACiD,gBAAkB3N,QAAU,CAA7B,EAAkCoJ,QAAvC,EAAmD,GAAnD,CAAyD,GAArF,EACX,KAAKsB,YAAL,CAAkB,GAAlB,CAAuBtB,QAAvB,EACA,KAAKsB,YAAL,CAAkB,IAAlB,CAAwB,CAAC1K,OAAzB,EACA,KAAK0K,YAAL,CAAkB,aAAlB,CAAiC,KAAjC,EACH,CACJ,CACJ,CArpBD","file":"histograms.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/vertex/formatters',\n    'd3',\n    'util/requirejs/promise!util/service/ontologyPromise'\n], function(defineComponent, F, d3, ontology) {\n    'use strict';\n\n    var HISTOGRAM_STYLE = 'max', // max or sum\n        GRAPH_TYPE = 'GRAPH_TYPE',\n        EDGE_LABEL = 'edgeLabel',\n        CONCEPT_TYPE = 'http://openlumify.org#conceptType',\n        MIN_VALUES_PRESENT_TO_DISPLAY = 1,\n        BAR_HEIGHT = 25,\n        PADDING = 5,\n        ANIMATION_DURATION = 400,\n        BINABLE_TYPES = 'double date currency integer number'.split(' '),\n        SCALE_COLOR_BASED_ON_WIDTH = false,\n        SCALE_COLOR_BASED_ON_WIDTH_RANGE = ['#00A1F8', '#0088cc'],\n        SCALE_OPACITY_BASED_ON_WIDTH = true,\n        SCALE_OPACITY_BASED_ON_WIDTH_RANGE = [50, 90],\n        NO_HISTOGRAM_DATATYPES = [\n            'geoLocation'\n        ],\n        MAX_BINS_FOR_NON_HISTOGRAM_TYPES = 5,\n        OTHER_PLACEHOLDER = '${OTHER-CATEGORY}';\n\n    return defineComponent(PropertyHistograms);\n\n    function PropertyHistograms() {\n\n        this.attributes({\n            model: null,\n            histogramSelector: '.histogram',\n            histogramListSelector: '.histograms',\n            histogramBarSelector: 'g.histogram-bar'\n        })\n\n        this.before('teardown', function() {\n            this.$node.off('mouseenter mouseleave');\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.$node.addClass('multiple').html('<ul class=\"histograms\">');\n\n            this.on('click', {\n                histogramBarSelector: this.histogramClick\n            });\n            this.$node.on('mouseenter mouseleave', '.histogram-bar', this.histogramHover.bind(this));\n\n            this.renderHistograms(this.attr.model, { duration: 0 });\n\n            var previousSize = -1;\n            this.debouncedRender = _.debounce(function(event, data) {\n                self.renderHistograms(self.attr.model, { duration: 0 });\n            }, 500);\n\n            $(document).off('.elementHistograms');\n            this.on(document, 'graphPaddingUpdated.elementHistograms', function(event, data) {\n                if (data.padding.r > 0 && (previousSize < 0 || data.padding.r !== previousSize)) {\n                    previousSize = data.padding.r;\n                    this.debouncedRender();\n                }\n                if (data.padding.r === 0) {\n                    $(document).off('.elementHistograms');\n                }\n            })\n\n            this.on('updateModel', function(event, data) {\n                this.attr.model = data.model;\n                this.renderHistograms(data.model);\n            })\n        });\n\n        this.renderHistograms = function(elements, options) {\n            var self = this,\n                opacityScale = d3.scale.linear().domain([0, 100]).range(SCALE_OPACITY_BASED_ON_WIDTH_RANGE),\n                colorScale = d3.scale.linear().domain([0, 100]).range(SCALE_COLOR_BASED_ON_WIDTH_RANGE),\n                animationDuration = (options && _.isNumber(options.duration)) ? options.duration : ANIMATION_DURATION;\n\n            var propertySections = _.chain(elements)\n                    .map(function(element) {\n                        var minimalElement = {\n                                elementType: element.type,\n                                elementId: element.id\n                            },\n                            typeProperty = {\n                                name: GRAPH_TYPE,\n                                value: element.type\n                            },\n                            extras = [typeProperty];\n                        if (element.type === 'edge') {\n                            extras.push({ value: element.label, name: EDGE_LABEL});\n                        }\n                        return element.properties.concat(extras).map(function(p) {\n                            return $.extend({}, p, minimalElement);\n                        })\n                    })\n                    .flatten()\n                    .filter(shouldDisplayProperty)\n                    .groupBy('name')\n                    .pairs()\n                    .each(function(pair) {\n                        if (pair[0] === CONCEPT_TYPE) {\n                            pair[1] = _.reject(pair[1], function(element) {\n                                return element.elementType === 'edge';\n                            })\n                        }\n                    })\n                    .filter(function(pair) {\n                        var ontologyProperty = ontology.properties.byTitle[pair[0]];\n                        if (ontologyProperty && ~BINABLE_TYPES.indexOf(ontologyProperty.dataType)) {\n                            return true;\n                        }\n\n                        var valueCounts = _.groupBy(pair[1], 'value'),\n                            values = _.map(valueCounts, function(value, key) {\n                                return value.length;\n                            }),\n                            len = values.length;\n\n                        if (len <= MAX_BINS_FOR_NON_HISTOGRAM_TYPES) {\n                            return true;\n                        }\n\n                        var orderedCounts = _.unique(values)\n                                .sort(function(a, b) {\n                                    return a - b;\n                                }),\n                            collapseSmallest = function(orderedCounts, valueCounts, len) {\n                                if (orderedCounts.length === 0 || len <= MAX_BINS_FOR_NON_HISTOGRAM_TYPES) {\n                                    return;\n                                }\n\n                                var moveToOtherWithCount = orderedCounts.shift(),\n                                    toMove = _.chain(valueCounts)\n                                        .pairs()\n                                        .filter(function(p) {\n                                            return p[1].length === moveToOtherWithCount;\n                                        })\n                                        .value(),\n                                    toMoveNames = _.map(toMove, function(p) {\n                                            return p[0];\n                                        });\n\n                                pair[1] = _.reject(pair[1], function(p) {\n                                    return ~toMoveNames.indexOf(p.value);\n                                });\n\n                                for (var i = 0; i < toMove.length; i++) {\n                                    for (var j = 0; j < toMove[i][1].length; j++) {\n                                        pair[1].push({\n                                            value: OTHER_PLACEHOLDER,\n                                            elementType: toMove[i][1][j].elementType,\n                                            elementId: toMove[i][1][j].elementId\n                                        });\n                                    }\n                                }\n\n                                valueCounts = _.groupBy(pair[1], 'value');\n                                values = _.map(valueCounts, function(value, key) {\n                                    return value.length;\n                                });\n                                len = values.length;\n\n                                collapseSmallest(orderedCounts, valueCounts, len);\n                            };\n\n                        collapseSmallest(orderedCounts, valueCounts, len);\n\n                        return true;\n                    })\n                    .filter(function(pair) {\n                        return pair[1].length >= MIN_VALUES_PRESENT_TO_DISPLAY;\n                    })\n                    .sortBy(function(pair) {\n                        var ontologyProperty = ontology.properties.byTitle[pair[0]],\n                            value = pair[0];\n\n                        if (value === GRAPH_TYPE) {\n                            return '0';\n                        }\n                        if (value === CONCEPT_TYPE) {\n                            return '1';\n                        }\n                        if (value === EDGE_LABEL) {\n                            return '2';\n                        }\n                        if (ontologyProperty && ontologyProperty.displayName) {\n                            value = ontologyProperty.displayName;\n                        }\n                        return '3' + value.toLowerCase();\n                    })\n                    .sortBy(function(pair) {\n                        return pair[1].length * -1;\n                    })\n                    .value(),\n                container = this.select('histogramListSelector'),\n                width = container.width();\n\n            d3.select(container.get(0))\n                    .selectAll('li.property-section')\n                    .data(propertySections, function(d) {\n                        return d[0];\n                    })\n                    .call(function() {\n                        this.enter()\n                            .append('li').attr('class', 'property-section')\n                            .call(function() {\n                                this.append('div').attr('class', 'nav-header')\n                                this.append('svg').attr('width', '100%')\n                            });\n                        this.exit().remove();\n\n                        this.order()\n                            .call(function() {\n                                this.select('.nav-header')\n                                    .text(propertyDisplayName)\n                                    .append('span')\n                                    .text(function(d) {\n                                        var ontologyProperty = ontology.properties.byTitle[d[0]],\n                                            values = _.pluck(d[1], 'value');\n\n\n                                        return _.map(F.vertex.rollup(d[0], values), function(value, label) {\n                                            return label + '=' + value;\n                                        }).join(', ');\n                                    })\n                                this.select('svg')\n                                    .call(function() {\n                                        this.transition()\n                                            .duration(animationDuration)\n                                            .attr('height', function(d) {\n                                                var ontologyProperty = ontology.properties.byTitle[d[0]],\n                                                    values = _.pluck(d[1], 'value');\n\n                                                d.values = values;\n\n                                                if (ontologyProperty &&\n                                                    ~BINABLE_TYPES.indexOf(ontologyProperty.dataType) &&\n                                                   !ontologyProperty.possibleValues) {\n\n                                                    var bins = _.reject(\n                                                        d3.layout.histogram().value(_.property('value'))(d[1]), function(bin) {\n                                                        return bin.length === 0;\n                                                    });\n\n                                                    d.bins = bins;\n                                                    return bins.length * BAR_HEIGHT;\n                                                }\n\n                                                if ('bins' in d) {\n                                                    delete d.bins;\n                                                }\n\n                                                return _.unique(_.pluck(d[1], 'value')).length * BAR_HEIGHT;\n                                            })\n                                    })\n                                    .selectAll('.histogram-bar')\n                                    .data(function(d) {\n                                        var xScale, yScale,\n                                            bins,\n                                            values = d.values;\n\n                                        if ('bins' in d) {\n                                            bins = d.bins;\n\n                                            xScale = d3.scale.linear().range([0, 100]);\n                                            yScale = d3.scale.ordinal();\n\n                                            bins = bins.map(function(bin) {\n                                                    bin.elements = _.clone(bin);\n                                                    bin.xScale = xScale;\n                                                    bin.yScale = yScale;\n                                                    bin.name = d[0];\n                                                    for (var i = 0; i < bin.length; i++) {\n                                                        bin[i] = bin[i].value;\n                                                    }\n                                                    return bin;\n                                                });\n                                            var domainValues = _.reject(_.pluck(bins, '0'), function(v) {\n                                                return _.isUndefined(v);\n                                            });\n                                            yScale.domain(domainValues);\n                                            yScale.rangeRoundBands([0, bins.length * BAR_HEIGHT], 0.1, 0);\n                                            xScale.domain([0, d3[HISTOGRAM_STYLE](bins, function(d) {\n                                                return d.length\n                                            })]);\n\n                                            return bins;\n                                        }\n\n                                        xScale = d3.scale.linear()\n                                            .range([0, 100]);\n\n                                        var groupedByValue = _.groupBy(d[1], 'value');\n                                        yScale = d3.scale.ordinal()\n                                            .domain(\n                                                _.chain(values)\n                                                .unique()\n                                                .sortBy(function(f) {\n                                                    if (f === OTHER_PLACEHOLDER) {\n                                                        return 999;\n                                                    }\n\n                                                    var bin = [f];\n                                                    bin.name = d[0];\n                                                    var value = propertyValueDisplay(bin);\n                                                    return (100 - groupedByValue[f].length) +\n                                                        String(value).toLowerCase();\n                                                })\n                                                .value()\n                                            );\n\n                                        bins = _.chain(groupedByValue)\n                                                .pairs()\n                                                .map(function(bin) {\n                                                    bin.xScale = xScale;\n                                                    bin.yScale = yScale;\n                                                    bin.name = d[0];\n                                                    bin.elements = bin[1];\n                                                    bin[1] = bin[1].length;\n                                                    return bin;\n                                                })\n                                                .value();\n\n                                        yScale.rangeRoundBands([0, bins.length * BAR_HEIGHT], 0.1, 0)\n                                        xScale.domain([0, d3[HISTOGRAM_STYLE](bins, function(d) {\n                                            return d[1];\n                                        })]);\n\n                                        return bins;\n                                    })\n                                    .call(function() {\n                                        this.enter()\n                                            .append('g')\n                                                .attr('class', 'histogram-bar')\n                                                .call(function() {\n                                                    this.append('defs')\n                                                        .call(function() {\n                                                            this.call(createMask);\n                                                            this.call(createMask);\n                                                            this.append('text')\n                                                                .attr('class', 'text')\n                                                                .attr('x', PADDING)\n                                                                .attr('text-anchor', 'start');\n                                                            this.append('text')\n                                                                .attr('class', 'text-number');\n\n                                                            function createMask() {\n                                                                this.append('mask')\n                                                                    .attr('maskUnits', 'userSpaceOnUse')\n                                                                    .attr('y', 0)\n                                                                    .append('rect')\n                                                                        .attr('x', 0)\n                                                                        .attr('y', 0)\n                                                                        .attr('fill', 'white')\n                                                            }\n                                                        })\n                                                    this.append('rect').attr('class', 'bar-background');\n                                                    this.append('rect')\n                                                        .attr('width', '100%')\n                                                        .attr('class', 'click-target')\n                                                        .attr('height', barHeight)\n                                                    this.append('use').attr('class', 'on-bar-text');\n                                                    this.append('use').attr('class', 'off-bar-text');\n                                                    this.append('use').attr('class', 'on-number-bar-text');\n                                                    this.append('use').attr('class', 'off-number-bar-text');\n                                                })\n                                        this.exit()\n                                            .transition()\n                                            .duration(animationDuration)\n                                            .style('opacity', 0)\n                                            .remove();\n\n                                        this.order()\n                                            .attr('data-element-ids', function(d) {\n                                                return JSON.stringify(d.elementIds || []);\n                                            })\n                                            .transition()\n                                            .duration(animationDuration)\n                                            .attr('transform', function(d) {\n                                                return 'translate(0,' + d.yScale(d[0]) + ')';\n                                            })\n\n                                        this.select('rect.bar-background')\n                                            .style('fill-opacity', _.compose(toPercent, barOpacity, barWidth))\n                                            .style('fill', _.compose(barColor, barWidth))\n                                            .attr('height', barHeight)\n                                            .attr('width', _.compose(toPercent, barWidth));\n\n                                        this.select('defs')\n                                            .call(function() {\n                                                this.select('mask:first-child')\n                                                    .attr('id', _.compose(append('_0'), maskId))\n                                                    .attr('height', barHeight)\n                                                    .attr('width', _.compose(toPercent, maskWidth(0)))\n                                                    .attr('x', _.compose(toPercent, maskX(0)))\n                                                    .select('rect')\n                                                        .attr('width', '500%')\n                                                        .attr('height', barHeight)\n                                                this.select('mask:nth-child(2)')\n                                                    .attr('id', _.compose(append('_1'), maskId))\n                                                    .attr('height', barHeight)\n                                                    .attr('width', _.compose(toPercent, maskWidth(1)))\n                                                    .attr('x', _.compose(toPercent, maskX(1)))\n                                                    .select('rect')\n                                                        .attr('width', '500%')\n                                                        .attr('height', barHeight)\n\n                                                this.select('.text')\n                                                    .attr('id', textId)\n                                                    .text(propertyValueDisplay)\n                                                    .each(setTextY(0.15));\n\n                                                this.select('.text-number')\n                                                    .attr('id', textNumberId)\n                                                    .text(textNumberValue)\n                                                    .attr('x', textNumberX)\n                                                    .attr('dx', PADDING * -1)\n                                                    .attr('text-anchor', 'end')\n                                                    .each(positionTextNumber)\n                                                    .each(setTextY(0.2));\n                                            });\n\n                                        this.select('use.on-bar-text')\n                                            .call(markOther)\n                                            .attr('xlink:href', _.compose(toRefId, textId))\n                                            .attr('mask', _.compose(toUrlId, append('_0'), maskId));\n                                        this.select('use.off-bar-text')\n                                            .call(markOther)\n                                            .attr('xlink:href', _.compose(toRefId, textId))\n                                            .attr('mask', _.compose(toUrlId, append('_1'), maskId));\n                                        this.select('use.on-number-bar-text')\n                                            .attr('xlink:href', _.compose(toRefId, textNumberId))\n                                        this.select('use.off-number-bar-text')\n                                            .attr('xlink:href', _.compose(toRefId, textNumberId))\n                                            .attr('mask', _.compose(toUrlId, append('_1'), maskId));\n\n                                        d3.selectAll('defs .text-number')\n                                            .each(positionTextNumber);\n\n                                    })\n\n                                function markOther(useTag) {\n                                    useTag.classed('other', function(pair) {\n                                        return pair[0] === OTHER_PLACEHOLDER;\n                                    })\n                                }\n\n                                function append(toAppend) {\n                                    return function(str) {\n                                        return str + toAppend;\n                                    }\n                                }\n\n                                function setTextY(k) {\n                                    return function() {\n                                        // Firefox exception here\n                                        var height = 22;\n                                        try {\n                                            height = this.getBBox().height;\n                                        } catch(e) { /*eslint no-empty:0*/ }\n                                        this.setAttribute('y', (BAR_HEIGHT / 2 + height * k) + 'px');\n                                    };\n                                }\n                                function maskId(d, i, barIndex) {\n                                    return 'section_' + barIndex + '_bar_' + i + '_mask';\n                                }\n                                function textId(d, i, barIndex) {\n                                    return 'section_' + barIndex + '_bar_' + i + '_text';\n                                }\n                                function textNumberId(d, i, barIndex) {\n                                    return 'section_' + barIndex + '_bar_' + i + '_textnumber';\n                                }\n                                function textNumberValue(d, i, barIndex) {\n                                    return barNumber(d);\n                                }\n                                function textNumberX(d, i, barIndex) {\n                                    return toPercent(barWidth(d, i, barIndex));\n                                }\n                                function toRefId(id) {\n                                    return '#' + id;\n                                }\n                                function toUrlId(id) {\n                                    return 'url(#' + id + ')';\n                                }\n                                function maskX(i) {\n                                    return function(d, ignored, barIndex) {\n                                        if (i === 0) {\n                                            return '0';\n                                        }\n\n                                        return barWidth(d, i, barIndex);\n                                    }\n                                }\n                                function maskWidth(i) {\n                                    return function(d, ignored, barIndex) {\n                                        var width = barWidth(d, i, barIndex);\n                                        if (i === 0) {\n                                            return width;\n                                        }\n\n                                        return 100 - width;\n                                    }\n                                }\n                                function barHeight(d) {\n                                    return d.yScale.rangeBand();\n                                }\n                                function barNumber(d) {\n                                    if ('dx' in d) {\n                                        return d.y;\n                                    }\n                                    return d[1];\n                                }\n                                function barWidth(d) {\n                                    return d.xScale(barNumber(d));\n                                }\n                                function barColor(percent) {\n                                    if (SCALE_COLOR_BASED_ON_WIDTH) {\n                                        return colorScale(percent);\n                                    }\n                                    return undefined;\n                                }\n                                function barOpacity(percent) {\n                                    if (SCALE_OPACITY_BASED_ON_WIDTH) {\n                                        return opacityScale(percent);\n                                    }\n                                    return 100;\n                                }\n                                function toPercent(number) {\n                                    return number + '%';\n                                }\n                            });\n                    })\n        };\n\n        this.histogramHover = function(event, object) {\n            var ids = eventToElementIdMap(event),\n                eventName = event.type === 'mouseenter' ? 'focus' : 'defocus';\n            this.trigger(document, eventName + 'Elements', ids);\n        };\n\n        this.histogramClick = function(event) {\n            var ids = eventToElementIdMap(event);\n            if (ids) {\n                this.trigger(document, 'selectObjects', ids);\n                this.trigger(document, 'defocusElements');\n            }\n        };\n    }\n\n    function eventToElementIdMap(event) {\n        var bar = $(event.target).closest('g'),\n            elements = bar.length && d3.select(bar.get(0)).datum().elements,\n            ids = elements && _.chain(elements)\n                .groupBy('elementType')\n                .mapObject(function(elements) {\n                    return _.pluck(elements, 'elementId')\n                })\n                .value();\n        if (ids) {\n            return {\n                vertexIds: ids.vertex,\n                edgeIds: ids.edge\n            }\n        }\n    }\n\n    function propertyDisplayName(pair) {\n        if (pair[0] === EDGE_LABEL) {\n            return i18n('detail.multiple.histogram.edgeLabel');\n        }\n        if (pair[0] === GRAPH_TYPE) {\n            return i18n('detail.multiple.histogram.graph_type');\n        }\n        var o = ontology.properties.byTitle[pair[0]];\n        return o && o.displayName || o;\n    }\n\n    function propertyValueDisplay(bin) {\n        var propertyValue = bin[0],\n            propertyName = bin.name,\n            display = propertyValue;\n\n        if (propertyName === GRAPH_TYPE) {\n            display = i18n('detail.multiple.histogram.graph_type.' + display);\n        } else if (propertyName === CONCEPT_TYPE && ontology.concepts.byId[propertyValue]) {\n            display = ontology.concepts.byId[propertyValue].displayName;\n        } else if (propertyName === EDGE_LABEL && ontology.relationships.byTitle[propertyValue]) {\n            display = ontology.relationships.byTitle[propertyValue].displayName;\n        } else if (display === OTHER_PLACEHOLDER) {\n            display = i18n('detail.multiple.histogram.other');\n        } else if (ontology.properties.byTitle[propertyName]) {\n            if ('dx' in bin) {\n                const min = F.vertex.propDisplay(propertyName, bin.x);\n                const max = F.vertex.propDisplay(propertyName, bin.x + bin.dx);\n                display = min === max ? min : min + ' – ' + max;\n            } else {\n                display = F.vertex.propDisplay(propertyName, propertyValue);\n            }\n        }\n        if (display === '') return i18n('detail.multiple.histogram.blank');\n        return display;\n    }\n\n\n    function shouldDisplayProperty(property) {\n        var propertyName = property.name;\n\n        if (property.streamingPropertyValue) {\n            return false;\n        }\n\n        if (propertyName === CONCEPT_TYPE ||\n           propertyName === GRAPH_TYPE ||\n           propertyName === EDGE_LABEL) {\n            return true;\n        } else {\n            var ontologyProperty = ontology.properties.byTitle[propertyName];\n            if (ontologyProperty && ~NO_HISTOGRAM_DATATYPES.indexOf(ontologyProperty.dataType)) {\n                return false;\n            }\n            return !!(ontologyProperty && ontologyProperty.userVisible);\n        }\n    }\n\n    function positionTextNumber() {\n        var self = this,\n            t = this.previousSibling,\n            tX = (t.x.baseVal[0] || t.x.baseVal.getItem(0)).value,\n            getWidthOfNodeByClass = function(cls) {\n                var node = self.parentNode;\n                while ((node = node.nextSibling)) {\n                    if (node.getAttribute('class').indexOf(cls) !== -1) {\n                        return node.getBBox().width;\n                    }\n                }\n                return 0;\n            },\n            textWidth = getWidthOfNodeByClass('on-bar-text'),\n            textNumberWidth = getWidthOfNodeByClass('on-number-bar-text'),\n            barRect = this.parentNode.nextSibling,\n            barWidth = barRect.getBoundingClientRect().width,\n            remainingBarWidth = barWidth - textWidth - tX - PADDING,\n            mask0 = this.parentNode.querySelector('defs mask:first-child');\n\n        if (remainingBarWidth <= textNumberWidth) {\n            if (mask0) mask0.setAttribute('width', '100%');\n            this.setAttribute('x', Math.max(barWidth, tX + textWidth) + PADDING);\n            this.setAttribute('text-anchor', 'start');\n            this.setAttribute('dx', 0);\n        } else {\n            if (mask0) mask0.setAttribute('width', (1 - (textNumberWidth + PADDING * 2) / barWidth) * 100 + '%');\n            this.setAttribute('x', barWidth);\n            this.setAttribute('dx', -PADDING);\n            this.setAttribute('text-anchor', 'end');\n        }\n    }\n});\n"]}