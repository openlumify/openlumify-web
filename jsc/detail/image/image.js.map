{"version":3,"sources":["../../../js/detail/image/image.js"],"names":["define","defineComponent","template","F","Privileges","withFacebox","require","ImageView","attributes","model","imageSelector","artifactImageSelector","ignoreUpdateModelNotImplemented","after","$node","addClass","html","src","vertex","imageDetail","attr","id","on","onCoordsChanged","self","image","select","imageEl","get","naturalWidth","naturalHeight","onImageLoaded","bind","event","data","width","parseFloat","x2","x1","height","y2","y1","artifactImage","find","isLargeEnough","detectedObject","_","first","props","omit","trigger","property","value","removeClass","missingEDIT","css","initializeFacebox"],"mappings":"AACAA,OAAO,CACH,sBADG,CAEH,iBAFG,CAGH,wBAHG,CAIH,iBAJG,CAKH,kCALG,CAMH,SANG,CAAP,CAOG,SACCC,eADD,CAECC,QAFD,CAGCC,CAHD,CAICC,UAJD,CAKCC,WALD,CAMCC,OAND,CAMU,CACT,aAEA,MAAOL,iBAAgBM,SAAhB,CAA2BF,WAA3B,CAAP,CAEA,QAASE,UAAT,EAAqB,CAEjB,KAAKC,UAAL,CAAgB,CACZC,MAAO,IADK,CAEZC,cAAe,KAFH,CAGZC,sBAAuB,gBAHX,CAIZC,gCAAiC,IAJrB,CAAhB,EAOA,KAAKC,KAAL,CAAW,YAAX,CAAyB,UAAW,CAChC,KAAKC,KAAL,CACKC,QADL,CACc,SADd,EAEKC,IAFL,CAEUd,SAAS,CACXe,IAAKd,EAAEe,MAAF,CAASC,WAAT,CAAqB,KAAKC,IAAL,CAAUX,KAA/B,CADM,CAEXY,GAAI,KAAKD,IAAL,CAAUX,KAAV,CAAgBY,EAFT,CAAT,CAFV,EAOA,KAAKC,EAAL,CAAQ,4BAAR,CAAsC,KAAKC,eAA3C,EAEA,GAAIC,MAAO,IAAX,CACIC,MAAQ,KAAKC,MAAL,CAAY,eAAZ,CADZ,CAEIC,QAAUF,MAAMG,GAAN,CAAU,CAAV,CAFd,CAGIC,aAAeF,QAAQE,YAH3B,CAIIC,cAAgBH,QAAQG,aAJ5B,CAMA,GAAID,eAAiB,CAAjB,EAAsBC,gBAAkB,CAA5C,CAA+C,CAC3CL,MAAMH,EAAN,CAAS,MAAT,CAAiB,KAAKS,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAAjB,EACH,CAFD,IAEO,CACH,KAAKD,aAAL,GACH,CACJ,CArBD,EAuBA,KAAKR,eAAL,CAAuB,SAASU,KAAT,CAAgBC,IAAhB,CAAsB,CACzC,GAAIV,MAAO,IAAX,CACIN,OAAS,KAAKE,IAAL,CAAUX,KADvB,CAEI0B,MAAQC,WAAWF,KAAKG,EAAhB,EAAsBD,WAAWF,KAAKI,EAAhB,CAFlC,CAGIC,OAASH,WAAWF,KAAKM,EAAhB,EAAsBJ,WAAWF,KAAKO,EAAhB,CAHnC,CAIIC,cAAgB,KAAK5B,KAAL,CAAW6B,IAAX,CAAgB,gBAAhB,CAJpB,CAKIC,cAAiBF,cAAcP,KAAd,GAAwBA,KAAzB,CAAkC,CAAlC,EACXO,cAAcH,MAAd,GAAyBA,MAA1B,CAAoC,CAN5C,CAOIM,cAPJ,CASA,GAAIX,KAAKb,EAAL,EAAWa,KAAKb,EAAL,GAAY,KAA3B,CAAkC,CAC9BwB,eAAiBC,EAAEC,KAAF,CAAQ5C,EAAEe,MAAF,CAAS8B,KAAT,CAAe9B,MAAf,CAAuB,gBAAvB,CAAyCgB,KAAKb,EAA9C,CAAR,CAAjB,CACH,CAFD,IAEO,CACHa,KAAOY,EAAEG,IAAF,CAAOf,IAAP,CAAa,IAAb,CAAP,CACH,CAED,KAAKgB,OAAL,CAAa,oBAAb,CAAmCN,cAC/B,CACIO,SAAUN,cADd,CAEIO,MAAOlB,IAFX,CAD+B,CAI3B,IAJR,EAMH,CAtBD,CAyBA,KAAKH,aAAL,CAAqB,UAAW,CAC5B,KAAKjB,KAAL,CAAWuC,WAAX,CAAuB,SAAvB,EAEA,GAAIjD,WAAWkD,WAAf,CAA4B,CACxB,MAAO,MAAKxC,KAAL,CAAWyC,GAAX,CAAe,QAAf,CAAyB,SAAzB,CAAP,CACH,CAED,GAAIb,eAAgB,KAAKhB,MAAL,CAAY,uBAAZ,CAApB,CACA,KAAK8B,iBAAL,CAAuBd,aAAvB,EACH,CATD,CAUH,CACJ,CAtFD","file":"image.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    './image-tpl.hbs',\n    'util/vertex/formatters',\n    'util/privileges',\n    'util/detectedObjects/withFacebox',\n    'require'\n], function(\n    defineComponent,\n    template,\n    F,\n    Privileges,\n    withFacebox,\n    require) {\n    'use strict';\n\n    return defineComponent(ImageView, withFacebox);\n\n    function ImageView() {\n\n        this.attributes({\n            model: null,\n            imageSelector: 'img',\n            artifactImageSelector: '.image-preview',\n            ignoreUpdateModelNotImplemented: true\n        });\n\n        this.after('initialize', function() {\n            this.$node\n                .addClass('loading')\n                .html(template({\n                    src: F.vertex.imageDetail(this.attr.model),\n                    id: this.attr.model.id\n                }));\n\n            this.on('detectedObjectCoordsChange', this.onCoordsChanged);\n\n            var self = this,\n                image = this.select('imageSelector'),\n                imageEl = image.get(0),\n                naturalWidth = imageEl.naturalWidth,\n                naturalHeight = imageEl.naturalHeight;\n\n            if (naturalWidth === 0 || naturalHeight === 0) {\n                image.on('load', this.onImageLoaded.bind(this))\n            } else {\n                this.onImageLoaded();\n            }\n        });\n\n        this.onCoordsChanged = function(event, data) {\n            var self = this,\n                vertex = this.attr.model,\n                width = parseFloat(data.x2) - parseFloat(data.x1),\n                height = parseFloat(data.y2) - parseFloat(data.y1),\n                artifactImage = this.$node.find('.image-preview'),\n                isLargeEnough = (artifactImage.width() * width) > 5 &&\n                    (artifactImage.height() * height) > 5,\n                detectedObject;\n\n            if (data.id && data.id !== 'NEW') {\n                detectedObject = _.first(F.vertex.props(vertex, 'detectedObject', data.id));\n            } else {\n                data = _.omit(data, 'id');\n            }\n\n            this.trigger('detectedObjectEdit', isLargeEnough ?\n                {\n                    property: detectedObject,\n                    value: data\n                } : null\n            );\n        };\n\n\n        this.onImageLoaded = function() {\n            this.$node.removeClass('loading');\n\n            if (Privileges.missingEDIT) {\n                return this.$node.css('cursor', 'default')\n            }\n\n            var artifactImage = this.select('artifactImageSelector');\n            this.initializeFacebox(artifactImage);\n        }\n    }\n});\n"]}