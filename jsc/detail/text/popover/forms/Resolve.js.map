{"version":3,"sources":["../../../../../js/detail/text/popover/forms/Resolve.jsx"],"names":["define","createReactClass","PropTypes","classNames","Alert","ElementSelector","ConceptSelector","JustificationEditor","VisibilityEditor","F","DefaultVisibility","value","valid","Resolve","propTypes","artifactId","string","isRequired","propertyKey","propertyName","mentionEnd","number","mentionStart","sign","onCancel","func","onResolve","error","instanceOf","Error","loading","bool","resolvedFromTermMention","conceptType","getInitialState","visibility","conceptId","props","render","rest","state","resolvedVertexId","newElementText","justification","justificationValid","justificationValues","i18n","matchType","onElementSelected","onCreateNewElement","onConceptSelected","onJustificationChanged","onVisibilityChanged","isValid","initialSign","visibilitySource","element","setState","id","text","concept","entity","others","_","all","o"],"mappings":"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","file":"Resolve.js","sourcesContent":["define([\n    'create-react-class',\n    'prop-types',\n    'classnames',\n    'components/Alert',\n    'components/element/ElementSelector',\n    'components/ontology/ConceptSelector',\n    'components/justification/JustificationEditor',\n    'components/visibility/VisibilityEditor',\n    'util/vertex/formatters'\n], function(\n    createReactClass,\n    PropTypes,\n    classNames,\n    Alert,\n    ElementSelector,\n    ConceptSelector,\n    JustificationEditor,\n    VisibilityEditor,\n    F) {\n\n    const DefaultVisibility = { value: '', valid: true };\n    const Resolve = createReactClass({\n        propTypes: {\n            artifactId: PropTypes.string.isRequired,\n            propertyKey: PropTypes.string.isRequired,\n            propertyName: PropTypes.string.isRequired,\n            mentionEnd: PropTypes.number.isRequired,\n            mentionStart: PropTypes.number.isRequired,\n            sign: PropTypes.string.isRequired,\n            onCancel: PropTypes.func.isRequired,\n            onResolve: PropTypes.func.isRequired,\n            error: PropTypes.instanceOf(Error),\n            loading: PropTypes.bool,\n            resolvedFromTermMention: PropTypes.string,\n            conceptType: PropTypes.string\n        },\n        getInitialState() {\n            return {\n                visibility: DefaultVisibility,\n                conceptId: this.props.conceptType\n            }\n        },\n        render() {\n            const { onCancel, sign, conceptType, error, loading = false, ...rest } = this.props;\n            const { resolvedVertexId, newElementText, conceptId, justification = {}, visibility } = this.state;\n            const { valid: justificationValid, value: justificationValues } = justification\n\n            return (\n                <div className=\"form\">\n                    { error ? (<Alert error={error} />) : null }\n\n                    <h1>{ resolvedVertexId ? i18n('detail.text.terms.form.resolve.existing') :\n                        newElementText ? i18n('detail.text.terms.form.resolve.new') : i18n('detail.text.terms.form.resolve.search')}</h1>\n                    <ElementSelector\n                        creatable\n                        filterResultsToTitleField\n                        searchOptions={{ matchType: 'vertex' }}\n                        value={sign}\n                        placeholder={i18n('detail.text.terms.form.resolve.placeholder')}\n                        onElementSelected={this.onElementSelected}\n                        onCreateNewElement={this.onCreateNewElement}\n                        createNewRenderer={value => i18n('detail.text.terms.form.resolve.create', value)}\n                        createNewValueRenderer={value => value } />\n                    { (resolvedVertexId || newElementText) ? (\n                        <div>\n                            { !resolvedVertexId && newElementText ?\n                                (<ConceptSelector\n                                    clearable={conceptId !== conceptType}\n                                    onSelected={this.onConceptSelected}\n                                    value={conceptId || conceptType || ''} />) : null\n                            }\n\n                            <JustificationEditor\n                                value={justificationValues}\n                                onJustificationChanged={this.onJustificationChanged}\n                                />\n\n                            { !resolvedVertexId ?\n                                (<VisibilityEditor\n                                    value={visibility && visibility.value}\n                                    onVisibilityChanged={this.onVisibilityChanged} />) : null\n                            }\n                        </div>\n                    ) : null }\n                    <div className=\"buttons\">\n                        <button onClick={onCancel} className=\"btn btn-link btn-small\">{i18n('detail.text.terms.form.cancel')}</button>\n                        <button\n                            disabled={loading || !this.isValid()}\n                            onClick={this.onResolve}\n                            className={classNames('btn-success btn btn-small', {loading})}>{i18n('detail.text.terms.form.resolve.button')}</button>\n                    </div>\n                </div>\n            )\n        },\n        onResolve() {\n            const {\n                artifactId, propertyName, propertyKey,\n                resolvedFromTermMention, sign: initialSign,\n                mentionStart, mentionEnd\n            } = this.props;\n\n            const {\n                resolvedVertexId, newElementText: sign,\n                conceptId, justification, visibility\n            } = this.state;\n\n            this.props.onResolve({\n                visibilitySource: visibility.value,\n                artifactId,\n                propertyName,\n                propertyKey,\n                resolvedFromTermMention,\n                mentionStart,\n                mentionEnd,\n                ...justification.value,\n                ...(resolvedVertexId ? { resolvedVertexId, sign: initialSign } : { sign, conceptId })\n            })\n        },\n        onElementSelected(element) {\n            this.setState({\n                resolvedVertexId: element ? element.id : null,\n                newElementText: null,\n                visibility: DefaultVisibility\n            })\n        },\n        onCreateNewElement(text) {\n            this.setState({ newElementText: text, resolvedVertexId: null })\n        },\n        onConceptSelected(concept) {\n            const { conceptType } = this.props;\n            this.setState({ conceptId: concept ? concept.id : conceptType })\n        },\n        onJustificationChanged(justification) {\n            this.setState({ justification })\n        },\n        onVisibilityChanged(visibility) {\n            this.setState({ visibility })\n        },\n        isValid() {\n            const { resolvedVertexId, newElementText, conceptId, justification, visibility } = this.state;\n            const entity = resolvedVertexId || (newElementText && conceptId);\n            const others = _.all([justification, visibility], o => o && o.valid);\n            return entity && others;\n        }\n    });\n\n    return Resolve;\n});\n"]}