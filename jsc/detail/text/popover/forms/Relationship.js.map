{"version":3,"sources":["../../../../../js/detail/text/popover/forms/Relationship.jsx"],"names":["define","createReactClass","PropTypes","classNames","Alert","RelationshipSelector","JustificationEditor","VisibilityEditor","F","Element","Relationship","propTypes","onCancel","func","isRequired","onSave","sourceVertexId","string","targetVertexId","getInitialState","invert","visibility","value","valid","render","props","loading","error","vertices","onFocusElements","state","relationshipId","justification","justificationValid","justificationValues","sourceVertex","targetVertex","sourceId","vertex","prop","targetId","i18n","onInvert","onSelected","onJustificationChanged","onVisibilityChanged","isValid","setState","relationship","title","outVertexId","inVertexId","predicateLabel","visibilitySource","others","_","all","o"],"mappings":"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","file":"Relationship.js","sourcesContent":["define([\n    'create-react-class',\n    'prop-types',\n    'classnames',\n    'components/Alert',\n    'components/ontology/RelationshipSelector',\n    'components/justification/JustificationEditor',\n    'components/visibility/VisibilityEditor',\n    'util/vertex/formatters',\n    'components/element/Element'\n], function(\n    createReactClass,\n    PropTypes,\n    classNames,\n    Alert,\n    RelationshipSelector,\n    JustificationEditor,\n    VisibilityEditor,\n    F,\n    Element) {\n\n    const Relationship = createReactClass({\n        propTypes: {\n            onCancel: PropTypes.func.isRequired,\n            onSave: PropTypes.func.isRequired,\n            sourceVertexId: PropTypes.string.isRequired,\n            targetVertexId: PropTypes.string.isRequired\n        },\n        getInitialState() {\n            return {\n                invert: false,\n                visibility: { value: '', valid: true }\n            };\n        },\n        render() {\n            const { loading, error, onCancel, onSave, vertices, onFocusElements } = this.props;\n            const { invert, relationshipId, justification = {}, visibility } = this.state;\n            const { valid: justificationValid, value: justificationValues } = justification\n\n            let { sourceVertexId, targetVertexId } = this.props;\n            if (invert) {\n                [sourceVertexId, targetVertexId] = [targetVertexId, sourceVertexId];\n            }\n\n            const sourceVertex = vertices[sourceVertexId];\n            const targetVertex = vertices[targetVertexId];\n            const sourceId = sourceVertex && F.vertex.prop(sourceVertex, 'conceptType')\n            const targetId = targetVertex && F.vertex.prop(targetVertex, 'conceptType')\n\n            return (\n                <div className=\"form relationshipform\">\n                    { error ? (<Alert error={error} />) : null }\n\n                    <h1>{i18n('detail.text.terms.form.relationship')}</h1>\n\n                    <div className=\"rel-elements\">\n                        <p><Element element={sourceVertex} onFocusElements={onFocusElements} /></p>\n\n                        <div className=\"rel-arrow-wrap\">\n                            <div className=\"rel-arrow\"></div>\n                            <button\n                                title={i18n('detail.text.terms.form.relationship.invert.tooltip')}\n                                onClick={this.onInvert}\n                                className=\"invert btn btn-link btm-mini\"\n                            >{ i18n('detail.text.terms.form.relationship.invert')}</button>\n                        </div>\n\n                        <p><Element element={targetVertex} onFocusElements={onFocusElements} /></p>\n                    </div>\n\n                    <RelationshipSelector\n                        onSelected={this.onSelected}\n                        disabled={!sourceId || !targetId}\n                        value={relationshipId}\n                        filter={{ sourceId, targetId }} />\n\n                    <JustificationEditor\n                        value={justificationValues}\n                        onJustificationChanged={this.onJustificationChanged} />\n\n                    <VisibilityEditor\n                        value={visibility && visibility.value}\n                        onVisibilityChanged={this.onVisibilityChanged} />\n\n                    <div className=\"buttons\">\n                        <button onClick={onCancel} className=\"btn btn-link btn-small\">{i18n('detail.text.terms.form.cancel')}</button>\n                        <button\n                            disabled={loading || !this.isValid()}\n                            onClick={this.onSave}\n                            className={classNames('btn-primary btn btn-small', {loading})}>{i18n('detail.text.terms.form.create')}</button>\n                    </div>\n                </div>\n            )\n        },\n        onInvert() {\n            const { invert } = this.state;\n            this.setState({ invert: !invert, relationshipId: null })\n        },\n        onJustificationChanged(justification) {\n            this.setState({ justification })\n        },\n        onVisibilityChanged(visibility) {\n            this.setState({ visibility })\n        },\n        onSelected(relationship) {\n            this.setState({ relationshipId: relationship ? relationship.title : null });\n        },\n        onSave() {\n            const { invert, relationshipId, justification, visibility } = this.state;\n\n            let { sourceVertexId, targetVertexId } = this.props;\n            if (invert) {\n                [sourceVertexId, targetVertexId] = [targetVertexId, sourceVertexId];\n            }\n\n            this.props.onSave({\n                outVertexId: sourceVertexId,\n                inVertexId: targetVertexId,\n                predicateLabel: relationshipId,\n                visibilitySource: visibility.value,\n                ...justification.value\n            })\n        },\n        isValid() {\n            const { relationshipId, justification, visibility } = this.state;\n            const others = _.all([justification, visibility], o => o && o.valid);\n            return relationshipId && others;\n        }\n    });\n\n    return Relationship;\n});\n"]}