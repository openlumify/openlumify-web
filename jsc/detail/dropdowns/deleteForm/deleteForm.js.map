{"version":3,"sources":["../../../../js/detail/dropdowns/deleteForm/deleteForm.js"],"names":["define","defineComponent","withDropdown","template","alertTemplate","withDataRequest","F","DeleteForm","defaultAttrs","primarySelector","after","self","shouldConfirm","vertex","isPublished","attr","data","render","onDelete","on","$node","html","event","buttonLoading","trigger","loading","text","dataRequest","type","id","finally","done","then","teardown","catch","error","is","markFieldErrors","clearLoading"],"mappings":"AAAAA,OAAO,CACH,sBADG,CAEH,mBAFG,CAGH,kBAHG,CAIH,gBAJG,CAKH,sBALG,CAMH,wBANG,CAAP,CAOG,SACCC,eADD,CAECC,YAFD,CAGCC,QAHD,CAICC,aAJD,CAKCC,eALD,CAMCC,CAND,CAMI,CACH,aAEA,MAAOL,iBAAgBM,UAAhB,CAA4BL,YAA5B,CAA0CG,eAA1C,CAAP,CAEA,QAASE,WAAT,EAAsB,CAElB,KAAKC,YAAL,CAAkB,CACdC,gBAAiB,aADH,CAAlB,EAIA,KAAKC,KAAL,CAAW,YAAX,CAAyB,UAAW,CAChC,GAAIC,MAAO,IAAX,CACIC,cAAgB,CAACN,EAAEO,MAAF,CAASC,WAAT,CAAqB,KAAKC,IAAL,CAAUC,IAA/B,CADrB,CAGA,GAAIJ,aAAJ,CAAmB,CACf,KAAKK,MAAL,GACH,CAFD,IAEO,CACH,KAAKC,QAAL,GACH,CACJ,CATD,EAWA,KAAKD,MAAL,CAAc,UAAW,CACrB,KAAKE,EAAL,CAAQ,OAAR,CAAiB,CACbV,gBAAiB,KAAKS,QADT,CAAjB,EAGA,KAAKE,KAAL,CAAWC,IAAX,CAAgBlB,SAAS,KAAKY,IAAL,CAAUC,IAAnB,CAAhB,EACH,CALD,CAOA,KAAKE,QAAL,CAAgB,SAASI,KAAT,CAAgB,CAC5B,GAAIX,MAAO,IAAX,CAEA,GAAIW,KAAJ,CAAW,CACP,KAAKC,aAAL,CAAmB,aAAnB,EACH,CAED,KAAKC,OAAL,CAAa,iBAAb,CAAgC,CAC5BC,QAAS,IADmB,CAE5BC,KAAM,aAFsB,CAAhC,EAKA,KAAKC,WAAL,CAAiB,KAAKZ,IAAL,CAAUC,IAAV,CAAeY,IAAhC,CAAsC,QAAtC,CAAgD,KAAKb,IAAL,CAAUC,IAAV,CAAea,EAA/D,EACKC,OADL,CACa,UAAW,CAChBnB,KAAKa,OAAL,CAAa,iBAAb,CAAgC,CAAEO,KAAM,IAAR,CAAhC,EACH,CAHL,EAIKC,IAJL,CAIU,UAAW,CACbrB,KAAKsB,QAAL,GACH,CANL,EAOKC,KAPL,CAOW,SAASC,KAAT,CAAgB,CACnB,GAAIxB,KAAKS,KAAL,CAAWgB,EAAX,CAAc,QAAd,CAAJ,CAA6B,CACzBzB,KAAKM,MAAL,GACH,CACDN,KAAK0B,eAAL,CAAqBF,KAArB,EACAxB,KAAK2B,YAAL,GACH,CAbL,EAcH,CA1BD,CA2BH,CACJ,CAtED","file":"deleteForm.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/withDropdown',\n    'tpl!./deleteForm',\n    'tpl!util/alert',\n    'util/withDataRequest',\n    'util/vertex/formatters'\n], function(\n    defineComponent,\n    withDropdown,\n    template,\n    alertTemplate,\n    withDataRequest,\n    F) {\n    'use strict';\n\n    return defineComponent(DeleteForm, withDropdown, withDataRequest);\n\n    function DeleteForm() {\n\n        this.defaultAttrs({\n            primarySelector: '.btn-danger'\n        });\n\n        this.after('initialize', function() {\n            var self = this,\n                shouldConfirm = !F.vertex.isPublished(this.attr.data);\n\n            if (shouldConfirm) {\n                this.render();\n            } else {\n                this.onDelete();\n            }\n        });\n\n        this.render = function() {\n            this.on('click', {\n                primarySelector: this.onDelete\n            })\n            this.$node.html(template(this.attr.data));\n        }\n\n        this.onDelete = function(event) {\n            var self = this;\n\n            if (event) {\n                this.buttonLoading('.btn-danger');\n            }\n\n            this.trigger('maskWithOverlay', {\n                loading: true,\n                text: 'Deleting...'\n            });\n\n            this.dataRequest(this.attr.data.type, 'delete', this.attr.data.id)\n                .finally(function() {\n                    self.trigger('maskWithOverlay', { done: true });\n                })\n                .then(function() {\n                    self.teardown();\n                })\n                .catch(function(error) {\n                    if (self.$node.is(':empty')) {\n                        self.render();\n                    }\n                    self.markFieldErrors(error);\n                    self.clearLoading();\n                })\n        };\n    }\n});\n"]}