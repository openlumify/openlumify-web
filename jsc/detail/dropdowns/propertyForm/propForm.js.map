{"version":3,"sources":["../../../../js/detail/dropdowns/propertyForm/propForm.js"],"names":["define","require","defineComponent","withDropdown","template","PropertySelector","alertTemplate","withTeardown","VertexSelector","F","withDataRequest","PropertyForm","defaultAttrs","propertyListSelector","saveButtonSelector","deleteButtonSelector","configurationSelector","configurationFieldSelector","previousValuesSelector","previousValuesDropdownSelector","vertexContainerSelector","visibilitySelector","justificationSelector","visibilityInputSelector","allowDeleteProperty","allowEditProperty","before","n","c","manualOpen","after","self","property","attr","vertex","data","justification","modified","on","onSave","onDelete","onPreviousValuesButtons","onKeyup","onPropertyError","onPropertyChange","onPropertyInvalid","onPropertySelected","onVisibilityChange","onJustificationChange","_","debounce","onPaste","bind","onPreviousValuesDropdown","$node","html","loading","select","prop","hide","trigger","disablePreviousValuePrompt","chain","pick","split","extend","title","name","value","onVertexSelected","attachTo","focus","defaultText","i18n","setupPropertySelectionField","label","conceptType","filter","addable","relationshipId","conceptId","propertyNode","show","teardownAllComponents","one","find","defer","placeholder","event","stopPropagation","teardownComponent","closest","length","remove","$","target","val","dropdown","buttons","removeClass","action","addClass","preventDefault","fromPreviousValuePrompt","omit","currentProperty","previousValues","map","p","i","visibility","metadata","previousValuesPropertyName","key","visibilityJson","JSON","stringify","join","Visibility","each","source","li","index","propertyName","config","vertexProperty","first","props","isUndefined","undefined","previousValue","visibilityValue","sandboxStatus","isExistingProperty","isEditingVisibility","streamingPropertyValue","previousValuesUniquedByKey","unique","previousValuesUniquedByKeyUpdateable","where","updateable","currentValue","attemptToCoerceValue","isObject","latitude","longitude","visibilitySource","valid","addBack","text","toggle","deleteButton","button","dataRequest","done","properties","propertyDetails","byTitle","deleteable","currentPropertyDetails","editVisibility","visibilityMetadata","isCompoundField","dependentPropertyIris","fieldComponent","dependentProperties","iri","displayType","possibleValues","dataType","PropertyField","Justification","$toHide","add","justificationText","sourceInfo","settingVisibility","checkValid","values","tooltip","placement","previousPropertyValue","getConfigurationValues","console","warn","isVisibilityProp","isExistingProp","isModified","current","previous","toggleClass","propertyInvalid","isEmpty","some","transformValue","valueArray","description","currentMetadata","valueModified","propertyValue","messages","markFieldErrors","error","clearLoading","saving","lookupAllComponents","shift","isFunction","getValue","getValues","evt","which","ui","keyCode","ENTER","is","type","_keydownValid","buttonLoading","vertexId","id","node","propertyKey","oldMetadata","oldVisibilitySource","reduce","valueMap","isString","isNumber","isEdge","element"],"mappings":"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","file":"propForm.js","sourcesContent":["define([\n    'require',\n    'flight/lib/component',\n    'util/withDropdown',\n    './propForm.hbs',\n    'util/ontology/propertySelect',\n    'tpl!util/alert',\n    'util/withTeardown',\n    'util/vertex/vertexSelect',\n    'util/vertex/formatters',\n    'util/withDataRequest'\n], function(\n    require,\n    defineComponent,\n    withDropdown,\n    template,\n    PropertySelector,\n    alertTemplate,\n    withTeardown,\n    VertexSelector,\n    F,\n    withDataRequest\n) {\n    'use strict';\n\n    return defineComponent(PropertyForm, withDropdown, withTeardown, withDataRequest);\n\n    function PropertyForm() {\n\n        this.defaultAttrs({\n            propertyListSelector: '.property-list',\n            saveButtonSelector: '.btn-primary',\n            deleteButtonSelector: '.btn-danger',\n            configurationSelector: '.configuration',\n            configurationFieldSelector: '.configuration input',\n            previousValuesSelector: '.previous-values',\n            previousValuesDropdownSelector: '.previous-values-container .dropdown-menu',\n            vertexContainerSelector: '.vertex-select-container',\n            visibilitySelector: '.visibility',\n            justificationSelector: '.justification',\n            visibilityInputSelector: '.visibility input',\n            allowDeleteProperty: true,\n            allowEditProperty: true\n        });\n\n        this.before('initialize', function(n, c) {\n            c.manualOpen = true;\n        });\n\n        this.after('initialize', function() {\n            var self = this,\n                property = this.attr.property,\n                vertex = this.attr.data;\n\n            this.justification = {};\n            this.modified = {};\n\n            this.on('click', {\n                saveButtonSelector: this.onSave,\n                deleteButtonSelector: this.onDelete,\n                previousValuesSelector: this.onPreviousValuesButtons\n            });\n            this.on('keyup keydown', {\n                configurationFieldSelector: this.onKeyup,\n                justificationSelector: this.onKeyup,\n                visibilityInputSelector: this.onKeyup\n            });\n\n            this.on('propertyerror', this.onPropertyError);\n            this.on('propertychange', this.onPropertyChange);\n            this.on('propertyinvalid', this.onPropertyInvalid);\n            this.on('propertyselected', this.onPropertySelected);\n            this.on('visibilitychange', this.onVisibilityChange);\n            this.on('justificationchange', this.onJustificationChange);\n            this.on('paste', {\n                configurationFieldSelector: _.debounce(this.onPaste.bind(this), 10)\n            });\n            this.on('click', {\n                previousValuesDropdownSelector: this.onPreviousValuesDropdown\n            });\n            this.$node.html(template({\n                property: property,\n                vertex: vertex,\n                loading: this.attr.loading\n            }));\n\n            this.select('saveButtonSelector').prop('disabled', true);\n            this.select('deleteButtonSelector').hide();\n\n            if (this.attr.property) {\n                this.trigger('propertyselected', {\n                    disablePreviousValuePrompt: true,\n                    property: _.chain(property)\n                        .pick('displayName key name value visibility metadata'.split(' '))\n                        .extend({\n                            title: property.name\n                        })\n                        .value()\n                });\n            } else if (!vertex) {\n                this.on('vertexSelected', this.onVertexSelected);\n                VertexSelector.attachTo(this.select('vertexContainerSelector'), {\n                    value: '',\n                    focus: true,\n                    defaultText: i18n('vertex.field.placeholder')\n                });\n                this.manualOpen();\n            } else {\n                this.setupPropertySelectionField();\n            }\n        });\n\n        this.setupPropertySelectionField = function() {\n            const { label, conceptType } = this.attr.data;\n            const filter = { addable: true };\n            if (label) {\n                filter.relationshipId = label\n            } else if (conceptType) {\n                filter.conceptId = conceptType;\n            }\n\n            const propertyNode = this.select('propertyListSelector').show();\n            propertyNode.teardownAllComponents();\n\n            propertyNode.one('rendered', () => {\n                this.on('opened', () => {\n                    propertyNode.find('input').focus()\n                })\n                _.defer(() => {\n                    this.manualOpen();\n                })\n            });\n\n            PropertySelector.attachTo(propertyNode, {\n                filter: {\n                    conceptId: this.attr.data.conceptType,\n                    relationshipId: this.attr.data.label,\n                    addable: true\n                },\n                placeholder: i18n('property.form.field.selection.placeholder')\n            });\n        };\n\n        this.onVertexSelected = function(event, data) {\n            event.stopPropagation();\n\n            if (data.vertex) {\n                this.attr.data = data.vertex;\n                this.setupPropertySelectionField();\n            } else {\n                this.select('propertyListSelector').hide();\n            }\n            this.trigger('propFormVertexChanged', data);\n        };\n\n        this.after('teardown', function() {\n            this.select('visibilitySelector').teardownAllComponents();\n            this.select('vertexContainerSelector').teardownComponent(VertexSelector);\n\n            if (this.$node.closest('.buttons').length === 0) {\n                this.$node.closest('tr').remove();\n            }\n        });\n\n        this.onPaste = function(event) {\n            var self = this,\n                value = $(event.target).val();\n\n            _.defer(function() {\n                self.trigger(\n                    self.select('justificationSelector'),\n                    'valuepasted',\n                    { value: value }\n                );\n            });\n        };\n\n        this.onPreviousValuesButtons = function(event) {\n            var self = this,\n                dropdown = this.select('previousValuesDropdownSelector'),\n                buttons = this.select('previousValuesSelector').find('.active').removeClass('active'),\n                action = $(event.target).closest('button').addClass('active').data('action');\n\n            event.stopPropagation();\n            event.preventDefault();\n\n            if (action === 'add') {\n                dropdown.hide();\n                this.trigger('propertyselected', {\n                    fromPreviousValuePrompt: true,\n                    property: _.omit(this.currentProperty, 'value', 'key')\n                });\n            } else if (this.previousValues.length > 1) {\n                this.trigger('propertyselected', {\n                    property: _.omit(this.currentProperty, 'value', 'key')\n                });\n\n                dropdown.html(\n                        this.previousValues.map(function(p, i) {\n                            var visibility = p.metadata && p.metadata['http://openlumify.org#visibilityJson'];\n                            return _.template(\n                                '<li data-index=\"{i}\">' +\n                                    '<a href=\"#\">{value}' +\n                                        '<div data-visibility=\"{visibilityJson}\" class=\"visibility\"/>' +\n                                    '</a>' +\n                                '</li>')({\n                                value: F.vertex.prop(self.attr.data, self.previousValuesPropertyName, p.key),\n                                visibilityJson: JSON.stringify(visibility || {}),\n                                i: i\n                            });\n                        }).join('')\n                    ).show();\n\n                require(['util/visibility/view'], function(Visibility) {\n                    dropdown.find('.visibility').each(function() {\n                        var value = $(this).data('visibility');\n                        Visibility.attachTo(this, {\n                            value: value && value.source\n                        });\n                    });\n                });\n\n            } else {\n                dropdown.hide();\n                this.trigger('propertyselected', {\n                    fromPreviousValuePrompt: true,\n                    property: $.extend({}, this.currentProperty, this.previousValues[0])\n                });\n            }\n        };\n\n        this.onPreviousValuesDropdown = function(event) {\n            var li = $(event.target).closest('li'),\n                index = li.data('index');\n\n            this.$node.find('.previous-values .edit-previous').addClass('active');\n            this.trigger('propertyselected', {\n                fromPreviousValuePrompt: true,\n                property: $.extend({}, this.currentProperty, this.previousValues[index])\n            });\n        };\n\n        this.onPropertySelected = function(event, data) {\n            var self = this,\n                property = data.property,\n                disablePreviousValuePrompt = data.disablePreviousValuePrompt,\n                propertyName = property && property.title,\n                config = self.select('configurationSelector'),\n                visibility = self.select('visibilitySelector'),\n                justification = self.select('justificationSelector');\n\n            this.trigger('propFormPropertyChanged', data);\n\n            if (!property) {\n                config.hide();\n                visibility.hide();\n                justification.hide();\n                return;\n            } else {\n                config.show();\n            }\n\n            this.currentProperty = property;\n            this.$node.find('.errors').hide();\n\n            config.teardownAllComponents();\n            visibility.teardownAllComponents();\n            justification.teardownAllComponents();\n\n            var vertexProperty = property.title === 'http://openlumify.org#visibilityJson' ?\n                    _.first(F.vertex.props(this.attr.data, property.title)) :\n                    !_.isUndefined(property.key) ?\n                    _.first(F.vertex.props(this.attr.data, property.title, property.key)) :\n                    undefined,\n                previousValue = vertexProperty && vertexProperty.value,\n                visibilityValue = vertexProperty &&\n                    vertexProperty.metadata &&\n                    vertexProperty.metadata['http://openlumify.org#visibilityJson'],\n                sandboxStatus = vertexProperty && vertexProperty.sandboxStatus,\n                isExistingProperty = typeof vertexProperty !== 'undefined',\n                isEditingVisibility = propertyName === 'http://openlumify.org#visibilityJson' || (\n                    vertexProperty && vertexProperty.streamingPropertyValue\n                ),\n                previousValues = disablePreviousValuePrompt !== true && F.vertex.props(this.attr.data, propertyName),\n                previousValuesUniquedByKey = previousValues && _.unique(previousValues, _.property('key')),\n                previousValuesUniquedByKeyUpdateable = _.where(previousValuesUniquedByKey, {updateable: true});\n\n\n            this.currentValue = this.attr.attemptToCoerceValue || previousValue;\n            if (this.currentValue && _.isObject(this.currentValue) && ('latitude' in this.currentValue)) {\n                this.currentValue = 'point(' + this.currentValue.latitude + ',' + this.currentValue.longitude + ')';\n            }\n\n            if (visibilityValue) {\n                visibilityValue = visibilityValue.source;\n                this.visibilitySource = { value: visibilityValue, valid: true };\n            }\n\n            if (property.name === 'http://openlumify.org#visibilityJson') {\n                vertexProperty = property;\n                isExistingProperty = true;\n                previousValues = null;\n                previousValuesUniquedByKey = null;\n            }\n\n            if (data.fromPreviousValuePrompt !== true && this.attr.allowEditProperty) {\n                if (previousValuesUniquedByKeyUpdateable && previousValuesUniquedByKeyUpdateable.length) {\n                    this.previousValues = previousValuesUniquedByKeyUpdateable;\n                    this.previousValuesPropertyName = propertyName;\n                    this.select('previousValuesSelector')\n                        .show()\n                        .find('.active').removeClass('active')\n                        .addBack()\n                        .find('.edit-previous span').text(previousValuesUniquedByKeyUpdateable.length)\n                        .addBack()\n                        .find('.edit-previous small').toggle(previousValuesUniquedByKeyUpdateable.length > 1);\n\n                    this.select('justificationSelector').hide();\n                    this.select('visibilitySelector').hide();\n                    this.select('previousValuesDropdownSelector').hide();\n\n                    return;\n                } else {\n                    this.select('previousValuesSelector').hide();\n                }\n            }\n\n            this.select('previousValuesDropdownSelector').hide();\n            this.select('justificationSelector').show();\n            this.select('visibilitySelector').show();\n\n            var deleteButton = this.select('deleteButtonSelector')\n                .toggle(\n                    !!isExistingProperty &&\n                    !isEditingVisibility &&\n                    this.attr.allowDeleteProperty\n                );\n\n            var button = this.select('saveButtonSelector')\n                .text(isExistingProperty ? i18n('property.form.button.update') : i18n('property.form.button.add'));\n\n            button.prop('disabled', true);\n\n            this.dataRequest('ontology', 'properties').done(function(properties) {\n                var propertyDetails = properties.byTitle[propertyName];\n                if (!propertyDetails.deleteable) {\n                    deleteButton.hide();\n                }\n                self.currentPropertyDetails = propertyDetails;\n                if (propertyName === 'http://openlumify.org#visibilityJson') {\n                    var val = vertexProperty && vertexProperty.value,\n                        source = (val && val.source) || (val && val.value && val.value.source);\n                    self.editVisibility(visibility, source);\n                } else if (vertexProperty && vertexProperty.streamingPropertyValue && vertexProperty.metadata) {\n                    var visibilityMetadata = vertexProperty.metadata['http://openlumify.org#visibilityJson'];\n                    self.editVisibility(visibility, visibilityMetadata.source);\n                } else if (propertyDetails) {\n                    var isCompoundField = propertyDetails.dependentPropertyIris &&\n                        propertyDetails.dependentPropertyIris.length,\n                        fieldComponent;\n\n                    if (isCompoundField) {\n                        const dependentProperties = property.key ?\n                            F.vertex.props(self.attr.data, propertyName, property.key) :\n                            F.vertex.props(self.attr.data, propertyName);\n                        self.currentValue = propertyDetails.dependentPropertyIris.map((iri) => {\n                            let property = dependentProperties.find((property) => property.name === iri);\n                            return property === undefined ? '' : property.value;\n                        });\n                        fieldComponent = 'fields/compound/compound';\n                    } else if (propertyDetails.displayType === 'duration') {\n                        fieldComponent = 'fields/duration';\n                    } else {\n                        fieldComponent = propertyDetails.possibleValues ?\n                            'fields/restrictValues' : 'fields/' + propertyDetails.dataType;\n                    }\n\n                    require([\n                        fieldComponent,\n                        'detail/dropdowns/propertyForm/justification',\n                        'util/visibility/edit'\n                    ], function(PropertyField, Justification, Visibility) {\n                        if (self.attr.manualOpen) {\n                            var $toHide = $()\n                                .add(config)\n                                .add(justification)\n                                .add(visibility)\n                                .hide();\n                        }\n\n                        Justification.attachTo(justification, {\n                            justificationText: self.attr.justificationText,\n                            sourceInfo: self.attr.sourceInfo\n                        });\n\n                        Visibility.attachTo(visibility, {\n                            value: visibilityValue || ''\n                        });\n\n                        self.settingVisibility = false;\n                        self.checkValid();\n                        self.$node.find('configuration').hide();\n\n                        self.on('fieldRendered', function() {\n                            if ($toHide) {\n                                $toHide.show();\n                            }\n                            self.manualOpen();\n                        });\n                        if (isCompoundField) {\n                            PropertyField.attachTo(config, {\n                                property: propertyDetails,\n                                vertex: self.attr.data,\n                                values: property.key !== undefined ?\n                                    F.vertex.props(self.attr.data, propertyDetails.title, property.key) :\n                                    null\n                            });\n                        } else {\n                            PropertyField.attachTo(config, {\n                                property: propertyDetails,\n                                vertexProperty: vertexProperty,\n                                value: self.attr.attemptToCoerceValue || previousValue,\n                                tooltip: (!self.attr.sourceInfo && !self.attr.justificationText) ? {\n                                    html: true,\n                                    title: `\n                                        <div class=\"message\">${i18n('justification.field.value.tooltip.title')}</div>\n                                        <div class=\"subtitle\">${i18n('justification.field.value.tooltip.subtitle')}</div>\n                                        <div class=\"footer\">${i18n('justification.field.value.tooltip.footer')}</div>\n                                    `,\n                                    placement: 'left',\n                                    trigger: 'focus'\n                                } : null\n                            });\n                        }\n                        self.previousPropertyValue = self.getConfigurationValues();\n                    });\n                } else console.warn('Property ' + propertyName + ' not found in ontology');\n            });\n        };\n\n        this.editVisibility = function(visibility, source) {\n            var self = this;\n            require(['util/visibility/edit'], function(Visibility) {\n                Visibility.attachTo(visibility, {\n                    value: source || ''\n                });\n                visibility.find('input').focus();\n                self.settingVisibility = true;\n                self.visibilitySource = { value: source || '', valid: true };\n\n                self.checkValid();\n                self.manualOpen();\n            });\n        }\n\n        this.onVisibilityChange = function(event, data) {\n            const { value, title, metadata } = this.currentProperty;\n            const isVisibilityProp = title === 'http://openlumify.org#visibilityJson';\n            const isExistingProp = isVisibilityProp || (metadata && 'http://openlumify.org#visibilityJson' in metadata);\n            const isModified = (isExistingProp, isVisibilityProp) => {\n                let current = data.value;\n                let previous = isVisibilityProp ? value.source : metadata['http://openlumify.org#visibilityJson'].source;\n\n                if (isVisibilityProp && !isExistingProp) {\n                    return !!current;\n                } else {\n                    return current ? current !== previous : !!previous;\n                }\n            };\n\n            this.visibilitySource = data;\n            this.modified.visibility = isExistingProp || isVisibilityProp\n                ? isModified(isExistingProp, isVisibilityProp)\n                : !!this.visibilitySource.value;\n\n            this.select('visibilityInputSelector').toggleClass('invalid', !data.valid);\n            this.checkValid();\n        };\n\n        this.onJustificationChange = function(event, data) {\n            var self = this;\n\n            this.justification = data;\n\n            this.modified.justification = data.valid && (data.justificationText || data.sourceInfo);\n            this.checkValid();\n        };\n\n        this.onPropertyInvalid = function(event, data) {\n            event.stopPropagation();\n\n            this.propertyInvalid = true;\n            this.checkValid();\n        };\n\n        this.checkValid = function() {\n            if (this.settingVisibility) {\n                this.valid = this.visibilitySource && this.visibilitySource.valid;\n            } else {\n                var valid = !this.propertyInvalid &&\n                    (this.visibilitySource && this.visibilitySource.valid) &&\n                    (!_.isEmpty(this.justification) ? this.justification.valid : true);\n\n                this.valid = valid;\n            }\n\n            if (this.valid && _.some(this.modified)) {\n                this.select('saveButtonSelector').prop('disabled', false);\n            } else {\n                this.select('saveButtonSelector').prop('disabled', true);\n            }\n        };\n\n        this.onPropertyChange = function(event, data) {\n            var self = this;\n\n            this.propertyInvalid = false;\n            event.stopPropagation();\n\n            var isCompoundField = this.currentPropertyDetails.dependentPropertyIris,\n                transformValue = function(valueArray) {\n                    if (valueArray.length === 1) {\n                        if (_.isObject(valueArray[0]) && ('latitude' in valueArray[0])) {\n                            return JSON.stringify(valueArray[0])\n                        }\n                        return valueArray[0];\n                    } else if (valueArray.length === 2) {\n                        // Must be geoLocation\n                        return 'point(' + valueArray.join(',') + ')';\n                    } else if (valueArray.length === 3) {\n                        return JSON.stringify({\n                            description: valueArray[0],\n                            latitude: valueArray[1],\n                            longitude: valueArray[2]\n                        });\n                    }\n                };\n\n            if (isCompoundField) {\n                this.currentValue = _.map(data.values, transformValue);\n            } else {\n                this.currentValue = data.value;\n            }\n\n            this.currentMetadata = data.metadata;\n            this.modified.value = this.currentProperty.value ? valueModified() : !!this.currentValue;\n            this.checkValid();\n\n\n            function valueModified() {\n                var previousValue = self.previousPropertyValue,\n                    propertyValue = self.getConfigurationValues();\n\n                if (previousValue !== undefined) {\n                    return propertyValue !== previousValue;\n                } else {\n                    return !!propertyValue;\n                }\n            }\n        };\n\n        this.onPropertyError = function(event, data) {\n            var messages = this.markFieldErrors(data.error);\n\n            this.$node.find('.errors').html(\n                alertTemplate({\n                    error: messages\n                })\n            ).show();\n\n            _.defer(() => {\n                this.clearLoading()\n                this.saving = false;\n            })\n        };\n\n        this.getConfigurationValues = function() {\n            var config = this.select('configurationSelector').lookupAllComponents().shift();\n\n            return _.isFunction(config.getValue) ? config.getValue() : config.getValues();\n        };\n\n        this.onKeyup = function(evt) {\n            const valid = evt.which === $.ui.keyCode.ENTER &&\n                $(evt.target).is('.configuration *,.visibility *,.justification *');\n\n            if (evt.type === 'keydown') {\n                this._keydownValid = valid;\n            } else if (this._keydownValid && valid) {\n                this._keydownValid = false;\n                if (!this.saving) {\n                    this.onSave();\n                }\n            }\n        };\n\n        this.onDelete = function() {\n            _.defer(this.buttonLoading.bind(this, this.attr.deleteButtonSelector));\n            this.trigger('deleteProperty', {\n                vertexId: this.attr.data.id,\n                property: _.pick(this.currentProperty, 'key', 'name'),\n                node: this.node\n            });\n        };\n\n        this.onSave = function(evt) {\n            var self = this;\n\n            if (!this.valid) return;\n\n            this.saving = true;\n\n            const vertexId = this.attr.data.id;\n            const propertyKey = this.currentProperty.key;\n            const propertyName = this.currentProperty.title;\n            const oldMetadata = this.currentProperty.metadata;\n            const { sourceInfo, justificationText } = this.justification;\n            const justification = sourceInfo ? { sourceInfo } : justificationText ? { justificationText } : {};\n            const oldVisibilitySource = oldMetadata && oldMetadata['http://openlumify.org#visibilityJson']\n                ? oldMetadata['http://openlumify.org#visibilityJson'].source\n                : undefined;\n            const dependentPropertyIris = this.currentPropertyDetails.dependentPropertyIris;\n            let value = this.currentValue;\n\n\n            if (dependentPropertyIris) {\n                value = value.reduce((valueMap, val, i) => {\n                    if (!val && val !== false) {\n                        val = null;\n                    }\n\n                    valueMap[dependentPropertyIris[i]] = val;\n                    return valueMap;\n                }, {})\n            }\n\n            _.defer(this.buttonLoading.bind(this, this.attr.saveButtonSelector));\n\n            this.$node.find('input').tooltip('hide');\n\n            this.$node.find('.errors').hide();\n            if (propertyName.length &&\n                (\n                    this.settingVisibility ||\n                    (\n                        (_.isString(value) && value.length) ||\n                        _.isNumber(value) ||\n                        value\n                    )\n                )) {\n\n                this.trigger('addProperty', {\n                    isEdge: F.vertex.isEdge(this.attr.data),\n                    vertexId: this.attr.data.id,\n                    element: this.attr.data,\n                    property: {\n                        key: propertyKey,\n                        name: propertyName,\n                        value: value,\n                        visibilitySource: this.visibilitySource.value,\n                        oldVisibilitySource: oldVisibilitySource,\n                        metadata: this.currentMetadata,\n                        ...justification\n                    },\n                    node: this.node\n                });\n            }\n        };\n    }\n});\n"]}