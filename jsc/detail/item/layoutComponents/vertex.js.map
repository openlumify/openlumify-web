{"version":3,"sources":["../../../../js/detail/item/layoutComponents/vertex.js"],"names":["define","Toolbar","F","ontology","MaxTitleWords","conceptDisplay","_","compose","property","vertex","concept","vertexDisplay","title","applyTo","type","identifier","layout","options","direction","componentPath","children","ref","style","flex","overflow","constraints","contexts","className","model","partial","modelTransformForFormula","collectionItem","render","el","textContent","displayType","modelAttribute","truncate","formula","contains","Error","Promise","require","then","names","subtitle","propertyName","last","ontologyProperty","properties","byTitle","displayName","compact"],"mappings":"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","file":"vertex.js","sourcesContent":["define([\n    'detail/toolbar/toolbar',\n    'util/vertex/formatters',\n    'util/requirejs/promise!util/service/ontologyPromise',\n], function(Toolbar, F, ontology) {\n    'use strict';\n\n    const MaxTitleWords = 12;\n\n    var conceptDisplay = _.compose(_.property('displayName'), F.vertex.concept),\n        vertexDisplay = F.vertex.title;\n\n    return [\n        {\n            applyTo: { type: 'vertex' },\n            identifier: 'org.openlumify.layout.root',\n            layout: { type: 'flex', options: { direction: 'column' }},\n            componentPath: 'detail/item/vertex',\n            children: [\n                { ref: 'org.openlumify.layout.header', style: { flex: '0 0 auto' } },\n                { ref: 'org.openlumify.layout.body', style: { flex: '1 1 auto', overflow: 'auto' } }\n            ]\n        },\n        {\n            applyTo: {\n                constraints: ['width', 'height'],\n                contexts: ['popup'],\n                type: 'vertex'\n            },\n            identifier: 'org.openlumify.layout.root',\n            componentPath: 'detail/item/vertex',\n            className: 'popupDetailPane',\n            children: [\n                { ref: 'org.openlumify.layout.header.text' },\n                { ref: 'org.openlumify.layout.body' }\n            ]\n        },\n        {\n            applyTo: {\n                constraints: ['width', 'height'],\n                contexts: ['popup']\n            },\n            identifier: 'org.openlumify.layout.body',\n            children: [\n                { ref: 'org.openlumify.layout.formulas' }\n            ]\n        },\n        {\n            identifier: 'org.openlumify.layout.formulas',\n            children: [\n                { ref: 'org.openlumify.layout.formula.item', model: _.partial(modelTransformForFormula, 'subtitle') },\n                { ref: 'org.openlumify.layout.formula.item', model: _.partial(modelTransformForFormula, 'time') }\n            ]\n        },\n        {\n            identifier: 'org.openlumify.layout.formula.item',\n            collectionItem: {\n                render: function(el, model) {\n                    el.textContent = model;\n                }\n            }\n        },\n        {\n            applyTo: { displayType: 'video' },\n            identifier: 'org.openlumify.layout.body',\n            children: [\n                { componentPath: 'detail/video/video', className: 'org-openlumify-video' },\n                { componentPath: 'detail/properties/properties', className: 'org-openlumify-properties', modelAttribute: 'data' },\n                { componentPath: 'comments/comments', className: 'org.openlumify-comments', modelAttribute: 'data' },\n                { componentPath: 'detail/relationships/relationships', className: 'org-openlumify-relationships', modelAttribute: 'data' },\n                { componentPath: 'detail/text/text', className: 'org-openlumify-texts' }\n            ]\n        },\n        {\n            applyTo: { displayType: 'video' },\n            identifier: 'org.openlumify.layout.body.split',\n            children: [\n                { componentPath: 'detail/video/video', className: 'org-openlumify-video' },\n                { ref: 'org.openlumify.layout.body.split.artifact' }\n            ]\n        },\n        {\n            applyTo: { displayType: 'image' },\n            identifier: 'org.openlumify.layout.body',\n            children: [\n                { componentPath: 'detail/image/image', className: 'org-openlumify-image' },\n                { componentPath: 'detail/detectedObjects/detectedObjects' },\n                { componentPath: 'detail/properties/properties', className: 'org-openlumify-properties', modelAttribute: 'data' },\n                { componentPath: 'comments/comments', className: 'org.openlumify-comments', modelAttribute: 'data' },\n                { componentPath: 'detail/relationships/relationships', className: 'org-openlumify-relationships', modelAttribute: 'data' },\n                { componentPath: 'detail/text/text', className: 'org-openlumify-texts' }\n            ]\n        },\n        {\n            applyTo: { displayType: 'image' },\n            identifier: 'org.openlumify.layout.body.split',\n            children: [\n                { componentPath: 'detail/image/image', className: 'org-openlumify-image' },\n                { componentPath: 'detail/detectedObjects/detectedObjects' },\n                { ref: 'org.openlumify.layout.body.split.artifact' }\n            ]\n        },\n        {\n            applyTo: { displayType: 'audio' },\n            identifier: 'org.openlumify.layout.body',\n            children: [\n                { componentPath: 'detail/audio/audio', className: 'org-openlumify-audio' },\n                { componentPath: 'detail/properties/properties', className: 'org-openlumify-properties', modelAttribute: 'data' },\n                { componentPath: 'comments/comments', className: 'org.openlumify-comments', modelAttribute: 'data' },\n                { componentPath: 'detail/relationships/relationships', className: 'org-openlumify-relationships', modelAttribute: 'data' },\n                { componentPath: 'detail/text/text', className: 'org-openlumify-texts' }\n            ]\n        },\n        {\n            applyTo: { displayType: 'audio' },\n            identifier: 'org.openlumify.layout.body.split',\n            children: [\n                { componentPath: 'detail/audio/audio', className: 'org-openlumify-audio' },\n                { ref: 'org.openlumify.layout.body.split.artifact' }\n            ]\n        },\n        {\n            applyTo: { displayType: 'video', constraints: ['width'] },\n            identifier: 'org.openlumify.layout.body',\n            children: [\n                { componentPath: 'detail/video/video', className: 'org-openlumify-video' },\n                { componentPath: 'detail/properties/properties', className: 'org-openlumify-properties', modelAttribute: 'data' },\n                { componentPath: 'comments/comments', className: 'org.openlumify-comments', modelAttribute: 'data' },\n                { componentPath: 'detail/relationships/relationships', className: 'org-openlumify-relationships', modelAttribute: 'data' },\n                { componentPath: 'detail/text/text', className: 'org-openlumify-texts' }\n            ]\n        },\n        {\n            applyTo: { displayType: 'image', constraints: ['width'] },\n            identifier: 'org.openlumify.layout.body',\n            children: [\n                { componentPath: 'detail/image/image', className: 'org-openlumify-image'},\n                { componentPath: 'detail/detectedObjects/detectedObjects' },\n                { componentPath: 'detail/properties/properties', className: 'org-openlumify-properties', modelAttribute: 'data' },\n                { componentPath: 'comments/comments', className: 'org.openlumify-comments', modelAttribute: 'data' },\n                { componentPath: 'detail/relationships/relationships', className: 'org-openlumify-relationships', modelAttribute: 'data' },\n                { componentPath: 'detail/text/text', className: 'org-openlumify-texts' }\n            ]\n        },\n        {\n            applyTo: { displayType: 'audio', constraints: ['width'] },\n            identifier: 'org.openlumify.layout.body',\n            children: [\n                { componentPath: 'detail/audio/audio' },\n                { componentPath: 'detail/properties/properties', className: 'org-openlumify-properties', modelAttribute: 'data' },\n                { componentPath: 'comments/comments', className: 'org.openlumify-comments', modelAttribute: 'data' },\n                { componentPath: 'detail/relationships/relationships', className: 'org-openlumify-relationships', modelAttribute: 'data' },\n                { componentPath: 'detail/text/text', className: 'org-openlumify-texts' }\n            ]\n        },\n        {\n            identifier: 'org.openlumify.layout.body.split.artifact',\n            layout: { type: 'flex', options: { direction: 'row' }},\n            children: [\n                { ref: 'org.openlumify.layout.body.left', style: { flex: 1 }},\n                { ref: 'org.openlumify.layout.body.right', style: { flex: 1 }}\n            ]\n        },\n        {\n            applyTo: { type: 'vertex' },\n            identifier: 'org.openlumify.layout.header.text',\n            layout: { type: 'flex', options: { direction: 'column' }},\n            className: 'vertex-header',\n            children: [\n                { componentPath: 'detail/headerImage/image', className: 'entity-glyphicon', modelAttribute: 'data' },\n                { ref: 'org.openlumify.layout.text', style: 'title', model: vertexDisplay, truncate: MaxTitleWords },\n                { ref: 'org.openlumify.layout.text', style: 'subtitle', model: conceptDisplay }\n            ]\n        }\n    ]\n\n    function modelTransformForFormula(formula, model) {\n        if (!_.contains(['subtitle', 'time', 'title'], formula)) {\n            throw new Error('Not a valid formula', formula);\n        }\n        return Promise.require('util/vertex/formatters').then(function(F) {\n            var names = [],\n                subtitle = F.vertex[formula](model, names),\n                propertyName = _.last(names)\n            if (propertyName) {\n                var ontologyProperty = ontology.properties.byTitle[propertyName];\n                if (ontologyProperty) {\n                    propertyName = ontologyProperty.displayName;\n                }\n                if (!subtitle) return [];\n            }\n            return _.compact([propertyName, subtitle]);\n        });\n    }\n});\n"]}