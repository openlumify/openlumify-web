{"version":3,"sources":["../../../js/detail/item/item.js"],"names":["define","defineComponent","flightRegistry","domElementUtil","F","Promise","ontology","registry","layoutComponents","layoutTypes","documentExtensionPoint","e","_","isFunction","applyTo","isObject","optionalApplyToIsValid","constraints","isArray","length","contexts","type","conceptIri","edgeLabel","displayType","children","render","collectionItem","isString","componentPath","Item","attributes","model","context","focus","after","$node","empty","self","on","onUpdateModel","onUpdateConstraints","onUpdateContext","attr","renderRoot","catch","error","trigger","console","then","isEmpty","find","rootLayoutComponent","findLayoutComponentsMatching","identifier","rootModel","deferredAttachments","renderLayoutComponent","node","prepareModel","attachDeferredComponents","event","data","stopPropagation","target","first","zipChildrenWithModels","layoutComponent","Error","map","modelItem","i","child","modelTransform","transform","teardownOldComponents","el","options","optionallyExcludingComponent","excluding","instanceInfos","findInstanceInfoByNode","forEach","info","key","substring","toUpperCase","componentToTeardown","instance","matchesType","__layoutType","teardown","opts","config","aggregateConstraints","layoutComponentRender","configRender","updateClasses","className","resolve","zipped","all","childAndModel","identity","$el","childElementCount","test","tagName","__isLayoutComponent","$","contents","filter","nodeType","Node","TEXT_NODE","remove","document","createElement","insertBefore","removeChild","get","ref","isUndefined","aggregatedConstraints","childComponent","push","attachComponent","html","createComment","JSON","stringify","elements","initializeLayout","parentConstraints","configuration","unique","concat","domElements","layoutConfig","layout","appendChild","findWhere","extensionsForPoint","require","LayoutType","element","lookupComponent","attachTo","flightInstanceInfo","__layoutTeardownWhenNotLayout","list","f","warn","removeAllStyles","Component","attrs","modelAttribute","componentFilter","constructor","eventFilter","eventInfo","triggerUpdateModelAndStopPropagation","textContent","instanceInfo","suppressWarning","ignoreUpdateModelNotImplemented","__layoutTeardownWhenNotComponent","some","events","classes","chain","arguments","rest","compact","cls","indexOf","packageNameToCssClass","value","removePreviousClasses","modifyClassesOnElement","packageName","replace","toLowerCase","toRemove","classList","existing","item","index","contains","splice","action","add","match","components","possible","comp","layoutComponentAppliesToModel","layoutComponentMatchesConstraints","layoutComponentMatchesContext","sorted","sortBy","concept","concepts","byId","ancestors","order","Number","MAX_VALUE","selected","component","requiredContext","compContexts","requiredConstraints","compConstraints","every","constraint","Boolean","pick","useModel","validIfOnlyOneOff","validApplyTos","applyToKeys","keys","applyToIsValid","intersection","join","multiple","single","properties","isEdge","vertex","isVertex","conceptIriProperty","name","parentConcept","label","otherKeysToDeferChecking","onlyHasKeysThatAreDeferred","difference","off","elementUpdateModelHandler"],"mappings":"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","file":"item.js","sourcesContent":["define([\n    'flight/lib/component',\n    'flight/lib/registry',\n    'util/domElement',\n    'util/vertex/formatters',\n    'util/promise',\n    'util/requirejs/promise!util/service/ontologyPromise',\n    'configuration/plugins/registry',\n    './layoutComponents',\n    './layoutTypes'\n], function(\n    defineComponent,\n    flightRegistry,\n    domElementUtil,\n    F,\n    Promise,\n    ontology,\n    registry,\n    layoutComponents,\n    layoutTypes) {\n    'use strict';\n\n\n    /**\n     * The detail pane is rendered using a custom layout engine consisting of a tree of layout components.\n     *\n     * *Layout Components* are nodes in the layout tree that define the type of layout\n     * and what children are included in the layout.\n     *\n     * The `children` defined in a layout component can be references (`ref`) to other\n     * components, or FlightJS components specified with a `componentPath`. Layout\n     * components can also specify a flight component to be attached to the node for implementing behavior.\n     *\n     * _Exactly one of the following is required: `render`, `collectionItem` or `children` (i.e., you cannot supply both render and collectionItem)._\n     *\n     * @param {org.openlumify.layout.component~applyTo|org.openlumify.layout.component~applyToFn} [applyTo] When does this component get used\n     * @param {string} identifier Identifier of this component for use in other components in package syntax. Also transforms into css class – replacing package periods with dashes\n     * @param {object} [layout]\n     * @param {string} [layout.type] Which {@link org.openlumify.layout.type|layout type} to render `children`.\n     * @param {object} [layout.options] Layout-specific options\n     * @param {string} [componentPath] Additional FlightJS component to attach to this node for behavior\n     * @param {string} [className] Additional css classname to add to DOM\n     * @param {function} [render] Function that renders the content, is passed the `model`, and `match` configuration.\n     * @param {org.openlumify.layout.component~child} [collectionItem] Reference to layout component to render for each item in model (requires model to be array).\n     * @param {array.<org.openlumify.layout.component~child>} [children] Children items to render\n     */\n    registry.documentExtensionPoint('org.openlumify.layout.component',\n        'Define the layout of the Inspector based on content',\n        function(e) {\n            if (!_.isFunction(e.applyTo) && _.isObject(e.applyTo)) {\n                var optionalApplyToIsValid = null;\n                if (e.applyTo.constraints) {\n                    optionalApplyToIsValid = _.isArray(e.applyTo.constraints) && e.applyTo.constraints.length;\n                }\n                if (e.applyTo.contexts) {\n                    optionalApplyToIsValid = optionalApplyToIsValid && _.isArray(e.applyTo.contexts) && e.applyTo.contexts.length;\n                }\n                if (optionalApplyToIsValid !== null) {\n                    return optionalApplyToIsValid;\n                }\n                return (e.applyTo.type || e.applyTo.conceptIri || e.applyTo.edgeLabel || e.applyTo.displayType);\n        }\n        return _.isArray(e.children) || _.isFunction(e.render) || _.isObject(e.collectionItem);\n    }, 'http://docs.openlumify.org/extension-points/front-end/layout/component.html')\n\n    /**\n     * OpenLumify includes the [Flex](https://github.com/openlumify/openlumify/blob/master/web/war/src/main/webapp/js/detail/item/types/flex.js) layout type.\n     *\n     * Layout components are passed properties: `layoutConfig` and `children`\n     *\n     * @param {string} type The identifier for this layout type (used by layout components)\n     * @param {string} componentPath\n     */\n    registry.documentExtensionPoint('org.openlumify.layout.type',\n        'Handles the layout of children within a component',\n        function(e) {\n            return _.isString(e.type) && _.isString(e.componentPath);\n        }\n    );\n\n    return defineComponent(Item);\n\n    function Item() {\n\n        this.attributes({\n            model: null,\n            constraints: [],\n            context: '',\n            focus: {}\n        })\n\n        this.after('teardown', function() {\n            this.$node.empty();\n        })\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.on('updateModel', this.onUpdateModel);\n            this.on('updateConstraints', this.onUpdateConstraints);\n            this.on('updateContext', this.onUpdateContext);\n\n            this.model = this.attr.model;\n            this.constraints = this.attr.constraints;\n            this.context = this.attr.context;\n\n            this.renderRoot()\n                .catch(function(error) {\n                    self.trigger('errorLoadingTypeContent');\n                    console.error(error);\n                })\n                .then(function() {\n                    self.trigger('finishedLoadingTypeContent');\n                    if (!_.isEmpty(self.attr.focus)) {\n                        self.$node.find('.org-openlumify-texts').trigger('focusOnSnippet', self.attr.focus);\n                    }\n                })\n        });\n\n        this.renderRoot = function() {\n            var rootLayoutComponent = findLayoutComponentsMatching({\n                    identifier: 'org.openlumify.layout.root',\n                    model: this.model,\n                    rootModel: this.model,\n                    constraints: this.constraints,\n                    context: this.context\n                }),\n                deferredAttachments = [];\n\n            return renderLayoutComponent(rootLayoutComponent, this.node, prepareModel(this.model), this.model, {\n                deferredAttachments: deferredAttachments,\n                constraints: this.constraints,\n                context: this.context\n            }).then(attachDeferredComponents(deferredAttachments))\n        };\n\n        this.onUpdateModel = function(event, data) {\n            var self = this;\n            event.stopPropagation();\n            if (event.target === this.node) {\n                this.model = data.model;\n                this.renderRoot(this.model, this.constraints).then(function() {\n                    self.trigger('modelUpdated');\n                })\n            }\n        };\n\n        this.onUpdateConstraints = function(event, data) {\n            var self = this;\n            event.stopPropagation();\n            if (event.target === this.node) {\n                this.constraints = data.constraints;\n                this.renderRoot().then(function() {\n                    self.trigger('constraintsUpdated');\n                })\n            }\n        };\n\n        this.onUpdateContext = function(event, data) {\n            var self = this;\n            event.stopPropagation();\n            if (event.target === this.node) {\n                this.context = data.context;\n                this.renderRoot().then(function() {\n                    self.trigger('contextUpdated');\n                })\n            }\n        };\n\n    }\n\n    function prepareModel(model) {\n        if (_.isArray(model) && model.length === 1) {\n            return _.first(model);\n        }\n        return model\n    }\n\n    function zipChildrenWithModels(layoutComponent, model) {\n        if ('collectionItem' in layoutComponent) {\n            if (!_.isArray(model)) {\n                console.error('LayoutComponent', layoutComponent, 'model', model);\n                throw new Error('Collection layout item is not passed an array');\n            }\n\n            return model.map(function(modelItem, i) {\n                return {\n                    child: layoutComponent.collectionItem,\n                    modelTransform: function(model) {\n                        return model[i];\n                    },\n                    model: model\n                }\n            });\n        }\n        /**\n         * _Exactly one of the following is required: `ref`, or `componentPath`._\n         *\n         * @typedef org.openlumify.layout.component~child\n         * @property {object} [style] CSS attributes to set on DOM\n         * @property {string} [modelAttribute] Use this attribute name instead of `model` when attaching FlightJS component.\n         * @property {function} [attributes] Transform attributes using function when attaching FlightJS component.\n         * @property {function|object} [model] Change the model passed to this child, either a function or object.\n         * * `function`: Transforms the state of the model at this level in the tree to the child. Return either the transformed model or a `Promise`.\n         * * `object`: Static object to pass as the model.\n         * @property {string} [ref] Reference to identifier of layout component to render.\n         * @property {string} [componentPath] RequireJS path to FlightJS component to render.\n         */\n        return layoutComponent.children.map(function(child) {\n            var transform;\n            if (_.isFunction(child.model)) {\n                transform = child.model\n            } else if ('model' in child) {\n                transform = function() {\n                    return child.model\n                }\n            }\n            return {\n                child: child,\n                modelTransform: transform,\n                model: model\n            }\n        });\n    }\n\n    function teardownOldComponents(el, options) {\n        var optionallyExcludingComponent = options && options.excluding,\n            type = options && options.type,\n            instanceInfos = flightRegistry.findInstanceInfoByNode(el);\n\n        if (type !== 'layout' && type !== 'component') {\n            throw new Error('type must be layout or component')\n        }\n\n        if (instanceInfos) {\n            instanceInfos.forEach(function(info) {\n                var key = '__layoutTeardownWhenNot' + type.substring(0, 1).toUpperCase() + type.substring(1),\n                    componentToTeardown = info.instance[key],\n                    matchesType = info.instance.__layoutType === type;\n\n                if (componentToTeardown && matchesType && (!optionallyExcludingComponent || componentToTeardown !== optionallyExcludingComponent)) {\n                    info.instance.teardown()\n                }\n            })\n        }\n    }\n\n    function renderLayoutComponent(layoutComponent, node, model, rootModel, opts) {\n        var options = opts || {},\n            config = options.config,\n            constraints = aggregateConstraints(options.constraints, config),\n            context = options.context,\n            deferredAttachments = options.deferredAttachments,\n            layoutComponentRender = layoutComponent && layoutComponent.render,\n            configRender = config && config.render;\n\n        if (_.isFunction(layoutComponentRender || configRender)) {\n            updateClasses(node,\n                layoutComponent && layoutComponent.identifier,\n                layoutComponent && layoutComponent.className,\n                config && config.className)\n            return Promise.resolve((layoutComponentRender || configRender)(node, model, config, layoutComponent));\n        }\n\n        var zipped = zipChildrenWithModels(layoutComponent, model);\n\n        return Promise.all(\n            zipped.map(function(childAndModel, i) {\n                var child = childAndModel.child,\n                    modelTransform = childAndModel.modelTransform || _.identity,\n                    el, $el;\n\n                if (i < node.childElementCount) {\n                    if ((/^DIV$/i).test(node.children[i].tagName) && !(\n                        node.children[i].__isLayoutComponent && child.componentPath\n                    )) {\n                        $el = $(node.children[i]);\n                        $el.contents().filter(function() {\n                            return this.nodeType === Node.TEXT_NODE;\n                        }).remove();\n                    } else {\n                        el = document.createElement('div');\n                        node.insertBefore(el, node.children[i]);\n                        node.removeChild(node.children[i + 1])\n                        $el = $(el);\n                    }\n                } else {\n                    $el = $('<div>');\n                }\n                el = $el.get(0);\n                el.__isLayoutComponent = true;\n                updateClasses(el, child.ref, child.className)\n\n                return Promise.resolve(modelTransform(model))\n                    .then(function(model) {\n                        if (_.isUndefined(model)) {\n                            throw new Error('No model specified')\n                        }\n                        if ('ref' in child) {\n                            teardownOldComponents(el, { type: 'component' })\n                            var aggregatedConstraints = aggregateConstraints(constraints, child),\n                                childComponent = findLayoutComponentsMatching({\n                                    identifier: child.ref,\n                                    model: model,\n                                    rootModel: rootModel,\n                                    constraints: aggregatedConstraints,\n                                    context: context\n                                });\n                            return renderLayoutComponent(childComponent, el, model, rootModel, {\n                                config: child,\n                                constraints: aggregatedConstraints,\n                                context: context,\n                                deferredAttachments: deferredAttachments\n                            });\n                        }\n                        if ('componentPath' in child) {\n                            deferredAttachments.push(attachComponent(child, el, model))\n                            return;\n                        }\n                        if (_.isFunction(child.render)) {\n                            return renderLayoutComponent(null, el, model, rootModel, {\n                                config: child,\n                                constraints: aggregatedConstraints,\n                                context: context,\n                                deferredAttachments: deferredAttachments\n                            })\n                        }\n                        $el.html(document.createComment('Unable to Render: ' + JSON.stringify(child)));\n                    })\n                    .then(function() {\n                        return el;\n                    })\n                    .catch(function(error) {\n                        console.error(error);\n                    })\n            }))\n            .then(function(elements) {\n                updateClasses(node, layoutComponent.identifier, layoutComponent.className, config && config.className)\n                return Promise.resolve(\n                    initializeLayout(node, elements, layoutComponent)\n                );\n            })\n            .then(function() {\n                deferredAttachments.push(attachComponent(layoutComponent, node, model))\n            })\n    }\n\n    function aggregateConstraints(parentConstraints, configuration) {\n        if (configuration && configuration.constraints) {\n            return _.unique((parentConstraints || []).concat(configuration.constraints));\n        }\n        return parentConstraints;\n    }\n\n    function initializeLayout(el, domElements, layoutComponent) {\n        var layoutConfig = layoutComponent.layout;\n        if (!layoutConfig) {\n            teardownOldComponents(el, { type: 'layout' });\n\n            while (el.childElementCount < domElements.length) {\n                var child = domElements[el.childElementCount]\n                el.appendChild(child)\n            }\n            while (el.childElementCount > domElements.length) {\n                el.removeChild(el.children[el.childElementCount - 1])\n            }\n            return\n        }\n        if (!layoutConfig.type) throw new Error('No layout type parameter specified');\n        var type = _.findWhere(registry.extensionsForPoint('org.openlumify.layout.type'), { type: layoutConfig.type });\n        if (!type) throw new Error('No registered layout type for: ' + layoutConfig.type);\n\n        return Promise.require(type.componentPath)\n            .then(function(LayoutType) {\n                var children = domElements.map(function(el, i) {\n                    return {\n                        element: el,\n                        configuration: layoutComponent.collectionItem || layoutComponent.children[i]\n                    }\n                });\n\n                teardownOldComponents(el, { type: 'layout', excluding: LayoutType });\n\n                if ($(el).lookupComponent(LayoutType)) {\n                    $(el).trigger('updateLayout', {\n                        children: children,\n                        layoutConfig: layoutConfig.options || {}\n                    });\n                } else {\n                    LayoutType.attachTo(el, {\n                        layoutConfig: layoutConfig.options || {},\n                        children: children\n                    });\n                    var instance = flightInstanceInfo(el, LayoutType).instance\n                    instance.__layoutType = 'layout';\n                    instance.__layoutTeardownWhenNotLayout = LayoutType\n                }\n            });\n    }\n\n    function attachDeferredComponents(list) {\n        return function() {\n            return Promise.all(\n                list.map(function(f) {\n                    if (_.isFunction(f)) {\n                        return Promise.resolve(f())\n                    } else if (f) {\n                        console.warn('Deferred attachment not a function?', f);\n                    }\n                    return Promise.resolve();\n                })\n            )\n        }\n    }\n\n    function attachComponent(config, el, model) {\n        if (!config.componentPath) {\n            return;\n        }\n        if (el.__isLayoutComponent) {\n            domElementUtil.removeAllStyles(el);\n        }\n        return function() {\n            return Promise.require(config.componentPath)\n                .then(function(Component) {\n                    var attrs = {};\n                    if (config.modelAttribute) {\n                        attrs[config.modelAttribute] = model\n                    } else if (_.isFunction(config.attributes)) {\n                        attrs = config.attributes(model);\n                    } else if (config.attributes) {\n                        attrs = config.attributes;\n                    } else {\n                        attrs.model = model;\n                    }\n\n                    teardownOldComponents(el, { type: 'component', excluding: Component })\n\n                    var instanceInfos = flightRegistry.findInstanceInfoByNode(el),\n                        componentFilter = function(info) {\n                            return info.instance.constructor === Component;\n                        },\n                        eventFilter = function(eventInfo) {\n                            return eventInfo.type === 'updateModel';\n                        }\n\n                    if (instanceInfos && instanceInfos.length && _.filter(instanceInfos, componentFilter).length) {\n                        triggerUpdateModelAndStopPropagation(el, model);\n                    } else {\n                        if (el.__isLayoutComponent && !config.identifier) {\n                            el.textContent = '';\n                        }\n                        Component.attachTo(el, attrs);\n                    }\n                    if (el.__isLayoutComponent) {\n                        delete el.__isLayoutComponent;\n                    }\n\n                    var instanceInfo = flightInstanceInfo(el, Component),\n                        suppressWarning = instanceInfo &&\n                            instanceInfo.instance.attr.ignoreUpdateModelNotImplemented === true;\n\n                    if (instanceInfo) {\n                        instanceInfo.instance.__layoutTeardownWhenNotComponent = Component\n                        instanceInfo.instance.__layoutType = 'component';\n                        if (!_.some(instanceInfo.events, eventFilter) && !suppressWarning) {\n\n                            console.warn(\n                                'Component added to layout doesn\\'t respond to \"updateModel\". ' +\n                                'Suppress warning with ' +\n                                '\"ignoreUpdateModelNotImplemented\" attribute',\n                                Component,\n                                el\n                            );\n                        }\n                    }\n\n                });\n        }\n    }\n\n    function updateClasses(el) {\n        var classes = _.chain(arguments)\n            .rest()\n            .compact()\n            .map(function(cls) {\n                if (cls.indexOf(' ') >= 0) {\n                    throw new Error('Spaces not allowed in classes')\n                }\n                if (cls.indexOf('.') >= 0) {\n                    return packageNameToCssClass(cls);\n                }\n                return cls;\n            })\n            .value()\n\n        removePreviousClasses(el);\n        modifyClassesOnElement(el, 'add', classes);\n\n        function packageNameToCssClass(packageName) {\n            if (packageName) {\n                return packageName.replace(/[.]/g, '-').replace(/[^a-zA-Z\\-]/g, '').toLowerCase();\n            }\n        }\n        function removePreviousClasses(el) {\n            var toRemove = [];\n            for (var i = 0; i < el.classList.length; i++) {\n                var existing = el.classList.item(i),\n                    index = classes.indexOf(existing);\n                if (index === -1) {\n                    // Special case, should be updated\n                    if (existing !== 'type-content' ||\n                        !_.contains(classes, 'org-openlumify-layout-root')) {\n                        toRemove.push(existing)\n                    }\n                } else {\n                    classes.splice(index, 1)\n                }\n            }\n            modifyClassesOnElement(el, 'remove', toRemove);\n        }\n        function modifyClassesOnElement(el, action, classes) {\n            if (el && action && classes.length) {\n                classes.forEach(function(cls) {\n                    if (action === 'add' && !el.classList.contains(cls)) {\n                        el.classList.add(cls);\n                    } else if (action === 'remove' && el.classList.contains(cls)) {\n                        el.classList.remove(cls);\n                    }\n                })\n            }\n        }\n    }\n\n    function findLayoutComponentsMatching(match) {\n        if (!match) {\n            throw new Error('Match object is required');\n        }\n        if (!_.isString(match.identifier) || !match.identifier.length) {\n            throw new Error('Match identifier required');\n        }\n        if (!match.rootModel) {\n            throw new Error('Match rootModel is required');\n        }\n        if (_.isUndefined(match.model)) {\n            throw new Error('Match model is required');\n        }\n        if (!match.constraints) {\n            match.constraints = [];\n        }\n        if (match.context && !_.isString(match.context)) {\n            throw new Error('Match context must be string: ' + match.context);\n        }\n        if (!_.isArray(match.constraints)) {\n            throw new Error('Contraints must be array: ' + match.constraints);\n        }\n\n        /**\n         * _Only one of these allowed: conceptIri, edgeLabel, displayType, type*_\n         *\n         * @typedef org.openlumify.layout.component~applyTo\n         * @property {string} [conceptIri] Implies vertices, only those whose concept (or ancestor) matches this Iri.\n         * @property {string} [edgeLabel] Implies edges, only those whose edgeLabel matches this Iri.\n         * @property {string} [displayType] Match ontological `displayType` option.\n         * @property {string} [type] Possible values: `vertex`, `edge`, `element`, `element[]`.\n         * @property {array.<string>} [constraints] Possible values: `width`, `height`.\n         * Match based on the view container, instead of matching model data.\n         * Constraints control the layout selection for views that are width, and/or height constrained.\n         * The detail pane is set to be width constrained, whereas the full screen view has no constraints.\n         * @property {array.<string>} [contexts] For named templates. `popup` is defined by default for graph previews\n         */\n\n        /**\n         * @callback org.openlumify.layout.component~applyToFn\n         * @param {object} model\n         * @param {object} match\n         * @param {array.<string>} match.contexts\n         * @param {array.<string>} match.constraints\n         * @returns {boolean} If this component should apply given the `model` and `match`\n         */\n\n        var components = registry.extensionsForPoint('org.openlumify.layout.component'),\n            possible = _.filter(components, function(comp) {\n                if (comp.identifier === match.identifier) {\n                    return layoutComponentAppliesToModel(comp, match.model, match.rootModel, match) &&\n                        layoutComponentMatchesConstraints(comp, match.constraints) &&\n                        layoutComponentMatchesContext(comp, match.context);\n                }\n            }),\n            sorted = _.chain(possible)\n                // sort concept hierarchy\n                .sortBy(function(comp) {\n                    var applyTo = comp.applyTo;\n                    if (applyTo && applyTo.conceptIri) {\n                        var concept = ontology.concepts.byId[applyTo.conceptIri];\n                        if (concept) return concept.ancestors.length;\n                    }\n                    return 0;\n                })\n                // sort by applyTo\n                .sortBy(function(comp) {\n                    var applyTo = comp.applyTo,\n                        order = -1;\n\n                    if (_.isFunction(applyTo)) return order;\n                    if (applyTo) {\n\n                        if (applyTo.conceptIri) return order + 1;\n                        if (applyTo.edgeLabel) return order + 1;\n\n                        if (applyTo.displayType) return order + 2;\n\n                        if (applyTo.type === 'vertex') return order + 3;\n                        if (applyTo.type === 'edge') return order + 3;\n\n                        if (applyTo.type === 'element') return order + 4;\n                    }\n                    return Number.MAX_VALUE;\n                })\n                // sort by applyTo constraints/contexts\n                .sortBy(function(comp) {\n                    var applyTo = comp.applyTo,\n                        order = -1;\n\n                    if (_.isFunction(applyTo)) return order;\n                    if (applyTo) {\n\n                        if (applyTo.contexts && applyTo.constraints) return order + 1;\n                        if (applyTo.contexts) return order + 2;\n                        if (applyTo.constraints) return order + 3;\n                    }\n                    return Number.MAX_VALUE;\n                })\n                .value(),\n            selected = _.first(sorted);\n\n        if (!selected) {\n            console.error(match)\n            throw new Error('No layout component available for');\n        }\n\n        return selected;\n    }\n\n    function layoutComponentMatchesContext(component, requiredContext) {\n        var compContexts = component.applyTo && component.applyTo.contexts;\n        if (compContexts) {\n            return _.contains(compContexts, requiredContext);\n        }\n\n        return true;\n    }\n\n    function layoutComponentMatchesConstraints(component, requiredConstraints) {\n        var compConstraints = component.applyTo && component.applyTo.constraints;\n        if (compConstraints) {\n            if (!requiredConstraints.length && compConstraints.length) {\n                return false;\n            }\n            return requiredConstraints.length === compConstraints.length &&\n                _.every(requiredConstraints, function(constraint) {\n                    return _.contains(compConstraints, constraint);\n                });\n        }\n\n        return true;\n    }\n\n    function layoutComponentAppliesToModel(component, model, rootModel, match) {\n        if ('applyTo' in component) {\n            if (_.isFunction(component.applyTo)) {\n                return Boolean(component.applyTo(model, _.pick(match, 'constraints', 'context')));\n            }\n            if (component.applyTo) {\n                var applyTo = component.applyTo,\n                    useModel = _.isUndefined(model) ? rootModel : model,\n                    validIfOnlyOneOff = ['type', 'displayType', 'conceptIri', 'edgeLabel'],\n                    validApplyTos = ['type', 'displayType', 'conceptIri', 'edgeLabel', 'constraints', 'contexts'],\n                    applyToKeys = _.keys(applyTo),\n                    applyToIsValid = applyToKeys.length &&\n                        _.intersection(validIfOnlyOneOff, applyToKeys).length <= 1 &&\n                        _.contains(validApplyTos, applyToKeys[0] || '');\n\n                if (!applyToIsValid) {\n                    console.error(applyTo)\n                    throw new Error('Invalid applyTo: Must contain 1 key: ' + validApplyTos.join(', '))\n                }\n\n                if (useModel) {\n                    var multiple = _.isArray(useModel) && useModel.length > 1,\n                        single = !_.isArray(useModel) || useModel.length === 1;\n\n                    if (multiple) {\n                        if (applyTo.type === 'element[]' && _.every(multiple, function(e) {\n                            return _.isObject(e) && 'id' in e;\n                        })) {\n                            return true;\n                        }\n                    } else {\n                        useModel = _.isArray(useModel) ? _.first(useModel) : useModel;\n                        if (_.isObject(useModel) && 'id' in useModel && useModel.properties) {\n                            var isEdge = F.vertex.isEdge(useModel),\n                                isVertex = !isEdge;\n\n                            if (applyTo.type === 'element') return true;\n                            if (isVertex) {\n                                if (applyTo.conceptIri || applyTo.displayType) {\n                                    var conceptIriProperty = _.findWhere(useModel.properties, { name: 'http://openlumify.org#conceptType'}),\n                                        conceptIri = conceptIriProperty && conceptIriProperty.value || 'http://www.w3.org/2002/07/owl#Thing',\n                                        concept;\n\n                                    while (conceptIri) {\n                                        if (applyTo.conceptIri && conceptIri === applyTo.conceptIri) {\n                                            return true;\n                                        }\n                                        concept = ontology.concepts.byId[conceptIri];\n                                        if (applyTo.displayType && concept && concept.displayType === applyTo.displayType) {\n                                            return true;\n                                        }\n                                        conceptIri = concept && concept.parentConcept;\n                                    }\n                                } else if (applyTo.type === 'vertex') return true;\n                            } else {\n                                if (component.applyTo.edgeLabel && component.applyTo.edgeLabel === useModel.label) return true;\n                                if (component.applyTo.type === 'edge') return true;\n                            }\n                        }\n                    }\n\n                    var otherKeysToDeferChecking = ['constraints', 'contexts'],\n                        onlyHasKeysThatAreDeferred = (\n                            (applyToKeys.length === 1 && _.contains(otherKeysToDeferChecking, applyToKeys[0])) ||\n                            (applyToKeys.length === 2 && _.difference(otherKeysToDeferChecking, applyToKeys).length === 0)\n                        );\n\n                    if (onlyHasKeysThatAreDeferred) {\n                        return true;\n                    }\n\n                    return false;\n                }\n                console.error(component, useModel);\n                throw new Error('Unexpected model or applyTo object');\n            }\n            console.warn('Unexpected applyTo value:', component.applyTo, component)\n            return false;\n        }\n        return true;\n    }\n\n    function triggerUpdateModelAndStopPropagation(el, model) {\n        // Prevent infinite loop\n        if (el.classList.contains('org-openlumify-layout-root')) {\n            return;\n        }\n        $(el)\n            .off('updateModel', elementUpdateModelHandler)\n            .on('updateModel', elementUpdateModelHandler)\n            .trigger('updateModel', { model: model })\n    }\n\n    function elementUpdateModelHandler(event) {\n        event.stopPropagation();\n    }\n\n    function flightInstanceInfo(el, Component) {\n        var instanceInfos = flightRegistry.findInstanceInfoByNode(el);\n        if (instanceInfos) {\n            return _.find(instanceInfos, function(info) {\n                return info.instance.constructor === Component;\n            })\n        }\n    }\n\n});\n"]}