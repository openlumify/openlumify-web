{"version":3,"sources":["../../../js/detail/item/elements.js"],"names":["define","defineComponent","withDataRequest","withItem","Elements","attributes","model","ignoreUpdateModelNotImplemented","headerSelector","bodySelector","listSelector","singleSelector","after","on","select","onSelectObjects","onObjectsSelected","self","$list","key","heightPreference","openlumifyData","currentUser","uiPreferences","originalHeight","parseInt","Math","round","$","window","height","css","attr","createResizable","parent","closest","event","target","length","data","resizable","stopPropagation","dataRequest","vertexIds","done","results","first","_","$single","$histogram","add","currentSelectedItemId","id","teardownAllComponents","remove","show","find","trigger","vertices","edges","edgeIds","hide","insertBefore","require","Item","attachTo","empty","constraints","el","handles","start","stop","resize","ui"],"mappings":"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","file":"elements.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/withDataRequest',\n    './withItem'\n], function(defineComponent, withDataRequest, withItem) {\n    'use strict';\n\n    return defineComponent(Elements, withDataRequest, withItem);\n\n    function Elements() {\n\n        this.attributes({\n            model: null,\n            ignoreUpdateModelNotImplemented: true,\n            headerSelector: '.org-openlumify-layout-elements-header',\n            bodySelector: '.org-openlumify-layout-elements-body',\n            listSelector: '.org-openlumify-layout-elements-list',\n            singleSelector: '.org-openlumify-layout-root'\n        })\n\n        this.after('initialize', function() {\n\n            this.on(this.select('listSelector'), 'selectObjects', this.onSelectObjects);\n            this.on(this.select('listSelector'), 'objectsSelected', this.onObjectsSelected);\n\n            var self = this,\n                $list = this.select('listSelector'),\n                key = 'elements[].list',\n                heightPreference = openlumifyData.currentUser.uiPreferences['pane-' + key],\n                originalHeight = heightPreference ?\n                    parseInt(heightPreference, 10) :\n                    Math.round($(window).height() * 0.3);\n\n            $list.css({ height: originalHeight + 'px' }).attr('data-height-preference', key);\n            createResizable($list);\n\n            // Hack to support nested resizables, destroy and recreate child\n            // resizable on parent resize\n            $list.parent().closest('.ui-resizable')\n                .on('resizestart', function(event) {\n                    if ($(event.target).closest($list).length) return;\n                    if ($list.data('ui-resizable')) {\n                        $list.resizable('destroy');\n                    }\n                })\n                .on('resizestop', function(event) {\n                    if ($(event.target).closest($list).length) return;\n                    if (!$list.data('ui-resizable')) {\n                        createResizable($list);\n                    }\n                })\n        });\n\n        this.onObjectsSelected = function(event, data) {\n            event.stopPropagation();\n        };\n\n        this.onSelectObjects = function(event, data) {\n            event.stopPropagation();\n\n            var self = this;\n\n            this.dataRequest(data.vertexIds.length ? 'vertex' : 'edge', 'store', data)\n                .done(function(results) {\n                    var first = _.first(results),\n                        $single = self.select('singleSelector'),\n                        $list = self.select('listSelector'),\n                        $histogram = self.select('bodySelector')\n                            .add(self.select('headerSelector'));\n\n                    if (self.currentSelectedItemId && first.id === self.currentSelectedItemId) {\n                        $single.teardownAllComponents().remove();\n                        $histogram.show();\n                        $list.find('.element-list').trigger('objectsSelected', {\n                            vertices: [], edges: [], vertexIds: [], edgeIds: []\n                        });\n                        self.currentSelectedItemId = null;\n                    } else {\n                        self.currentSelectedItemId = first.id;\n\n                        if (!$single.length) {\n                            $single = $('<div>')\n                                .css('flex', 1)\n                                .hide()\n                                .insertBefore($list)\n                        }\n\n                        require(['detail/item/item'], function(Item) {\n                            Item.attachTo($single.empty().teardownAllComponents(), {\n                                constraints: ['width'],\n                                model: first\n                            })\n                            self.select('bodySelector')\n                                .add(self.select('headerSelector'))\n                                .hide();\n                            $single.show();\n                        });\n\n                        $list.find('.element-list').trigger('objectsSelected', {\n                            vertices: data.vertexIds.length ? results : [],\n                            edges: data.edgeIds.length ? results : [],\n                            vertexIds: data.vertexIds,\n                            edgeIds: data.edgeIds\n                        })\n                    }\n                })\n        };\n    }\n\n    function createResizable(el) {\n        $(el).resizable({\n            handles: 'n',\n            start: function(event) {\n                event.stopPropagation();\n            },\n            stop: function(event) {\n                event.stopPropagation();\n            },\n            resize: function(event, ui) {\n                event.stopPropagation();\n                $(this).css('top', '');\n            }\n        });\n    }\n\n});\n"]}