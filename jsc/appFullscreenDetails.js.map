{"version":3,"sources":["../js/appFullscreenDetails.js"],"names":["define","defineComponent","registry","template","errorTemplate","Detail","F","withDataRequest","FullscreenDetails","filterEntity","v","filterArtifacts","vertex","isArtifact","defaultAttrs","detailSelector","noResultsSelector","changeWorkspaceSelector","after","self","$node","html","updateTitle","openlumifyData","storePromise","then","store","observe","state","selection","newSelection","oldSelection","elements","idsByType","vertexIds","vertices","edgeIds","edges","updateItems","add","_windowIsHidden","on","document","onOpenFullscreen","onVisibilityChange","onVertexUrlChange","onChangeWorkspace","clearFlashing","bind","$","window","focus","onVerticesDeleted","onEdgesDeleted","onLogout","objects","fullscreenIdentifier","Math","floor","random","toString","substring","addClass","switchWorkspace","attr","workspaceId","event","data","Promise","require","_F","getVertexAndEdgeIdsFromDataEventOrCurrentSelection","async","url","vertexUrl","map","e","currentWorkspaceId","open","clearTimeout","timer","length","removeRelatedEdges","_","difference","previousVertexIds","onItemsDeleted","edgesToRemove","filter","object","type","hasDeletedVertex","some","vId","inVertexId","outVertexId","pluck","errorMessage","message","trigger","dataRequest","Login","setErrorMessage","location","reload","without","edgeId","previousEdgeIds","all","resolve","results","shift","concat","updateLocationHash","handleObjectsLoaded","catch","handleVerticesFailed","hash","fragmentUrl","updateLayout","entities","artifacts","verts","removePrefixedClasses","toggleClass","find","i","join","title","titleForVertices","handleNoObjects","requiredFallback","i18n","select","somePublished","noWorkspaceGiven","fallbackToPublic","teardownAll","remove","chain","sortBy","descriptors","push","displayType","toLowerCase","value","objectIds","notFoundIds","notFound","nId","id","properties","splice","apply","workspaceTitle","loadWorkspaces","forEach","node","subType","$newPane","className","to","append","appendTo","handler","off","css","flex","overflow","constraints","attachTo","model","preventRecursiveUrlChange","done","workspaces","workspaceTpl","show","end","w","workspace","disabled","actualWorkspaceId","prev","removeClass","target","closest","loaded","compact","deferred","Deferred","toRemove","hidden","visible","willRemove","isEmpty","willAdd","uniq","flatten","$pane","teardownAllComponents","reject","contains","flashTitle","newVertexIds","newVertices","newVerticesById","indexBy","setTimeout","f","sorted","first","l"],"mappings":"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","file":"appFullscreenDetails.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    'flight/lib/registry',\n    'tpl!./appFullscreenDetails',\n    'tpl!./appFullscreenDetailsError',\n    'detail/item/item',\n    'util/vertex/formatters',\n    'util/withDataRequest',\n    'util/jquery.removePrefixedClasses'\n], function(defineComponent, registry, template, errorTemplate, Detail, F, withDataRequest) {\n    'use strict';\n\n    return defineComponent(FullscreenDetails, withDataRequest);\n\n    function filterEntity(v) {\n        return !filterArtifacts(v);\n    }\n\n    function filterArtifacts(v) {\n        return F.vertex.isArtifact(v);\n    }\n\n    function FullscreenDetails() {\n\n        this.defaultAttrs({\n            detailSelector: '.detail-pane .content',\n            noResultsSelector: '.no-results',\n            changeWorkspaceSelector: '.no-workspace-access li a'\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.$node.html(template({}));\n            this.updateTitle();\n\n            openlumifyData.storePromise.then(store => store.observe(state => state.selection,\n                (newSelection, oldSelection) => {\n                    const elements = newSelection.idsByType;\n                    const { vertices: vertexIds, edges: edgeIds } = elements;\n                    this.updateItems({\n                        add: { vertexIds, edgeIds }\n                    });\n                }\n            ));\n            this._windowIsHidden = false;\n            this.on(document, 'openFullscreen', this.onOpenFullscreen);\n            this.on(document, 'window-visibility-change', this.onVisibilityChange);\n            this.on(document, 'vertexUrlChanged', this.onVertexUrlChange);\n            this.on('click', {\n                changeWorkspaceSelector: this.onChangeWorkspace\n            });\n            this.on('click', this.clearFlashing.bind(this));\n            $(window).focus(this.clearFlashing.bind(this));\n\n            this.on(document, 'verticesDeleted', this.onVerticesDeleted);\n            this.on(document, 'edgesDeleted', this.onEdgesDeleted);\n            this.on(document, 'logout', this.onLogout);\n\n            this.objects = [];\n            this.fullscreenIdentifier = Math.floor((1 + Math.random()) * 0xFFFFFF).toString(16).substring(1);\n            this.$node.addClass('fullscreen-details');\n\n            this.switchWorkspace(this.attr.workspaceId);\n        });\n\n        this.onOpenFullscreen = function(event, data) {\n            if (!data) return;\n\n            let F;\n            Promise.require('util/vertex/formatters')\n                .then(function(_F) {\n                    F = _F;\n                    return F.vertex.getVertexAndEdgeIdsFromDataEventOrCurrentSelection(data, { async: true });\n                })\n                .then(function({ vertexIds, edgeIds }) {\n                    var url = F.vertexUrl.url(\n                        [\n                            ...vertexIds.map(v => `v${v}`),\n                            ...edgeIds.map(e => `e${e}`)\n                        ],\n                        openlumifyData.currentWorkspaceId\n                    );\n                    window.open(url);\n                })\n        };\n\n        this.clearFlashing = function() {\n            clearTimeout(this.timer);\n            this._windowIsHidden = false;\n        };\n\n        this.onVerticesDeleted = function(event, data) {\n            var self = this;\n\n            if (this.attr.edgeIds.length) {\n                removeRelatedEdges(data.vertexIds);\n            }\n\n            this.attr.vertexIds = _.difference(this.attr.vertexIds, data.vertexIds);\n            if (this.attr.previousVertexIds && !_.difference(this.attr.previousVertexIds, this.attr.vertexIds).length) return;\n            this.attr.previousVertexIds = this.attr.vertexIds;\n\n            this.onItemsDeleted();\n\n            function removeRelatedEdges(vertexIds) {\n                var edgesToRemove = _.filter(self.objects, function(object) {\n                    if (object.type !== 'edge') return false;\n\n                    var hasDeletedVertex = _.some(vertexIds, function(vId) {\n                        return vId === object.inVertexId || vId === object.outVertexId;\n                    })\n\n                    return hasDeletedVertex;\n                });\n\n                self.attr.edgeIds = _.difference(self.attr.edgeIds, _.pluck(edgesToRemove, 'id'));\n            }\n        };\n\n        this.onLogout = function(event, data) {\n            const errorMessage = data && data.message;\n            this.trigger('willLogout');\n            this.dataRequest('user', 'logout')\n                .then(() => {\n                    require(['login'], Login => {\n                        Login.setErrorMessage(errorMessage);\n                        window.location.reload();\n                    })\n                })\n        };\n\n        this.onEdgesDeleted = function(event, data) {\n            this.attr.edgeIds = _.without(this.attr.edgeIds, data.edgeId);\n            if (this.attr.previousEdgeIds && !_.difference(this.attr.previousEdgeIds, this.attr.edgeIds).length) return;\n            this.attr.previousEdgeIds = this.attr.edgeIds;\n\n            this.onItemsDeleted();\n        };\n\n        this.onItemsDeleted = function() {\n            var self = this;\n\n            Promise.all([\n                self.attr.vertexIds.length ?\n                    self.dataRequest('vertex', 'multiple', {\n                        vertexIds: self.attr.vertexIds\n                    }) : Promise.resolve([]),\n                self.attr.edgeIds.length ?\n                    self.dataRequest('edge', 'multiple', {\n                        edgeIds: self.attr.edgeIds\n                    }) : Promise.resolve([])\n            ])\n            .then(function(results) {\n                var vertices = results.shift().vertices || [],\n                    edges = results.shift().edges || [];\n\n                self.objects = vertices.concat(edges);\n\n                self.updateLocationHash();\n                self.handleObjectsLoaded(self.objects);\n            })\n            .catch(self.handleVerticesFailed.bind(self));\n        };\n\n        this.updateLocationHash = function() {\n            location.hash = F.vertexUrl.fragmentUrl(this.objects, this.attr.workspaceId);\n        };\n\n        this.updateLayout = function() {\n            var entities = _.filter(this.objects, filterEntity).length,\n                artifacts = _.filter(this.objects, filterArtifacts).length,\n                verts = entities + artifacts;\n\n            this.$node\n                .removePrefixedClasses('vertices- artifacts- entities- has- entity-cols- onlyone')\n                .toggleClass('onlyone', verts === 1)\n                .addClass([\n                    verts <= 4 ? 'vertices-' + verts : 'vertices-many',\n                    'entities-' + entities,\n                    'entity-cols-' + _.find([4, 3, 2, 1], function(i) {\n                        return entities % i === 0;\n                    }),\n                    entities ? 'has-entities' : '',\n                    'artifacts-' + artifacts,\n                    artifacts ? 'has-artifacts' : ''\n                ].join(' '));\n        };\n\n        this.updateTitle = function() {\n            document.title = this.titleForVertices();\n        };\n\n        this.handleNoObjects = function() {\n            var requiredFallback = this.attr.workspaceId !== openlumifyData.currentWorkspaceId;\n\n            document.title = requiredFallback ?\n                i18n('fullscreen.unauthorized') :\n                i18n('fullscreen.no_vertices');\n\n            this.select('noResultsSelector')\n                .html(errorTemplate({\n                    objects: this.attr.vertexIds.concat(this.attr.edgeIds),\n                    somePublished: false,\n                    requiredFallback: requiredFallback,\n                    noWorkspaceGiven: !this.attr.workspaceId\n                }))\n                .addClass('visible');\n        };\n\n        this.handleVerticesFailed = function() {\n            this.handleNoObjects();\n        };\n\n        this.handleObjectsLoaded = function(objects, data) {\n            var self = this,\n                fallbackToPublic = this.attr.workspaceId !== openlumifyData.currentWorkspaceId;\n\n            Detail.teardownAll();\n            this.$node.find('.detail-pane').remove();\n\n            if (objects.length === 0) {\n                return this.handleNoObjects();\n            }\n\n            this.objects = _.chain(objects)\n                .sortBy(function(v) {\n                    var descriptors = [];\n                    // Image/Video/Audio before documents\n                    if (v.type === 'vertex') {\n                        descriptors.push(\n                            F.vertex.displayType(v) === 'document' ? '1' : '0'\n                        );\n                    }\n                    // Sort by title\n                    descriptors.push(F.vertex.title(v).toLowerCase());\n\n                    return descriptors.join('');\n                })\n                .sortBy(function(v) {\n                    return v.type === 'vertex' ? 0 : 1;\n                })\n                .value();\n\n            // Find vertices not found and insert at beginning\n            var objectIds = this.attr.vertexIds.concat(this.attr.edgeIds),\n                notFoundIds = _.difference(objectIds, _.pluck(this.objects, 'id')),\n                notFound = _.map(notFoundIds, function(nId) {\n                    return {\n                        id: nId,\n                        notFound: true,\n                        properties: {\n                            title: '?'\n                        }\n                    };\n                });\n\n            this.objects.splice.apply(this.objects, [0, 0].concat(notFound));\n            if (notFound.length || fallbackToPublic) {\n                this.select('noResultsSelector')\n                    .html(errorTemplate({\n                        objects: notFoundIds,\n                        requiredFallback: fallbackToPublic,\n                        somePublished: true,\n                        workspaceTitle: this.workspaceTitle,\n                        noWorkspaceGiven: !this.attr.workspaceId\n                    }))\n                    .addClass('visible someVerticesFound');\n                this.loadWorkspaces();\n            }\n\n            this.objects.forEach(function(object) {\n                if (object.notFound) return;\n\n                var node = filterEntity(object) ?\n                        this.$node.find('.entities-container') :\n                        this.$node.find('.artifacts-container'),\n                    type = filterArtifacts(object) ? 'artifact' : 'entity',\n                    subType = F.vertex.displayType(object),\n                    $newPane = $('<div class=\"detail-pane visible highlight-none\">')\n                        .addClass('type-' + type +\n                                  (subType ? (' subType-' + subType) : '') +\n                                  ' ' + F.className.to(object.id))\n                        .append('<div class=\"content\">')\n                        .appendTo(node)\n                        .find('.content')\n                        .append('<div class=\"type-content\">')\n                        .find('.type-content');\n\n                this.on('finishedLoadingTypeContent', function handler() {\n                    this.off('finishedLoadingTypeContent', handler);\n                    this.$node.find('.org-openlumify-layout-body').css({ flex: 'none', overflow: 'visible' });\n                    this.$node.find('.org-openlumify-layout-root').css('overflow', 'visible');\n                });\n\n                var constraints = this.objects.length === 1 ? [] : ['width'];\n                Detail.attachTo($newPane, { model: object, constraints: constraints });\n            }.bind(this));\n\n            if (data && data.preventRecursiveUrlChange !== true) {\n                this.updateLocationHash();\n            }\n            this.updateLayout();\n            this.updateTitle();\n        };\n\n        this.loadWorkspaces = function() {\n            var self = this;\n\n            this.dataRequest('workspace', 'all')\n                .done(function(workspaces) {\n                    if (workspaces.length > 1) {\n                        var workspaceTpl = _.template(\n                            '<li data-id=\"{workspaceId}\" ' +\n                            '<% if (disabled) { %>class=\"disabled\"<% } %>>' +\n                            '<a>{title}</a>' +\n                            '</li>'\n                        );\n                        self.$node.find('.no-workspace-access')\n                            .find('.caret').show()\n                            .end()\n                            .find('.dropdown-menu')\n                            .html(_.chain(workspaces)\n                                    .sortBy(function(w) {\n                                        return w.title.toLowerCase();\n                                    })\n                                    .map(function(workspace) {\n                                        workspace.disabled = workspace.workspaceId === self.actualWorkspaceId;\n                                        return workspaceTpl(workspace);\n                                    })\n                                    .value()\n                                    .join(''))\n                            .prev('.dropdown-toggle').removeClass('disabled')\n                    }\n                });\n        };\n\n        this.onChangeWorkspace = function(event) {\n            var workspaceId = $(event.target).closest('li').data('id').toString();\n            this.switchWorkspace(workspaceId);\n        };\n\n        this.switchWorkspace = function(workspaceId) {\n            var self = this;\n\n            this.on(document, 'workspaceLoaded', function loaded(event, workspace) {\n                self.workspaceTitle = workspace.title;\n                self.actualWorkspaceId = workspace.workspaceId;\n                self.off(document, 'workspaceLoaded', loaded);\n\n                Promise.all([\n                        self.attr.vertexIds.length ?\n                            self.dataRequest('vertex', 'store', {\n                                vertexIds: self.attr.vertexIds\n                            }) : Promise.resolve([]),\n                        self.attr.edgeIds.length ?\n                            self.dataRequest('edge', 'store', {\n                                edgeIds: self.attr.edgeIds\n                            }) : Promise.resolve([])\n                    ])\n                    .then(function(results) {\n                        var vertices = results.shift(),\n                            edges = results.shift();\n                        self.handleObjectsLoaded(_.compact(vertices.concat(edges)));\n                    })\n                    .catch(self.handleVerticesFailed.bind(self))\n            });\n            if (workspaceId) {\n                this.trigger(document, 'switchWorkspace', { workspaceId: workspaceId });\n            } else {\n                this.dataRequest('workspace', 'getOrCreate')\n                    .done(function(workspace) {\n                        self.attr.workspaceId = workspace.workspaceId;\n                        self.trigger(document, 'switchWorkspace', { workspaceId: workspace.workspaceId });\n                    })\n            }\n        };\n\n        this.onVertexUrlChange = function(event, data) {\n            var self = this,\n                deferred = $.Deferred();\n\n            if (data.workspaceId) {\n                this.attr.workspaceId = data.workspaceId;\n                if (openlumifyData.currentWorkspaceId !== this.attr.workspaceId) {\n                    this.on(document, 'workspaceLoaded', function loaded() {\n                        self.off(document, 'workspaceLoaded', loaded);\n                        deferred.resolve();\n                    });\n                    this.trigger(document, 'switchWorkspace', { workspaceId: this.attr.workspaceId });\n                } else deferred.resolve();\n            } else deferred.resolve();\n\n            var vertexIds = _.difference(data.vertexIds, this.attr.vertexIds);\n            var edgeIds = _.difference(data.edgeIds, this.attr.edgeIds);\n\n            var toRemove = [];\n            toRemove.concat(\n                _.difference(this.attr.vertexIds, data.vertexIds),\n                _.difference(this.attr.edgeIds, data.edgeIds)\n            );\n\n            deferred.done(function() {\n                self.updateItems({\n                    remove: toRemove,\n                    add: {\n                        vertexIds: vertexIds,\n                        edgeIds: edgeIds\n                    },\n                    preventRecursiveUrlChange: true\n                });\n            })\n        };\n\n        this.onVisibilityChange = function(event, data) {\n            this._windowIsHidden = data.hidden;\n            if (data.visible) {\n                clearTimeout(this.timer);\n                this.updateTitle();\n            }\n        };\n\n        this.updateItems = function(data) {\n            var self = this,\n                willRemove = !_.isEmpty(data.remove),\n                willAdd = !_.isEmpty(data.add) && !!(data.add.vertexIds.length || data.add.edgeIds.length);\n\n            if (!willRemove && !willAdd) {\n                return;\n            }\n\n            if (willAdd) {\n                var vertexIds = this.attr.vertexIds = _.uniq(data.add.vertexIds.concat(self.attr.vertexIds));\n                var edgeIds = this.attr.edgeIds = _.uniq(data.add.edgeIds.concat(self.attr.edgeIds));\n                Promise.all([\n                    vertexIds.length ?\n                        self.dataRequest('vertex', 'store', {\n                            vertexIds: vertexIds\n                        }) : Promise.resolve([]),\n                    edgeIds.length ?\n                        self.dataRequest('edge', 'store', {\n                            edgeIds: edgeIds\n                        }) : Promise.resolve([])\n                    ])\n                    .then(function(results) {\n                        self.handleObjectsLoaded(_.flatten(results), data);\n                    })\n            }\n\n            if (willRemove) {\n                data.remove.forEach(function(id) {\n                    var $pane = self.$node.find('.detail-pane.' + F.className.to(id));\n                    if ($pane.length) {\n                        $pane\n                            .find('.content').teardownAllComponents()\n                            .end()\n                            .remove();\n                    }\n                });\n\n                this.objects = _.reject(this.objects, function(object) {\n                    return _.contains(data.remove, object.id);\n                });\n            }\n\n            if (data.preventRecursiveUrlChange !== true) {\n                self.updateLocationHash();\n            }\n            self.updateLayout();\n            self.updateTitle();\n        };\n\n        this.flashTitle = function(newVertexIds, newVertices) {\n            var self = this,\n                i = 0;\n\n            clearTimeout(this.timer);\n\n            if (!newVertices || newVertices.length === 0) return;\n\n            var newVerticesById = _.indexBy(newVertices, 'id');\n\n            if (this._windowIsHidden) {\n                this.timer = setTimeout(function f() {\n                    if (self._windowIsHidden && i++ % 2 === 0) {\n                        if (newVertexIds.length === 1) {\n                            document.title = i18n(\n                                'fullscreen.title.added.one',\n                                F.vertex.title(newVerticesById[newVertexIds[0]])\n                            );\n                        } else {\n                            document.title = i18n('fullscreen.title.added.some', newVertexIds.length);\n                        }\n                    } else {\n                        self.updateTitle();\n                    }\n\n                    if (self._windowIsHidden) {\n                        self.timer = setTimeout(f, 500);\n                    }\n                }, 500);\n            }\n        };\n\n        this.titleForVertices = function() {\n            if (!this.objects || this.objects.length === 0) {\n                return i18n('fullscreen.loading');\n            }\n\n            var sorted = _.sortBy(this.objects, function(v) {\n                return v.notFound ? 1 : -1;\n            });\n\n            if (sorted.length === 1) {\n                return F.vertex.title(sorted[0]);\n            } else {\n                var first = '\"' + F.vertex.title(sorted[0]) + '\"',\n                    l = sorted.length - 1;\n\n                if (l > 1) {\n                    return i18n('fullscreen.title.some', first, l)\n                }\n\n                return i18n('fullscreen.title.one', first)\n            }\n        };\n    }\n});\n"]}