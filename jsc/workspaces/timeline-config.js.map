{"version":3,"sources":["../../js/workspaces/timeline-config.js"],"names":["define","defineComponent","withDataRequest","withPopover","d3","Color","TimelineConfig","defaultAttrs","inputSelector","before","node","config","template","after","self","triggerUpdate","_","debounce","bind","on","e","data","attr","ontologyProperties","popover","onCheckboxChange","dataRequest","done","ontology","ontologyConcepts","concepts","ontologyRelationships","relationships","update","positionDialog","trigger","properties","find","toArray","map","input","$","event","$target","target","checked","is","title","not","each","length","prettyConcepts","d","chain","c","concept","byId","byTitle","displayName","compact","sort","value","join","select","selectAll","sortBy","p","property","call","enter","append","order","text","color","width","exit","remove","style","processedColor","setLightness","setSaturation","toString","contains"],"mappings":"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","file":"timeline-config.js","sourcesContent":["define([\n    'flight/lib/component',\n    'util/withDataRequest',\n    'util/popovers/withPopover',\n    'd3',\n    'colorjs'\n], function(\n    defineComponent,\n    withDataRequest,\n    withPopover,\n    d3,\n    Color) {\n    'use strict';\n\n    return defineComponent(TimelineConfig, withPopover, withDataRequest);\n\n    function TimelineConfig() {\n\n        this.defaultAttrs({\n            inputSelector: 'input'\n        });\n\n        this.before('initialize', function(node, config) {\n            config.template = '/workspaces/timeline-config-tpl.hbs';\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.triggerUpdate = _.debounce(this.triggerUpdate.bind(this), 100);\n\n            this.after('setupWithTemplate', function() {\n                self.on('ontologyPropertiesChanged', function(e, data) {\n                    self.attr.ontologyProperties = data.ontologyProperties;\n                })\n                self.on(self.popover, 'change', {\n                    inputSelector: this.onCheckboxChange\n                })\n                self.dataRequest('ontology', 'ontology')\n                    .done(function(ontology) {\n                        self.ontologyConcepts = ontology.concepts;\n                        self.ontologyRelationships = ontology.relationships;\n                        self.update();\n                        self.positionDialog();\n                    })\n            });\n        });\n\n        this.triggerUpdate = function() {\n            this.trigger('timelineConfigChanged', {\n                config: {\n                    properties: this.popover.find('.popover-content input:checked')\n                        .toArray()\n                        .map(function(input) {\n                            return $(input).data('title')\n                        })\n                }\n            });\n        };\n\n        this.onCheckboxChange = function(event) {\n            var $target = $(event.target),\n                checked = $target.is(':checked'),\n                title = $target.data('title');\n\n            if (title === 'ALL') {\n                this.popover.find('input').not($target).each(function() {\n                    this.checked = checked;\n                })\n            } else {\n                if (checked) {\n                    this.popover.find('.popover-title input')[0].checked = (\n                        this.popover.find('.popover-content input').not(':checked').length === 0\n                    );\n                } else {\n                    this.popover.find('.popover-title input')[0].checked = false;\n                }\n            }\n\n            this.triggerUpdate();\n        };\n\n        this.update = function() {\n            var self = this,\n                prettyConcepts = function(d) {\n                    return _.chain(d.concepts)\n                        .map(function(c) {\n                            var concept = self.ontologyConcepts.byId[c] || self.ontologyRelationships.byTitle[c];\n                            return concept && concept.displayName;\n                        })\n                        .compact()\n                        .sort()\n                        .value()\n                        .join(', ')\n                };\n\n            d3.select(this.popover.find('ul')[0])\n                .selectAll('li')\n                .data(_.sortBy(this.attr.ontologyProperties, function(p) {\n                    return p.property.displayName;\n                }))\n                .call(function() {\n                    this.enter()\n                        .append('li')\n                        .append('label')\n                        .call(function() {\n                            this.append('input').attr('type', 'checkbox')\n                            this.append('div')\n                                .call(function() {\n                                    this.append('span').attr('class', 'name')\n                                    this.append('span').attr('class', 'subtitle')\n                                })\n                            this.append('span').attr('class', 'colors')\n                        })\n\n                    this.order();\n\n                    this.attr('title', prettyConcepts);\n                    this.select('.name').text(function(d) {\n                        return d.property.displayName;\n                    });\n                    this.select('.subtitle')\n                        .text(prettyConcepts)\n                    this.select('.colors')\n                        .selectAll('.color')\n                        .data(function(d) {\n                            return d.concepts.map(function(c) {\n                                var concept = self.ontologyConcepts.byId[c] || self.ontologyRelationships.byTitle[c];\n                                return {\n                                    color: concept && concept.color,\n                                    width: (10 / d.concepts.length) + 'px'\n                                };\n                            })\n                        })\n                        .call(function() {\n                            this.enter()\n                                .append('span').attr('class', 'color')\n\n                            this.exit().remove();\n                            this.style('width', function(d) {\n                                return d.width;\n                            })\n                            this.style('background-color', function(d) {\n                                if (d.color) {\n                                    var processedColor = new Color(d.color).setLightness(0.6).setSaturation(0.5);\n                                    return processedColor.toString();\n                                }\n                                return '#c4c4c4';\n                            });\n                        })\n                    this.select('input')\n                        .each(function(d) {\n                            if (self.attr.config) {\n                                this.checked = _.contains(self.attr.config.properties || [], d.property.title);\n                            } else {\n                                this.checked = true;\n                            }\n                        })\n                        .attr('data-title', function(d) {\n                            return d.property.title;\n                        })\n\n                    this.exit().remove();\n\n                    self.popover.find('.popover-title input')[0].checked =\n                        self.popover.find('.popover-content input').not(':checked').length === 0;\n                })\n\n\n        }\n    }\n});\n"]}