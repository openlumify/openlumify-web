{"version":3,"sources":["../../js/workspaces/workspaces.js"],"names":["define","defineComponent","WorkspaceForm","workspacesTemplate","listTemplate","withDataRequest","F","Workspaces","defaultAttrs","listSelector","workspaceListItemSelector","addNewInputSelector","addNewSelector","disclosureSelector","formSelector","titleErrorSelector","after","usersById","on","document","onWorkspaceLoaded","onWorkspaceSaving","onWorkspaceSaved","onWorkspaceDeleted","onWorkspaceUpdated","didToggleDisplay","onSwitchWorkspace","onWorkspaceDeleting","onWorkspaceItemClick","onAddNew","onDisclosure","onInputKeyUp","$node","html","event","$target","$","target","is","closest","length","li","workspaceId","data","switchToWorkspace","toString","openlumifyData","currentWorkspaceId","trigger","self","$input","parents","find","title","trim","val","workspaceTitles","includes","toLowerCase","select","addClass","show","hide","removeClass","$button","prop","next","dataRequest","then","workspace","catch","error","finally","add","focus","attr","which","ui","keyCode","ENTER","preventDefault","container","form","resizable","handles","minWidth","maxWidth","resize","instance","lookupComponent","teardown","teardownAll","_","findWhere","workspaces","attachTo","empty","currentWorkspaceTitle","collapseEditForm","deletingWorkspace","extend","update","reject","w","findWorkspaceRow","switchActive","className","to","updatedWorkspace","chain","tap","users","userId","currentUser","id","push","value","$row","not","loadWorkspaceList","MINE","SHARED","userIds","pluck","filter","e","unique","workspacesGrouped","sortBy","groupBy","sharedToUser","renderRows","userIdToDisplay","isShared","entering","enter","append","insert","call","exit","remove","order","each","removePrefixedClasses","classed","text","property","people","user","subtitle","createdBy","i18n","mine","map","Promise","all","require","results","d3","shift","userNames","object","fullfill","$list","d3List","selectAll","i","name","visible","defer","active"],"mappings":"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","file":"workspaces.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    './form/form',\n    './workspaces.hbs',\n    './list-tpl.hbs',\n    'util/withDataRequest',\n    'util/formatters'\n], function(defineComponent,\n    WorkspaceForm,\n    workspacesTemplate,\n    listTemplate,\n    withDataRequest,\n    F) {\n    'use strict';\n\n    return defineComponent(Workspaces, withDataRequest);\n\n    function Workspaces() {\n\n        this.defaultAttrs({\n            listSelector: 'ul.nav-list',\n            workspaceListItemSelector: 'ul.nav-list li',\n            addNewInputSelector: 'input.new',\n            addNewSelector: 'button.new',\n            disclosureSelector: 'button.disclosure',\n            formSelector: '.workspace-form',\n            titleErrorSelector: '.add-title-error'\n        });\n\n        this.after('initialize', function() {\n            this.usersById = {};\n\n            this.on(document, 'workspaceLoaded', this.onWorkspaceLoaded);\n            this.on(document, 'workspaceSaving', this.onWorkspaceSaving);\n            this.on(document, 'workspaceSaved', this.onWorkspaceSaved);\n            this.on(document, 'workspaceDeleted', this.onWorkspaceDeleted);\n            this.on(document, 'workspaceUpdated', this.onWorkspaceUpdated);\n\n            this.on(document, 'didToggleDisplay', this.didToggleDisplay);\n            this.on(document, 'switchWorkspace', this.onSwitchWorkspace);\n\n            this.on('workspaceDeleting', this.onWorkspaceDeleting);\n\n            this.on('click', {\n                workspaceListItemSelector: this.onWorkspaceItemClick,\n                addNewSelector: this.onAddNew,\n                disclosureSelector: this.onDisclosure\n            });\n\n            this.on('keyup', {\n                addNewInputSelector: this.onInputKeyUp\n            });\n\n            this.$node.html(workspacesTemplate({}));\n        });\n\n        this.onWorkspaceItemClick = function(event) {\n            var $target = $(event.target);\n\n            if ($target.is('input') || $target.is('button') || $target.is('.new-workspace')) return;\n            if ($target.closest('.workspace-form').length) return;\n\n            var li = $(event.target).closest('li'),\n                workspaceId = li.data('workspaceId');\n\n            if (workspaceId) {\n                this.switchToWorkspace(workspaceId.toString());\n            }\n        };\n\n        this.switchToWorkspace = function(workspaceId) {\n            if (workspaceId !== openlumifyData.currentWorkspaceId) {\n                this.trigger('switchWorkspace', { workspaceId: workspaceId });\n            }\n        };\n\n        this.onAddNew = function(event) {\n            var self = this,\n                $input = $(event.target).parents('li').find('input'),\n                title = $.trim($input.val());\n\n            if (!title) return;\n            if (this.workspaceTitles && this.workspaceTitles.includes(title.toLowerCase())) {\n                this.select('addNewInputSelector').addClass('invalid');\n                this.select('titleErrorSelector').show();\n                return;\n            } else {\n                this.select('titleErrorSelector').hide();\n                this.select('addNewInputSelector').removeClass('invalid');\n                var $button = $input.prop('disabled', true)\n                    .next('button')\n                    .prop('disabled', true)\n                    .addClass('loading')\n\n                this.dataRequest('workspace', 'create', { title: title })\n                    .then(function(workspace) {\n                        $input.val('')\n                        self.trigger('switchWorkspace', { workspaceId: workspace.workspaceId });\n                    })\n                    .catch(function(error) {\n                    })\n                    .finally(function() {\n                        $input.add($button).prop('disabled', false);\n                        $button.removeClass('loading');\n                        $input.focus();\n                    })\n            }\n        };\n\n        this.onInputKeyUp = function(event) {\n            var title = $(this.attr.addNewInputSelector).val();\n            if (this.workspaceTitles && this.workspaceTitles.includes(title.toLowerCase())) {\n                this.select('addNewInputSelector').addClass('invalid');\n                this.select('titleErrorSelector').show();\n            } else {\n                this.select('titleErrorSelector').hide();\n                this.select('addNewInputSelector').removeClass('invalid');\n            }\n\n            switch (event.which) {\n                case $.ui.keyCode.ENTER:\n                    this.onAddNew(event);\n            }\n        };\n\n        this.onDisclosure = function(event) {\n            var self = this,\n                $target = $(event.target),\n                data = $target.closest('li').data();\n\n            event.preventDefault();\n\n            this.switchToWorkspace(data.workspaceId);\n\n            var container = this.select('formSelector'),\n                form = container.resizable({\n                        handles: 'e',\n                        minWidth: 170,\n                        maxWidth: 250,\n                        resize: function() {\n                            self.trigger(document, 'paneResized');\n                        }\n                    }).show().find('.content'),\n                instance = form.lookupComponent(WorkspaceForm);\n\n            if ((instance && instance.attr.data.workspaceId) === data.workspaceId) {\n                container.hide();\n                instance.teardown();\n                return self.trigger(document, 'paneResized');\n            }\n\n            WorkspaceForm.teardownAll();\n            var workspace = _.findWhere(self.workspaces, { workspaceId: data.workspaceId })\n            WorkspaceForm.attachTo(form.empty(), {\n                data: workspace,\n                workspaceTitles: self.workspaceTitles || [],\n                currentWorkspaceTitle: workspace.title\n            });\n\n            self.trigger(container, 'paneResized');\n        };\n\n        this.collapseEditForm = function() {\n            if (this.select('formSelector').is(':visible')) {\n                WorkspaceForm.teardownAll();\n                this.select('formSelector').hide();\n                this.trigger(document, 'paneResized');\n            }\n        };\n\n        this.onWorkspaceDeleting = function(event, data) {\n            this.deletingWorkspace = $.extend({}, data);\n        };\n\n        this.onWorkspaceDeleted = function(event, data) {\n            var self = this;\n            this.collapseEditForm();\n            this.update(_.reject(this.workspaces, function(w) {\n                return data.workspaceId === w.workspaceId;\n            }));\n        };\n\n        this.onSwitchWorkspace = function(event, data) {\n            if (this.$node.closest('.visible').length) {\n                var li = this.findWorkspaceRow(data.workspaceId);\n                this.switchActive(data.workspaceId);\n                li.find('.badge').addClass('loading').show().next().hide();\n            }\n            this.collapseEditForm();\n        };\n\n        this.onWorkspaceLoaded = function(event, data) {\n            if (this.$node.closest('.visible').length) {\n                var li = this.findWorkspaceRow(data.workspaceId);\n                li.find('.badge').removeClass('loading').hide().next().show();\n                this.switchActive(data.workspaceId);\n            }\n        };\n\n        this.findWorkspaceRow = function(workspaceId) {\n            return this.$node.find('.wid-' + F.className.to(workspaceId), this.select('listSelector'));\n        };\n\n        this.onWorkspaceSaving = function(event, data) {\n            var li = this.findWorkspaceRow(data.workspaceId);\n            li.find('.badge').addClass('loading').show().next().hide();\n        };\n\n        this.onWorkspaceSaved = function(event, data) {\n            var li = this.findWorkspaceRow(data.workspaceId);\n            li.find('.badge').removeClass('loading').hide().next().show();\n        };\n\n        this.onWorkspaceUpdated = function(event, data) {\n            var updatedWorkspace = data && data.workspace || data;\n            this.update(\n                _.chain(this.workspaces)\n                .reject(function(w) {\n                    return updatedWorkspace.workspaceId === w.workspaceId;\n                })\n                .tap(function(workspaces) {\n                    if (_.findWhere(updatedWorkspace.users, { userId: openlumifyData.currentUser.id })) {\n                        workspaces.push(updatedWorkspace);\n                    }\n                })\n                .value()\n            );\n        };\n\n        this.switchActive = function(workspaceId) {\n            this.workspaceId = workspaceId;\n\n            var $row = this.findWorkspaceRow(workspaceId);\n\n            this.select('workspaceListItemSelector')\n                .not($row.addClass('active'))\n                .removeClass('active');\n\n            if ($row.length === 0) {\n                this.loadWorkspaceList();\n            }\n        };\n\n        this.update = function(workspaces) {\n            var self = this,\n                MINE = 'mine',\n                SHARED = 'shared',\n                userIds = _.chain(workspaces)\n                    .pluck('createdBy')\n                    .filter(function(e) { return e; }) // filter null or undefined\n                    .unique()\n                    .value(),\n                workspacesGrouped = _.chain(workspaces)\n                        .sortBy('workspaceId')\n                        .sortBy('createdBy')\n                        .sortBy(function(w) {\n                            return w.title.toLowerCase()\n                        })\n                        .groupBy(function(w) {\n                            return w.sharedToUser ? SHARED : MINE\n                        })\n                        .tap(w => {\n                            if (!w[MINE]) w[MINE] = []\n                            if (!w[SHARED]) w[SHARED] = []\n                        })\n                        .value(),\n                renderRows = function(userIdToDisplay, isShared) {\n                    return function() {\n                        var entering = isShared ?\n                            this.enter().append('li').attr('class', 'w-shared') :\n                            this.enter().insert('li', '.new-workspace').attr('class', 'w-mine');\n\n                        entering\n                            .append('a')\n                            .call(function() {\n                                this.append('span').attr('class', 'badge')\n                                this.append('button').attr('class', 'disclosure btn btn-mini')\n                                this.append('span').attr('class', 'nav-list-title')\n                                this.append('span').attr('class', 'nav-list-subtitle')\n                            })\n                        this.exit().remove();\n\n                        self.select('listSelector').find('.nav-header:first-child .loading').remove();\n\n                        this.order()\n                            .each(function(w) {\n                                $(this)\n                                    .removePrefixedClasses('wid-')\n                                    .addClass('wid-' + F.className.to(w.workspaceId))\n                                    .data('workspaceId', w.workspaceId);\n                            })\n                        this.classed('active', function(w) {\n                            return w.workspaceId === openlumifyData.currentWorkspaceId;\n                        })\n                        this.select('a .nav-list-title')\n                            .text(_.property('title'))\n                            .attr('title', _.property('title'));\n                        this.select('a .nav-list-subtitle').text(function(w) {\n                            var people = _.reject(w.users, function(user) {\n                                    return user.userId === openlumifyData.currentUser.id;\n                                }).length,\n                                subtitle = '',\n                                sharedToUser = w.sharedToUser && userIdToDisplay[w.createdBy];\n\n                            if (w.sharedToUser) {\n                                if (sharedToUser) {\n                                    subtitle = i18n('workspaces.shared_with_me.subtitle.prefix', sharedToUser);\n                                } else {\n                                    subtitle = i18n('workspaces.shared_with_me.subtitle.unknown_user');\n                                }\n                            } else {\n                                subtitle = i18n('workspaces.sharing.subtitle.prefix');\n                            }\n\n                            if (people === 1 && w.sharedToUser) {\n                                subtitle += ' ' + i18n('workspaces.sharing.subtitle.suffix.only_you');\n                            } else if (people === 1) {\n                                subtitle += ' ' + i18n('workspaces.sharing.subtitle.suffix.one_other');\n                            } else if (people) {\n                                subtitle += ' ' + i18n('workspaces.sharing.subtitle.suffix.others', people);\n                            } else {\n                                subtitle = null;\n                            }\n\n                            return subtitle;\n                        });\n                    };\n                };\n\n            this.workspaceTitles = workspacesGrouped.mine.map((workspace) => workspace.title.toLowerCase());\n            this.workspaces = workspaces;\n\n            return Promise.all([\n                Promise.require('d3'),\n                this.dataRequest('user', 'getUserNames', userIds)\n            ]).then(function(results) {\n                var d3 = results.shift(),\n                    userNames = results.shift(),\n                    userIdToDisplay = _.object(userIds, userNames);\n\n                return new Promise(function(fullfill, reject) {\n                    var $list = self.select('listSelector'),\n                        d3List = d3.select($list[0]);\n\n                    if ($list.find('.new-workspace').length === 0) {\n                        $list.html(listTemplate({}));\n                    }\n\n                    d3List\n                        .selectAll('li.w-mine')\n                        .data(workspacesGrouped[MINE] || [], _.property('workspaceId'))\n                        .call(renderRows(userIdToDisplay, false));\n\n                    d3List\n                        .selectAll('li.w-shared')\n                        .data(workspacesGrouped[SHARED] || [], _.property('workspaceId'))\n                        .call(renderRows(userIdToDisplay, true));\n\n                    fullfill(workspaces);\n                });\n            })\n        };\n\n        this.loadWorkspaceList = function() {\n            var self = this, i = 0;\n\n            return this.dataRequest('workspace', 'all')\n                .then(function(workspaces) {\n                    return self.update(workspaces || [])\n                });\n        };\n\n        this.didToggleDisplay = function(event, data) {\n            var self = this;\n\n            if (data.name === 'workspaces') {\n                if (data.visible) {\n                    _.defer(function() {\n                        self.loadWorkspaceList()\n                            .then(function(workspaces) {\n                                var active = openlumifyData.currentWorkspaceId;\n                                if (_.findWhere(workspaces, { workspaceId: active })) {\n                                    self.switchActive(active);\n                                } else if (workspaces && workspaces.length) {\n                                    self.trigger('switchWorkspace', workspaces[0]);\n                                }\n                            })\n                    });\n                } else {\n                    this.collapseEditForm();\n                }\n            }\n        };\n    }\n});\n"]}