{"version":3,"sources":["../../../js/workspaces/form/form.js"],"names":["define","defineComponent","template","shareRowTemplate","permissionsTemplate","UserSelect","withDataRequest","Permissions","name","display","i18n","Form","defaultAttrs","titleSelector","titleErrorSelector","shareListSelector","shareHeader","shareFormSelector","permissionsSelector","permissionsRadioSelector","permissionsRadioLabelSelector","deleteSelector","confirmDeleteSelector","confirmDeleteCancelSelector","removeAccessSelector","after","$","document","off","self","editable","attr","data","$node","html","workspace","loadUserPermissionsList","on","event","user","trigger","select","attachTo","filterUserIds","_","pluck","users","placeholder","$target","target","closest","length","find","popover","onShareWorkspaceWithUser","onDelete","onDeleteConfirm","onDeleteCancel","onRevokeAccess","e","stopPropagation","onPermissionsChange","onChangeTitle","bind","timeout","saveWorkspace","immediate","options","changes","revert","d","Deferred","save","dataRequest","workspaceId","then","resolve","catch","reject","clearTimeout","setTimeout","workspaceUsers","userIds","without","openlumifyData","currentUser","id","Promise","error","console","log","done","usersById","indexBy","currentUsers","sortBy","userPermission","userId","displayName","forEach","String","shareRowDataForPermission","add","remove","show","updatePopovers","_user","subtitle","toLowerCase","email","userName","accessName","access","toUpperCase","accessDisplay","read","comment","write","warn","makePopover","el","placement","container","content","row","permissions","map","p","active","val","trim","replace","hide","workspaceTitles","includes","currentWorkspaceTitle","addClass","removeClass","title","titleRevert","extend","fail","always","newPermissions","list","userRow","badge","findWhere","userUpdates","newUserRow","replaceWith","$buttons","$confirm","prop","delay","previousText","text","userDeletes","originalHtml","updateUserSelectionFilter","form","insertBefore","push","defer"],"mappings":"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","file":"form.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    './form.hbs',\n    './shareRow.hbs',\n    './permissions.hbs',\n    'util/users/userSelect',\n    'util/withDataRequest'\n], function(\n    defineComponent,\n    template,\n    shareRowTemplate,\n    permissionsTemplate,\n    UserSelect,\n    withDataRequest) {\n    'use strict';\n\n    const Permissions = [\n        { name: 'READ', display: i18n('workspaces.form.sharing.access.view') },\n        { name: 'COMMENT', display: i18n('workspaces.form.sharing.access.comment') },\n        { name: 'WRITE', display: i18n('workspaces.form.sharing.access.edit') }\n    ];\n\n    return defineComponent(Form, withDataRequest);\n\n    function Form() {\n\n        this.defaultAttrs({\n            titleSelector: '.workspace-title',\n            titleErrorSelector: '.form-title-error',\n            shareListSelector: '.share-list',\n            shareHeader: '.share-header',\n            shareFormSelector: '.share-form',\n            permissionsSelector: '.permissions',\n            permissionsRadioSelector: '.popover input',\n            permissionsRadioLabelSelector: '.popover label',\n            deleteSelector: '.delete',\n            confirmDeleteSelector: '.delete-confirm .btn-danger',\n            confirmDeleteCancelSelector: '.delete-confirm .btn-link',\n            removeAccessSelector: '.remove-access'\n        });\n\n        this.after('teardown', function() {\n            $(document).off('click.permPopover');\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.editable = this.attr.data.editable;\n\n            this.$node.html(template({\n                workspace: this.attr.data,\n                editable: this.editable\n            }));\n            this.loadUserPermissionsList();\n\n            if (this.editable) {\n\n                this.on('userSelected', function(event, data) {\n                    if (data && data.user) {\n                        self.trigger('shareWorkspaceWithUser', {\n                            workspace: self.attr.data,\n                            user: data.user\n                        });\n                        self.trigger(this.select('shareFormSelector'), 'clearUser');\n                    }\n                });\n\n                UserSelect.attachTo(this.select('shareFormSelector'), {\n                    filterUserIds: _.pluck(self.attr.data.users, 'userId'),\n                    placeholder: i18n('workspaces.form.sharing.placeholder')\n                });\n\n                $(document).on('click.permPopover', function(event) {\n                    var $target = $(event.target);\n\n                    if ($target.closest('.permissions-list').length === 0) {\n                        self.$node.find('.permissions-list').popover('hide');\n                    }\n                });\n                this.on('shareWorkspaceWithUser', this.onShareWorkspaceWithUser);\n                this.on('click', {\n                    deleteSelector: this.onDelete,\n                    confirmDeleteSelector: this.onDeleteConfirm,\n                    confirmDeleteCancelSelector: this.onDeleteCancel,\n                    removeAccessSelector: this.onRevokeAccess,\n                    permissionsRadioLabelSelector: function(e) {\n                        e.stopPropagation();\n                    }\n                });\n                this.on('change', {\n                    permissionsRadioSelector: this.onPermissionsChange\n                });\n                this.select('titleSelector').on('change keyup paste', this.onChangeTitle.bind(this));\n            }\n        });\n\n        var timeout;\n        this.saveWorkspace = function(immediate, options) {\n            var self = this,\n                changes = options.changes,\n                revert = options.revert,\n                d = $.Deferred(),\n                save = function() {\n                    self.trigger(document, 'workspaceSaving', self.attr.data);\n\n                    self.dataRequest('workspace', 'save', self.attr.data.workspaceId, changes)\n                        .then(function(workspace) {\n                            self.trigger(document, 'workspaceSaved', self.attr.data);\n                            d.resolve({ workspace: self.attr.data });\n                        })\n                        .catch(function() {\n                            self.attr.data = revert;\n                            self.trigger(document, 'workspaceSaved', revert);\n                            d.reject();\n                        })\n                }\n\n            if (immediate) {\n                save();\n            } else {\n                clearTimeout(timeout);\n                timeout = setTimeout(function() {\n                    save();\n                }, 1000);\n            }\n\n            return d;\n        };\n\n        this.loadUserPermissionsList = function() {\n            var self = this,\n                workspace = this.attr.data,\n                workspaceUsers = workspace.users || (workspace.users = []),\n                userIds = _.pluck(workspaceUsers, 'userId'),\n                html = $();\n\n            userIds = _.without(userIds, openlumifyData.currentUser.id);\n\n            (userIds.length ?\n                this.dataRequest('user', 'search', { userIds: userIds }) :\n                Promise.resolve([]))\n                .catch(function(error) {\n                    console.log(error);\n                    return [];\n                })\n                .done(function(users) {\n                    var usersById = _.indexBy(users, 'id');\n                    self.currentUsers = usersById;\n\n                    _.sortBy(workspaceUsers, function(userPermission) {\n                        var user = usersById[userPermission.userId];\n                        return user && user.displayName || 1;\n                    }).forEach(function(userPermission) {\n                        if (String(userPermission.userId) !== String(openlumifyData.currentUser.id)) {\n                            var data = self.shareRowDataForPermission(userPermission);\n                            if (data) {\n                                html = html.add(shareRowTemplate(data));\n                            }\n                        }\n                    });\n                    self.select('shareHeader').after(html).find('.loading').remove();\n                    if (self.editable) {\n                        self.select('shareFormSelector').show();\n                        self.updatePopovers();\n                    }\n\n                })\n        };\n\n        this.shareRowDataForPermission = function(userPermission, _user) {\n            var user = _user || this.currentUsers[userPermission.userId];\n            if (user) {\n                return {\n                    userId: user.id,\n                    displayName: user.displayName,\n                    subtitle: (user.displayName.toLowerCase() !== (user.email || user.userName).toLowerCase()) ?\n                        (user.email || user.userName) : null,\n                    accessName: userPermission.access.toUpperCase(),\n                    accessDisplay: {\n                        read: i18n('workspaces.form.sharing.access.view'),\n                        comment: i18n('workspaces.form.sharing.access.comment'),\n                        write: i18n('workspaces.form.sharing.access.edit')\n                    }[userPermission.access.toLowerCase()],\n                    editable: this.editable\n                };\n            } else console.warn('User ' + userPermission.userId + ' in permissions is not a current user');\n        };\n\n        this.updatePopovers = function() {\n            this.makePopover(this.select('permissionsSelector'));\n        };\n\n        this.makePopover = function(el) {\n            var self = this;\n\n            el.popover({\n                html: true,\n                placement: 'bottom',\n                container: this.$node,\n                content: function() {\n                    var row = $(this).closest('.user-row'),\n                        data = $(this).data();\n                    return $(permissionsTemplate({\n                        permissions: Permissions.map(p => ({\n                            ...p,\n                            active: p.name === data.access\n                        }))\n                    })).data('userRow', row);\n                }\n            });\n        };\n\n        this.onChangeTitle = function(event) {\n            var self = this,\n                $target = $(event.target),\n                val = $target.val().trim().replace(/\\s+/g, ' ');\n\n            if (!val.length) {\n                this.select('titleErrorSelector').hide();\n                return;\n            }\n\n            if (this.attr.workspaceTitles.includes(val.toLowerCase()) &&\n                val.toLowerCase() !== this.attr.currentWorkspaceTitle.toLowerCase()) {\n                this.select('titleSelector').addClass('invalid');\n                this.select('titleErrorSelector').show();\n                return;\n            } else {\n                this.select('titleSelector').removeClass('invalid');\n                this.select('titleErrorSelector').hide();\n\n                if (val !== this.attr.data.title) {\n                    if (!this.titleRevert) {\n                        this.titleRevert = $.extend(true, {}, this.attr.data);\n                    }\n                    this.attr.data.title = val;\n                    this.saveWorkspace(false, {\n                        changes: {\n                            title: val\n                        },\n                        revert: this.titleRevert\n                    }).fail(function() {\n                        $target.val(self.titleRevert.title);\n                    }).always(function() {\n                        self.titleRevert = null;\n                    });\n                }\n            }\n        };\n\n        this.onPermissionsChange = function(event) {\n            var self = this,\n                $target = $(event.target),\n                newPermissions = $target.data('permissions'),\n                list = $target.closest('.permissions-list'),\n                userRow = list.data('userRow'),\n                badge = userRow.find('.permissions'),\n                userId = userRow.data('userId'),\n                user = _.findWhere(this.attr.data.users, { userId: userId });\n\n            if (user) {\n                var revert = $.extend(true, {}, this.attr.data);\n                user.access = newPermissions;\n                badge.popover('hide').popover('disable').addClass('loading');\n                this.saveWorkspace(true, {\n                    changes: {\n                        userUpdates: [user]\n                    },\n                    revert: revert\n                })\n                    .done(function() {\n                        var newUserRow = $(shareRowTemplate(self.shareRowDataForPermission(user)));\n                        userRow.replaceWith(newUserRow);\n                        self.makePopover(newUserRow.find('.badge'));\n                    });\n            } else console.warn('Unable to update permissions because user \"' + userId + '\" not found');\n        };\n\n        this.onDelete = function(event) {\n            const $buttons = $(event.target).closest('.buttons').addClass('confirm')\n            const $confirm = this.select('confirmDeleteSelector').prop('disabled', true)\n            _.delay(() => {\n                $confirm.prop('disabled', false)\n            }, 1000)\n        };\n\n        this.onDeleteCancel = function(event) {\n            $(event.target).closest('.buttons').removeClass('confirm')\n        };\n\n        this.onDeleteConfirm = function(event) {\n            var self = this,\n                workspaceId = this.attr.data.workspaceId,\n                $target = this.select('deleteSelector'),\n                previousText = $target.text();\n\n            $target.closest('.buttons').removeClass('confirm')\n\n            this.trigger('workspaceDeleting', this.attr.data);\n\n            $target.text(i18n('workspaces.form.button.deleting')).prop('disabled', true);\n\n            this.dataRequest('workspace', 'delete', workspaceId)\n                .then(function() {\n                    self.trigger('workspaceDeleted', { workspaceId: workspaceId });\n                })\n                .catch(function() {\n                    $target.text(previousText).prop('disabled', false);\n                })\n        };\n\n        this.onRevokeAccess = function(event) {\n            var self = this,\n                list = $(event.target).closest('.permissions-list'),\n                row = list.data('userRow'),\n                userId = row.data('userId'),\n                badge = row.find('.permissions').popover('hide').popover('disable').addClass('loading'),\n                revert = $.extend(true, {}, this.attr.data);\n\n            this.attr.data.users = _.reject(this.attr.data.users, function(user) {\n                return user.userId === userId;\n            });\n            this.saveWorkspace(true, {\n                changes: {\n                    userDeletes: [userId]\n                },\n                revert: revert\n            })\n                .fail(function() {\n                    var originalHtml = badge.html();\n                    badge.removeClass('loading').addClass('badge-important').text('Error');\n                    _.delay(function() {\n                        badge.html(originalHtml).removeClass('badge-important').popover('enable');\n                    }, 2000)\n                })\n                .done(function() {\n                    row.remove();\n                    self.updateUserSelectionFilter();\n                });\n        };\n\n        this.updateUserSelectionFilter = function() {\n            this.trigger(this.select('shareFormSelector'), 'updateFilterUserIds', {\n                userIds: _.pluck(this.attr.data.users, 'userId')\n            });\n        };\n\n        this.onShareWorkspaceWithUser = function(event, data) {\n            if (this.currentUsers) {\n                this.currentUsers[data.user.id] = data.user;\n            }\n\n            var self = this,\n                form = this.select('shareFormSelector'),\n                user = {\n                    userId: data.user.id,\n                    access: 'READ'\n                },\n                row = $(shareRowTemplate(this.shareRowDataForPermission(user, data.user))).insertBefore(form),\n                badge = row.find('.permissions'),\n                revert = $.extend(true, {}, this.attr.data);\n\n            this.attr.data.users.push(user);\n\n            badge.addClass('loading');\n            this.saveWorkspace(true, {\n                changes: {\n                    userUpdates: [user]\n                },\n                revert: revert\n            })\n                .always(function() {\n                    badge.removeClass('loading');\n                    badge.popover('destroy');\n                })\n                .fail(function() {\n                    badge.addClass('badge-important').text('Error');\n                    _.delay(function() {\n                        row.remove();\n                    }, 2000);\n                })\n                .done(function() {\n                    _.defer(function() {\n                        self.makePopover(badge);\n                        self.updateUserSelectionFilter();\n                    });\n                });\n        };\n\n    }\n});\n"]}