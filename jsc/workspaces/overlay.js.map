{"version":3,"sources":["../../js/workspaces/overlay.js"],"names":["define","defineComponent","template","F","Privilege","withDataRequest","registry","documentExtensionPoint","e","LAST_SAVED_UPDATE_FREQUENCY_SECONDS","UPDATE_WORKSPACE_DIFF_SECONDS","SHOW_UNPUBLUSHED_CHANGES_SECONDS","COMMENT_ENTRY_IRI","WorkspaceOverlay","isWorkspaceDiffPost","settings","route","indexOf","url","isPost","test","type","defaultAttrs","userSelector","nameSelector","toggleTimelineSelector","after","self","menuBarWidth","requestAnimationFrame","$","width","updateDiffBadge","_","throttle","bind","$node","hide","html","updateUserTooltip","user","openlumifyData","currentUser","addClass","on","document","onWorkspaceSaving","onDidToggleDisplay","onWorkspaceSaved","onWorkspaceLoaded","onWorkspaceUpdated","onSwitchWorkspace","onGraphPaddingUpdated","toggleDiffPanel","closeDiffPanel","onToggleTimeline","trigger","scope","map","i18n","shortcuts","fire","desc","event","data","name","visible","select","show","badge","find","is","popover","css","padding","l","window","height","paddingH","paddingV","popoverCss","maxWidth","r","maxHeight","t","b","length","updatePopoverSize","tip","resizable","keys","setContent","title","editable","commentable","text","updateWithNewWorkspaceData","workspace","clearTimeout","updateTimer","previousWorkspace","workspaceId","previousDiff","remove","currentWorkspaceId","lastSaved","date","utc","Date","now","onDiffBadgeMouse","elementIds","currentDiffIds","node","insertAfter","Promise","all","dataRequest","spread","diffs","ontologyProperties","properties","ontologyConcepts","concepts","sameDiff","isEqual","vertexDiffsById","indexBy","diff","vertexId","count","alreadyCountedCompoundProperties","filteredDiffs","filter","ontologyProperty","byTitle","userVisible","vertexDiff","elementId","compoundProperty","byDependentToCompound","ontologyConcept","byId","elementConcept","alreadyCountedKey","key","contains","push","formattedCount","number","pretty","uniq","edgeId","require","Diff","placement","content","left","parseInt","position","marginLeft","top","handles","$popoverContent","toggleClass","Boolean","lookupComponent","attachTo","teardownComponent","teardownAll","removePrefixedClasses","attr","animateBadge","badgeReset","animateTimer","previousWidth","outerWidth","findWidth","delay","duration","backgroundColor","transition","TRANSITION_END","originalEvent","propertyName","off","displayName","cursor","modalTemplate","UserAccount","modal","appendTo","body","tooltip"],"mappings":"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","file":"overlay.js","sourcesContent":["\ndefine([\n    'flight/lib/component',\n    './overlay.hbs',\n    'util/formatters',\n    'util/privileges',\n    'util/withDataRequest',\n    'configuration/plugins/registry'\n], function(\n    defineComponent,\n    template,\n    F,\n    Privilege,\n    withDataRequest,\n    registry) {\n    'use strict';\n\n    /**\n     * Create new clickable sections in the user account dialog accessed when\n     * clicking the username in the case overlay.\n     *\n     * Create a key in a message bundle for the name of the section:\n     *\n     *      useraccount.page.[Identifier].displayName=[String to display]\n     *\n     * @param {string} identifier The unique identifier for this page\n     * @param {string} pageComponentPath The path to component to render in the\n     * content area of the modal.\n     */\n    registry.documentExtensionPoint('org.openlumify.user.account.page',\n        'Add new tabs to user account modal dialog',\n        function(e) {\n            return ('identifier' in e) && ('pageComponentPath' in e);\n        },\n        'http://docs.openlumify.org/extension-points/front-end/userAccount'\n    );\n\n\n    const LAST_SAVED_UPDATE_FREQUENCY_SECONDS = 30;\n    const UPDATE_WORKSPACE_DIFF_SECONDS = 5;\n    const SHOW_UNPUBLUSHED_CHANGES_SECONDS = 3;\n    const COMMENT_ENTRY_IRI = 'http://openlumify.org/comment#entry';\n\n    return defineComponent(WorkspaceOverlay, withDataRequest);\n\n    function isWorkspaceDiffPost(settings) {\n        var route = ~['workspace/undo', 'workspace/publish'].indexOf(settings.url),\n            isPost = (/post/i).test(settings.type);\n\n        return !!(route && isPost);\n    }\n\n    function WorkspaceOverlay() {\n\n        this.defaultAttrs({\n            userSelector: '.user',\n            nameSelector: '.name',\n            toggleTimelineSelector: '.toggle-timeline'\n        });\n\n        this.after('initialize', function() {\n            var self = this;\n\n            this.menuBarWidth = 30;\n            requestAnimationFrame(function() {\n                self.menuBarWidth = $('.menubar-pane').width();\n            })\n\n            this.updateDiffBadge = _.throttle(this.updateDiffBadge.bind(this), UPDATE_WORKSPACE_DIFF_SECONDS * 1000)\n\n            this.$node.hide().html(template({}));\n\n            this.updateUserTooltip({user: openlumifyData.currentUser});\n\n            requestAnimationFrame(function() {\n                self.$node.addClass('visible');\n            });\n\n            this.on(document, 'workspaceSaving', this.onWorkspaceSaving);\n            this.on(document, 'didToggleDisplay', this.onDidToggleDisplay);\n            this.on(document, 'workspaceSaved', this.onWorkspaceSaved);\n            this.on(document, 'workspaceLoaded', this.onWorkspaceLoaded);\n            this.on(document, 'workspaceUpdated', this.onWorkspaceUpdated);\n            this.on(document, 'switchWorkspace', this.onSwitchWorkspace);\n            this.on(document, 'graphPaddingUpdated', this.onGraphPaddingUpdated);\n\n            this.on(document, 'verticesUpdated', this.updateDiffBadge);\n            this.on(document, 'verticesDeleted', this.updateDiffBadge);\n            this.on(document, 'edgesUpdated', this.updateDiffBadge);\n            this.on(document, 'edgesDeleted', this.updateDiffBadge);\n            this.on(document, 'ontologyUpdated', this.updateDiffBadge);\n            this.on(document, 'textUpdated', this.updateDiffBadge);\n            this.on(document, 'updateDiff', this.updateDiffBadge);\n\n            this.on(document, 'toggleDiffPanel', this.toggleDiffPanel);\n            this.on(document, 'escape', this.closeDiffPanel);\n\n            this.on('click', {\n                toggleTimelineSelector: this.onToggleTimeline\n            });\n\n            this.trigger(document, 'registerKeyboardShortcuts', {\n                scope: ['graph.help.scope', 'map.help.scope'].map(i18n),\n                shortcuts: {\n                    'alt-d': { fire: 'toggleDiffPanel', desc: i18n('workspaces.help.show_diff') }\n                }\n            });\n\n            this.trigger(document, 'registerKeyboardShortcuts', {\n                scope: ['graph.help.scope', 'map.help.scope'].map(i18n),\n                shortcuts: {\n                    'alt-i': { fire: 'toggleTimeline', desc: i18n('workspaces.help.toggle_timeline') }\n                }\n            });\n        });\n\n        this.onDidToggleDisplay = function(event, data) {\n            if (data.name === 'products-full' && data.visible) {\n                this.select('toggleTimelineSelector').show();\n            } else if (data.visible && data.type === 'full') {\n                this.select('toggleTimelineSelector').hide()\n                this.trigger('toggleTimeline');\n            }\n        };\n\n        this.onToggleTimeline = function() {\n            this.trigger('toggleTimeline');\n        }\n\n        this.toggleDiffPanel = function() {\n            var badge = this.$node.find('.badge');\n            if (badge.is(':visible')) {\n                badge.popover('toggle');\n            }\n        };\n\n        this.closeDiffPanel = function() {\n            var badge = this.$node.find('.badge');\n            if (badge.is(':visible')) {\n                badge.popover('hide');\n            }\n        };\n\n        this.onGraphPaddingUpdated = function(event, data) {\n            this.$node.css('left', data.padding.l + this.menuBarWidth);\n\n            var width = $(window).width(),\n                height = $(window).height(),\n                popover = this.$node.find('.popover'),\n                paddingH = 100,\n                paddingV = 75,\n                popoverCss = {\n                    maxWidth: (width - this.menuBarWidth - (data.padding.l + data.padding.r) - paddingH),\n                    maxHeight: (height - (data.padding.t + data.padding.b) - paddingV)\n                };\n\n            this.popoverCss = popoverCss;\n            if (popover.length) {\n                this.updatePopoverSize(popover);\n            }\n        };\n\n        this.updatePopoverSize = function(tip) {\n            var css = {};\n            if (tip.width() > this.popoverCss.maxWidth) {\n                css.width = this.popoverCss.maxWidth + 'px';\n            }\n            if (tip.height() > this.popoverCss.maxHeight) {\n                css.height = this.popoverCss.maxHeight + 'px';\n            }\n\n            tip.resizable('option', 'maxWidth', this.popoverCss.maxWidth);\n            tip.resizable('option', 'maxHeight', this.popoverCss.maxHeight);\n            if (_.keys(css).length) {\n                tip.css(css);\n            }\n        }\n\n        this.setContent = function(title, editable, commentable) {\n            this.select('nameSelector').text(title);\n        };\n\n        this.updateWithNewWorkspaceData = function(workspace) {\n            this.setContent(\n                workspace.title,\n                workspace.editable,\n                workspace.commentable\n            );\n            clearTimeout(this.updateTimer);\n        };\n\n        this.onSwitchWorkspace = function(event, data) {\n            if (this.previousWorkspace !== data.workspaceId) {\n                this.previousDiff = null;\n                this.$node.find('.badge').popover('destroy').remove();\n            }\n        };\n\n        this.onWorkspaceLoaded = function(event, data) {\n            this.$node.show();\n            this.updateWithNewWorkspaceData(data);\n            this.previousWorkspace = data.workspaceId;\n            this.updateDiffBadge();\n        };\n\n        this.onWorkspaceUpdated = function(event, data) {\n            if (openlumifyData.currentWorkspaceId === data.workspace.workspaceId) {\n                this.updateWithNewWorkspaceData(data.workspace);\n            }\n        };\n\n        this.onWorkspaceSaving = function(event, data) {\n            clearTimeout(this.updateTimer);\n        };\n\n        this.onWorkspaceSaved = function(event, data) {\n            clearTimeout(this.updateTimer);\n            this.lastSaved = F.date.utc(Date.now());\n\n            if (data.title) {\n                this.select('nameSelector').text(data.title);\n            }\n        };\n\n        this.onDiffBadgeMouse = function(event) {\n            this.trigger(\n                event.type === 'mouseenter' ? 'focusElements' : 'defocusElements',\n                { elementIds: this.currentDiffIds || [] }\n            );\n        };\n\n        this.updateDiffBadge = function(event, data) {\n            var self = this,\n                node = this.select('nameSelector'),\n                badge = this.$node.find('.badge');\n\n            if (!badge.length) {\n                badge = $('<span class=\"badge\"></span>')\n                    .insertAfter(node)\n                    .on('mouseenter mouseleave', this.onDiffBadgeMouse.bind(this))\n            }\n\n            Promise.all([\n                this.dataRequest('workspace', 'diff'),\n                this.dataRequest('ontology', 'ontology')\n            ]).spread(function({ diffs }, { properties: ontologyProperties, concepts: ontologyConcepts }) {\n                const sameDiff = self.previousDiff && _.isEqual(diffs, self.previousDiff);\n\n                if (sameDiff) {\n                    return;\n                }\n                self.previousDiff = diffs;\n\n                var vertexDiffsById = _.indexBy(diffs, function(diff) {\n                        return diff.vertexId;\n                    }),\n                    count = 0,\n                    alreadyCountedCompoundProperties = [],\n                    filteredDiffs = _.filter(diffs, function(diff) {\n                        if (diff.type === 'PropertyDiffItem') {\n                            var ontologyProperty = ontologyProperties.byTitle[diff.name];\n                            if (!ontologyProperty ||\n                                !(ontologyProperty.userVisible || ontologyProperty.title === COMMENT_ENTRY_IRI)) {\n                                return false;\n                            }\n\n                            var vertexDiff = vertexDiffsById[diff.elementId];\n                            if (vertexDiff && diff.name === 'title') return true;\n\n                            var compoundProperty = ontologyProperties.byDependentToCompound[diff.name],\n                                ontologyConcept = ontologyConcepts.byId[diff.elementConcept];\n                            if (compoundProperty && ontologyConcept && ontologyConcept.properties.indexOf(compoundProperty) >= 0) {\n                                var alreadyCountedKey = diff.elementId + diff.key + compoundProperty;\n                                if (_.contains(alreadyCountedCompoundProperties, alreadyCountedKey)) {\n                                    return true;\n                                }\n                                alreadyCountedCompoundProperties.push(alreadyCountedKey);\n                            }\n                        }\n                        count++;\n                        return true;\n                    });\n                self.formattedCount = F.number.pretty(count);\n\n                self.currentDiffIds = _.uniq(filteredDiffs.map(function(diff) {\n                    return diff.vertexId || diff.elementId || diff.edgeId;\n                }));\n\n                require(['workspaces/diff/diff'], function(Diff) {\n                    var popover = badge.data('popover'),\n                        tip = popover && popover.tip();\n\n                    if (tip && tip.is(':visible')) {\n                        self.trigger(popover.tip().find('.popover-content'),\n                             'diffsChanged',\n                             { diffs: filteredDiffs });\n                        popover.show();\n                    } else {\n                        badge\n                            .popover('destroy')\n                            .popover({\n                                placement: 'top',\n                                content: i18n('workspaces.diff.loading'),\n                                title: i18n('workspaces.diff.header.unpublished_changes')\n                            });\n\n                        popover = badge.data('popover');\n                        tip = popover.tip();\n\n                        var left = 10;\n                        tip.css({\n                                width: '400px',\n                                height: '250px'\n                            })\n                            .data('sizePreference', 'diff')\n                            .find('.arrow').css({\n                                left: parseInt(badge.position().left - (left / 2) + 1, 10) + 'px',\n                                marginLeft: 0\n                            })\n\n                        // We fill in our own content\n                        popover.setContent = function() {}\n                        badge.on('shown', function() {\n                            var css = {\n                                top: (parseInt(tip.css('top')) - 10) + 'px'\n                            };\n                            tip.resizable({\n                                handles: 'n, e, ne',\n                                maxWidth: self.popoverCss.maxWidth,\n                                maxHeight: self.popoverCss.maxHeight\n                            }).css({top: top});\n\n                            self.updatePopoverSize(tip);\n\n                            const $popoverContent = tip.find('.popover-content');\n\n                            $popoverContent\n                                .toggleClass(\n                                    'loading-small-animate',\n                                    Boolean(!$popoverContent.lookupComponent(Diff))\n                                );\n\n                            Diff.attachTo($popoverContent, {\n                                diffs: filteredDiffs\n                            });\n                        }).on('hide', () => {\n                            tip.find('.popover-content').teardownComponent(Diff);\n                        })\n\n                        Diff.teardownAll();\n                    }\n                });\n\n                badge.removePrefixedClasses('badge-').addClass('badge-info')\n                    .attr('title', i18n('workspaces.diff.unpublished_change.' + (\n                        self.formattedCount === 1 ?\n                        'one' : 'some'), self.formattedCount))\n                    .text(count > 0 ? self.formattedCount : '');\n\n                if (count > 0) {\n                    self.animateBadge(badge);\n                } else if (count === 0) {\n                    badge.popover('destroy');\n                }\n            })\n        };\n\n        var badgeReset, animateTimer;\n        this.animateBadge = function(badge) {\n            badge.text(this.formattedCount).css('width', 'auto');\n\n            var self = this,\n                html = '<span class=\"number\">' + this.formattedCount + '</span>' +\n                    '<span class=\"suffix\"> ' + i18n('workspaces.diff.unpublished') + '</span>',\n                previousWidth = badge.outerWidth(),\n                findWidth = function() {\n                    return (\n                        badge.find('.number').outerWidth(true) +\n                        badge.find('.suffix').outerWidth(true) +\n                        parseInt(badge.css('paddingRight'), 10) * 2\n                    ) + 'px';\n                };\n\n            if (animateTimer) {\n                clearTimeout(animateTimer);\n                animateTimer = _.delay(\n                    badgeReset.bind(null, previousWidth),\n                    SHOW_UNPUBLUSHED_CHANGES_SECONDS * 1000\n                );\n                return badge.html(html).css({ width: findWidth() })\n            }\n\n            var duration = '0.5s';\n            badge.css({\n                width: previousWidth + 'px',\n                backgroundColor: '#0088cc',\n                transition: 'all cubic-bezier(.29,.79,0,1.48) ' + duration,\n                position: 'relative'\n            }).html(html);\n\n            requestAnimationFrame(function() {\n                badge.css({\n                    backgroundColor: '#1ab2ff',\n                    width: findWidth()\n                }).find('.suffix').css({\n                    transition: 'opacity ease-out ' + duration\n                })\n\n                animateTimer = _.delay((badgeReset = function(previousWidth) {\n                    animateTimer = null;\n                    badge.on(TRANSITION_END, function(e) {\n                        if (e.originalEvent.propertyName === 'width') {\n                            badge.off(TRANSITION_END);\n                            badge.text(self.formattedCount).css('width', 'auto');\n                        }\n                    }).css({\n                        transition: 'all cubic-bezier(.92,-0.42,.37,1.31) ' + duration,\n                        backgroundColor: '#0088cc',\n                        width: previousWidth + 'px'\n                    }).find('.suffix').css('opacity', 0);\n                }).bind(null, previousWidth), SHOW_UNPUBLUSHED_CHANGES_SECONDS * 1000);\n            })\n        };\n\n        this.updateUserTooltip = function(data) {\n            if (data && data.user) {\n                this.select('userSelector')\n                    .text(data.user.displayName)\n                    .css({ cursor: 'pointer' })\n                    .on('click', function() {\n                        require([\n                            'workspaces/userAccount/modal.hbs',\n                            'workspaces/userAccount/userAccount'\n                        ], function(modalTemplate, UserAccount) {\n                            var modal = $(modalTemplate({\n                                displayName: openlumifyData.currentUser.displayName\n                            })).appendTo(document.body);\n                            UserAccount.attachTo(modal);\n                            modal.modal('show');\n                        });\n                    })\n                    .tooltip({\n                        placement: 'right',\n                        title: i18n('workspaces.overlay.open.useraccount'),\n                        trigger: 'hover',\n                        delay: { show: 250, hide: 0 }\n                    })\n            }\n        }\n    }\n});\n"]}