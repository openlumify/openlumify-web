var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}define(['create-react-class','prop-types','react-virtualized-select'],function(createReactClass,PropTypes,_ref){var VirtualizedSelect=_ref.default;var _counter=1;var keyCounter=function keyCounter(){return _counter++;};var MaxValueLength=50;var transformForInput=function transformForInput(value){return(value||'').substring(0,MaxValueLength);};var createFixedCreatable=function createFixedCreatable(Creatable){var CreatablePutLast=function(_Creatable){_inherits(CreatablePutLast,_Creatable);function CreatablePutLast(props){_classCallCheck(this,CreatablePutLast);var _this=_possibleConstructorReturn(this,(CreatablePutLast.__proto__||Object.getPrototypeOf(CreatablePutLast)).call(this,props));_this.filterOptions=_.wrap(_this.filterOptions,function(fn){for(var _len=arguments.length,rest=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){rest[_key-1]=arguments[_key];}var filtered=fn.apply(_this,rest);if(filtered.length>1&&filtered[0]===_this._createPlaceholderOption){filtered.push(filtered.shift());}return filtered;});return _this;}return CreatablePutLast;}(Creatable);return CreatablePutLast;};var BaseSelect=createReactClass({displayName:'BaseSelect',propTypes:{onSelected:PropTypes.func.isRequired,valueKey:PropTypes.string.isRequired,labelKey:PropTypes.string.isRequired,options:PropTypes.array.isRequired,createForm:PropTypes.string,value:PropTypes.string,creatable:PropTypes.bool},getInitialState:function getInitialState(){return{showForm:false};},getDefaultProps:function getDefaultProps(){return{creatable:true,labelKey:'displayName',valueKey:'title'};},updateValue:function updateValue(value){this.setState({value:value});if(!value){this.props.onSelected();}else{this.props.onSelected(this.getOptionByValue(value));}},getOptionByValue:function getOptionByValue(value,props){var _ref2=props||this.props,valueKey=_ref2.valueKey,options=_ref2.options;return _.findWhere(options,_defineProperty({},valueKey,value));},componentDidMount:function componentDidMount(){if(this.props.creatable){this.setupCreatable(this.props);}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var key=this.state.key;if(key&&nextProps.iriKeys&&nextProps.iriKeys[key]){var value=nextProps.iriKeys[key];if(_.isString(value)){var option=this.getOptionByValue(value,nextProps);if(option){this.setState({value:value,key:false,error:null});this.props.onSelected(option);}}else if(_.isObject(value)&&'error'in value){this.setState({key:false,showForm:true,error:value.error||'Server Error'});}}else if(nextProps.value!==(this.state.value||this.props.value)){this.setState({value:nextProps.value});}if(nextProps.creatable!==this.props.creatable){if(nextProps.creatable){this.setupCreatable(nextProps);}else{this.setState({selectComponent:null,CreateForm:null});}}},render:function render(){var _this2=this;var _state=this.state,creating=_state.creating,showForm=_state.showForm,value=_state.value,CreateForm=_state.CreateForm,selectComponent=_state.selectComponent,key=_state.key,error=_state.error,type=_state.type;var _props=this.props,formProps=_props.formProps,defaultValue=_props.value,creatable=_props.creatable,createForm=_props.createForm,disabled=_props.disabled,placeholder=_props.placeholder,rest=_objectWithoutProperties(_props,['formProps','value','creatable','createForm','disabled','placeholder']);var hasKey=Boolean(key);var extendedFormProps=_extends({},formProps||{},{type:type,transformForSubmit:this.transformForSubmit,transformForInput:transformForInput});return React.createElement('div',null,creating&&showForm&&CreateForm?React.createElement(CreateForm,_extends({displayName:creating,onCancel:this.onCancel,onCreate:this.onCreate,error:error},extendedFormProps)):React.createElement(VirtualizedSelect,_extends({ref:function ref(r){_this2._virtualized=r;},simpleValue:true,clearable:true,searchable:true,isLoading:hasKey,disabled:disabled||hasKey,placeholder:hasKey?i18n('ontology.selector.placeholder'):placeholder,selectComponent:selectComponent,promptTextCreator:function promptTextCreator(label){return i18n('ontology.selector.prompt',label);},newOptionCreator:_.memoize(function(_ref3){var _ref4;var label=_ref3.label,labelKey=_ref3.labelKey,valueKey=_ref3.valueKey;return _ref4={},_defineProperty(_ref4,valueKey,label),_defineProperty(_ref4,labelKey,label),_defineProperty(_ref4,'className','Select-create-option-placeholder'),_ref4;},function(_ref5){var label=_ref5.label;return label;}),value:_.isString(value)?value:defaultValue,onChange:this.updateValue,onNewOptionClick:this.onNewOptionClick,optionRenderer:nameOptionRenderer(this.props.depthKey,this.props.pathKey),optionHeight:28,matchProp:'label'},rest)));},transformForSubmit:function transformForSubmit(value){var _props2=this.props,options=_props2.options,labelKey=_props2.labelKey;var transformed=transformForInput(value).trim();var valid=transformed.length>0;var matchesExisting=valid&&_.any(options,function(o){return o[labelKey].toLowerCase()===transformed.toLowerCase();});if(matchesExisting){return{valid:false,value:transformed,reason:i18n('ontology.form.displayname.error.duplicate')};}return{valid:valid,value:transformed,reason:valid?null:i18n('ontology.form.displayname.error.empty')};},setupCreatable:function setupCreatable(props){var _this3=this;var ref=this._virtualized;var Select=ref._getSelectComponent();if(Select){var Creatable=Select.Creatable;this.setState({selectComponent:createFixedCreatable(Creatable)});}else{throw new Error('Internal structure of select has changed');}if(props.createForm){Promise.require(props.createForm).then(function(CreateForm){_this3.setState({CreateForm:CreateForm});});}else throw new Error('Create form prop required when creatable');},onCancel:function onCancel(){this.setState({showForm:false});},onCreate:function onCreate(option){var _transformForSubmit=this.transformForSubmit(option.displayName),valid=_transformForSubmit.valid,value=_transformForSubmit.value;if(valid){option.displayName=value;var key=keyCounter();this.props.onCreate(option,{key:key});var type=option.type,displayName=option.displayName;this.setState({showForm:false,key:key,creating:displayName,type:type});}},onNewOptionClick:function onNewOptionClick(option){this.setState({showForm:true,error:null,creating:option[this.props.labelKey],type:null});this.props.onSelected();}});return BaseSelect;function nameOptionRenderer(){var depthKey=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'depth';var pathKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'path';return function NameOptionRenderer(_ref6){var focusedOption=_ref6.focusedOption,focusedOptionIndex=_ref6.focusedOptionIndex,focusOption=_ref6.focusOption,key=_ref6.key,labelKey=_ref6.labelKey,option=_ref6.option,optionIndex=_ref6.optionIndex,options=_ref6.options,selectValue=_ref6.selectValue,style=_ref6.style,valueArray=_ref6.valueArray;var className=['VirtualizedSelectOption'];if(option.className){className.push(option.className);}if(option===focusedOption){className.push('VirtualizedSelectFocusedOption');}if(option.disabled){className.push('VirtualizedSelectDisabledOption');}if(option.header){className.push('VirtualizedSelectHeader');}if(valueArray&&valueArray.indexOf(option)>=0){className.push('VirtualizedSelectSelectedOption');}var events=option.disabled?{}:{onClick:function onClick(){return selectValue(option);},onMouseOver:function onMouseOver(){return focusOption(option);}};var indent=(option[depthKey]||0)*15;if(option.header){return React.createElement('div',{className:className.join(' '),key:key,style:style},option[labelKey]);}var iconStyles=option.domainGlyphIconHref?{backgroundSize:'auto 80%'}:{};return React.createElement('div',_extends({className:className.join(' '),key:key,style:_extends({},style,{paddingLeft:indent+'px'}),title:''+(option[pathKey]||option[labelKey])+(option.displayNameSub?'\n'+option.displayNameSub:'')},events),option.glyphIconHref?React.createElement('div',{className:'icon',style:_extends({},iconStyles,{backgroundImage:'url('+option.glyphIconHref+')'})}):option.domainGlyphIconHref&&option.rangeGlyphIconHref?React.createElement('div',{style:{display:'inline-flex',alignItems:'center'}},React.createElement('div',{className:'icon',style:_extends({},iconStyles,{margin:'0 0 0 5px',backgroundImage:'url('+option.domainGlyphIconHref+')'})}),'\u2192',React.createElement('div',{className:'icon',style:_extends({},iconStyles,{margin:'0 5px 0 0',backgroundImage:'url('+option.rangeGlyphIconHref+')'})})):React.createElement('div',{className:'icon',style:{width:'6px',margin:'0'}}),option[labelKey]);};}});
//# sourceMappingURL=BaseSelect.js.map
