{"version":3,"sources":["../../js/components/ElementContextMenu.jsx"],"names":["define","createReactClass","PropTypes","registry","F","withDataRequest","DIVIDER","MENU_ITEM_SHAPE","shape","shouldDisable","func","canHandle","label","string","isRequired","submenu","arrayOf","any","cls","shortcut","subtitle","options","insertIntoMenuItems","ElementContextMenuList","propTypes","element","elementTitle","items","oneOfType","domElement","onMenuItemClick","handleMenuItemClick","item","props","render","map","itemIndex","bind","ElementContextMenuItem","onClick","getInitialState","disabled","componentWillMount","currentSelection","openlumifyData","selectedObjects","vertexIds","_","isFunction","id","setState","handleClick","event","preventDefault","state","getLabel","template","title","hasSubmenu","length","getClassName","getLinkClassName","renderShortcut","renderSubtitle","renderSubmenu","ElementContextMenu","vertexId","edgeIds","collapsedItemId","position","x","number","y","getElement","Promise","resolve","dataRequest","isCollapsedItem","isVertex","then","elements","Error","createCollapsedItemMenuItems","createVertexMenuItems","createEdgeMenuItems","firstElement","isArray","extensionsForPoint","filter","selection","amount","Object","keys","forEach","push","i18n","truncate","vertex","edge","catch","err","console","error","$","trigger","args","collapsedNodeId","positionMenu","refs","menuDiv","padding","windowSize","window","width","height","menu","children","menuSize","outerWidth","outerHeight","find","submenuSize","placement","left","Math","min","top","submenuPlacement","right","bottom","extend","parent","addClass","css","componentDidMount","componentDidUpdate","currentWorkspaceEditable","select","target"],"mappings":"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","file":"ElementContextMenu.js","sourcesContent":["define([\n    'create-react-class',\n    'prop-types',\n    'configuration/plugins/registry',\n    'util/vertex/formatters',\n    'util/withDataRequest'\n], function(createReactClass, PropTypes, registry, F, withDataRequest) {\n    'use strict';\n\n    const DIVIDER = 'DIVIDER';\n\n    const MENU_ITEM_SHAPE = PropTypes.shape({\n        // function(currentSelection, elementId, DOMElement, element): return true if this item should be disabled\n        shouldDisable: PropTypes.func,\n\n        // function(currentSelection, element): return true if this item can handle the given vertex\n        canHandle: PropTypes.func,\n\n        // The primary label to display\n        label: PropTypes.string.isRequired,\n\n        // optional sub-menu\n        submenu: PropTypes.arrayOf(PropTypes.any),\n\n        // CSS class to apply\n        cls: PropTypes.string,\n\n        // Keyboard shortcut\n        shortcut: PropTypes.string,\n\n        // subtitle to display under the primary label\n        subtitle: PropTypes.string,\n\n        options: PropTypes.shape({\n            insertIntoMenuItems: PropTypes.func\n        })\n    });\n\n    const ElementContextMenuList = createReactClass({\n        propTypes: {\n            // the element that was clicked on\n            element: PropTypes.any,\n\n            // the collapsed item, vertex, or edge title\n            elementTitle: PropTypes.string.isRequired,\n\n            // the menu items to render\n            items: PropTypes.arrayOf(\n                PropTypes.oneOfType([\n                    MENU_ITEM_SHAPE,\n                    PropTypes.string\n                ])\n            ).isRequired,\n\n            // the DOM element that originated the menu\n            domElement: PropTypes.any.isRequired,\n\n            // callback when a menu item is clicked\n            onMenuItemClick: PropTypes.func.isRequired\n        },\n\n        handleMenuItemClick(item) {\n            this.props.onMenuItemClick(item);\n        },\n\n        render() {\n            const { items, element, elementTitle, domElement, onMenuItemClick } = this.props;\n\n            return (\n                <ul className=\"dropdown-menu\" role=\"menu\">\n                    {this.props.items.map((item, itemIndex) => {\n                        if (item === DIVIDER) {\n                            return (<li key={itemIndex} className=\"divider\"/>);\n                        } else {\n                            return (\n                                <ElementContextMenuItem\n                                    key={itemIndex}\n                                    elementTitle={elementTitle}\n                                    item={item}\n                                    domElement={domElement}\n                                    element={element}\n                                    onClick={this.handleMenuItemClick.bind(this, item)}\n                                    onMenuItemClick={onMenuItemClick}\n                                />\n                            );\n                        }\n                    })}\n                </ul>\n            );\n        }\n    });\n\n    const ElementContextMenuItem = createReactClass({\n        propTypes: {\n            // the element that was clicked on\n            element: PropTypes.any,\n\n            // the collapsed item, vertex, or edge title\n            elementTitle: PropTypes.string.isRequired,\n\n            // the menu item to render\n            item: MENU_ITEM_SHAPE,\n\n            // the DOM element that originated the menu\n            domElement: PropTypes.any.isRequired,\n\n            // callback to call when this item is clicked\n            onClick: PropTypes.func.isRequired,\n\n            // callback when a menu item is clicked (needed to pass to submenus)\n            onMenuItemClick: PropTypes.func.isRequired\n        },\n\n        getInitialState() {\n            return {\n                disabled: true\n            };\n        },\n\n        componentWillMount() {\n            const { element, domElement, item } = this.props;\n            const currentSelection = openlumifyData.selectedObjects.vertexIds;\n            const disabled = _.isFunction(item.shouldDisable)\n                ? this.props.item.shouldDisable(currentSelection, element.id, domElement, element)\n                : false;\n\n            this.setState({\n                disabled: disabled\n            });\n        },\n\n        handleClick(event) {\n            event.preventDefault();\n            if (!this.state.disabled) {\n                this.props.onClick();\n            }\n        },\n\n        getLabel() {\n            return _.template(this.props.item.label)({\n                title: this.props.elementTitle\n            });\n        },\n\n        hasSubmenu() {\n            return this.props.item.submenu && this.props.item.submenu.length;\n        },\n\n        getClassName() {\n            return (this.props.item.cls || '')\n                + (this.hasSubmenu() ? ' dropdown-submenu' : '')\n                + (this.state.disabled ? ' disabled' : '');\n        },\n\n        getLinkClassName() {\n            return (this.props.item.shortcut ? 'has-shortcut' : '')\n                + (this.props.item.subtitle ? ' has-subtitle' : '')\n                + (this.hasSubmenu() ? ' has-submenu' : '');\n        },\n\n        renderShortcut() {\n            const label = this.props.item.shortcut\n                ? F.string.shortcut(this.props.item.shortcut)\n                : null;\n            if (label) {\n                return (<span className=\"shortcut\">{label}</span>);\n            }\n            return null;\n        },\n\n        renderSubtitle() {\n            if (this.props.item.subtitle) {\n                return (<span className=\"subtitle\">{this.props.item.subtitle}</span>);\n            }\n        },\n\n        renderSubmenu() {\n            if (this.hasSubmenu()) {\n                return (<ElementContextMenuList items={this.props.item.submenu} elementTitle={this.props.elementTitle}\n                                                domElement={this.props.domElement} element={this.props.element}\n                                                onMenuItemClick={this.props.onMenuItemClick}/>);\n            }\n            return null;\n        },\n\n        render() {\n            return (\n                <li className={this.getClassName()}>\n                    <a className={this.getLinkClassName()} tabIndex=\"-1\" href=\"#\"\n                       onClick={this.handleClick}>{this.getLabel()}\n                        {this.hasSubmenu() ? '…' : ''}\n                        {this.renderShortcut()}\n                        {this.renderSubtitle()}\n                    </a>\n                    {this.renderSubmenu()}\n                </li>\n            );\n        }\n    });\n\n    const ElementContextMenu = createReactClass({\n        propTypes: {\n            // can be a collapsedItemId, vertexId, or edgeIds\n            vertexId: PropTypes.string,\n            edgeIds: PropTypes.arrayOf(PropTypes.string),\n            collapsedItemId: PropTypes.string,\n\n            // the position to display the menu\n            position: PropTypes.shape({\n                x: PropTypes.number,\n                y: PropTypes.number\n            }).isRequired,\n\n            // the DOM element that originated the menu\n            domElement: PropTypes.any.isRequired\n        },\n\n        getInitialState() {\n            return {\n                items: [],\n                title: 'Loading...'\n            };\n        },\n\n        getElement() {\n            if (this.props.collapsedItemId) {\n                return Promise.resolve({\n                    collapsedItemId: this.props.collapsedItemId\n                });\n            } else if (this.props.vertexId) {\n                return withDataRequest.dataRequest('vertex', 'store', {vertexIds: this.props.vertexId});\n            } else {\n                return withDataRequest.dataRequest('edge', 'store', {edgeIds: this.props.edgeIds});\n            }\n        },\n\n        componentWillMount() {\n            const isCollapsedItem = !!this.props.collapsedItemId;\n            const isVertex = !!this.props.vertexId;\n            this.getElement()\n                .then((elements) => {\n                    if (!isCollapsedItem && (!elements || elements.length === 0)) {\n                        throw new Error(`Could not find element: ${this.props.vertexId || this.props.edgeIds}`);\n                    }\n\n                    const items = isCollapsedItem\n                        ? this.createCollapsedItemMenuItems()\n                        : isVertex\n                            ? this.createVertexMenuItems()\n                            : this.createEdgeMenuItems();\n                    const firstElement = _.isArray(elements)\n                        ? elements[0]\n                        : elements;\n                    const currentSelection = isVertex\n                        ? openlumifyData.selectedObjects.vertexIds\n                        : openlumifyData.selectedObjects.edgeIds;\n\n                    registry.extensionsForPoint(`org.openlumify.${isCollapsedItem ? 'collapsedItem' : isVertex ? 'vertex' : 'edge'}.menu`)\n                        .filter(item => {\n                            if (item.selection) {\n                                const amount = firstElement.id in currentSelection\n                                    ? Object.keys(currentSelection).length\n                                    : _.isArray(elements)\n                                        ? elements.length\n                                        : 1;\n                                return item.selection === amount;\n                            } else {\n                                return true\n                            }\n                        })\n                        .forEach(item => {\n                            const canHandle = _.isFunction(item.canHandle) ? item.canHandle(currentSelection, elements) : true;\n\n                            if (!canHandle) {\n                                return;\n                            }\n\n                            if (item.options && _.isFunction(item.options.insertIntoMenuItems)) {\n                                item.options.insertIntoMenuItems(item, items);\n                            } else {\n                                items.push(item);\n                            }\n                        });\n\n                    const title = isCollapsedItem\n                        ? i18n('vertex.contextmenu.collapsed')\n                        : elements.length > 1\n                            ? i18n('vertex.contextmenu.multiple')\n                            : isVertex\n                                ? F.string.truncate(F.vertex.title(firstElement), 3)\n                                : F.string.truncate(F.edge.title(firstElement), 3);\n\n                    this.setState({\n                        domElement: this.props.domElement,\n                        element: firstElement,\n                        title: title,\n                        items: items\n                    });\n                })\n                .catch((err) => {\n                    console.error('Could not get menu items', err);\n                    this.setState({\n                        domElement: this.props.domElement,\n                        element: null,\n                        title: 'Error',\n                        items: []\n                    });\n                });\n        },\n\n        handleMenuItemClick(item) {\n            $(this.state.domElement).trigger(\n                item.event,\n                {\n                    ...item.args,\n                    collapsedNodeId: this.props.collapsedItemId,\n                    vertexId: this.props.vertexId,\n                    edgeIds: this.props.edgeIds\n                }\n            );\n        },\n\n        positionMenu(position) {\n            if (!this.refs.menuDiv) {\n                return;\n            }\n            const padding = 10;\n            const windowSize = {x: $(window).width(), y: $(window).height()};\n            const menu = $(this.refs.menuDiv).children('.dropdown-menu');\n            const menuSize = {x: menu.outerWidth(true), y: menu.outerHeight(true)};\n            const submenu = menu.find('li.dropdown-submenu ul');\n            const submenuSize = menuSize;\n            const placement = {\n                left: Math.min(\n                    position.x,\n                    windowSize.x - menuSize.x - padding\n                ),\n                top: Math.min(\n                    position.y,\n                    windowSize.y - menuSize.y - padding\n                )\n            };\n            let submenuPlacement = {left: '100%', right: 'auto', top: 0, bottom: 'auto'};\n            if ((placement.left + menuSize.x + submenuSize.x + padding) > windowSize.x) {\n                submenuPlacement = $.extend(submenuPlacement, {right: '100%', left: 'auto'});\n            }\n            if ((placement.top + menuSize.y + (submenu.children('li').length * 26) + padding) > windowSize.y) {\n                submenuPlacement = $.extend(submenuPlacement, {top: 'auto', bottom: '0'});\n            }\n\n            menu.parent('div')\n                .addClass('open')\n                .css($.extend({position: 'absolute'}, placement));\n            submenu.css(submenuPlacement);\n        },\n\n        componentDidMount() {\n            this.positionMenu(this.props.position);\n        },\n\n        componentDidUpdate() {\n            this.positionMenu(this.props.position);\n        },\n\n        render() {\n            const { items, title, element } = this.state;\n\n            return (items.length ?\n                <div className=\"vertex-menu\" ref=\"menuDiv\">\n                    <ElementContextMenuList\n                        items={items}\n                        elementTitle={title}\n                        domElement={this.props.domElement}\n                        element={element}\n                        onMenuItemClick={this.handleMenuItemClick}\n                    />\n                </div>\n            : null);\n        },\n\n        createCollapsedItemMenuItems() {\n            const items = [\n                {\n                    label: i18n('vertex.contextmenu.collapsed-node.rename'),\n                    event: 'editCollapsedNode',\n                    canHandle: () => openlumifyData.currentWorkspaceEditable\n                },\n                {\n                    label: i18n('vertex.contextmenu.collapsed-node.select.contents'),\n                    submenu: [\n                        {\n                            label: i18n('vertex.contextmenu.collapsed-node.select.all'),\n                            event: 'selectCollapsedNodeContents',\n                            args: { select: 'all' }\n                        },\n                        {\n                            label: i18n('vertex.contextmenu.collapsed-node.select.none'),\n                            event: 'selectCollapsedNodeContents',\n                            args: { select: 'none' }\n                        },\n                        {\n                            label: i18n('vertex.contextmenu.collapsed-node.select.vertices'),\n                            event: 'selectCollapsedNodeContents',\n                            args: { select: 'vertices' }\n                        },\n                        {\n                            label: i18n('vertex.contextmenu.collapsed-node.select.edges'),\n                            event: 'selectCollapsedNodeContents',\n                            args: { select: 'edges' }\n                        }\n                    ]\n                },\n                DIVIDER,\n                {\n                    label: i18n('vertex.contextmenu.collapsed-node.uncollapse'),\n                    event: 'uncollapse',\n                    canHandle: () => openlumifyData.currentWorkspaceEditable\n                }\n            ];\n\n            return items.filter(item => _.isFunction(item.canHandle) ? item.canHandle() : true);\n        },\n\n        createEdgeMenuItems() {\n            return [\n                {\n                    label: i18n('vertex.contextmenu.open'),\n                    submenu: [\n                        {\n                            label: i18n('vertex.contextmenu.open.fullscreen'),\n                            subtitle: i18n('vertex.contextmenu.open.fullscreen.subtitle'),\n                            event: 'openFullscreen'\n                        }\n                    ]\n                }\n            ];\n        },\n\n        createVertexMenuItems() {\n            return [\n                {\n                    label: i18n('vertex.contextmenu.open'),\n                    submenu: [\n                        {\n                            label: i18n('vertex.contextmenu.open.fullscreen'),\n                            subtitle: i18n('vertex.contextmenu.open.fullscreen.subtitle'),\n                            event: 'openFullscreen'\n                        }\n                    ]\n                },\n                {\n                    label: i18n('vertex.contextmenu.select'),\n                    submenu: [\n                        {\n                            label: i18n('vertex.contextmenu.select.connected'),\n                            subtitle: i18n('vertex.contextmenu.select.connected.subtitle'),\n                            shortcut: 'meta-e',\n                            event: 'selectConnected'\n                        }\n                    ]\n                },\n                {\n                    label: i18n('vertex.contextmenu.search'),\n                    submenu: [\n                        {\n                            label: '{ title }',\n                            shortcut: 'alt+t',\n                            event: 'searchTitle',\n                            selection: 1\n                        },\n                        {\n                            label: i18n('graph.contextmenu.search.related'),\n                            subtitle: i18n('graph.contextmenu.search.related.subtitle'),\n                            shortcut: 'alt+s',\n                            event: 'searchRelated',\n                            selection: 1\n                        }\n                    ]\n                },\n                DIVIDER,\n                {\n                    label: i18n('vertex.contextmenu.remove'),\n                    shortcut: 'delete',\n                    subtitle: i18n('vertex.contextmenu.remove.subtitle'),\n                    event: 'deleteSelected',\n                    shouldDisable: function(selection, vertexId, target) {\n                        return !openlumifyData.currentWorkspaceEditable || false;\n                        // TODO:  !inWorkspace(vertexId);\n                    }\n                }\n            ];\n        }\n    });\n\n    return ElementContextMenu;\n});\n"]}